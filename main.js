/*! For license information please see main.js.LICENSE.txt */
(()=>{var e={1208:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var n=r(1601),i=r.n(n),o=r(6314),a=r.n(o)()(i());a.push([e.id,"html {\n  font-family: Arial;\n  color: #4c4c4c;\n}\nbody {\n  padding: 8px;\n}\nbutton {\n  cursor: pointer;\n}\ntd {\n  border: none;\n}\nli {\n  margin-bottom: 12px;\n}\n.labeledItem {\n  display: inline-block;\n  margin: 0 8px 8px 0;\n}\n.display-none {\n  display: none;\n}\nlabel {\n  margin-top: 5px;\n}\n",""]);const s=a},6314:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var r="",n=void 0!==t[5];return t[4]&&(r+="@supports (".concat(t[4],") {")),t[2]&&(r+="@media ".concat(t[2]," {")),n&&(r+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),r+=e(t),n&&(r+="}"),t[2]&&(r+="}"),t[4]&&(r+="}"),r})).join("")},t.i=function(e,r,n,i,o){"string"==typeof e&&(e=[[null,e,void 0]]);var a={};if(n)for(var s=0;s<this.length;s++){var u=this[s][0];null!=u&&(a[u]=!0)}for(var c=0;c<e.length;c++){var l=[].concat(e[c]);n&&a[l[0]]||(void 0!==o&&(void 0===l[5]||(l[1]="@layer".concat(l[5].length>0?" ".concat(l[5]):""," {").concat(l[1],"}")),l[5]=o),r&&(l[2]?(l[1]="@media ".concat(l[2]," {").concat(l[1],"}"),l[2]=r):l[2]=r),i&&(l[4]?(l[1]="@supports (".concat(l[4],") {").concat(l[1],"}"),l[4]=i):l[4]="".concat(i)),t.push(l))}},t}},1601:e=>{"use strict";e.exports=function(e){return e[1]}},5072:e=>{"use strict";var t=[];function r(e){for(var r=-1,n=0;n<t.length;n++)if(t[n].identifier===e){r=n;break}return r}function n(e,n){for(var o={},a=[],s=0;s<e.length;s++){var u=e[s],c=n.base?u[0]+n.base:u[0],l=o[c]||0,d="".concat(c," ").concat(l);o[c]=l+1;var p=r(d),f={css:u[1],media:u[2],sourceMap:u[3],supports:u[4],layer:u[5]};if(-1!==p)t[p].references++,t[p].updater(f);else{var m=i(f,n);n.byIndex=s,t.splice(s,0,{identifier:d,updater:m,references:1})}a.push(d)}return a}function i(e,t){var r=t.domAPI(t);return r.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;r.update(e=t)}else r.remove()}}e.exports=function(e,i){var o=n(e=e||[],i=i||{});return function(e){e=e||[];for(var a=0;a<o.length;a++){var s=r(o[a]);t[s].references--}for(var u=n(e,i),c=0;c<o.length;c++){var l=r(o[c]);0===t[l].references&&(t[l].updater(),t.splice(l,1))}o=u}}},7659:e=>{"use strict";var t={};e.exports=function(e,r){var n=function(e){if(void 0===t[e]){var r=document.querySelector(e);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(e){r=null}t[e]=r}return t[e]}(e);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(r)}},540:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},5056:(e,t,r)=>{"use strict";e.exports=function(e){var t=r.nc;t&&e.setAttribute("nonce",t)}},7825:e=>{"use strict";e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(r){!function(e,t,r){var n="";r.supports&&(n+="@supports (".concat(r.supports,") {")),r.media&&(n+="@media ".concat(r.media," {"));var i=void 0!==r.layer;i&&(n+="@layer".concat(r.layer.length>0?" ".concat(r.layer):""," {")),n+=r.css,i&&(n+="}"),r.media&&(n+="}"),r.supports&&(n+="}");var o=r.sourceMap;o&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleTagTransform(n,e,t.options)}(t,e,r)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},1113:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},5302:(e,t,r)=>{"use strict";r.d(t,{N:()=>o,w:()=>a});var n=r(5854),i=r(5500);function o(e){var t=(0,i.e)(e)+"/community/groups/"+e.id+"/protect";return(0,n.Em)(t,e)}function a(e){var t=(0,i.e)(e)+"/community/groups/"+e.id+"/unprotect";return(0,n.Em)(t,e)}},6349:(e,t,r)=>{"use strict";r.d(t,{Y:()=>a});var n=r(5478),i=r(5854),o=r(5500);function a(e){var t=(0,o.e)(e)+"/community/groups/"+e.id+"/delete",r=(0,n.Cl)({},e);return(0,i.Em)(t,r)}},6155:(e,t,r)=>{"use strict";r.d(t,{Gq:()=>a,JA:()=>l,MB:()=>u,S9:()=>c});var n=r(5478),i=r(5854),o=r(5500);function a(e,t){var r=s(e,t),o=(0,n.Cl)({httpMethod:"GET"},t);return(0,i.Em)(r,o)}var s=function(e,t){return("string"==typeof t?t:(0,o.e)(t))+"/content/items/"+e};function u(e,t){var r=s(e,t)+"/data",o=(0,n.Cl)({httpMethod:"GET",params:{}},t);return o.file&&(o.params.f=null),(0,i.Em)(r,o).catch((function(e){if(!RegExp(/The string did not match the expected pattern|(Unexpected end of (JSON input|data at line 1 column 1))/i).test(e.message))throw e}))}function c(e){var t=s(e.id,e)+"/relatedItems",r=(0,n.Cl)({httpMethod:"GET",params:{direction:e.direction}},e);return"string"==typeof e.relationshipType?r.params.relationshipType=e.relationshipType:r.params.relationshipTypes=e.relationshipType,delete r.direction,delete r.relationshipType,(0,i.Em)(t,r)}function l(e,t){var r=s(e,t)+"/resources",o=(0,n.Cl)({},t);return o.params=(0,n.Cl)({num:1e3},o.params),(0,i.Em)(r,o)}},5500:(e,t,r)=>{"use strict";r.d(t,{e:()=>i});var n=r(6380);function i(e){return void 0===e&&(e={}),e.portal?(0,n.T)(e.portal):e.authentication?e.authentication.portal:"https://www.arcgis.com/sharing/rest"}},5854:(e,t,r)=>{"use strict";r.d(t,{Em:()=>d,qX:()=>u,yk:()=>l});var n=r(5478),i=r(8639),o=r(2898),a=r(7603),s=r(2689),u="@esri/arcgis-rest-js",c={httpMethod:"POST",params:{f:"json"}},l=function(e){function t(t,r,n,i,o){void 0===t&&(t="AUTHENTICATION_ERROR"),void 0===r&&(r="AUTHENTICATION_ERROR_CODE");var a=e.call(this,t,r,n,i,o)||this;return a.name="ArcGISAuthError",a.message="AUTHENTICATION_ERROR_CODE"===r?t:r+": "+t,a}return(0,n.C6)(t,e),t.prototype.retry=function(e,t){var r=this;void 0===t&&(t=3);var i=0,o=function(a,s){e(r.url,r.options).then((function(e){var t=(0,n.Cl)((0,n.Cl)({},r.options),{authentication:e});return i+=1,d(r.url,t)})).then((function(e){a(e)})).catch((function(e){"ArcGISAuthError"===e.name&&i<t?o(a,s):"ArcGISAuthError"===e.name&&i>=t?s(r):s(e)}))};return new Promise((function(e,t){o(e,t)}))},t}(s.L);function d(e,t){void 0===t&&(t={params:{f:"json"}});var r=(0,n.Cl)((0,n.Cl)((0,n.Cl)({httpMethod:"POST"},c),t),{params:(0,n.Cl)((0,n.Cl)({},c.params),t.params),headers:(0,n.Cl)((0,n.Cl)({},c.headers),t.headers)}),d=[],p=[];if(r.fetch||"undefined"==typeof fetch?(d.push("`fetch`"),p.push("`node-fetch`")):r.fetch=fetch.bind(Function("return this")()),"undefined"==typeof Promise&&(d.push("`Promise`"),p.push("`es6-promise`")),"undefined"==typeof FormData&&(d.push("`FormData`"),p.push("`isomorphic-form-data`")),!r.fetch||"undefined"==typeof Promise||"undefined"==typeof FormData)throw new Error("`arcgis-rest-request` requires a `fetch` implementation and global variables for `Promise` and `FormData` to be present in the global scope. You are missing "+d.join(", ")+". We recommend installing the "+p.join(", ")+" modules at the root of your application to add these to the global scope. See https://bit.ly/2KNwWaJ for more info.");var f=r.httpMethod,m=r.authentication,h=r.rawResponse,g=(0,n.Cl)({f:"json"},r.params),y=null,v={method:f,credentials:r.credentials||"same-origin"};return r.headers&&r.headers["X-Esri-Auth-Client-Id"]&&e.indexOf("/oauth2/platformSelf")>-1&&(v.credentials="include"),(m?m.getToken(e,{fetch:r.fetch}).catch((function(t){return t.url=e,t.options=r,y=t,Promise.resolve("")})):Promise.resolve("")).then((function(t){t.length&&(g.token=t),m&&m.getDomainCredentials&&(v.credentials=m.getDomainCredentials(e));var s={};if("GET"===v.method){g.token&&r.hideToken&&"undefined"==typeof window&&(s["X-Esri-Authorization"]="Bearer "+g.token,delete g.token);var c=""===(0,o.G)(g)?e:e+"?"+(0,o.G)(g);r.maxUrlLength&&c.length>r.maxUrlLength||g.token&&r.hideToken?(v.method="POST",t.length&&r.hideToken&&(g.token=t,delete s["X-Esri-Authorization"])):e=c}var l=new RegExp("/items/.+/updateResources").test(e);return"POST"===v.method&&(v.body=(0,i.b)(g,l)),v.headers=(0,n.Cl)((0,n.Cl)({},s),r.headers),"undefined"!=typeof window||v.headers.referer||(v.headers.referer=u),(0,a.Z)(g)||l||(v.headers["Content-Type"]="application/x-www-form-urlencoded"),r.fetch(e,v)})).then((function(t){if(!t.ok){var n=t.status,i=t.statusText;throw new s.L(i,"HTTP "+n,t,e,r)}if(h)return t;switch(g.f){case"json":case"geojson":return t.json();case"html":case"text":return t.text();default:return t.blob()}})).then((function(t){if("json"!==g.f&&"geojson"!==g.f||h)return t;var n=function(e,t,r,n,i){if(e.code>=400){var o=e.message,a=e.code;throw new s.L(o,a,e,t,n)}if(e.error){var u=e.error,c=(o=u.message,a=u.code,u.messageCode),d=c||a||"UNKNOWN_ERROR_CODE";if(498===a||499===a||"GWM_0003"===c||400===a&&"Unable to generate token."===o)throw i||new l(o,d,e,t,n);throw new s.L(o,d,e,t,n)}if("failed"===e.status||"failure"===e.status){o=void 0,a="UNKNOWN_ERROR_CODE";try{o=JSON.parse(e.statusMessage).message,a=JSON.parse(e.statusMessage).code}catch(t){o=e.statusMessage||e.message}throw new s.L(o,a,e,t,n)}return e}(t,e,0,r,y);if(y){var i=e.toLowerCase().split(/\/rest(\/admin)?\/services\//)[0];r.authentication.federatedServers[i]={token:[],expires:new Date(Date.now()+864e5)},y=null}return n}))}},2689:(e,t,r)=>{"use strict";r.d(t,{L:()=>n});var n=function(e,t,r,n,i){e=e||"UNKNOWN_ERROR",t=t||"UNKNOWN_ERROR_CODE",this.name="ArcGISRequestError",this.message="UNKNOWN_ERROR_CODE"===t?e:t+": "+e,this.originalMessage=e,this.code=t,this.response=r,this.url=n,this.options=i};n.prototype=Object.create(Error.prototype),n.prototype.constructor=n},6380:(e,t,r)=>{"use strict";function n(e){return"string"!=typeof e||"/"===(e=e.trim())[e.length-1]&&(e=e.slice(0,-1)),e}r.d(t,{T:()=>n})},8639:(e,t,r)=>{"use strict";r.d(t,{b:()=>o});var n=r(7603),i=r(2898);function o(e,t){var r=(0,n.Z)(e)||t,o=(0,n.y)(e);if(r){var a=new FormData;return Object.keys(o).forEach((function(e){if("undefined"!=typeof Blob&&o[e]instanceof Blob){var t=o.fileName||o[e].name||e;a.append(e,o[e],t)}else o[e].constructor&&"ReadStream"===o[e].constructor.name&&Number.isInteger(o.dataSize)?a.append(e,o[e],{knownLength:o.dataSize}):a.append(e,o[e])})),a}return(0,i.G)(e)}},2898:(e,t,r)=>{"use strict";r.d(t,{G:()=>o});var n=r(7603);function i(e,t){return Array.isArray(t)&&t[0]&&Array.isArray(t[0])?t.map((function(t){return i(e,t)})).join("&"):encodeURIComponent(e)+"="+encodeURIComponent(t)}function o(e){var t=(0,n.y)(e);return Object.keys(t).map((function(e){return i(e,t[e])})).join("&")}},7603:(e,t,r)=>{"use strict";function n(e){return Object.keys(e).some((function(t){var r=e[t];if(!r)return!1;switch(r&&r.toParam&&(r=r.toParam()),r.constructor.name){case"Array":case"Object":case"Date":case"Function":case"Boolean":case"String":case"Number":return!1;default:return!0}}))}function i(e){var t={};return Object.keys(e).forEach((function(r){var n,i,o=e[r];if(o&&o.toParam&&(o=o.toParam()),o||0===o||"boolean"==typeof o||"string"==typeof o){var a;switch(o.constructor.name){case"Array":var s=null===(i=null===(n=o[0])||void 0===n?void 0:n.constructor)||void 0===i?void 0:i.name;a="Array"===s?o:"Object"===s?JSON.stringify(o):o.join(",");break;case"Object":a=JSON.stringify(o);break;case"Date":a=o.valueOf();break;case"Function":a=null;break;case"Boolean":a=o+"";break;default:a=o}(a||0===a||"string"==typeof a||Array.isArray(a))&&(t[r]=a)}})),t}r.d(t,{Z:()=>n,y:()=>i})},7096:()=>{},5273:()=>{},8916:()=>{},1034:()=>{},496:()=>{},7304:()=>{},3415:()=>{},6666:()=>{},2143:()=>{},8430:(e,t,r)=>{"use strict";var n=r(7304);r.o(n,"_unprotectAndRemoveGroup")&&r.d(t,{_unprotectAndRemoveGroup:function(){return n._unprotectAndRemoveGroup}}),r.o(n,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return n.getSurveyModels}});var i=r(8916);r.o(i,"_unprotectAndRemoveGroup")&&r.d(t,{_unprotectAndRemoveGroup:function(){return i._unprotectAndRemoveGroup}}),r.o(i,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return i.getSurveyModels}});var o=r(6666);r.o(o,"_unprotectAndRemoveGroup")&&r.d(t,{_unprotectAndRemoveGroup:function(){return o._unprotectAndRemoveGroup}}),r.o(o,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return o.getSurveyModels}});var a=r(3415);r.o(a,"_unprotectAndRemoveGroup")&&r.d(t,{_unprotectAndRemoveGroup:function(){return a._unprotectAndRemoveGroup}}),r.o(a,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return a.getSurveyModels}});var s=r(1034);r.o(s,"_unprotectAndRemoveGroup")&&r.d(t,{_unprotectAndRemoveGroup:function(){return s._unprotectAndRemoveGroup}}),r.o(s,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return s.getSurveyModels}});var u=r(496);r.o(u,"_unprotectAndRemoveGroup")&&r.d(t,{_unprotectAndRemoveGroup:function(){return u._unprotectAndRemoveGroup}}),r.o(u,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return u.getSurveyModels}});var c=r(2143);r.o(c,"_unprotectAndRemoveGroup")&&r.d(t,{_unprotectAndRemoveGroup:function(){return c._unprotectAndRemoveGroup}}),r.o(c,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return c.getSurveyModels}});var l=r(5273);r.o(l,"_unprotectAndRemoveGroup")&&r.d(t,{_unprotectAndRemoveGroup:function(){return l._unprotectAndRemoveGroup}}),r.o(l,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return l.getSurveyModels}});var d=r(7096);r.o(d,"_unprotectAndRemoveGroup")&&r.d(t,{_unprotectAndRemoveGroup:function(){return d._unprotectAndRemoveGroup}}),r.o(d,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return d.getSurveyModels}})},3474:(e,t,r)=>{"use strict";var n=r(5978);r.o(n,"_unprotectAndRemoveGroup")&&r.d(t,{_unprotectAndRemoveGroup:function(){return n._unprotectAndRemoveGroup}}),r.o(n,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return n.getSurveyModels}});var i=r(1896);r.o(i,"_unprotectAndRemoveGroup")&&r.d(t,{_unprotectAndRemoveGroup:function(){return i._unprotectAndRemoveGroup}}),r.o(i,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return i.getSurveyModels}});var o=r(8430);r.o(o,"_unprotectAndRemoveGroup")&&r.d(t,{_unprotectAndRemoveGroup:function(){return o._unprotectAndRemoveGroup}}),r.o(o,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return o.getSurveyModels}})},3253:()=>{},6141:()=>{},6102:()=>{},8890:()=>{},2288:()=>{},6750:()=>{},9563:()=>{},8837:()=>{},9358:()=>{},9721:()=>{},5978:(e,t,r)=>{"use strict";var n=r(6141);r.o(n,"_unprotectAndRemoveGroup")&&r.d(t,{_unprotectAndRemoveGroup:function(){return n._unprotectAndRemoveGroup}}),r.o(n,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return n.getSurveyModels}});var i=r(6102);r.o(i,"_unprotectAndRemoveGroup")&&r.d(t,{_unprotectAndRemoveGroup:function(){return i._unprotectAndRemoveGroup}}),r.o(i,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return i.getSurveyModels}});var o=r(9563);r.o(o,"_unprotectAndRemoveGroup")&&r.d(t,{_unprotectAndRemoveGroup:function(){return o._unprotectAndRemoveGroup}}),r.o(o,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return o.getSurveyModels}});var a=r(9358);r.o(a,"_unprotectAndRemoveGroup")&&r.d(t,{_unprotectAndRemoveGroup:function(){return a._unprotectAndRemoveGroup}}),r.o(a,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return a.getSurveyModels}});var s=r(8837);r.o(s,"_unprotectAndRemoveGroup")&&r.d(t,{_unprotectAndRemoveGroup:function(){return s._unprotectAndRemoveGroup}}),r.o(s,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return s.getSurveyModels}});var u=r(8890);r.o(u,"_unprotectAndRemoveGroup")&&r.d(t,{_unprotectAndRemoveGroup:function(){return u._unprotectAndRemoveGroup}}),r.o(u,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return u.getSurveyModels}});var c=r(9721);r.o(c,"_unprotectAndRemoveGroup")&&r.d(t,{_unprotectAndRemoveGroup:function(){return c._unprotectAndRemoveGroup}}),r.o(c,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return c.getSurveyModels}});var l=r(2288);r.o(l,"_unprotectAndRemoveGroup")&&r.d(t,{_unprotectAndRemoveGroup:function(){return l._unprotectAndRemoveGroup}}),r.o(l,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return l.getSurveyModels}});var d=r(3253);r.o(d,"_unprotectAndRemoveGroup")&&r.d(t,{_unprotectAndRemoveGroup:function(){return d._unprotectAndRemoveGroup}}),r.o(d,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return d.getSurveyModels}});var p=r(6750);r.o(p,"_unprotectAndRemoveGroup")&&r.d(t,{_unprotectAndRemoveGroup:function(){return p._unprotectAndRemoveGroup}}),r.o(p,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return p.getSurveyModels}})},9575:()=>{},6259:()=>{},6636:()=>{},1333:()=>{},3398:()=>{},7513:()=>{},7668:()=>{},6563:()=>{},5930:()=>{},2778:()=>{},1741:()=>{},8503:()=>{},4238:()=>{},2808:()=>{},2532:()=>{},6562:()=>{},2435:()=>{},1297:()=>{},2423:()=>{},3429:()=>{},5783:()=>{},9974:()=>{},8226:()=>{},874:()=>{},4703:()=>{},8696:()=>{},2330:()=>{},5732:()=>{},3120:()=>{},1896:(e,t,r)=>{"use strict";var n=r(9575);r.o(n,"_unprotectAndRemoveGroup")&&r.d(t,{_unprotectAndRemoveGroup:function(){return n._unprotectAndRemoveGroup}}),r.o(n,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return n.getSurveyModels}});var i=r(6259);r.o(i,"_unprotectAndRemoveGroup")&&r.d(t,{_unprotectAndRemoveGroup:function(){return i._unprotectAndRemoveGroup}}),r.o(i,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return i.getSurveyModels}});var o=r(6636);r.o(o,"_unprotectAndRemoveGroup")&&r.d(t,{_unprotectAndRemoveGroup:function(){return o._unprotectAndRemoveGroup}}),r.o(o,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return o.getSurveyModels}});var a=r(1333);r.o(a,"_unprotectAndRemoveGroup")&&r.d(t,{_unprotectAndRemoveGroup:function(){return a._unprotectAndRemoveGroup}}),r.o(a,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return a.getSurveyModels}});var s=r(7513);r.o(s,"_unprotectAndRemoveGroup")&&r.d(t,{_unprotectAndRemoveGroup:function(){return s._unprotectAndRemoveGroup}}),r.o(s,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return s.getSurveyModels}});var u=r(7668);r.o(u,"_unprotectAndRemoveGroup")&&r.d(t,{_unprotectAndRemoveGroup:function(){return u._unprotectAndRemoveGroup}}),r.o(u,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return u.getSurveyModels}});var c=r(6563);r.o(c,"_unprotectAndRemoveGroup")&&r.d(t,{_unprotectAndRemoveGroup:function(){return c._unprotectAndRemoveGroup}}),r.o(c,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return c.getSurveyModels}});var l=r(5930);r.o(l,"_unprotectAndRemoveGroup")&&r.d(t,{_unprotectAndRemoveGroup:function(){return l._unprotectAndRemoveGroup}}),r.o(l,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return l.getSurveyModels}});var d=r(2778);r.o(d,"_unprotectAndRemoveGroup")&&r.d(t,{_unprotectAndRemoveGroup:function(){return d._unprotectAndRemoveGroup}}),r.o(d,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return d.getSurveyModels}});var p=r(8226);r.o(p,"_unprotectAndRemoveGroup")&&r.d(t,{_unprotectAndRemoveGroup:function(){return p._unprotectAndRemoveGroup}}),r.o(p,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return p.getSurveyModels}});var f=r(1741);r.o(f,"_unprotectAndRemoveGroup")&&r.d(t,{_unprotectAndRemoveGroup:function(){return f._unprotectAndRemoveGroup}}),r.o(f,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return f.getSurveyModels}});var m=r(8503);r.o(m,"_unprotectAndRemoveGroup")&&r.d(t,{_unprotectAndRemoveGroup:function(){return m._unprotectAndRemoveGroup}}),r.o(m,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return m.getSurveyModels}});var h=r(4238);r.o(h,"_unprotectAndRemoveGroup")&&r.d(t,{_unprotectAndRemoveGroup:function(){return h._unprotectAndRemoveGroup}}),r.o(h,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return h.getSurveyModels}});var g=r(2808);r.o(g,"_unprotectAndRemoveGroup")&&r.d(t,{_unprotectAndRemoveGroup:function(){return g._unprotectAndRemoveGroup}}),r.o(g,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return g.getSurveyModels}});var y=r(2532);r.o(y,"_unprotectAndRemoveGroup")&&r.d(t,{_unprotectAndRemoveGroup:function(){return y._unprotectAndRemoveGroup}}),r.o(y,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return y.getSurveyModels}});var v=r(6562);r.o(v,"_unprotectAndRemoveGroup")&&r.d(t,{_unprotectAndRemoveGroup:function(){return v._unprotectAndRemoveGroup}}),r.o(v,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return v.getSurveyModels}});var b=r(2435);r.o(b,"_unprotectAndRemoveGroup")&&r.d(t,{_unprotectAndRemoveGroup:function(){return b._unprotectAndRemoveGroup}}),r.o(b,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return b.getSurveyModels}});var w=r(1297);r.o(w,"_unprotectAndRemoveGroup")&&r.d(t,{_unprotectAndRemoveGroup:function(){return w._unprotectAndRemoveGroup}}),r.o(w,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return w.getSurveyModels}});var I=r(2423);r.o(I,"_unprotectAndRemoveGroup")&&r.d(t,{_unprotectAndRemoveGroup:function(){return I._unprotectAndRemoveGroup}}),r.o(I,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return I.getSurveyModels}});var x=r(874);r.o(x,"_unprotectAndRemoveGroup")&&r.d(t,{_unprotectAndRemoveGroup:function(){return x._unprotectAndRemoveGroup}}),r.o(x,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return x.getSurveyModels}});var _=r(5783);r.o(_,"_unprotectAndRemoveGroup")&&r.d(t,{_unprotectAndRemoveGroup:function(){return _._unprotectAndRemoveGroup}}),r.o(_,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return _.getSurveyModels}});var k=r(9974);r.o(k,"_unprotectAndRemoveGroup")&&r.d(t,{_unprotectAndRemoveGroup:function(){return k._unprotectAndRemoveGroup}}),r.o(k,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return k.getSurveyModels}});var S=r(3429);r.o(S,"_unprotectAndRemoveGroup")&&r.d(t,{_unprotectAndRemoveGroup:function(){return S._unprotectAndRemoveGroup}}),r.o(S,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return S.getSurveyModels}});var E=r(8696);r.o(E,"_unprotectAndRemoveGroup")&&r.d(t,{_unprotectAndRemoveGroup:function(){return E._unprotectAndRemoveGroup}}),r.o(E,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return E.getSurveyModels}});var A=r(2330);r.o(A,"_unprotectAndRemoveGroup")&&r.d(t,{_unprotectAndRemoveGroup:function(){return A._unprotectAndRemoveGroup}}),r.o(A,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return A.getSurveyModels}});var P=r(5732);r.o(P,"_unprotectAndRemoveGroup")&&r.d(t,{_unprotectAndRemoveGroup:function(){return P._unprotectAndRemoveGroup}}),r.o(P,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return P.getSurveyModels}});var O=r(3120);r.o(O,"_unprotectAndRemoveGroup")&&r.d(t,{_unprotectAndRemoveGroup:function(){return O._unprotectAndRemoveGroup}}),r.o(O,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return O.getSurveyModels}});var T=r(3398);r.o(T,"_unprotectAndRemoveGroup")&&r.d(t,{_unprotectAndRemoveGroup:function(){return T._unprotectAndRemoveGroup}}),r.o(T,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return T.getSurveyModels}});var C=r(4703);r.o(C,"_unprotectAndRemoveGroup")&&r.d(t,{_unprotectAndRemoveGroup:function(){return C._unprotectAndRemoveGroup}}),r.o(C,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return C.getSurveyModels}})},743:(e,t,r)=>{"use strict";r.d(t,{Y:()=>a});var n=r(6808),i=r(5302),o=r(6349);function a(e){const t=(0,n.M)(i.w,{success:!0}),r=(0,n.M)(o.Y,{success:!0});return t(e).then((()=>r(e)))}},322:(e,t,r)=>{"use strict";var n=r(8640);r.o(n,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return n.getSurveyModels}})},8640:()=>{},9365:(e,t,r)=>{"use strict";r.d(t,{_unprotectAndRemoveGroup:()=>n.Y});var n=r(743),i=r(322);r.o(i,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return i.getSurveyModels}});var o=r(4435);r.o(o,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return o.getSurveyModels}})},8397:()=>{},4435:(e,t,r)=>{"use strict";var n=r(8397);r.o(n,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return n.getSurveyModels}});var i=r(7794);r.o(i,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return i.getSurveyModels}})},7794:()=>{},7184:(e,t,r)=>{"use strict";r.d(t,{_unprotectAndRemoveGroup:()=>i._unprotectAndRemoveGroup,getSurveyModels:()=>o.getSurveyModels});var n=r(3474);r.o(n,"_unprotectAndRemoveGroup")&&r.d(t,{_unprotectAndRemoveGroup:function(){return n._unprotectAndRemoveGroup}}),r.o(n,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return n.getSurveyModels}});var i=r(9365);r.o(i,"getSurveyModels")&&r.d(t,{getSurveyModels:function(){return i.getSurveyModels}});var o=r(3001);r(1638)},3001:(e,t,r)=>{"use strict";r.d(t,{getSurveyModels:()=>a}),r(3494);var n=r(6155);const i=(e,t)=>(0,n.S9)(Object.assign({id:e,relationshipType:"Survey2Service",direction:"forward"},t)).then((({relatedItems:[e]})=>{let t;return e&&(t={item:e}),t})),o=(e,t)=>(0,n.S9)(Object.assign({id:e,relationshipType:"Survey2Data",direction:"forward"},t)).then((({relatedItems:[e]})=>{let t;return e&&(t={item:e}),t})),a=(e,t)=>{let r,a;return("string"==typeof e?(0,n.Gq)(e,t):Promise.resolve(e)).then((e=>{const s=[i(e.id,t),o(e.id,t)];return Promise.all(s).then((([e,i])=>(a=i,e&&function(e){const t=t=>e.typeKeywords.indexOf(t)>-1;let r=t("FieldworkerView");return r||(r=["Survey123","Feature Service","View Service"].every(t)&&!t("StakeholderView")),r}(e.item)?(r=e,((e,t)=>(0,n.S9)(Object.assign({id:e,relationshipType:"Service2Data",direction:"forward"},t)).then((({relatedItems:[e]})=>{let t;return e&&(t={item:e}),t})))(r.item.id,t)):e))).then((t=>({form:{item:e},featureService:t,fieldworker:r,stakeholder:a})))}))}},3494:()=>{},6808:(e,t,r)=>{"use strict";function n(e,t={}){return(...r)=>e(...r).catch((e=>t))}r.d(t,{M:()=>n})},1638:(e,t,r)=>{"use strict";const n=r(6520),i=r(966);e.exports={atob:n,btoa:i}},6520:e=>{"use strict";function t(e){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e);return t<0?void 0:t}e.exports=function(e){if(0===arguments.length)throw new TypeError("1 argument required, but only 0 present.");if((e=(e=`${e}`).replace(/[ \t\n\f\r]/g,"")).length%4==0&&(e=e.replace(/==?$/,"")),e.length%4==1||/[^+/0-9A-Za-z]/.test(e))return null;let r="",n=0,i=0;for(let o=0;o<e.length;o++)n<<=6,n|=t(e[o]),i+=6,24===i&&(r+=String.fromCharCode((16711680&n)>>16),r+=String.fromCharCode((65280&n)>>8),r+=String.fromCharCode(255&n),n=i=0);return 12===i?(n>>=4,r+=String.fromCharCode(n)):18===i&&(n>>=2,r+=String.fromCharCode((65280&n)>>8),r+=String.fromCharCode(255&n)),r}},966:e=>{"use strict";function t(e){if(e>=0&&e<64)return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[e]}e.exports=function(e){if(0===arguments.length)throw new TypeError("1 argument required, but only 0 present.");let r;for(e=`${e}`,r=0;r<e.length;r++)if(e.charCodeAt(r)>255)return null;let n="";for(r=0;r<e.length;r+=3){const i=[void 0,void 0,void 0,void 0];i[0]=e.charCodeAt(r)>>2,i[1]=(3&e.charCodeAt(r))<<4,e.length>r+1&&(i[1]|=e.charCodeAt(r+1)>>4,i[2]=(15&e.charCodeAt(r+1))<<2),e.length>r+2&&(i[2]|=e.charCodeAt(r+2)>>6,i[3]=63&e.charCodeAt(r+2));for(let e=0;e<i.length;e++)void 0===i[e]?n+="=":n+=t(i[e])}return n}},2461:(e,t,r)=>{e.exports=function e(t,r,n){function i(a,s){if(!r[a]){if(!t[a]){if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var c=r[a]={exports:{}};t[a][0].call(c.exports,(function(e){return i(t[a][1][e]||e)}),c,c.exports,e,t,r,n)}return r[a].exports}for(var o=void 0,a=0;a<n.length;a++)i(n[a]);return i}({1:[function(e,t,r){"use strict";var n=e("./utils"),i=e("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";r.encode=function(e){for(var t,r,i,a,s,u,c,l=[],d=0,p=e.length,f=p,m="string"!==n.getTypeOf(e);d<e.length;)f=p-d,i=m?(t=e[d++],r=d<p?e[d++]:0,d<p?e[d++]:0):(t=e.charCodeAt(d++),r=d<p?e.charCodeAt(d++):0,d<p?e.charCodeAt(d++):0),a=t>>2,s=(3&t)<<4|r>>4,u=1<f?(15&r)<<2|i>>6:64,c=2<f?63&i:64,l.push(o.charAt(a)+o.charAt(s)+o.charAt(u)+o.charAt(c));return l.join("")},r.decode=function(e){var t,r,n,a,s,u,c=0,l=0,d="data:";if(e.substr(0,5)===d)throw new Error("Invalid base64 input, it looks like a data url.");var p,f=3*(e=e.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(e.charAt(e.length-1)===o.charAt(64)&&f--,e.charAt(e.length-2)===o.charAt(64)&&f--,f%1!=0)throw new Error("Invalid base64 input, bad content length.");for(p=i.uint8array?new Uint8Array(0|f):new Array(0|f);c<e.length;)t=o.indexOf(e.charAt(c++))<<2|(a=o.indexOf(e.charAt(c++)))>>4,r=(15&a)<<4|(s=o.indexOf(e.charAt(c++)))>>2,n=(3&s)<<6|(u=o.indexOf(e.charAt(c++))),p[l++]=t,64!==s&&(p[l++]=r),64!==u&&(p[l++]=n);return p}},{"./support":30,"./utils":32}],2:[function(e,t,r){"use strict";var n=e("./external"),i=e("./stream/DataWorker"),o=e("./stream/Crc32Probe"),a=e("./stream/DataLengthProbe");function s(e,t,r,n,i){this.compressedSize=e,this.uncompressedSize=t,this.crc32=r,this.compression=n,this.compressedContent=i}s.prototype={getContentWorker:function(){var e=new i(n.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new a("data_length")),t=this;return e.on("end",(function(){if(this.streamInfo.data_length!==t.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")})),e},getCompressedWorker:function(){return new i(n.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},s.createWorkerFrom=function(e,t,r){return e.pipe(new o).pipe(new a("uncompressedSize")).pipe(t.compressWorker(r)).pipe(new a("compressedSize")).withStreamInfo("compression",t)},t.exports=s},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,t,r){"use strict";var n=e("./stream/GenericWorker");r.STORE={magic:"\0\0",compressWorker:function(){return new n("STORE compression")},uncompressWorker:function(){return new n("STORE decompression")}},r.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,t,r){"use strict";var n=e("./utils"),i=function(){for(var e,t=[],r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}();t.exports=function(e,t){return void 0!==e&&e.length?"string"!==n.getTypeOf(e)?function(e,t,r){var n=i,o=0+r;e^=-1;for(var a=0;a<o;a++)e=e>>>8^n[255&(e^t[a])];return~e}(0|t,e,e.length):function(e,t,r){var n=i,o=0+r;e^=-1;for(var a=0;a<o;a++)e=e>>>8^n[255&(e^t.charCodeAt(a))];return~e}(0|t,e,e.length):0}},{"./utils":32}],5:[function(e,t,r){"use strict";r.base64=!1,r.binary=!1,r.dir=!1,r.createFolders=!0,r.date=null,r.compression=null,r.compressionOptions=null,r.comment=null,r.unixPermissions=null,r.dosPermissions=null},{}],6:[function(e,t,r){"use strict";var n;n="undefined"!=typeof Promise?Promise:e("lie"),t.exports={Promise:n}},{lie:37}],7:[function(e,t,r){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,i=e("pako"),o=e("./utils"),a=e("./stream/GenericWorker"),s=n?"uint8array":"array";function u(e,t){a.call(this,"FlateWorker/"+e),this._pako=null,this._pakoAction=e,this._pakoOptions=t,this.meta={}}r.magic="\b\0",o.inherits(u,a),u.prototype.processChunk=function(e){this.meta=e.meta,null===this._pako&&this._createPako(),this._pako.push(o.transformTo(s,e.data),!1)},u.prototype.flush=function(){a.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},u.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this._pako=null},u.prototype._createPako=function(){this._pako=new i[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var e=this;this._pako.onData=function(t){e.push({data:t,meta:e.meta})}},r.compressWorker=function(e){return new u("Deflate",e)},r.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,t,r){"use strict";function n(e,t){var r,n="";for(r=0;r<t;r++)n+=String.fromCharCode(255&e),e>>>=8;return n}function i(e,t,r,i,a,l){var d,p,f=e.file,m=e.compression,h=l!==s.utf8encode,g=o.transformTo("string",l(f.name)),y=o.transformTo("string",s.utf8encode(f.name)),v=f.comment,b=o.transformTo("string",l(v)),w=o.transformTo("string",s.utf8encode(v)),I=y.length!==f.name.length,x=w.length!==v.length,_="",k="",S="",E=f.dir,A=f.date,P={crc32:0,compressedSize:0,uncompressedSize:0};t&&!r||(P.crc32=e.crc32,P.compressedSize=e.compressedSize,P.uncompressedSize=e.uncompressedSize);var O=0;t&&(O|=8),h||!I&&!x||(O|=2048);var T=0,C=0;E&&(T|=16),"UNIX"===a?(C=798,T|=function(e,t){var r=e;return e||(r=t?16893:33204),(65535&r)<<16}(f.unixPermissions,E)):(C=20,T|=function(e){return 63&(e||0)}(f.dosPermissions)),d=A.getUTCHours(),d<<=6,d|=A.getUTCMinutes(),d<<=5,d|=A.getUTCSeconds()/2,p=A.getUTCFullYear()-1980,p<<=4,p|=A.getUTCMonth()+1,p<<=5,p|=A.getUTCDate(),I&&(k=n(1,1)+n(u(g),4)+y,_+="up"+n(k.length,2)+k),x&&(S=n(1,1)+n(u(b),4)+w,_+="uc"+n(S.length,2)+S);var R="";return R+="\n\0",R+=n(O,2),R+=m.magic,R+=n(d,2),R+=n(p,2),R+=n(P.crc32,4),R+=n(P.compressedSize,4),R+=n(P.uncompressedSize,4),R+=n(g.length,2),R+=n(_.length,2),{fileRecord:c.LOCAL_FILE_HEADER+R+g+_,dirRecord:c.CENTRAL_FILE_HEADER+n(C,2)+R+n(b.length,2)+"\0\0\0\0"+n(T,4)+n(i,4)+g+_+b}}var o=e("../utils"),a=e("../stream/GenericWorker"),s=e("../utf8"),u=e("../crc32"),c=e("../signature");function l(e,t,r,n){a.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=t,this.zipPlatform=r,this.encodeFileName=n,this.streamFiles=e,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}o.inherits(l,a),l.prototype.push=function(e){var t=e.meta.percent||0,r=this.entriesCount,n=this._sources.length;this.accumulate?this.contentBuffer.push(e):(this.bytesWritten+=e.data.length,a.prototype.push.call(this,{data:e.data,meta:{currentFile:this.currentFile,percent:r?(t+100*(r-n-1))/r:100}}))},l.prototype.openedSource=function(e){this.currentSourceOffset=this.bytesWritten,this.currentFile=e.file.name;var t=this.streamFiles&&!e.file.dir;if(t){var r=i(e,t,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:r.fileRecord,meta:{percent:0}})}else this.accumulate=!0},l.prototype.closedSource=function(e){this.accumulate=!1;var t=this.streamFiles&&!e.file.dir,r=i(e,t,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(r.dirRecord),t)this.push({data:function(e){return c.DATA_DESCRIPTOR+n(e.crc32,4)+n(e.compressedSize,4)+n(e.uncompressedSize,4)}(e),meta:{percent:100}});else for(this.push({data:r.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},l.prototype.flush=function(){for(var e=this.bytesWritten,t=0;t<this.dirRecords.length;t++)this.push({data:this.dirRecords[t],meta:{percent:100}});var r=this.bytesWritten-e,i=function(e,t,r,i,a){var s=o.transformTo("string",a(i));return c.CENTRAL_DIRECTORY_END+"\0\0\0\0"+n(e,2)+n(e,2)+n(t,4)+n(r,4)+n(s.length,2)+s}(this.dirRecords.length,r,e,this.zipComment,this.encodeFileName);this.push({data:i,meta:{percent:100}})},l.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},l.prototype.registerPrevious=function(e){this._sources.push(e);var t=this;return e.on("data",(function(e){t.processChunk(e)})),e.on("end",(function(){t.closedSource(t.previous.streamInfo),t._sources.length?t.prepareNextSource():t.end()})),e.on("error",(function(e){t.error(e)})),this},l.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},l.prototype.error=function(e){var t=this._sources;if(!a.prototype.error.call(this,e))return!1;for(var r=0;r<t.length;r++)try{t[r].error(e)}catch(e){}return!0},l.prototype.lock=function(){a.prototype.lock.call(this);for(var e=this._sources,t=0;t<e.length;t++)e[t].lock()},t.exports=l},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,t,r){"use strict";var n=e("../compressions"),i=e("./ZipFileWorker");r.generateWorker=function(e,t,r){var o=new i(t.streamFiles,r,t.platform,t.encodeFileName),a=0;try{e.forEach((function(e,r){a++;var i=function(e,t){var r=e||t,i=n[r];if(!i)throw new Error(r+" is not a valid compression method !");return i}(r.options.compression,t.compression),s=r.options.compressionOptions||t.compressionOptions||{},u=r.dir,c=r.date;r._compressWorker(i,s).withStreamInfo("file",{name:e,dir:u,date:c,comment:r.comment||"",unixPermissions:r.unixPermissions,dosPermissions:r.dosPermissions}).pipe(o)})),o.entriesCount=a}catch(e){o.error(e)}return o}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,t,r){"use strict";function n(){if(!(this instanceof n))return new n;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var e=new n;for(var t in this)"function"!=typeof this[t]&&(e[t]=this[t]);return e}}(n.prototype=e("./object")).loadAsync=e("./load"),n.support=e("./support"),n.defaults=e("./defaults"),n.version="3.10.1",n.loadAsync=function(e,t){return(new n).loadAsync(e,t)},n.external=e("./external"),t.exports=n},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,t,r){"use strict";var n=e("./utils"),i=e("./external"),o=e("./utf8"),a=e("./zipEntries"),s=e("./stream/Crc32Probe"),u=e("./nodejsUtils");function c(e){return new i.Promise((function(t,r){var n=e.decompressed.getContentWorker().pipe(new s);n.on("error",(function(e){r(e)})).on("end",(function(){n.streamInfo.crc32!==e.decompressed.crc32?r(new Error("Corrupted zip : CRC32 mismatch")):t()})).resume()}))}t.exports=function(e,t){var r=this;return t=n.extend(t||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),u.isNode&&u.isStream(e)?i.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):n.prepareContent("the loaded zip file",e,!0,t.optimizedBinaryString,t.base64).then((function(e){var r=new a(t);return r.load(e),r})).then((function(e){var r=[i.Promise.resolve(e)],n=e.files;if(t.checkCRC32)for(var o=0;o<n.length;o++)r.push(c(n[o]));return i.Promise.all(r)})).then((function(e){for(var i=e.shift(),o=i.files,a=0;a<o.length;a++){var s=o[a],u=s.fileNameStr,c=n.resolve(s.fileNameStr);r.file(c,s.decompressed,{binary:!0,optimizedBinaryString:!0,date:s.date,dir:s.dir,comment:s.fileCommentStr.length?s.fileCommentStr:null,unixPermissions:s.unixPermissions,dosPermissions:s.dosPermissions,createFolders:t.createFolders}),s.dir||(r.file(c).unsafeOriginalName=u)}return i.zipComment.length&&(r.comment=i.zipComment),r}))}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,t,r){"use strict";var n=e("../utils"),i=e("../stream/GenericWorker");function o(e,t){i.call(this,"Nodejs stream input adapter for "+e),this._upstreamEnded=!1,this._bindStream(t)}n.inherits(o,i),o.prototype._bindStream=function(e){var t=this;(this._stream=e).pause(),e.on("data",(function(e){t.push({data:e,meta:{percent:0}})})).on("error",(function(e){t.isPaused?this.generatedError=e:t.error(e)})).on("end",(function(){t.isPaused?t._upstreamEnded=!0:t.end()}))},o.prototype.pause=function(){return!!i.prototype.pause.call(this)&&(this._stream.pause(),!0)},o.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},t.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,t,r){"use strict";var n=e("readable-stream").Readable;function i(e,t,r){n.call(this,t),this._helper=e;var i=this;e.on("data",(function(e,t){i.push(e)||i._helper.pause(),r&&r(t)})).on("error",(function(e){i.emit("error",e)})).on("end",(function(){i.push(null)}))}e("../utils").inherits(i,n),i.prototype._read=function(){this._helper.resume()},t.exports=i},{"../utils":32,"readable-stream":16}],14:[function(e,t,r){"use strict";t.exports={isNode:"undefined"!=typeof Buffer,newBufferFrom:function(e,t){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(e,t);if("number"==typeof e)throw new Error('The "data" argument must not be a number');return new Buffer(e,t)},allocBuffer:function(e){if(Buffer.alloc)return Buffer.alloc(e);var t=new Buffer(e);return t.fill(0),t},isBuffer:function(e){return Buffer.isBuffer(e)},isStream:function(e){return e&&"function"==typeof e.on&&"function"==typeof e.pause&&"function"==typeof e.resume}}},{}],15:[function(e,t,r){"use strict";function n(e,t,r){var n,i=o.getTypeOf(t),s=o.extend(r||{},u);s.date=s.date||new Date,null!==s.compression&&(s.compression=s.compression.toUpperCase()),"string"==typeof s.unixPermissions&&(s.unixPermissions=parseInt(s.unixPermissions,8)),s.unixPermissions&&16384&s.unixPermissions&&(s.dir=!0),s.dosPermissions&&16&s.dosPermissions&&(s.dir=!0),s.dir&&(e=h(e)),s.createFolders&&(n=m(e))&&g.call(this,n,!0);var d="string"===i&&!1===s.binary&&!1===s.base64;r&&void 0!==r.binary||(s.binary=!d),(t instanceof c&&0===t.uncompressedSize||s.dir||!t||0===t.length)&&(s.base64=!1,s.binary=!0,t="",s.compression="STORE",i="string");var y;y=t instanceof c||t instanceof a?t:p.isNode&&p.isStream(t)?new f(e,t):o.prepareContent(e,t,s.binary,s.optimizedBinaryString,s.base64);var v=new l(e,y,s);this.files[e]=v}var i=e("./utf8"),o=e("./utils"),a=e("./stream/GenericWorker"),s=e("./stream/StreamHelper"),u=e("./defaults"),c=e("./compressedObject"),l=e("./zipObject"),d=e("./generate"),p=e("./nodejsUtils"),f=e("./nodejs/NodejsStreamInputAdapter"),m=function(e){"/"===e.slice(-1)&&(e=e.substring(0,e.length-1));var t=e.lastIndexOf("/");return 0<t?e.substring(0,t):""},h=function(e){return"/"!==e.slice(-1)&&(e+="/"),e},g=function(e,t){return t=void 0!==t?t:u.createFolders,e=h(e),this.files[e]||n.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]};function y(e){return"[object RegExp]"===Object.prototype.toString.call(e)}var v={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(e){var t,r,n;for(t in this.files)n=this.files[t],(r=t.slice(this.root.length,t.length))&&t.slice(0,this.root.length)===this.root&&e(r,n)},filter:function(e){var t=[];return this.forEach((function(r,n){e(r,n)&&t.push(n)})),t},file:function(e,t,r){if(1!==arguments.length)return e=this.root+e,n.call(this,e,t,r),this;if(y(e)){var i=e;return this.filter((function(e,t){return!t.dir&&i.test(e)}))}var o=this.files[this.root+e];return o&&!o.dir?o:null},folder:function(e){if(!e)return this;if(y(e))return this.filter((function(t,r){return r.dir&&e.test(t)}));var t=this.root+e,r=g.call(this,t),n=this.clone();return n.root=r.name,n},remove:function(e){e=this.root+e;var t=this.files[e];if(t||("/"!==e.slice(-1)&&(e+="/"),t=this.files[e]),t&&!t.dir)delete this.files[e];else for(var r=this.filter((function(t,r){return r.name.slice(0,e.length)===e})),n=0;n<r.length;n++)delete this.files[r[n].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(e){var t,r={};try{if((r=o.extend(e||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:i.utf8encode})).type=r.type.toLowerCase(),r.compression=r.compression.toUpperCase(),"binarystring"===r.type&&(r.type="string"),!r.type)throw new Error("No output type specified.");o.checkSupport(r.type),"darwin"!==r.platform&&"freebsd"!==r.platform&&"linux"!==r.platform&&"sunos"!==r.platform||(r.platform="UNIX"),"win32"===r.platform&&(r.platform="DOS");var n=r.comment||this.comment||"";t=d.generateWorker(this,r,n)}catch(e){(t=new a("error")).error(e)}return new s(t,r.type||"string",r.mimeType)},generateAsync:function(e,t){return this.generateInternalStream(e).accumulate(t)},generateNodeStream:function(e,t){return(e=e||{}).type||(e.type="nodebuffer"),this.generateInternalStream(e).toNodejsStream(t)}};t.exports=v},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,t,r){"use strict";t.exports=e("stream")},{stream:void 0}],17:[function(e,t,r){"use strict";var n=e("./DataReader");function i(e){n.call(this,e);for(var t=0;t<this.data.length;t++)e[t]=255&e[t]}e("../utils").inherits(i,n),i.prototype.byteAt=function(e){return this.data[this.zero+e]},i.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),r=e.charCodeAt(1),n=e.charCodeAt(2),i=e.charCodeAt(3),o=this.length-4;0<=o;--o)if(this.data[o]===t&&this.data[o+1]===r&&this.data[o+2]===n&&this.data[o+3]===i)return o-this.zero;return-1},i.prototype.readAndCheckSignature=function(e){var t=e.charCodeAt(0),r=e.charCodeAt(1),n=e.charCodeAt(2),i=e.charCodeAt(3),o=this.readData(4);return t===o[0]&&r===o[1]&&n===o[2]&&i===o[3]},i.prototype.readData=function(e){if(this.checkOffset(e),0===e)return[];var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=i},{"../utils":32,"./DataReader":18}],18:[function(e,t,r){"use strict";var n=e("../utils");function i(e){this.data=e,this.length=e.length,this.index=0,this.zero=0}i.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<this.zero+e||e<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(){},readInt:function(e){var t,r=0;for(this.checkOffset(e),t=this.index+e-1;t>=this.index;t--)r=(r<<8)+this.byteAt(t);return this.index+=e,r},readString:function(e){return n.transformTo("string",this.readData(e))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var e=this.readInt(4);return new Date(Date.UTC(1980+(e>>25&127),(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1))}},t.exports=i},{"../utils":32}],19:[function(e,t,r){"use strict";var n=e("./Uint8ArrayReader");function i(e){n.call(this,e)}e("../utils").inherits(i,n),i.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=i},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,t,r){"use strict";var n=e("./DataReader");function i(e){n.call(this,e)}e("../utils").inherits(i,n),i.prototype.byteAt=function(e){return this.data.charCodeAt(this.zero+e)},i.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)-this.zero},i.prototype.readAndCheckSignature=function(e){return e===this.readData(4)},i.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=i},{"../utils":32,"./DataReader":18}],21:[function(e,t,r){"use strict";var n=e("./ArrayReader");function i(e){n.call(this,e)}e("../utils").inherits(i,n),i.prototype.readData=function(e){if(this.checkOffset(e),0===e)return new Uint8Array(0);var t=this.data.subarray(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=i},{"../utils":32,"./ArrayReader":17}],22:[function(e,t,r){"use strict";var n=e("../utils"),i=e("../support"),o=e("./ArrayReader"),a=e("./StringReader"),s=e("./NodeBufferReader"),u=e("./Uint8ArrayReader");t.exports=function(e){var t=n.getTypeOf(e);return n.checkSupport(t),"string"!==t||i.uint8array?"nodebuffer"===t?new s(e):i.uint8array?new u(n.transformTo("uint8array",e)):new o(n.transformTo("array",e)):new a(e)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,t,r){"use strict";r.LOCAL_FILE_HEADER="PK",r.CENTRAL_FILE_HEADER="PK",r.CENTRAL_DIRECTORY_END="PK",r.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",r.ZIP64_CENTRAL_DIRECTORY_END="PK",r.DATA_DESCRIPTOR="PK\b"},{}],24:[function(e,t,r){"use strict";var n=e("./GenericWorker"),i=e("../utils");function o(e){n.call(this,"ConvertWorker to "+e),this.destType=e}i.inherits(o,n),o.prototype.processChunk=function(e){this.push({data:i.transformTo(this.destType,e.data),meta:e.meta})},t.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(e,t,r){"use strict";var n=e("./GenericWorker"),i=e("../crc32");function o(){n.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(o,n),o.prototype.processChunk=function(e){this.streamInfo.crc32=i(e.data,this.streamInfo.crc32||0),this.push(e)},t.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,t,r){"use strict";var n=e("../utils"),i=e("./GenericWorker");function o(e){i.call(this,"DataLengthProbe for "+e),this.propName=e,this.withStreamInfo(e,0)}n.inherits(o,i),o.prototype.processChunk=function(e){if(e){var t=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=t+e.data.length}i.prototype.processChunk.call(this,e)},t.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(e,t,r){"use strict";var n=e("../utils"),i=e("./GenericWorker");function o(e){i.call(this,"DataWorker");var t=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,e.then((function(e){t.dataIsReady=!0,t.data=e,t.max=e&&e.length||0,t.type=n.getTypeOf(e),t.isPaused||t._tickAndRepeat()}),(function(e){t.error(e)}))}n.inherits(o,i),o.prototype.cleanUp=function(){i.prototype.cleanUp.call(this),this.data=null},o.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,n.delay(this._tickAndRepeat,[],this)),!0)},o.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(n.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var e=null,t=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":e=this.data.substring(this.index,t);break;case"uint8array":e=this.data.subarray(this.index,t);break;case"array":case"nodebuffer":e=this.data.slice(this.index,t)}return this.index=t,this.push({data:e,meta:{percent:this.max?this.index/this.max*100:0}})},t.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(e,t,r){"use strict";function n(e){this.name=e||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}n.prototype={push:function(e){this.emit("data",e)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(e){this.emit("error",e)}return!0},error:function(e){return!this.isFinished&&(this.isPaused?this.generatedError=e:(this.isFinished=!0,this.emit("error",e),this.previous&&this.previous.error(e),this.cleanUp()),!0)},on:function(e,t){return this._listeners[e].push(t),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(e,t){if(this._listeners[e])for(var r=0;r<this._listeners[e].length;r++)this._listeners[e][r].call(this,t)},pipe:function(e){return e.registerPrevious(this)},registerPrevious:function(e){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=e.streamInfo,this.mergeStreamInfo(),this.previous=e;var t=this;return e.on("data",(function(e){t.processChunk(e)})),e.on("end",(function(){t.end()})),e.on("error",(function(e){t.error(e)})),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var e=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),e=!0),this.previous&&this.previous.resume(),!e},flush:function(){},processChunk:function(e){this.push(e)},withStreamInfo:function(e,t){return this.extraStreamInfo[e]=t,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var e in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,e)&&(this.streamInfo[e]=this.extraStreamInfo[e])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var e="Worker "+this.name;return this.previous?this.previous+" -> "+e:e}},t.exports=n},{}],29:[function(e,t,r){"use strict";var n=e("../utils"),i=e("./ConvertWorker"),o=e("./GenericWorker"),a=e("../base64"),s=e("../support"),u=e("../external"),c=null;if(s.nodestream)try{c=e("../nodejs/NodejsStreamOutputAdapter")}catch(e){}function l(e,t,r){var a=t;switch(t){case"blob":case"arraybuffer":a="uint8array";break;case"base64":a="string"}try{this._internalType=a,this._outputType=t,this._mimeType=r,n.checkSupport(a),this._worker=e.pipe(new i(a)),e.lock()}catch(e){this._worker=new o("error"),this._worker.error(e)}}l.prototype={accumulate:function(e){return function(e,t){return new u.Promise((function(r,i){var o=[],s=e._internalType,u=e._outputType,c=e._mimeType;e.on("data",(function(e,r){o.push(e),t&&t(r)})).on("error",(function(e){o=[],i(e)})).on("end",(function(){try{var e=function(e,t,r){switch(e){case"blob":return n.newBlob(n.transformTo("arraybuffer",t),r);case"base64":return a.encode(t);default:return n.transformTo(e,t)}}(u,function(e,t){var r,n=0,i=null,o=0;for(r=0;r<t.length;r++)o+=t[r].length;switch(e){case"string":return t.join("");case"array":return Array.prototype.concat.apply([],t);case"uint8array":for(i=new Uint8Array(o),r=0;r<t.length;r++)i.set(t[r],n),n+=t[r].length;return i;case"nodebuffer":return Buffer.concat(t);default:throw new Error("concat : unsupported type '"+e+"'")}}(s,o),c);r(e)}catch(e){i(e)}o=[]})).resume()}))}(this,e)},on:function(e,t){var r=this;return"data"===e?this._worker.on(e,(function(e){t.call(r,e.data,e.meta)})):this._worker.on(e,(function(){n.delay(t,arguments,r)})),this},resume:function(){return n.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(e){if(n.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new c(this,{objectMode:"nodebuffer"!==this._outputType},e)}},t.exports=l},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,t,r){"use strict";if(r.base64=!0,r.array=!0,r.string=!0,r.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,r.nodebuffer="undefined"!=typeof Buffer,r.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)r.blob=!1;else{var n=new ArrayBuffer(0);try{r.blob=0===new Blob([n],{type:"application/zip"}).size}catch(e){try{var i=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);i.append(n),r.blob=0===i.getBlob("application/zip").size}catch(e){r.blob=!1}}}try{r.nodestream=!!e("readable-stream").Readable}catch(e){r.nodestream=!1}},{"readable-stream":16}],31:[function(e,t,r){"use strict";for(var n=e("./utils"),i=e("./support"),o=e("./nodejsUtils"),a=e("./stream/GenericWorker"),s=new Array(256),u=0;u<256;u++)s[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;function c(){a.call(this,"utf-8 decode"),this.leftOver=null}function l(){a.call(this,"utf-8 encode")}s[254]=s[254]=1,r.utf8encode=function(e){return i.nodebuffer?o.newBufferFrom(e,"utf-8"):function(e){var t,r,n,o,a,s=e.length,u=0;for(o=0;o<s;o++)55296==(64512&(r=e.charCodeAt(o)))&&o+1<s&&56320==(64512&(n=e.charCodeAt(o+1)))&&(r=65536+(r-55296<<10)+(n-56320),o++),u+=r<128?1:r<2048?2:r<65536?3:4;for(t=i.uint8array?new Uint8Array(u):new Array(u),o=a=0;a<u;o++)55296==(64512&(r=e.charCodeAt(o)))&&o+1<s&&56320==(64512&(n=e.charCodeAt(o+1)))&&(r=65536+(r-55296<<10)+(n-56320),o++),r<128?t[a++]=r:(r<2048?t[a++]=192|r>>>6:(r<65536?t[a++]=224|r>>>12:(t[a++]=240|r>>>18,t[a++]=128|r>>>12&63),t[a++]=128|r>>>6&63),t[a++]=128|63&r);return t}(e)},r.utf8decode=function(e){return i.nodebuffer?n.transformTo("nodebuffer",e).toString("utf-8"):function(e){var t,r,i,o,a=e.length,u=new Array(2*a);for(t=r=0;t<a;)if((i=e[t++])<128)u[r++]=i;else if(4<(o=s[i]))u[r++]=65533,t+=o-1;else{for(i&=2===o?31:3===o?15:7;1<o&&t<a;)i=i<<6|63&e[t++],o--;1<o?u[r++]=65533:i<65536?u[r++]=i:(i-=65536,u[r++]=55296|i>>10&1023,u[r++]=56320|1023&i)}return u.length!==r&&(u.subarray?u=u.subarray(0,r):u.length=r),n.applyFromCharCode(u)}(e=n.transformTo(i.uint8array?"uint8array":"array",e))},n.inherits(c,a),c.prototype.processChunk=function(e){var t=n.transformTo(i.uint8array?"uint8array":"array",e.data);if(this.leftOver&&this.leftOver.length){if(i.uint8array){var o=t;(t=new Uint8Array(o.length+this.leftOver.length)).set(this.leftOver,0),t.set(o,this.leftOver.length)}else t=this.leftOver.concat(t);this.leftOver=null}var a=function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;0<=r&&128==(192&e[r]);)r--;return r<0||0===r?t:r+s[e[r]]>t?r:t}(t),u=t;a!==t.length&&(i.uint8array?(u=t.subarray(0,a),this.leftOver=t.subarray(a,t.length)):(u=t.slice(0,a),this.leftOver=t.slice(a,t.length))),this.push({data:r.utf8decode(u),meta:e.meta})},c.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:r.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},r.Utf8DecodeWorker=c,n.inherits(l,a),l.prototype.processChunk=function(e){this.push({data:r.utf8encode(e.data),meta:e.meta})},r.Utf8EncodeWorker=l},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,t,r){"use strict";var n=e("./support"),i=e("./base64"),o=e("./nodejsUtils"),a=e("./external");function s(e){return e}function u(e,t){for(var r=0;r<e.length;++r)t[r]=255&e.charCodeAt(r);return t}e("setimmediate"),r.newBlob=function(e,t){r.checkSupport("blob");try{return new Blob([e],{type:t})}catch(r){try{var n=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return n.append(e),n.getBlob(t)}catch(e){throw new Error("Bug : can't construct the Blob.")}}};var c={stringifyByChunk:function(e,t,r){var n=[],i=0,o=e.length;if(o<=r)return String.fromCharCode.apply(null,e);for(;i<o;)"array"===t||"nodebuffer"===t?n.push(String.fromCharCode.apply(null,e.slice(i,Math.min(i+r,o)))):n.push(String.fromCharCode.apply(null,e.subarray(i,Math.min(i+r,o)))),i+=r;return n.join("")},stringifyByChar:function(e){for(var t="",r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},applyCanBeUsed:{uint8array:function(){try{return n.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(e){return!1}}(),nodebuffer:function(){try{return n.nodebuffer&&1===String.fromCharCode.apply(null,o.allocBuffer(1)).length}catch(e){return!1}}()}};function l(e){var t=65536,n=r.getTypeOf(e),i=!0;if("uint8array"===n?i=c.applyCanBeUsed.uint8array:"nodebuffer"===n&&(i=c.applyCanBeUsed.nodebuffer),i)for(;1<t;)try{return c.stringifyByChunk(e,n,t)}catch(e){t=Math.floor(t/2)}return c.stringifyByChar(e)}function d(e,t){for(var r=0;r<e.length;r++)t[r]=e[r];return t}r.applyFromCharCode=l;var p={};p.string={string:s,array:function(e){return u(e,new Array(e.length))},arraybuffer:function(e){return p.string.uint8array(e).buffer},uint8array:function(e){return u(e,new Uint8Array(e.length))},nodebuffer:function(e){return u(e,o.allocBuffer(e.length))}},p.array={string:l,array:s,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return o.newBufferFrom(e)}},p.arraybuffer={string:function(e){return l(new Uint8Array(e))},array:function(e){return d(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:s,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return o.newBufferFrom(new Uint8Array(e))}},p.uint8array={string:l,array:function(e){return d(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:s,nodebuffer:function(e){return o.newBufferFrom(e)}},p.nodebuffer={string:l,array:function(e){return d(e,new Array(e.length))},arraybuffer:function(e){return p.nodebuffer.uint8array(e).buffer},uint8array:function(e){return d(e,new Uint8Array(e.length))},nodebuffer:s},r.transformTo=function(e,t){if(t=t||"",!e)return t;r.checkSupport(e);var n=r.getTypeOf(t);return p[n][e](t)},r.resolve=function(e){for(var t=e.split("/"),r=[],n=0;n<t.length;n++){var i=t[n];"."===i||""===i&&0!==n&&n!==t.length-1||(".."===i?r.pop():r.push(i))}return r.join("/")},r.getTypeOf=function(e){return"string"==typeof e?"string":"[object Array]"===Object.prototype.toString.call(e)?"array":n.nodebuffer&&o.isBuffer(e)?"nodebuffer":n.uint8array&&e instanceof Uint8Array?"uint8array":n.arraybuffer&&e instanceof ArrayBuffer?"arraybuffer":void 0},r.checkSupport=function(e){if(!n[e.toLowerCase()])throw new Error(e+" is not supported by this platform")},r.MAX_VALUE_16BITS=65535,r.MAX_VALUE_32BITS=-1,r.pretty=function(e){var t,r,n="";for(r=0;r<(e||"").length;r++)n+="\\x"+((t=e.charCodeAt(r))<16?"0":"")+t.toString(16).toUpperCase();return n},r.delay=function(e,t,r){setImmediate((function(){e.apply(r||null,t||[])}))},r.inherits=function(e,t){function r(){}r.prototype=t.prototype,e.prototype=new r},r.extend=function(){var e,t,r={};for(e=0;e<arguments.length;e++)for(t in arguments[e])Object.prototype.hasOwnProperty.call(arguments[e],t)&&void 0===r[t]&&(r[t]=arguments[e][t]);return r},r.prepareContent=function(e,t,o,s,c){return a.Promise.resolve(t).then((function(e){return n.blob&&(e instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(e)))&&"undefined"!=typeof FileReader?new a.Promise((function(t,r){var n=new FileReader;n.onload=function(e){t(e.target.result)},n.onerror=function(e){r(e.target.error)},n.readAsArrayBuffer(e)})):e})).then((function(t){var l=r.getTypeOf(t);return l?("arraybuffer"===l?t=r.transformTo("uint8array",t):"string"===l&&(c?t=i.decode(t):o&&!0!==s&&(t=function(e){return u(e,n.uint8array?new Uint8Array(e.length):new Array(e.length))}(t))),t):a.Promise.reject(new Error("Can't read the data of '"+e+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))}))}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(e,t,r){"use strict";var n=e("./reader/readerFor"),i=e("./utils"),o=e("./signature"),a=e("./zipEntry"),s=e("./support");function u(e){this.files=[],this.loadOptions=e}u.prototype={checkSignature:function(e){if(!this.reader.readAndCheckSignature(e)){this.reader.index-=4;var t=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+i.pretty(t)+", expected "+i.pretty(e)+")")}},isSignature:function(e,t){var r=this.reader.index;this.reader.setIndex(e);var n=this.reader.readString(4)===t;return this.reader.setIndex(r),n},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var e=this.reader.readData(this.zipCommentLength),t=s.uint8array?"uint8array":"array",r=i.transformTo(t,e);this.zipComment=this.loadOptions.decodeFileName(r)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e,t,r,n=this.zip64EndOfCentralSize-44;0<n;)e=this.reader.readInt(2),t=this.reader.readInt(4),r=this.reader.readData(t),this.zip64ExtensibleData[e]={id:e,length:t,value:r}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var e,t;for(e=0;e<this.files.length;e++)t=this.files[e],this.reader.setIndex(t.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),t.readLocalPart(this.reader),t.handleUTF8(),t.processAttributes()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(e=new a({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(e);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(e<0)throw this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(e);var t=e;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===i.MAX_VALUE_16BITS||this.diskWithCentralDirStart===i.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===i.MAX_VALUE_16BITS||this.centralDirRecords===i.MAX_VALUE_16BITS||this.centralDirSize===i.MAX_VALUE_32BITS||this.centralDirOffset===i.MAX_VALUE_32BITS){if(this.zip64=!0,(e=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(e),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var r=this.centralDirOffset+this.centralDirSize;this.zip64&&(r+=20,r+=12+this.zip64EndOfCentralSize);var n=t-r;if(0<n)this.isSignature(t,o.CENTRAL_FILE_HEADER)||(this.reader.zero=n);else if(n<0)throw new Error("Corrupted zip: missing "+Math.abs(n)+" bytes.")},prepareReader:function(e){this.reader=n(e)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},t.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(e,t,r){"use strict";var n=e("./reader/readerFor"),i=e("./utils"),o=e("./compressedObject"),a=e("./crc32"),s=e("./utf8"),u=e("./compressions"),c=e("./support");function l(e,t){this.options=e,this.loadOptions=t}l.prototype={isEncrypted:function(){return!(1&~this.bitFlag)},useUTF8:function(){return!(2048&~this.bitFlag)},readLocalPart:function(e){var t,r;if(e.skip(22),this.fileNameLength=e.readInt(2),r=e.readInt(2),this.fileName=e.readData(this.fileNameLength),e.skip(r),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(t=function(e){for(var t in u)if(Object.prototype.hasOwnProperty.call(u,t)&&u[t].magic===e)return u[t];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+i.pretty(this.compressionMethod)+" unknown (inner file : "+i.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,t,e.readData(this.compressedSize))},readCentralPart:function(e){this.versionMadeBy=e.readInt(2),e.skip(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4);var t=e.readInt(2);if(this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");e.skip(t),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var e=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0==e&&(this.dosPermissions=63&this.externalFileAttributes),3==e&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var e=n(this.extraFields[1].value);this.uncompressedSize===i.MAX_VALUE_32BITS&&(this.uncompressedSize=e.readInt(8)),this.compressedSize===i.MAX_VALUE_32BITS&&(this.compressedSize=e.readInt(8)),this.localHeaderOffset===i.MAX_VALUE_32BITS&&(this.localHeaderOffset=e.readInt(8)),this.diskNumberStart===i.MAX_VALUE_32BITS&&(this.diskNumberStart=e.readInt(4))}},readExtraFields:function(e){var t,r,n,i=e.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});e.index+4<i;)t=e.readInt(2),r=e.readInt(2),n=e.readData(r),this.extraFields[t]={id:t,length:r,value:n};e.setIndex(i)},handleUTF8:function(){var e=c.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=s.utf8decode(this.fileName),this.fileCommentStr=s.utf8decode(this.fileComment);else{var t=this.findExtraFieldUnicodePath();if(null!==t)this.fileNameStr=t;else{var r=i.transformTo(e,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(r)}var n=this.findExtraFieldUnicodeComment();if(null!==n)this.fileCommentStr=n;else{var o=i.transformTo(e,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(o)}}},findExtraFieldUnicodePath:function(){var e=this.extraFields[28789];if(e){var t=n(e.value);return 1!==t.readInt(1)||a(this.fileName)!==t.readInt(4)?null:s.utf8decode(t.readData(e.length-5))}return null},findExtraFieldUnicodeComment:function(){var e=this.extraFields[25461];if(e){var t=n(e.value);return 1!==t.readInt(1)||a(this.fileComment)!==t.readInt(4)?null:s.utf8decode(t.readData(e.length-5))}return null}},t.exports=l},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,t,r){"use strict";function n(e,t,r){this.name=e,this.dir=r.dir,this.date=r.date,this.comment=r.comment,this.unixPermissions=r.unixPermissions,this.dosPermissions=r.dosPermissions,this._data=t,this._dataBinary=r.binary,this.options={compression:r.compression,compressionOptions:r.compressionOptions}}var i=e("./stream/StreamHelper"),o=e("./stream/DataWorker"),a=e("./utf8"),s=e("./compressedObject"),u=e("./stream/GenericWorker");n.prototype={internalStream:function(e){var t=null,r="string";try{if(!e)throw new Error("No output type specified.");var n="string"===(r=e.toLowerCase())||"text"===r;"binarystring"!==r&&"text"!==r||(r="string"),t=this._decompressWorker();var o=!this._dataBinary;o&&!n&&(t=t.pipe(new a.Utf8EncodeWorker)),!o&&n&&(t=t.pipe(new a.Utf8DecodeWorker))}catch(e){(t=new u("error")).error(e)}return new i(t,r,"")},async:function(e,t){return this.internalStream(e).accumulate(t)},nodeStream:function(e,t){return this.internalStream(e||"nodebuffer").toNodejsStream(t)},_compressWorker:function(e,t){if(this._data instanceof s&&this._data.compression.magic===e.magic)return this._data.getCompressedWorker();var r=this._decompressWorker();return this._dataBinary||(r=r.pipe(new a.Utf8EncodeWorker)),s.createWorkerFrom(r,e,t)},_decompressWorker:function(){return this._data instanceof s?this._data.getContentWorker():this._data instanceof u?this._data:new o(this._data)}};for(var c=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],l=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},d=0;d<c.length;d++)n.prototype[c[d]]=l;t.exports=n},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,t,n){(function(e){"use strict";var r,n,i=e.MutationObserver||e.WebKitMutationObserver;if(i){var o=0,a=new i(l),s=e.document.createTextNode("");a.observe(s,{characterData:!0}),r=function(){s.data=o=++o%2}}else if(e.setImmediate||void 0===e.MessageChannel)r="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){l(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(l,0)};else{var u=new e.MessageChannel;u.port1.onmessage=l,r=function(){u.port2.postMessage(0)}}var c=[];function l(){var e,t;n=!0;for(var r=c.length;r;){for(t=c,c=[],e=-1;++e<r;)t[e]();r=c.length}n=!1}t.exports=function(e){1!==c.push(e)||n||r()}}).call(this,void 0!==r.g?r.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],37:[function(e,t,r){"use strict";var n=e("immediate");function i(){}var o={},a=["REJECTED"],s=["FULFILLED"],u=["PENDING"];function c(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,e!==i&&f(this,e)}function l(e,t,r){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof r&&(this.onRejected=r,this.callRejected=this.otherCallRejected)}function d(e,t,r){n((function(){var n;try{n=t(r)}catch(n){return o.reject(e,n)}n===e?o.reject(e,new TypeError("Cannot resolve promise with itself")):o.resolve(e,n)}))}function p(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function f(e,t){var r=!1;function n(t){r||(r=!0,o.reject(e,t))}function i(t){r||(r=!0,o.resolve(e,t))}var a=m((function(){t(i,n)}));"error"===a.status&&n(a.value)}function m(e,t){var r={};try{r.value=e(t),r.status="success"}catch(e){r.status="error",r.value=e}return r}(t.exports=c).prototype.finally=function(e){if("function"!=typeof e)return this;var t=this.constructor;return this.then((function(r){return t.resolve(e()).then((function(){return r}))}),(function(r){return t.resolve(e()).then((function(){throw r}))}))},c.prototype.catch=function(e){return this.then(null,e)},c.prototype.then=function(e,t){if("function"!=typeof e&&this.state===s||"function"!=typeof t&&this.state===a)return this;var r=new this.constructor(i);return this.state!==u?d(r,this.state===s?e:t,this.outcome):this.queue.push(new l(r,e,t)),r},l.prototype.callFulfilled=function(e){o.resolve(this.promise,e)},l.prototype.otherCallFulfilled=function(e){d(this.promise,this.onFulfilled,e)},l.prototype.callRejected=function(e){o.reject(this.promise,e)},l.prototype.otherCallRejected=function(e){d(this.promise,this.onRejected,e)},o.resolve=function(e,t){var r=m(p,t);if("error"===r.status)return o.reject(e,r.value);var n=r.value;if(n)f(e,n);else{e.state=s,e.outcome=t;for(var i=-1,a=e.queue.length;++i<a;)e.queue[i].callFulfilled(t)}return e},o.reject=function(e,t){e.state=a,e.outcome=t;for(var r=-1,n=e.queue.length;++r<n;)e.queue[r].callRejected(t);return e},c.resolve=function(e){return e instanceof this?e:o.resolve(new this(i),e)},c.reject=function(e){var t=new this(i);return o.reject(t,e)},c.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,n=!1;if(!r)return this.resolve([]);for(var a=new Array(r),s=0,u=-1,c=new this(i);++u<r;)l(e[u],u);return c;function l(e,i){t.resolve(e).then((function(e){a[i]=e,++s!==r||n||(n=!0,o.resolve(c,a))}),(function(e){n||(n=!0,o.reject(c,e))}))}},c.race=function(e){if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var t=e.length,r=!1;if(!t)return this.resolve([]);for(var n,a=-1,s=new this(i);++a<t;)n=e[a],this.resolve(n).then((function(e){r||(r=!0,o.resolve(s,e))}),(function(e){r||(r=!0,o.reject(s,e))}));return s}},{immediate:36}],38:[function(e,t,r){"use strict";var n={};(0,e("./lib/utils/common").assign)(n,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),t.exports=n},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,t,r){"use strict";var n=e("./zlib/deflate"),i=e("./utils/common"),o=e("./utils/strings"),a=e("./zlib/messages"),s=e("./zlib/zstream"),u=Object.prototype.toString,c=0,l=-1,d=0,p=8;function f(e){if(!(this instanceof f))return new f(e);this.options=i.assign({level:l,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:d,to:""},e||{});var t=this.options;t.raw&&0<t.windowBits?t.windowBits=-t.windowBits:t.gzip&&0<t.windowBits&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;var r=n.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==c)throw new Error(a[r]);if(t.header&&n.deflateSetHeader(this.strm,t.header),t.dictionary){var m;if(m="string"==typeof t.dictionary?o.string2buf(t.dictionary):"[object ArrayBuffer]"===u.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(r=n.deflateSetDictionary(this.strm,m))!==c)throw new Error(a[r]);this._dict_set=!0}}function m(e,t){var r=new f(t);if(r.push(e,!0),r.err)throw r.msg||a[r.err];return r.result}f.prototype.push=function(e,t){var r,a,s=this.strm,l=this.options.chunkSize;if(this.ended)return!1;a=t===~~t?t:!0===t?4:0,"string"==typeof e?s.input=o.string2buf(e):"[object ArrayBuffer]"===u.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new i.Buf8(l),s.next_out=0,s.avail_out=l),1!==(r=n.deflate(s,a))&&r!==c)return this.onEnd(r),!(this.ended=!0);0!==s.avail_out&&(0!==s.avail_in||4!==a&&2!==a)||("string"===this.options.to?this.onData(o.buf2binstring(i.shrinkBuf(s.output,s.next_out))):this.onData(i.shrinkBuf(s.output,s.next_out)))}while((0<s.avail_in||0===s.avail_out)&&1!==r);return 4===a?(r=n.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===c):2!==a||(this.onEnd(c),!(s.avail_out=0))},f.prototype.onData=function(e){this.chunks.push(e)},f.prototype.onEnd=function(e){e===c&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},r.Deflate=f,r.deflate=m,r.deflateRaw=function(e,t){return(t=t||{}).raw=!0,m(e,t)},r.gzip=function(e,t){return(t=t||{}).gzip=!0,m(e,t)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,t,r){"use strict";var n=e("./zlib/inflate"),i=e("./utils/common"),o=e("./utils/strings"),a=e("./zlib/constants"),s=e("./zlib/messages"),u=e("./zlib/zstream"),c=e("./zlib/gzheader"),l=Object.prototype.toString;function d(e){if(!(this instanceof d))return new d(e);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&0<=t.windowBits&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(0<=t.windowBits&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),15<t.windowBits&&t.windowBits<48&&!(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var r=n.inflateInit2(this.strm,t.windowBits);if(r!==a.Z_OK)throw new Error(s[r]);this.header=new c,n.inflateGetHeader(this.strm,this.header)}function p(e,t){var r=new d(t);if(r.push(e,!0),r.err)throw r.msg||s[r.err];return r.result}d.prototype.push=function(e,t){var r,s,u,c,d,p,f=this.strm,m=this.options.chunkSize,h=this.options.dictionary,g=!1;if(this.ended)return!1;s=t===~~t?t:!0===t?a.Z_FINISH:a.Z_NO_FLUSH,"string"==typeof e?f.input=o.binstring2buf(e):"[object ArrayBuffer]"===l.call(e)?f.input=new Uint8Array(e):f.input=e,f.next_in=0,f.avail_in=f.input.length;do{if(0===f.avail_out&&(f.output=new i.Buf8(m),f.next_out=0,f.avail_out=m),(r=n.inflate(f,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&h&&(p="string"==typeof h?o.string2buf(h):"[object ArrayBuffer]"===l.call(h)?new Uint8Array(h):h,r=n.inflateSetDictionary(this.strm,p)),r===a.Z_BUF_ERROR&&!0===g&&(r=a.Z_OK,g=!1),r!==a.Z_STREAM_END&&r!==a.Z_OK)return this.onEnd(r),!(this.ended=!0);f.next_out&&(0!==f.avail_out&&r!==a.Z_STREAM_END&&(0!==f.avail_in||s!==a.Z_FINISH&&s!==a.Z_SYNC_FLUSH)||("string"===this.options.to?(u=o.utf8border(f.output,f.next_out),c=f.next_out-u,d=o.buf2string(f.output,u),f.next_out=c,f.avail_out=m-c,c&&i.arraySet(f.output,f.output,u,c,0),this.onData(d)):this.onData(i.shrinkBuf(f.output,f.next_out)))),0===f.avail_in&&0===f.avail_out&&(g=!0)}while((0<f.avail_in||0===f.avail_out)&&r!==a.Z_STREAM_END);return r===a.Z_STREAM_END&&(s=a.Z_FINISH),s===a.Z_FINISH?(r=n.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===a.Z_OK):s!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),!(f.avail_out=0))},d.prototype.onData=function(e){this.chunks.push(e)},d.prototype.onEnd=function(e){e===a.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},r.Inflate=d,r.inflate=p,r.inflateRaw=function(e,t){return(t=t||{}).raw=!0,p(e,t)},r.ungzip=p},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,t,r){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;r.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var r=t.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])}}return e},r.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var i={arraySet:function(e,t,r,n,i){if(t.subarray&&e.subarray)e.set(t.subarray(r,r+n),i);else for(var o=0;o<n;o++)e[i+o]=t[r+o]},flattenChunks:function(e){var t,r,n,i,o,a;for(t=n=0,r=e.length;t<r;t++)n+=e[t].length;for(a=new Uint8Array(n),t=i=0,r=e.length;t<r;t++)o=e[t],a.set(o,i),i+=o.length;return a}},o={arraySet:function(e,t,r,n,i){for(var o=0;o<n;o++)e[i+o]=t[r+o]},flattenChunks:function(e){return[].concat.apply([],e)}};r.setTyped=function(e){e?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,i)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,o))},r.setTyped(n)},{}],42:[function(e,t,r){"use strict";var n=e("./common"),i=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(e){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){o=!1}for(var a=new n.Buf8(256),s=0;s<256;s++)a[s]=252<=s?6:248<=s?5:240<=s?4:224<=s?3:192<=s?2:1;function u(e,t){if(t<65537&&(e.subarray&&o||!e.subarray&&i))return String.fromCharCode.apply(null,n.shrinkBuf(e,t));for(var r="",a=0;a<t;a++)r+=String.fromCharCode(e[a]);return r}a[254]=a[254]=1,r.string2buf=function(e){var t,r,i,o,a,s=e.length,u=0;for(o=0;o<s;o++)55296==(64512&(r=e.charCodeAt(o)))&&o+1<s&&56320==(64512&(i=e.charCodeAt(o+1)))&&(r=65536+(r-55296<<10)+(i-56320),o++),u+=r<128?1:r<2048?2:r<65536?3:4;for(t=new n.Buf8(u),o=a=0;a<u;o++)55296==(64512&(r=e.charCodeAt(o)))&&o+1<s&&56320==(64512&(i=e.charCodeAt(o+1)))&&(r=65536+(r-55296<<10)+(i-56320),o++),r<128?t[a++]=r:(r<2048?t[a++]=192|r>>>6:(r<65536?t[a++]=224|r>>>12:(t[a++]=240|r>>>18,t[a++]=128|r>>>12&63),t[a++]=128|r>>>6&63),t[a++]=128|63&r);return t},r.buf2binstring=function(e){return u(e,e.length)},r.binstring2buf=function(e){for(var t=new n.Buf8(e.length),r=0,i=t.length;r<i;r++)t[r]=e.charCodeAt(r);return t},r.buf2string=function(e,t){var r,n,i,o,s=t||e.length,c=new Array(2*s);for(r=n=0;r<s;)if((i=e[r++])<128)c[n++]=i;else if(4<(o=a[i]))c[n++]=65533,r+=o-1;else{for(i&=2===o?31:3===o?15:7;1<o&&r<s;)i=i<<6|63&e[r++],o--;1<o?c[n++]=65533:i<65536?c[n++]=i:(i-=65536,c[n++]=55296|i>>10&1023,c[n++]=56320|1023&i)}return u(c,n)},r.utf8border=function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;0<=r&&128==(192&e[r]);)r--;return r<0||0===r?t:r+a[e[r]]>t?r:t}},{"./common":41}],43:[function(e,t,r){"use strict";t.exports=function(e,t,r,n){for(var i=65535&e,o=e>>>16&65535,a=0;0!==r;){for(r-=a=2e3<r?2e3:r;o=o+(i=i+t[n++]|0)|0,--a;);i%=65521,o%=65521}return i|o<<16}},{}],44:[function(e,t,r){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,t,r){"use strict";var n=function(){for(var e,t=[],r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}();t.exports=function(e,t,r,i){var o=n,a=i+r;e^=-1;for(var s=i;s<a;s++)e=e>>>8^o[255&(e^t[s])];return~e}},{}],46:[function(e,t,r){"use strict";var n,i=e("../utils/common"),o=e("./trees"),a=e("./adler32"),s=e("./crc32"),u=e("./messages"),c=0,l=0,d=-2,p=2,f=8,m=286,h=30,g=19,y=2*m+1,v=15,b=3,w=258,I=w+b+1,x=42,_=113;function k(e,t){return e.msg=u[t],t}function S(e){return(e<<1)-(4<e?9:0)}function E(e){for(var t=e.length;0<=--t;)e[t]=0}function A(e){var t=e.state,r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(i.arraySet(e.output,t.pending_buf,t.pending_out,r,e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))}function P(e,t){o._tr_flush_block(e,0<=e.block_start?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,A(e.strm)}function O(e,t){e.pending_buf[e.pending++]=t}function T(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function C(e,t){var r,n,i=e.max_chain_length,o=e.strstart,a=e.prev_length,s=e.nice_match,u=e.strstart>e.w_size-I?e.strstart-(e.w_size-I):0,c=e.window,l=e.w_mask,d=e.prev,p=e.strstart+w,f=c[o+a-1],m=c[o+a];e.prev_length>=e.good_match&&(i>>=2),s>e.lookahead&&(s=e.lookahead);do{if(c[(r=t)+a]===m&&c[r+a-1]===f&&c[r]===c[o]&&c[++r]===c[o+1]){o+=2,r++;do{}while(c[++o]===c[++r]&&c[++o]===c[++r]&&c[++o]===c[++r]&&c[++o]===c[++r]&&c[++o]===c[++r]&&c[++o]===c[++r]&&c[++o]===c[++r]&&c[++o]===c[++r]&&o<p);if(n=w-(p-o),o=p-w,a<n){if(e.match_start=t,s<=(a=n))break;f=c[o+a-1],m=c[o+a]}}}while((t=d[t&l])>u&&0!=--i);return a<=e.lookahead?a:e.lookahead}function R(e){var t,r,n,o,u,c,l,d,p,f,m=e.w_size;do{if(o=e.window_size-e.lookahead-e.strstart,e.strstart>=m+(m-I)){for(i.arraySet(e.window,e.window,m,m,0),e.match_start-=m,e.strstart-=m,e.block_start-=m,t=r=e.hash_size;n=e.head[--t],e.head[t]=m<=n?n-m:0,--r;);for(t=r=m;n=e.prev[--t],e.prev[t]=m<=n?n-m:0,--r;);o+=m}if(0===e.strm.avail_in)break;if(c=e.strm,l=e.window,d=e.strstart+e.lookahead,f=void 0,(p=o)<(f=c.avail_in)&&(f=p),r=0===f?0:(c.avail_in-=f,i.arraySet(l,c.input,c.next_in,f,d),1===c.state.wrap?c.adler=a(c.adler,l,f,d):2===c.state.wrap&&(c.adler=s(c.adler,l,f,d)),c.next_in+=f,c.total_in+=f,f),e.lookahead+=r,e.lookahead+e.insert>=b)for(u=e.strstart-e.insert,e.ins_h=e.window[u],e.ins_h=(e.ins_h<<e.hash_shift^e.window[u+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[u+b-1])&e.hash_mask,e.prev[u&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=u,u++,e.insert--,!(e.lookahead+e.insert<b)););}while(e.lookahead<I&&0!==e.strm.avail_in)}function M(e,t){for(var r,n;;){if(e.lookahead<I){if(R(e),e.lookahead<I&&t===c)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=b&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+b-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-I&&(e.match_length=C(e,r)),e.match_length>=b)if(n=o._tr_tally(e,e.strstart-e.match_start,e.match_length-b),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=b){for(e.match_length--;e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+b-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart,0!=--e.match_length;);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else n=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(P(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<b-1?e.strstart:b-1,4===t?(P(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(P(e,!1),0===e.strm.avail_out)?1:2}function F(e,t){for(var r,n,i;;){if(e.lookahead<I){if(R(e),e.lookahead<I&&t===c)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=b&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+b-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=b-1,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-I&&(e.match_length=C(e,r),e.match_length<=5&&(1===e.strategy||e.match_length===b&&4096<e.strstart-e.match_start)&&(e.match_length=b-1)),e.prev_length>=b&&e.match_length<=e.prev_length){for(i=e.strstart+e.lookahead-b,n=o._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-b),e.lookahead-=e.prev_length-1,e.prev_length-=2;++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+b-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!=--e.prev_length;);if(e.match_available=0,e.match_length=b-1,e.strstart++,n&&(P(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((n=o._tr_tally(e,0,e.window[e.strstart-1]))&&P(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=o._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<b-1?e.strstart:b-1,4===t?(P(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(P(e,!1),0===e.strm.avail_out)?1:2}function D(e,t,r,n,i){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=i}function j(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=f,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(2*y),this.dyn_dtree=new i.Buf16(2*(2*h+1)),this.bl_tree=new i.Buf16(2*(2*g+1)),E(this.dyn_ltree),E(this.dyn_dtree),E(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(v+1),this.heap=new i.Buf16(2*m+1),E(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(2*m+1),E(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function G(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=p,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?x:_,e.adler=2===t.wrap?0:1,t.last_flush=c,o._tr_init(t),l):k(e,d)}function z(e){var t=G(e);return t===l&&function(e){e.window_size=2*e.w_size,E(e.head),e.max_lazy_match=n[e.level].max_lazy,e.good_match=n[e.level].good_length,e.nice_match=n[e.level].nice_length,e.max_chain_length=n[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=b-1,e.match_available=0,e.ins_h=0}(e.state),t}function L(e,t,r,n,o,a){if(!e)return d;var s=1;if(-1===t&&(t=6),n<0?(s=0,n=-n):15<n&&(s=2,n-=16),o<1||9<o||r!==f||n<8||15<n||t<0||9<t||a<0||4<a)return k(e,d);8===n&&(n=9);var u=new j;return(e.state=u).strm=e,u.wrap=s,u.gzhead=null,u.w_bits=n,u.w_size=1<<u.w_bits,u.w_mask=u.w_size-1,u.hash_bits=o+7,u.hash_size=1<<u.hash_bits,u.hash_mask=u.hash_size-1,u.hash_shift=~~((u.hash_bits+b-1)/b),u.window=new i.Buf8(2*u.w_size),u.head=new i.Buf16(u.hash_size),u.prev=new i.Buf16(u.w_size),u.lit_bufsize=1<<o+6,u.pending_buf_size=4*u.lit_bufsize,u.pending_buf=new i.Buf8(u.pending_buf_size),u.d_buf=1*u.lit_bufsize,u.l_buf=3*u.lit_bufsize,u.level=t,u.strategy=a,u.method=r,z(e)}n=[new D(0,0,0,0,(function(e,t){var r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(R(e),0===e.lookahead&&t===c)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var n=e.block_start+r;if((0===e.strstart||e.strstart>=n)&&(e.lookahead=e.strstart-n,e.strstart=n,P(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-I&&(P(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(P(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(P(e,!1),e.strm.avail_out),1)})),new D(4,4,8,4,M),new D(4,5,16,8,M),new D(4,6,32,32,M),new D(4,4,16,16,F),new D(8,16,32,32,F),new D(8,16,128,128,F),new D(8,32,128,256,F),new D(32,128,258,1024,F),new D(32,258,258,4096,F)],r.deflateInit=function(e,t){return L(e,t,f,15,8,0)},r.deflateInit2=L,r.deflateReset=z,r.deflateResetKeep=G,r.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?d:(e.state.gzhead=t,l):d},r.deflate=function(e,t){var r,i,a,u;if(!e||!e.state||5<t||t<0)return e?k(e,d):d;if(i=e.state,!e.output||!e.input&&0!==e.avail_in||666===i.status&&4!==t)return k(e,0===e.avail_out?-5:d);if(i.strm=e,r=i.last_flush,i.last_flush=t,i.status===x)if(2===i.wrap)e.adler=0,O(i,31),O(i,139),O(i,8),i.gzhead?(O(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),O(i,255&i.gzhead.time),O(i,i.gzhead.time>>8&255),O(i,i.gzhead.time>>16&255),O(i,i.gzhead.time>>24&255),O(i,9===i.level?2:2<=i.strategy||i.level<2?4:0),O(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(O(i,255&i.gzhead.extra.length),O(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=s(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69):(O(i,0),O(i,0),O(i,0),O(i,0),O(i,0),O(i,9===i.level?2:2<=i.strategy||i.level<2?4:0),O(i,3),i.status=_);else{var p=f+(i.w_bits-8<<4)<<8;p|=(2<=i.strategy||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(p|=32),p+=31-p%31,i.status=_,T(i,p),0!==i.strstart&&(T(i,e.adler>>>16),T(i,65535&e.adler)),e.adler=1}if(69===i.status)if(i.gzhead.extra){for(a=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>a&&(e.adler=s(e.adler,i.pending_buf,i.pending-a,a)),A(e),a=i.pending,i.pending!==i.pending_buf_size));)O(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>a&&(e.adler=s(e.adler,i.pending_buf,i.pending-a,a)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=73)}else i.status=73;if(73===i.status)if(i.gzhead.name){a=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>a&&(e.adler=s(e.adler,i.pending_buf,i.pending-a,a)),A(e),a=i.pending,i.pending===i.pending_buf_size)){u=1;break}u=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,O(i,u)}while(0!==u);i.gzhead.hcrc&&i.pending>a&&(e.adler=s(e.adler,i.pending_buf,i.pending-a,a)),0===u&&(i.gzindex=0,i.status=91)}else i.status=91;if(91===i.status)if(i.gzhead.comment){a=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>a&&(e.adler=s(e.adler,i.pending_buf,i.pending-a,a)),A(e),a=i.pending,i.pending===i.pending_buf_size)){u=1;break}u=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,O(i,u)}while(0!==u);i.gzhead.hcrc&&i.pending>a&&(e.adler=s(e.adler,i.pending_buf,i.pending-a,a)),0===u&&(i.status=103)}else i.status=103;if(103===i.status&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&A(e),i.pending+2<=i.pending_buf_size&&(O(i,255&e.adler),O(i,e.adler>>8&255),e.adler=0,i.status=_)):i.status=_),0!==i.pending){if(A(e),0===e.avail_out)return i.last_flush=-1,l}else if(0===e.avail_in&&S(t)<=S(r)&&4!==t)return k(e,-5);if(666===i.status&&0!==e.avail_in)return k(e,-5);if(0!==e.avail_in||0!==i.lookahead||t!==c&&666!==i.status){var m=2===i.strategy?function(e,t){for(var r;;){if(0===e.lookahead&&(R(e),0===e.lookahead)){if(t===c)return 1;break}if(e.match_length=0,r=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(P(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(P(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(P(e,!1),0===e.strm.avail_out)?1:2}(i,t):3===i.strategy?function(e,t){for(var r,n,i,a,s=e.window;;){if(e.lookahead<=w){if(R(e),e.lookahead<=w&&t===c)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=b&&0<e.strstart&&(n=s[i=e.strstart-1])===s[++i]&&n===s[++i]&&n===s[++i]){a=e.strstart+w;do{}while(n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&i<a);e.match_length=w-(a-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=b?(r=o._tr_tally(e,1,e.match_length-b),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(P(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(P(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(P(e,!1),0===e.strm.avail_out)?1:2}(i,t):n[i.level].func(i,t);if(3!==m&&4!==m||(i.status=666),1===m||3===m)return 0===e.avail_out&&(i.last_flush=-1),l;if(2===m&&(1===t?o._tr_align(i):5!==t&&(o._tr_stored_block(i,0,0,!1),3===t&&(E(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),A(e),0===e.avail_out))return i.last_flush=-1,l}return 4!==t?l:i.wrap<=0?1:(2===i.wrap?(O(i,255&e.adler),O(i,e.adler>>8&255),O(i,e.adler>>16&255),O(i,e.adler>>24&255),O(i,255&e.total_in),O(i,e.total_in>>8&255),O(i,e.total_in>>16&255),O(i,e.total_in>>24&255)):(T(i,e.adler>>>16),T(i,65535&e.adler)),A(e),0<i.wrap&&(i.wrap=-i.wrap),0!==i.pending?l:1)},r.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==x&&69!==t&&73!==t&&91!==t&&103!==t&&t!==_&&666!==t?k(e,d):(e.state=null,t===_?k(e,-3):l):d},r.deflateSetDictionary=function(e,t){var r,n,o,s,u,c,p,f,m=t.length;if(!e||!e.state)return d;if(2===(s=(r=e.state).wrap)||1===s&&r.status!==x||r.lookahead)return d;for(1===s&&(e.adler=a(e.adler,t,m,0)),r.wrap=0,m>=r.w_size&&(0===s&&(E(r.head),r.strstart=0,r.block_start=0,r.insert=0),f=new i.Buf8(r.w_size),i.arraySet(f,t,m-r.w_size,r.w_size,0),t=f,m=r.w_size),u=e.avail_in,c=e.next_in,p=e.input,e.avail_in=m,e.next_in=0,e.input=t,R(r);r.lookahead>=b;){for(n=r.strstart,o=r.lookahead-(b-1);r.ins_h=(r.ins_h<<r.hash_shift^r.window[n+b-1])&r.hash_mask,r.prev[n&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=n,n++,--o;);r.strstart=n,r.lookahead=b-1,R(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=b-1,r.match_available=0,e.next_in=c,e.input=p,e.avail_in=u,r.wrap=s,l},r.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,t,r){"use strict";t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,t,r){"use strict";t.exports=function(e,t){var r,n,i,o,a,s,u,c,l,d,p,f,m,h,g,y,v,b,w,I,x,_,k,S,E;r=e.state,n=e.next_in,S=e.input,i=n+(e.avail_in-5),o=e.next_out,E=e.output,a=o-(t-e.avail_out),s=o+(e.avail_out-257),u=r.dmax,c=r.wsize,l=r.whave,d=r.wnext,p=r.window,f=r.hold,m=r.bits,h=r.lencode,g=r.distcode,y=(1<<r.lenbits)-1,v=(1<<r.distbits)-1;e:do{m<15&&(f+=S[n++]<<m,m+=8,f+=S[n++]<<m,m+=8),b=h[f&y];t:for(;;){if(f>>>=w=b>>>24,m-=w,0==(w=b>>>16&255))E[o++]=65535&b;else{if(!(16&w)){if(!(64&w)){b=h[(65535&b)+(f&(1<<w)-1)];continue t}if(32&w){r.mode=12;break e}e.msg="invalid literal/length code",r.mode=30;break e}I=65535&b,(w&=15)&&(m<w&&(f+=S[n++]<<m,m+=8),I+=f&(1<<w)-1,f>>>=w,m-=w),m<15&&(f+=S[n++]<<m,m+=8,f+=S[n++]<<m,m+=8),b=g[f&v];r:for(;;){if(f>>>=w=b>>>24,m-=w,!(16&(w=b>>>16&255))){if(!(64&w)){b=g[(65535&b)+(f&(1<<w)-1)];continue r}e.msg="invalid distance code",r.mode=30;break e}if(x=65535&b,m<(w&=15)&&(f+=S[n++]<<m,(m+=8)<w&&(f+=S[n++]<<m,m+=8)),u<(x+=f&(1<<w)-1)){e.msg="invalid distance too far back",r.mode=30;break e}if(f>>>=w,m-=w,(w=o-a)<x){if(l<(w=x-w)&&r.sane){e.msg="invalid distance too far back",r.mode=30;break e}if(k=p,(_=0)===d){if(_+=c-w,w<I){for(I-=w;E[o++]=p[_++],--w;);_=o-x,k=E}}else if(d<w){if(_+=c+d-w,(w-=d)<I){for(I-=w;E[o++]=p[_++],--w;);if(_=0,d<I){for(I-=w=d;E[o++]=p[_++],--w;);_=o-x,k=E}}}else if(_+=d-w,w<I){for(I-=w;E[o++]=p[_++],--w;);_=o-x,k=E}for(;2<I;)E[o++]=k[_++],E[o++]=k[_++],E[o++]=k[_++],I-=3;I&&(E[o++]=k[_++],1<I&&(E[o++]=k[_++]))}else{for(_=o-x;E[o++]=E[_++],E[o++]=E[_++],E[o++]=E[_++],2<(I-=3););I&&(E[o++]=E[_++],1<I&&(E[o++]=E[_++]))}break}}break}}while(n<i&&o<s);n-=I=m>>3,f&=(1<<(m-=I<<3))-1,e.next_in=n,e.next_out=o,e.avail_in=n<i?i-n+5:5-(n-i),e.avail_out=o<s?s-o+257:257-(o-s),r.hold=f,r.bits=m}},{}],49:[function(e,t,r){"use strict";var n=e("../utils/common"),i=e("./adler32"),o=e("./crc32"),a=e("./inffast"),s=e("./inftrees"),u=0,c=-2,l=1,d=852,p=592;function f(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function m(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function h(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=l,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new n.Buf32(d),t.distcode=t.distdyn=new n.Buf32(p),t.sane=1,t.back=-1,u):c}function g(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,h(e)):c}function y(e,t){var r,n;return e&&e.state?(n=e.state,t<0?(r=0,t=-t):(r=1+(t>>4),t<48&&(t&=15)),t&&(t<8||15<t)?c:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,g(e))):c}function v(e,t){var r,n;return e?(n=new m,(e.state=n).window=null,(r=y(e,t))!==u&&(e.state=null),r):c}var b,w,I=!0;function x(e){if(I){var t;for(b=new n.Buf32(512),w=new n.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(s(1,e.lens,0,288,b,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;s(2,e.lens,0,32,w,0,e.work,{bits:5}),I=!1}e.lencode=b,e.lenbits=9,e.distcode=w,e.distbits=5}function _(e,t,r,i){var o,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new n.Buf8(a.wsize)),i>=a.wsize?(n.arraySet(a.window,t,r-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):(i<(o=a.wsize-a.wnext)&&(o=i),n.arraySet(a.window,t,r-i,o,a.wnext),(i-=o)?(n.arraySet(a.window,t,r-i,i,0),a.wnext=i,a.whave=a.wsize):(a.wnext+=o,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=o))),0}r.inflateReset=g,r.inflateReset2=y,r.inflateResetKeep=h,r.inflateInit=function(e){return v(e,15)},r.inflateInit2=v,r.inflate=function(e,t){var r,d,p,m,h,g,y,v,b,w,I,k,S,E,A,P,O,T,C,R,M,F,D,j,G=0,z=new n.Buf8(4),L=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return c;12===(r=e.state).mode&&(r.mode=13),h=e.next_out,p=e.output,y=e.avail_out,m=e.next_in,d=e.input,g=e.avail_in,v=r.hold,b=r.bits,w=g,I=y,F=u;e:for(;;)switch(r.mode){case l:if(0===r.wrap){r.mode=13;break}for(;b<16;){if(0===g)break e;g--,v+=d[m++]<<b,b+=8}if(2&r.wrap&&35615===v){z[r.check=0]=255&v,z[1]=v>>>8&255,r.check=o(r.check,z,2,0),b=v=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&v)<<8)+(v>>8))%31){e.msg="incorrect header check",r.mode=30;break}if(8!=(15&v)){e.msg="unknown compression method",r.mode=30;break}if(b-=4,M=8+(15&(v>>>=4)),0===r.wbits)r.wbits=M;else if(M>r.wbits){e.msg="invalid window size",r.mode=30;break}r.dmax=1<<M,e.adler=r.check=1,r.mode=512&v?10:12,b=v=0;break;case 2:for(;b<16;){if(0===g)break e;g--,v+=d[m++]<<b,b+=8}if(r.flags=v,8!=(255&r.flags)){e.msg="unknown compression method",r.mode=30;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=30;break}r.head&&(r.head.text=v>>8&1),512&r.flags&&(z[0]=255&v,z[1]=v>>>8&255,r.check=o(r.check,z,2,0)),b=v=0,r.mode=3;case 3:for(;b<32;){if(0===g)break e;g--,v+=d[m++]<<b,b+=8}r.head&&(r.head.time=v),512&r.flags&&(z[0]=255&v,z[1]=v>>>8&255,z[2]=v>>>16&255,z[3]=v>>>24&255,r.check=o(r.check,z,4,0)),b=v=0,r.mode=4;case 4:for(;b<16;){if(0===g)break e;g--,v+=d[m++]<<b,b+=8}r.head&&(r.head.xflags=255&v,r.head.os=v>>8),512&r.flags&&(z[0]=255&v,z[1]=v>>>8&255,r.check=o(r.check,z,2,0)),b=v=0,r.mode=5;case 5:if(1024&r.flags){for(;b<16;){if(0===g)break e;g--,v+=d[m++]<<b,b+=8}r.length=v,r.head&&(r.head.extra_len=v),512&r.flags&&(z[0]=255&v,z[1]=v>>>8&255,r.check=o(r.check,z,2,0)),b=v=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags&&(g<(k=r.length)&&(k=g),k&&(r.head&&(M=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),n.arraySet(r.head.extra,d,m,k,M)),512&r.flags&&(r.check=o(r.check,d,k,m)),g-=k,m+=k,r.length-=k),r.length))break e;r.length=0,r.mode=7;case 7:if(2048&r.flags){if(0===g)break e;for(k=0;M=d[m+k++],r.head&&M&&r.length<65536&&(r.head.name+=String.fromCharCode(M)),M&&k<g;);if(512&r.flags&&(r.check=o(r.check,d,k,m)),g-=k,m+=k,M)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(0===g)break e;for(k=0;M=d[m+k++],r.head&&M&&r.length<65536&&(r.head.comment+=String.fromCharCode(M)),M&&k<g;);if(512&r.flags&&(r.check=o(r.check,d,k,m)),g-=k,m+=k,M)break e}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;b<16;){if(0===g)break e;g--,v+=d[m++]<<b,b+=8}if(v!==(65535&r.check)){e.msg="header crc mismatch",r.mode=30;break}b=v=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=12;break;case 10:for(;b<32;){if(0===g)break e;g--,v+=d[m++]<<b,b+=8}e.adler=r.check=f(v),b=v=0,r.mode=11;case 11:if(0===r.havedict)return e.next_out=h,e.avail_out=y,e.next_in=m,e.avail_in=g,r.hold=v,r.bits=b,2;e.adler=r.check=1,r.mode=12;case 12:if(5===t||6===t)break e;case 13:if(r.last){v>>>=7&b,b-=7&b,r.mode=27;break}for(;b<3;){if(0===g)break e;g--,v+=d[m++]<<b,b+=8}switch(r.last=1&v,b-=1,3&(v>>>=1)){case 0:r.mode=14;break;case 1:if(x(r),r.mode=20,6!==t)break;v>>>=2,b-=2;break e;case 2:r.mode=17;break;case 3:e.msg="invalid block type",r.mode=30}v>>>=2,b-=2;break;case 14:for(v>>>=7&b,b-=7&b;b<32;){if(0===g)break e;g--,v+=d[m++]<<b,b+=8}if((65535&v)!=(v>>>16^65535)){e.msg="invalid stored block lengths",r.mode=30;break}if(r.length=65535&v,b=v=0,r.mode=15,6===t)break e;case 15:r.mode=16;case 16:if(k=r.length){if(g<k&&(k=g),y<k&&(k=y),0===k)break e;n.arraySet(p,d,m,k,h),g-=k,m+=k,y-=k,h+=k,r.length-=k;break}r.mode=12;break;case 17:for(;b<14;){if(0===g)break e;g--,v+=d[m++]<<b,b+=8}if(r.nlen=257+(31&v),v>>>=5,b-=5,r.ndist=1+(31&v),v>>>=5,b-=5,r.ncode=4+(15&v),v>>>=4,b-=4,286<r.nlen||30<r.ndist){e.msg="too many length or distance symbols",r.mode=30;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;b<3;){if(0===g)break e;g--,v+=d[m++]<<b,b+=8}r.lens[L[r.have++]]=7&v,v>>>=3,b-=3}for(;r.have<19;)r.lens[L[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,D={bits:r.lenbits},F=s(0,r.lens,0,19,r.lencode,0,r.work,D),r.lenbits=D.bits,F){e.msg="invalid code lengths set",r.mode=30;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;P=(G=r.lencode[v&(1<<r.lenbits)-1])>>>16&255,O=65535&G,!((A=G>>>24)<=b);){if(0===g)break e;g--,v+=d[m++]<<b,b+=8}if(O<16)v>>>=A,b-=A,r.lens[r.have++]=O;else{if(16===O){for(j=A+2;b<j;){if(0===g)break e;g--,v+=d[m++]<<b,b+=8}if(v>>>=A,b-=A,0===r.have){e.msg="invalid bit length repeat",r.mode=30;break}M=r.lens[r.have-1],k=3+(3&v),v>>>=2,b-=2}else if(17===O){for(j=A+3;b<j;){if(0===g)break e;g--,v+=d[m++]<<b,b+=8}b-=A,M=0,k=3+(7&(v>>>=A)),v>>>=3,b-=3}else{for(j=A+7;b<j;){if(0===g)break e;g--,v+=d[m++]<<b,b+=8}b-=A,M=0,k=11+(127&(v>>>=A)),v>>>=7,b-=7}if(r.have+k>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=30;break}for(;k--;)r.lens[r.have++]=M}}if(30===r.mode)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=30;break}if(r.lenbits=9,D={bits:r.lenbits},F=s(1,r.lens,0,r.nlen,r.lencode,0,r.work,D),r.lenbits=D.bits,F){e.msg="invalid literal/lengths set",r.mode=30;break}if(r.distbits=6,r.distcode=r.distdyn,D={bits:r.distbits},F=s(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,D),r.distbits=D.bits,F){e.msg="invalid distances set",r.mode=30;break}if(r.mode=20,6===t)break e;case 20:r.mode=21;case 21:if(6<=g&&258<=y){e.next_out=h,e.avail_out=y,e.next_in=m,e.avail_in=g,r.hold=v,r.bits=b,a(e,I),h=e.next_out,p=e.output,y=e.avail_out,m=e.next_in,d=e.input,g=e.avail_in,v=r.hold,b=r.bits,12===r.mode&&(r.back=-1);break}for(r.back=0;P=(G=r.lencode[v&(1<<r.lenbits)-1])>>>16&255,O=65535&G,!((A=G>>>24)<=b);){if(0===g)break e;g--,v+=d[m++]<<b,b+=8}if(P&&!(240&P)){for(T=A,C=P,R=O;P=(G=r.lencode[R+((v&(1<<T+C)-1)>>T)])>>>16&255,O=65535&G,!(T+(A=G>>>24)<=b);){if(0===g)break e;g--,v+=d[m++]<<b,b+=8}v>>>=T,b-=T,r.back+=T}if(v>>>=A,b-=A,r.back+=A,r.length=O,0===P){r.mode=26;break}if(32&P){r.back=-1,r.mode=12;break}if(64&P){e.msg="invalid literal/length code",r.mode=30;break}r.extra=15&P,r.mode=22;case 22:if(r.extra){for(j=r.extra;b<j;){if(0===g)break e;g--,v+=d[m++]<<b,b+=8}r.length+=v&(1<<r.extra)-1,v>>>=r.extra,b-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;P=(G=r.distcode[v&(1<<r.distbits)-1])>>>16&255,O=65535&G,!((A=G>>>24)<=b);){if(0===g)break e;g--,v+=d[m++]<<b,b+=8}if(!(240&P)){for(T=A,C=P,R=O;P=(G=r.distcode[R+((v&(1<<T+C)-1)>>T)])>>>16&255,O=65535&G,!(T+(A=G>>>24)<=b);){if(0===g)break e;g--,v+=d[m++]<<b,b+=8}v>>>=T,b-=T,r.back+=T}if(v>>>=A,b-=A,r.back+=A,64&P){e.msg="invalid distance code",r.mode=30;break}r.offset=O,r.extra=15&P,r.mode=24;case 24:if(r.extra){for(j=r.extra;b<j;){if(0===g)break e;g--,v+=d[m++]<<b,b+=8}r.offset+=v&(1<<r.extra)-1,v>>>=r.extra,b-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=30;break}r.mode=25;case 25:if(0===y)break e;if(k=I-y,r.offset>k){if((k=r.offset-k)>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=30;break}S=k>r.wnext?(k-=r.wnext,r.wsize-k):r.wnext-k,k>r.length&&(k=r.length),E=r.window}else E=p,S=h-r.offset,k=r.length;for(y<k&&(k=y),y-=k,r.length-=k;p[h++]=E[S++],--k;);0===r.length&&(r.mode=21);break;case 26:if(0===y)break e;p[h++]=r.length,y--,r.mode=21;break;case 27:if(r.wrap){for(;b<32;){if(0===g)break e;g--,v|=d[m++]<<b,b+=8}if(I-=y,e.total_out+=I,r.total+=I,I&&(e.adler=r.check=r.flags?o(r.check,p,I,h-I):i(r.check,p,I,h-I)),I=y,(r.flags?v:f(v))!==r.check){e.msg="incorrect data check",r.mode=30;break}b=v=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;b<32;){if(0===g)break e;g--,v+=d[m++]<<b,b+=8}if(v!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=30;break}b=v=0}r.mode=29;case 29:F=1;break e;case 30:F=-3;break e;case 31:return-4;default:return c}return e.next_out=h,e.avail_out=y,e.next_in=m,e.avail_in=g,r.hold=v,r.bits=b,(r.wsize||I!==e.avail_out&&r.mode<30&&(r.mode<27||4!==t))&&_(e,e.output,e.next_out,I-e.avail_out)?(r.mode=31,-4):(w-=e.avail_in,I-=e.avail_out,e.total_in+=w,e.total_out+=I,r.total+=I,r.wrap&&I&&(e.adler=r.check=r.flags?o(r.check,p,I,e.next_out-I):i(r.check,p,I,e.next_out-I)),e.data_type=r.bits+(r.last?64:0)+(12===r.mode?128:0)+(20===r.mode||15===r.mode?256:0),(0==w&&0===I||4===t)&&F===u&&(F=-5),F)},r.inflateEnd=function(e){if(!e||!e.state)return c;var t=e.state;return t.window&&(t.window=null),e.state=null,u},r.inflateGetHeader=function(e,t){var r;return e&&e.state&&2&(r=e.state).wrap?((r.head=t).done=!1,u):c},r.inflateSetDictionary=function(e,t){var r,n=t.length;return e&&e.state?0!==(r=e.state).wrap&&11!==r.mode?c:11===r.mode&&i(1,t,n,0)!==r.check?-3:_(e,t,n,n)?(r.mode=31,-4):(r.havedict=1,u):c},r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,t,r){"use strict";var n=e("../utils/common"),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,r,u,c,l,d,p){var f,m,h,g,y,v,b,w,I,x=p.bits,_=0,k=0,S=0,E=0,A=0,P=0,O=0,T=0,C=0,R=0,M=null,F=0,D=new n.Buf16(16),j=new n.Buf16(16),G=null,z=0;for(_=0;_<=15;_++)D[_]=0;for(k=0;k<u;k++)D[t[r+k]]++;for(A=x,E=15;1<=E&&0===D[E];E--);if(E<A&&(A=E),0===E)return c[l++]=20971520,c[l++]=20971520,p.bits=1,0;for(S=1;S<E&&0===D[S];S++);for(A<S&&(A=S),_=T=1;_<=15;_++)if(T<<=1,(T-=D[_])<0)return-1;if(0<T&&(0===e||1!==E))return-1;for(j[1]=0,_=1;_<15;_++)j[_+1]=j[_]+D[_];for(k=0;k<u;k++)0!==t[r+k]&&(d[j[t[r+k]]++]=k);if(v=0===e?(M=G=d,19):1===e?(M=i,F-=257,G=o,z-=257,256):(M=a,G=s,-1),_=S,y=l,O=k=R=0,h=-1,g=(C=1<<(P=A))-1,1===e&&852<C||2===e&&592<C)return 1;for(;;){for(b=_-O,I=d[k]<v?(w=0,d[k]):d[k]>v?(w=G[z+d[k]],M[F+d[k]]):(w=96,0),f=1<<_-O,S=m=1<<P;c[y+(R>>O)+(m-=f)]=b<<24|w<<16|I,0!==m;);for(f=1<<_-1;R&f;)f>>=1;if(0!==f?(R&=f-1,R+=f):R=0,k++,0==--D[_]){if(_===E)break;_=t[r+d[k]]}if(A<_&&(R&g)!==h){for(0===O&&(O=A),y+=S,T=1<<(P=_-O);P+O<E&&!((T-=D[P+O])<=0);)P++,T<<=1;if(C+=1<<P,1===e&&852<C||2===e&&592<C)return 1;c[h=R&g]=A<<24|P<<16|y-l}}return 0!==R&&(c[y+R]=_-O<<24|64<<16),p.bits=A,0}},{"../utils/common":41}],51:[function(e,t,r){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,t,r){"use strict";var n=e("../utils/common");function i(e){for(var t=e.length;0<=--t;)e[t]=0}var o=256,a=286,s=30,u=15,c=16,l=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],d=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],p=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],f=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],m=new Array(576);i(m);var h=new Array(60);i(h);var g=new Array(512);i(g);var y=new Array(256);i(y);var v=new Array(29);i(v);var b,w,I,x=new Array(s);function _(e,t,r,n,i){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=e&&e.length}function k(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function S(e){return e<256?g[e]:g[256+(e>>>7)]}function E(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function A(e,t,r){e.bi_valid>c-r?(e.bi_buf|=t<<e.bi_valid&65535,E(e,e.bi_buf),e.bi_buf=t>>c-e.bi_valid,e.bi_valid+=r-c):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)}function P(e,t,r){A(e,r[2*t],r[2*t+1])}function O(e,t){for(var r=0;r|=1&e,e>>>=1,r<<=1,0<--t;);return r>>>1}function T(e,t,r){var n,i,o=new Array(u+1),a=0;for(n=1;n<=u;n++)o[n]=a=a+r[n-1]<<1;for(i=0;i<=t;i++){var s=e[2*i+1];0!==s&&(e[2*i]=O(o[s]++,s))}}function C(e){var t;for(t=0;t<a;t++)e.dyn_ltree[2*t]=0;for(t=0;t<s;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function R(e){8<e.bi_valid?E(e,e.bi_buf):0<e.bi_valid&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function M(e,t,r,n){var i=2*t,o=2*r;return e[i]<e[o]||e[i]===e[o]&&n[t]<=n[r]}function F(e,t,r){for(var n=e.heap[r],i=r<<1;i<=e.heap_len&&(i<e.heap_len&&M(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!M(t,n,e.heap[i],e.depth));)e.heap[r]=e.heap[i],r=i,i<<=1;e.heap[r]=n}function D(e,t,r){var n,i,a,s,u=0;if(0!==e.last_lit)for(;n=e.pending_buf[e.d_buf+2*u]<<8|e.pending_buf[e.d_buf+2*u+1],i=e.pending_buf[e.l_buf+u],u++,0===n?P(e,i,t):(P(e,(a=y[i])+o+1,t),0!==(s=l[a])&&A(e,i-=v[a],s),P(e,a=S(--n),r),0!==(s=d[a])&&A(e,n-=x[a],s)),u<e.last_lit;);P(e,256,t)}function j(e,t){var r,n,i,o=t.dyn_tree,a=t.stat_desc.static_tree,s=t.stat_desc.has_stree,c=t.stat_desc.elems,l=-1;for(e.heap_len=0,e.heap_max=573,r=0;r<c;r++)0!==o[2*r]?(e.heap[++e.heap_len]=l=r,e.depth[r]=0):o[2*r+1]=0;for(;e.heap_len<2;)o[2*(i=e.heap[++e.heap_len]=l<2?++l:0)]=1,e.depth[i]=0,e.opt_len--,s&&(e.static_len-=a[2*i+1]);for(t.max_code=l,r=e.heap_len>>1;1<=r;r--)F(e,o,r);for(i=c;r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],F(e,o,1),n=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=n,o[2*i]=o[2*r]+o[2*n],e.depth[i]=(e.depth[r]>=e.depth[n]?e.depth[r]:e.depth[n])+1,o[2*r+1]=o[2*n+1]=i,e.heap[1]=i++,F(e,o,1),2<=e.heap_len;);e.heap[--e.heap_max]=e.heap[1],function(e,t){var r,n,i,o,a,s,c=t.dyn_tree,l=t.max_code,d=t.stat_desc.static_tree,p=t.stat_desc.has_stree,f=t.stat_desc.extra_bits,m=t.stat_desc.extra_base,h=t.stat_desc.max_length,g=0;for(o=0;o<=u;o++)e.bl_count[o]=0;for(c[2*e.heap[e.heap_max]+1]=0,r=e.heap_max+1;r<573;r++)h<(o=c[2*c[2*(n=e.heap[r])+1]+1]+1)&&(o=h,g++),c[2*n+1]=o,l<n||(e.bl_count[o]++,a=0,m<=n&&(a=f[n-m]),s=c[2*n],e.opt_len+=s*(o+a),p&&(e.static_len+=s*(d[2*n+1]+a)));if(0!==g){do{for(o=h-1;0===e.bl_count[o];)o--;e.bl_count[o]--,e.bl_count[o+1]+=2,e.bl_count[h]--,g-=2}while(0<g);for(o=h;0!==o;o--)for(n=e.bl_count[o];0!==n;)l<(i=e.heap[--r])||(c[2*i+1]!==o&&(e.opt_len+=(o-c[2*i+1])*c[2*i],c[2*i+1]=o),n--)}}(e,t),T(o,l,e.bl_count)}function G(e,t,r){var n,i,o=-1,a=t[1],s=0,u=7,c=4;for(0===a&&(u=138,c=3),t[2*(r+1)+1]=65535,n=0;n<=r;n++)i=a,a=t[2*(n+1)+1],++s<u&&i===a||(s<c?e.bl_tree[2*i]+=s:0!==i?(i!==o&&e.bl_tree[2*i]++,e.bl_tree[32]++):s<=10?e.bl_tree[34]++:e.bl_tree[36]++,o=i,c=(s=0)===a?(u=138,3):i===a?(u=6,3):(u=7,4))}function z(e,t,r){var n,i,o=-1,a=t[1],s=0,u=7,c=4;for(0===a&&(u=138,c=3),n=0;n<=r;n++)if(i=a,a=t[2*(n+1)+1],!(++s<u&&i===a)){if(s<c)for(;P(e,i,e.bl_tree),0!=--s;);else 0!==i?(i!==o&&(P(e,i,e.bl_tree),s--),P(e,16,e.bl_tree),A(e,s-3,2)):s<=10?(P(e,17,e.bl_tree),A(e,s-3,3)):(P(e,18,e.bl_tree),A(e,s-11,7));o=i,c=(s=0)===a?(u=138,3):i===a?(u=6,3):(u=7,4)}}i(x);var L=!1;function N(e,t,r,i){A(e,0+(i?1:0),3),function(e,t,r){R(e),E(e,r),E(e,~r),n.arraySet(e.pending_buf,e.window,t,r,e.pending),e.pending+=r}(e,t,r)}r._tr_init=function(e){L||(function(){var e,t,r,n,i,o=new Array(u+1);for(n=r=0;n<28;n++)for(v[n]=r,e=0;e<1<<l[n];e++)y[r++]=n;for(y[r-1]=n,n=i=0;n<16;n++)for(x[n]=i,e=0;e<1<<d[n];e++)g[i++]=n;for(i>>=7;n<s;n++)for(x[n]=i<<7,e=0;e<1<<d[n]-7;e++)g[256+i++]=n;for(t=0;t<=u;t++)o[t]=0;for(e=0;e<=143;)m[2*e+1]=8,e++,o[8]++;for(;e<=255;)m[2*e+1]=9,e++,o[9]++;for(;e<=279;)m[2*e+1]=7,e++,o[7]++;for(;e<=287;)m[2*e+1]=8,e++,o[8]++;for(T(m,287,o),e=0;e<s;e++)h[2*e+1]=5,h[2*e]=O(e,5);b=new _(m,l,257,a,u),w=new _(h,d,0,s,u),I=new _(new Array(0),p,0,19,7)}(),L=!0),e.l_desc=new k(e.dyn_ltree,b),e.d_desc=new k(e.dyn_dtree,w),e.bl_desc=new k(e.bl_tree,I),e.bi_buf=0,e.bi_valid=0,C(e)},r._tr_stored_block=N,r._tr_flush_block=function(e,t,r,n){var i,a,s=0;0<e.level?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,r=4093624447;for(t=0;t<=31;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<o;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),j(e,e.l_desc),j(e,e.d_desc),s=function(e){var t;for(G(e,e.dyn_ltree,e.l_desc.max_code),G(e,e.dyn_dtree,e.d_desc.max_code),j(e,e.bl_desc),t=18;3<=t&&0===e.bl_tree[2*f[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),i=e.opt_len+3+7>>>3,(a=e.static_len+3+7>>>3)<=i&&(i=a)):i=a=r+5,r+4<=i&&-1!==t?N(e,t,r,n):4===e.strategy||a===i?(A(e,2+(n?1:0),3),D(e,m,h)):(A(e,4+(n?1:0),3),function(e,t,r,n){var i;for(A(e,t-257,5),A(e,r-1,5),A(e,n-4,4),i=0;i<n;i++)A(e,e.bl_tree[2*f[i]+1],3);z(e,e.dyn_ltree,t-1),z(e,e.dyn_dtree,r-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,s+1),D(e,e.dyn_ltree,e.dyn_dtree)),C(e),n&&R(e)},r._tr_tally=function(e,t,r){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&r,e.last_lit++,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(y[r]+o+1)]++,e.dyn_dtree[2*S(t)]++),e.last_lit===e.lit_bufsize-1},r._tr_align=function(e){A(e,2,3),P(e,256,m),function(e){16===e.bi_valid?(E(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):8<=e.bi_valid&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},{"../utils/common":41}],53:[function(e,t,r){"use strict";t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,t,n){(function(e){!function(e,t){"use strict";if(!e.setImmediate){var r,n,i,o,a=1,s={},u=!1,c=e.document,l=Object.getPrototypeOf&&Object.getPrototypeOf(e);l=l&&l.setTimeout?l:e,r="[object process]"==={}.toString.call(e.process)?function(e){process.nextTick((function(){p(e)}))}:function(){if(e.postMessage&&!e.importScripts){var t=!0,r=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=r,t}}()?(o="setImmediate$"+Math.random()+"$",e.addEventListener?e.addEventListener("message",f,!1):e.attachEvent("onmessage",f),function(t){e.postMessage(o+t,"*")}):e.MessageChannel?((i=new MessageChannel).port1.onmessage=function(e){p(e.data)},function(e){i.port2.postMessage(e)}):c&&"onreadystatechange"in c.createElement("script")?(n=c.documentElement,function(e){var t=c.createElement("script");t.onreadystatechange=function(){p(e),t.onreadystatechange=null,n.removeChild(t),t=null},n.appendChild(t)}):function(e){setTimeout(p,0,e)},l.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var i={callback:e,args:t};return s[a]=i,r(a),a++},l.clearImmediate=d}function d(e){delete s[e]}function p(e){if(u)setTimeout(p,0,e);else{var r=s[e];if(r){u=!0;try{!function(e){var r=e.callback,n=e.args;switch(n.length){case 0:r();break;case 1:r(n[0]);break;case 2:r(n[0],n[1]);break;case 3:r(n[0],n[1],n[2]);break;default:r.apply(t,n)}}(r)}finally{d(e),u=!1}}}}function f(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(o)&&p(+t.data.slice(o.length))}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,void 0!==r.g?r.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[10])(10)},5478:(e,t,r)=>{"use strict";r.d(t,{C6:()=>i,Cl:()=>o,aN:()=>a});var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},n(e,t)};function i(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var o=function(){return o=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},o.apply(this,arguments)};function a(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),i=0;for(t=0;t<r;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,i++)n[i]=o[a];return n}}},t={};function r(n){var i=t[n];if(void 0!==i)return i.exports;var o=t[n]={id:n,exports:{}};return e[n](o,o.exports,r),o.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.nc=void 0,(()=>{"use strict";var e={};r.r(e),r.d(e,{_mostRecentlyEditedLayer:()=>pa,convertItemToTemplate:()=>ca,createItemFromTemplate:()=>la,postProcess:()=>da});var t={};r.r(t),r.d(t,{convertItemToTemplate:()=>fa,createItemFromTemplate:()=>ma});var n={};r.r(n),r.d(n,{convertItemToTemplate:()=>Ta,convertNotebookToTemplate:()=>Ra,createItemFromTemplate:()=>Ca,deleteProps:()=>Fa,fineTuneCreatedItem:()=>Da,postProcess:()=>ja,postProcessNotebookTemplates:()=>Ma});var i={};r.r(i),r.d(i,{_templatizeAdminEmail:()=>Ua,_templatizeApplication:()=>Na,_templatizeId:()=>Wa,_templatizeUrl:()=>Ba,_updateDependencies:()=>$a,convertItemToTemplate:()=>za,convertQuickCaptureToTemplate:()=>La,createItemFromTemplate:()=>Va});var o={};r.r(o),r.d(o,{convertItemToTemplate:()=>Ja,createItemFromTemplate:()=>Za,postProcess:()=>Xa,postProcessFieldReferences:()=>Ya});var a={};r.r(a),r.d(a,{_getFormDataFilename:()=>fs,_replaceFeatureServiceURLs:()=>as,_replaceItemIds:()=>ss,_replacePortalBaseUrls:()=>us,_replaceWorkflowManagerBaseUrls:()=>cs,_updateZipObjectTextContent:()=>ls,convertItemToTemplate:()=>Qa,createItemFromTemplate:()=>ns,postProcess:()=>ds,postProcessFormItems:()=>ps,swizzleFormObject:()=>is,templatizeFormData:()=>os});var s={};r.r(s),r.d(s,{_initializeNewGroup:()=>ys,convertItemToTemplate:()=>ms,createItemFromTemplate:()=>hs,postProcess:()=>gs});var u={};r.r(u),r.d(u,{convertItemToTemplate:()=>Js,createItemFromTemplate:()=>Zs,isAPage:()=>Xs,postProcess:()=>Ys});var c={};r.r(c),r.d(c,{convertItemToTemplate:()=>zu,createItemFromTemplate:()=>Lu,isASite:()=>Uu,postProcess:()=>Nu});var l={};r.r(l),r.d(l,{convertItemToTemplate:()=>Hu,createItemFromTemplate:()=>Ku,isAStoryMap:()=>Ju});var d={};r.r(d),r.d(d,{convertItemToTemplate:()=>uc,createItemFromTemplate:()=>cc,postProcess:()=>lc});var p={};r.r(p),r.d(p,{convertItemToTemplate:()=>mc,createItemFromTemplate:()=>hc,postProcess:()=>gc});var f={};r.r(f),r.d(f,{convertItemToTemplate:()=>yc,createItemFromTemplate:()=>vc,createWebTool:()=>bc});var m={};r.r(m),r.d(m,{_cacheLayerDetails:()=>Sc,addWorkflowItem:()=>wc,convertItemToTemplate:()=>Ec,createItemFromTemplate:()=>Ac,fetchAuxiliaryItems:()=>Ic,postProcessFormItems:()=>xc,updateTempDictWorkflowId:()=>kc,updateTemplateDictionaryForWorkflow:()=>_c});var h=r(5072),g=r.n(h),y=r(7825),v=r.n(y),b=r(7659),w=r.n(b),I=r(5056),x=r.n(I),_=r(540),k=r.n(_),S=r(1113),E=r.n(S),A=r(1208),P={};P.styleTagTransform=E(),P.setAttributes=x(),P.insert=w().bind(null,"head"),P.domAPI=v(),P.insertStyleElement=k(),g()(A.A,P),A.A&&A.A.locals&&A.A.locals;var O=r(5478);function T(e,t,r){var n=(0,O.Cl)((0,O.Cl)({params:{}},r),e);return n.params=t.reduce((function(t,r){return(e[r]||"boolean"==typeof e[r])&&(t[r]=e[r]),t}),n.params),["params","httpMethod","rawResponse","authentication","portal","fetch","maxUrlLength","headers"].reduce((function(e,t){return n[t]&&(e[t]=n[t]),e}),{})}var C=r(5854),R=r(5500);function M(e){var t=JSON.parse(JSON.stringify(e));return t.data&&("undefined"!=typeof Blob&&e.data instanceof Blob||"ReadStream"===e.data.constructor.name?t.file=e.data:t.text=e.data,delete t.data),t}function F(e){return e.owner?Promise.resolve(e.owner):e.item&&e.item.owner?Promise.resolve(e.item.owner):e.authentication&&e.authentication.getUsername?e.authentication.getUsername():Promise.reject(new Error("Could not determine the owner of this item. Pass the `owner`, `item.owner`, or `authentication` option."))}function D(e){return Array.isArray(e)&&Array.isArray(e[0])&&Array.isArray(e[1])}function j(e){return e.join(",")}function G(e){return F(e).then((function(t){var r=(0,R.e)(e)+"/content/users/"+t+"/addRelationship",n=T(e,["originItemId","destinationItemId","relationshipType"],{params:(0,O.Cl)({},e.params)});return(0,C.Em)(r,n)}))}function z(e){return F(e).then((function(t){var r=(0,R.e)(e)+"/content/users/"+t+"/items/"+e.id+"/addResources";return e.params=(0,O.Cl)({file:e.resource,fileName:e.name,resourcesPrefix:e.prefix,text:e.content,access:e.private?"private":"inherit"},e.params),(0,C.Em)(r,e)}))}function L(e,t){var r=(0,R.e)(t)+"/community/groups/"+e,n=(0,O.Cl)({httpMethod:"GET"},t);return(0,C.Em)(r,n)}var N=r(6155);function U(e,t){var r=e||"self",n=(0,R.e)(t)+"/portals/"+r,i=(0,O.Cl)({httpMethod:"GET"},t);return(0,C.Em)(n,i)}function $(e){var t,r={httpMethod:"GET"};if("string"==typeof e)t="https://www.arcgis.com/sharing/rest/community/users/"+e;else{var n=e.username||e.authentication.username;t=(0,R.e)(e)+"/community/users/"+encodeURIComponent(n),r=(0,O.Cl)((0,O.Cl)({},e),r)}return(0,C.Em)(t,r)}function B(e){return F(e).then((function(t){var r=(0,R.e)(e)+"/content/users/"+t+"/items/"+e.id+"/delete";return(0,C.Em)(r,e)}))}var W=r(6349);function V(e){console&&console.warn&&console.warn.apply(console,[e])}var q=function(){function e(e){void 0===e&&(e=""),this.termStack=[],this.rangeStack=[],this.openGroups=0,this.q=e}return e.prototype.match=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.termStack=this.termStack.concat(e),this},e.prototype.in=function(e){var t="`in("+(e?'"'+e+'"':"")+")`";return this.hasRange||this.hasTerms?(e&&"*"!==e&&(this.q+=e+":"),this.commit()):(V(t+" was called with no call to `match(...)` or `from(...)`/`to(...)`. Your query was not modified."),this)},e.prototype.startGroup=function(){return this.commit(),this.openGroups>0&&(this.q+=" "),this.openGroups++,this.q+="(",this},e.prototype.endGroup=function(){return this.openGroups<=0?(V("`endGroup(...)` was called without calling `startGroup(...)` first. Your query was not modified."),this):(this.commit(),this.openGroups--,this.q+=")",this)},e.prototype.and=function(){return this.addModifier("and")},e.prototype.or=function(){return this.addModifier("or")},e.prototype.not=function(){return this.addModifier("not")},e.prototype.from=function(e){return this.hasTerms?(V('`from(...)` is not allowed after `match(...)` try using `.from(...).to(...).in(...)`. Optionally, you may see this because dates are incorrectly formatted. Dates should be a primative Date value, aka a number in milliseconds or Date object, ie new Date("2020-01-01").  Your query was not modified.'),this):(this.rangeStack[0]=e,this)},e.prototype.to=function(e){return this.hasTerms?(V('`to(...)` is not allowed after `match(...)` try using `.from(...).to(...).in(...)`. Optionally, you may see this because dates are incorrectly formatted. Dates should be a primative Date value, aka a number in milliseconds or Date object, ie new Date("2020-01-01"). Your query was not modified.'),this):(this.rangeStack[1]=e,this)},e.prototype.boost=function(e){return this.commit(),this.q+="^"+e,this},e.prototype.toParam=function(){return this.commit(),this.cleanup(),this.q},e.prototype.clone=function(){return this.commit(),this.cleanup(),new e(this.q+"")},e.prototype.addModifier=function(e){return this.currentModifer?(V("You have called `"+this.currentModifer+"()` after `"+e+"()`. Your current query was not modified."),this):(this.commit(),""===this.q&&"not"!==e?(V("You have called `"+e+"()` without calling another method to modify your query first. Try calling `match()` first."),this):(this.currentModifer=e,this.q+=""===this.q?"":" ",this.q+=e.toUpperCase()+" ",this))},e.prototype.needsQuotes=function(e){return/\s|:/g.test(e)},e.prototype.formatTerm=function(e){return e instanceof Date?e.getTime():"string"==typeof e&&this.needsQuotes(e)?'"'+e+'"':e},e.prototype.commit=function(){var e=this;return this.currentModifer=void 0,this.hasRange&&(this.q+="["+this.formatTerm(this.rangeStack[0])+" TO "+this.formatTerm(this.rangeStack[1])+"]",this.rangeStack=[void 0,void 0]),this.hasTerms&&(this.q+=this.termStack.map((function(t){return e.formatTerm(t)})).join(" "),this.termStack=[]),this},Object.defineProperty(e.prototype,"hasTerms",{get:function(){return this.termStack.length>0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasRange",{get:function(){return this.rangeStack.length&&this.rangeStack[0]&&this.rangeStack[1]},enumerable:!1,configurable:!0}),e.prototype.cleanup=function(){if(this.openGroups>0)for(V("Automatically closing "+this.openGroups+" group(s). You can use `endGroup(...)` to remove this warning.");this.openGroups>0;)this.q+=")",this.openGroups--;var e=this.q;this.q=e.replace(/( AND ?| NOT ?| OR ?)*$/,""),e!==this.q&&V("`startGroup(...)` was called without calling `endGroup(...)` first. Your query was not modified."),this.q=this.q.replace(/(\(\))*/,"")},e}();function H(e,t){var r,n;switch(r="string"==typeof e||e instanceof q?{httpMethod:"GET",params:{q:e}}:T(e,["q","num","start","sortField","sortOrder","searchUserAccess","searchUserName","filter","countFields","countSize","categories","categoryFilters"],{httpMethod:"GET"}),t){case"item":n="/search";break;case"group":n="/community/groups";break;case"groupContent":if("string"==typeof e||e instanceof q||!e.groupId)return Promise.reject(new Error("you must pass a `groupId` option to `searchGroupContent`"));n="/content/groups/"+e.groupId+"/search";break;case"communityUser":n="/community/users";break;default:n="/portals/self/users/search"}var i=(0,R.e)(r)+n;return(0,C.Em)(i,r).then((function(r){return r.nextStart&&-1!==r.nextStart&&(r.nextPage=function(){var n;return"string"==typeof e||e instanceof q?n={q:e,start:r.nextStart}:(n=e).start=r.nextStart,H(n,t)}),r}))}function K(e){return H(e,"item")}function J(e){return F(e).then((function(t){var r=e.folderId?(0,R.e)(e)+"/content/users/"+t+"/"+e.folderId+"/items/"+e.item.id+"/update":(0,R.e)(e)+"/content/users/"+t+"/items/"+e.item.id+"/update";return e.params=(0,O.Cl)((0,O.Cl)({},e.params),M(e.item)),e.params.extent&&D(e.params.extent)&&(e.params.extent=j(e.params.extent)),e.params.file&&e.params.file.constructor&&"ReadStream"===e.params.file.constructor.name&&(e.params.dataSize=e.dataSize),(0,C.Em)(r,e)}))}function Z(e){return F(e).then((function(t){var r=(0,R.e)(e)+"/content/users/"+t+"/items/"+e.itemId+"/move",n=e.folderId;return n||(n="/"),e.params=(0,O.Cl)({folder:n},e.params),(0,C.Em)(r,e)}))}function Y(e){return L(e.groupId,e).then((function(e){return e.userMembership.memberType})).catch((function(){return"none"}))}function X(e,t){if(0===e.length)return[];for(var r=[],n=0;n<e.length;n+=t)r.push(e.slice(n,n+t));return r}function Q(e,t,r){return!t||t.length<1?[]:X(t,25).map((function(t){return function(e,t,r){var n,i;return Object.assign({},r,((n={})[e]=t,n.params=(0,O.Cl)((0,O.Cl)({},r.params),((i={})[e]=t,i)),n))}(e,t,r)}))}function ee(e){var t=e.filter((function(e){return e.notAdded})).reduce((function(e,t){return e.concat(t.notAdded)}),[]),r=e.filter((function(e){return e.errors})).reduce((function(e,t){return e.concat(t.errors)}),[]),n={notAdded:t};return r.length>0&&(n.errors=r),n}function te(e){var t=e.id,r=e.users,n=(0,R.e)(e)+"/community/groups/"+t+"/removeUsers",i=X(r,25).map((function(t){return function(t){var r=(0,O.Cl)((0,O.Cl)({},e),{users:t,params:{users:t}});return(0,C.Em)(n,r).catch((function(e){return{errors:[e]}}))}(t)}));return Promise.all(i).then((function(e){var t=function(t){return e.filter((function(e){return e[t]})).reduce((function(e,r){return e.concat(r[t])}),[])},r=t("errors"),n={notRemoved:t("notRemoved")};return r.length?(0,O.Cl)((0,O.Cl)({},n),{errors:r}):n}))}function re(e){var t=(0,R.e)(e)+"/community/groups/"+e.id+"/updateUsers",r={authentication:e.authentication,params:{}};return"admin"===e.newMemberType?r.params.admins=e.users:r.params.users=e.users,(0,C.Em)(t,r)}function ne(e){return K({q:"id: "+e.id+" AND group: "+e.groupId,start:1,num:10,sortField:"title",authentication:e.authentication,httpMethod:"POST"}).then((function(t){if(t.total>0)return t.results.some((function(t){return t.id===e.id}))}))}function ie(e){return ne(e).then((function(t){if(t)return{itemId:e.id,shortcut:!0,notSharedWith:[]};var r=e.authentication.username,n=e.owner,i=e.confirmItemControl,o=n||r;if(o!==r){var a=!1,s=!1;return Promise.all([$({username:r,authentication:e.authentication}),$({username:o,authentication:e.authentication}),Y(e)]).then((function(t){var r=t[0],n=t[1],o=t[2],u=!!i;return a="org_admin"===r.role&&!r.roleId,s=r.orgId!==n.orgId,function(e,t,r,n,i,o){var a=[];if(o.groupId!==e.favGroupId)if(t){if(!n)throw Error("This item can not be shared to shared editing group "+o.groupId+" by "+e.username+" as they not the item owner or org admin.");a.push(ae(e,e,!1,"Error adding "+e.username+" as member to edit group "+o.groupId+". Consequently item "+o.id+" was not shared to the group.",o),ae(e,i,!0,"none"===r?"Error adding user "+i.username+" to edit group "+o.groupId+". Consequently item "+o.id+" was not shared to the group.":"Error promoting user "+i.username+" to admin in edit group "+o.groupId+". Consequently item "+o.id+" was not shared to the group.",o))}else if(n)a.push(ae(e,e,!1,"Error adding "+e.username+" as member to view group "+o.groupId+". Consequently item "+o.id+" was not shared to the group.",o));else if("none"===r)throw new Error("This item can not be shared by "+e.username+" as they are not a member of the specified group "+o.groupId+".");return a}(r,u,o,a,n,e)})).then((function(t){var r=t[0],n=(void 0===r?{promise:Promise.resolve({notAdded:[]}),revert:function(e){return Promise.resolve(e)}}:r).revert;return Promise.all(t.map((function(e){return e.promise}))).then((function(){return oe(e,a,s)})).then((function(e){return n(e)}))}))}return oe(e)})).then((function(t){if(t.notSharedWith.length)throw Error("Item "+e.id+" could not be shared to group "+e.groupId+".");return t}))}function oe(e,t,r){void 0===t&&(t=!1),void 0===r&&(r=!1);var n=e.authentication.username,i=e.owner||n,o=(0,R.e)(e)+"/content/items/"+e.id+"/share";return(i===n||t&&!r)&&(o=(0,R.e)(e)+"/content/users/"+i+"/items/"+e.id+"/share"),e.params={groups:e.groupId,confirmItemControl:e.confirmItemControl},(0,C.Em)(o,e)}function ae(e,t,r,n,i){var o,a,s,u=t.groups||[],c=u.find((function(e){return e.id===i.groupId}));if(e.orgId!==t.orgId)throw Error("User "+t.username+" is not a member of the same org as "+e.username+". Consequently they can not be added added to group "+i.groupId+" nor can item "+i.id+" be shared to the group.");if(!c&&u.length>511)throw Error("User "+t.username+" already has 512 groups, and can not be added to group "+i.groupId+". Consequently item "+i.id+" can not be shared to the group.");if(c)r&&"member"===c.userMembership.memberType?(a=re({id:i.groupId,users:[t.username],newMemberType:"admin",authentication:i.authentication}).then((function(e){var t=e.results.reduce((function(e,t){return t.success||e.push(t.username),e}),[]);return Promise.resolve({notAdded:t})})).catch((function(){return{notAdded:[t.username]}})),s=function(e){return re({id:i.groupId,users:[t.username],newMemberType:"member",authentication:i.authentication}).then((function(){return e})).catch((function(){return e}))}):(a=Promise.resolve({notAdded:[]}),s=function(e){return Promise.resolve(e)});else{var l=r?"admins":"users";a=function(e){var t=e.id,r=(0,R.e)(e)+"/community/groups/"+t+"/addUsers",n=Object.assign({},e,{admins:void 0,users:void 0}),i=(0,O.aN)(Q("users",e.users,n),Q("admins",e.admins,n)).map((function(e){return function(e,t){return(0,C.Em)(e,t).catch((function(e){return{errors:[e]}}))}(r,e)}));return Promise.all(i).then(ee)}((o={id:i.groupId},o[l]=[t.username],o.authentication=i.authentication,o)).then((function(e){if(e.errors&&e.errors.length)throw e.errors[0];return e})).catch((function(){return{notAdded:[t.username]}})),s=function(e){return te({id:i.groupId,users:[t.username],authentication:i.authentication}).then((function(){return e}))}}return{promise:a.then((function(e){if(e.notAdded.length)throw new Error(n);return e})),revert:s}}var se=r(5302);function ue(e){return F(e).then((function(t){var r=(0,R.e)(e)+"/content/users/"+t+"/items/"+e.id+"/protect";return(0,C.Em)(r,e)}))}function ce(e){return F(e).then((function(t){var r=(0,R.e)(e)+"/content/users/"+t+"/items/"+e.id+"/unprotect";return(0,C.Em)(r,e)}))}var le=r(6380),de=r(2898);function pe(e,t){var r=t;return"undefined"!=typeof window&&window.location&&window.location.host?r.params.referer=window.location.host:r.params.referer=C.qX,(0,C.Em)(e,r)}function fe(e,t){var r=t;return r.rawResponse=!1,(0,C.Em)(e,r).then((function(e){var t={token:e.access_token,username:e.username,expires:new Date(Date.now()+(1e3*e.expires_in-1e3)),ssl:!0===e.ssl};return e.refresh_token&&(t.refreshToken=e.refresh_token),t}))}var me=/^https?:\/\/(\S+)\.arcgis\.com.+/;function he(e){return me.test(e)}function ge(e){if(!me.test(e))return null;var t=e.match(me)[1].split(".").pop();return t.includes("dev")?"dev":t.includes("qa")?"qa":"production"}var ye=function(){function e(e){if(this.clientId=e.clientId,this._refreshToken=e.refreshToken,this._refreshTokenExpires=e.refreshTokenExpires,this.username=e.username,this.password=e.password,this._token=e.token,this._tokenExpires=e.tokenExpires,this.portal=e.portal?(0,le.T)(e.portal):"https://www.arcgis.com/sharing/rest",this.ssl=e.ssl,this.provider=e.provider||"arcgis",this.tokenDuration=e.tokenDuration||20160,this.redirectUri=e.redirectUri,this.refreshTokenTTL=e.refreshTokenTTL||20160,this.server=e.server,this.federatedServers={},this.trustedDomains=[],e.server){var t=this.getServerRootUrl(e.server);this.federatedServers[t]={token:e.token,expires:e.tokenExpires}}this._pendingTokenRequests={}}return Object.defineProperty(e.prototype,"token",{get:function(){return this._token},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tokenExpires",{get:function(){return this._tokenExpires},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"refreshToken",{get:function(){return this._refreshToken},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"refreshTokenExpires",{get:function(){return this._refreshTokenExpires},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"trustedServers",{get:function(){return console.log("DEPRECATED: use federatedServers instead"),this.federatedServers},enumerable:!1,configurable:!0}),e.beginOAuth2=function(t,r){void 0===r&&(r=window),t.duration&&console.log("DEPRECATED: 'duration' is deprecated - use 'expiration' instead");var n,i=(0,O.Cl)({portal:"https://www.arcgis.com/sharing/rest",provider:"arcgis",expiration:20160,popup:!0,popupWindowFeatures:"height=400,width=600,menubar=no,location=yes,resizable=yes,scrollbars=yes,status=yes",state:t.clientId,locale:""},t),o=i.portal,a=i.provider,s=i.clientId,u=i.expiration,c=i.redirectUri,l=i.popup,d=i.popupWindowFeatures,p=i.state,f=i.locale,m=i.params;if(n="arcgis"===a?o+"/oauth2/authorize?client_id="+s+"&response_type=token&expiration="+(t.duration||u)+"&redirect_uri="+encodeURIComponent(c)+"&state="+p+"&locale="+f:o+"/oauth2/social/authorize?client_id="+s+"&socialLoginProviderName="+a+"&autoAccountCreateForSocial=true&response_type=token&expiration="+(t.duration||u)+"&redirect_uri="+encodeURIComponent(c)+"&state="+p+"&locale="+f,m&&(n=n+"&"+(0,de.G)(m)),l){var h,g=((h={promise:null,resolve:null,reject:null}).promise=new Promise((function(e,t){h.resolve=e,h.reject=t})),h);return r["__ESRI_REST_AUTH_HANDLER_"+s]=function(t,r){if(t){var n=JSON.parse(t);g.reject(new C.yk(n.errorMessage,n.error))}else if(r){var i=JSON.parse(r);g.resolve(new e({clientId:s,portal:o,ssl:i.ssl,token:i.token,tokenExpires:new Date(i.expires),username:i.username}))}},r.open(n,"oauth-window",d),g.promise}r.location.href=n},e.completeOAuth2=function(t,r){void 0===r&&(r=window);var n=(0,O.Cl)({portal:"https://www.arcgis.com/sharing/rest",popup:!0},t),i=n.portal,o=n.clientId,a=n.popup;function s(t,n){try{var s=void 0,u="__ESRI_REST_AUTH_HANDLER_"+o;if(a&&(r.opener?r.opener.parent&&r.opener.parent[u]?s=r.opener.parent[u]:r.opener&&r.opener[u]&&(s=r.opener[u]):r!==r.parent&&r.parent&&r.parent[u]&&(s=r.parent[u]),s))return s(t?JSON.stringify(t):void 0,JSON.stringify(n)),void r.close()}catch(e){throw new C.yk('Unable to complete authentication. It\'s possible you specified popup based oAuth2 but no handler from "beginOAuth2()" present. This generally happens because the "popup" option differs between "beginOAuth2()" and "completeOAuth2()".')}if(t)throw new C.yk(t.errorMessage,t.error);return new e({clientId:o,portal:i,ssl:n.ssl,token:n.token,tokenExpires:n.expires,username:n.username})}var u=r.location.hash.replace(/^#/,"").split("&").reduce((function(e,t){var r=function(e){var t=e.split("="),r=t[0],n=t[1];return{key:decodeURIComponent(r),value:decodeURIComponent(n)}}(t),n=r.key,i=r.value;return e[n]=i,e}),{});if(!u.access_token){var c=void 0,l="Unknown error";return u.error&&(c=u.error,l=u.error_description),s({error:c,errorMessage:l})}var d=u.access_token,p=new Date(Date.now()+1e3*parseInt(u.expires_in,10)-6e4),f=u.username;return s(void 0,{token:d,expires:p,ssl:"true"===u.ssl,username:f})},e.fromParent=function(t,r){var n;return!r&&window&&(r=window),new Promise((function(i,o){n=function(t){if(t.source===r.parent&&t.data)try{return i(e.parentMessageHandler(t))}catch(e){return o(e)}},r.addEventListener("message",n,!1),r.parent.postMessage({type:"arcgis:auth:requestCredential"},t)})).then((function(e){return r.removeEventListener("message",n,!1),e}))},e.authorize=function(e,t){e.duration&&console.log("DEPRECATED: 'duration' is deprecated - use 'expiration' instead");var r=(0,O.Cl)({portal:"https://arcgis.com/sharing/rest",expiration:20160},e),n=r.portal,i=r.clientId,o=r.expiration,a=r.redirectUri;t.writeHead(301,{Location:n+"/oauth2/authorize?client_id="+i+"&expiration="+(e.duration||o)+"&response_type=code&redirect_uri="+encodeURIComponent(a)}),t.end()},e.exchangeAuthorizationCode=function(t,r){var n=(0,O.Cl)({portal:"https://www.arcgis.com/sharing/rest",refreshTokenTTL:20160},t),i=n.portal,o=n.clientId,a=n.redirectUri,s=n.refreshTokenTTL;return fe(i+"/oauth2/token",{params:{grant_type:"authorization_code",client_id:o,redirect_uri:a,code:r}}).then((function(t){return new e({clientId:o,portal:i,ssl:t.ssl,redirectUri:a,refreshToken:t.refreshToken,refreshTokenTTL:s,refreshTokenExpires:new Date(Date.now()+60*(s-1)*1e3),token:t.token,tokenExpires:t.expires,username:t.username})}))},e.deserialize=function(t){var r=JSON.parse(t);return new e({clientId:r.clientId,refreshToken:r.refreshToken,refreshTokenExpires:new Date(r.refreshTokenExpires),username:r.username,password:r.password,token:r.token,tokenExpires:new Date(r.tokenExpires),portal:r.portal,ssl:r.ssl,tokenDuration:r.tokenDuration,redirectUri:r.redirectUri,refreshTokenTTL:r.refreshTokenTTL})},e.fromCredential=function(t){var r=void 0===t.ssl||t.ssl,n=t.expires||Date.now()+72e5;return new e({portal:t.server.includes("sharing/rest")?t.server:t.server+"/sharing/rest",ssl:r,token:t.token,username:t.userId,tokenExpires:new Date(n)})},e.parentMessageHandler=function(t){if("arcgis:auth:credential"===t.data.type)return e.fromCredential(t.data.credential);if("arcgis:auth:error"===t.data.type){var r=new Error(t.data.error.message);throw r.name=t.data.error.name,r}throw new Error("Unknown message type.")},e.prototype.toCredential=function(){return{expires:this.tokenExpires.getTime(),server:this.portal,ssl:this.ssl,token:this.token,userId:this.username}},e.prototype.getUser=function(e){var t=this;if(this._pendingUserRequest)return this._pendingUserRequest;if(this._user)return Promise.resolve(this._user);var r=this.portal+"/community/self",n=(0,O.Cl)((0,O.Cl)({httpMethod:"GET",authentication:this},e),{rawResponse:!1});return this._pendingUserRequest=(0,C.Em)(r,n).then((function(e){return t._user=e,t._pendingUserRequest=null,e})),this._pendingUserRequest},e.prototype.getPortal=function(e){var t=this;if(this._pendingPortalRequest)return this._pendingPortalRequest;if(this._portalInfo)return Promise.resolve(this._portalInfo);var r=this.portal+"/portals/self",n=(0,O.Cl)((0,O.Cl)({httpMethod:"GET",authentication:this},e),{rawResponse:!1});return this._pendingPortalRequest=(0,C.Em)(r,n).then((function(e){return t._portalInfo=e,t._pendingPortalRequest=null,e})),this._pendingPortalRequest},e.prototype.getUsername=function(){return this.username?Promise.resolve(this.username):this._user?Promise.resolve(this._user.username):this.getUser().then((function(e){return e.username}))},e.prototype.getToken=function(e,t){return n=e,i=he(r=this.portal),o=he(n),a=ge(r),s=ge(n),i&&o&&a===s||new RegExp(this.portal,"i").test(e)?this.getFreshToken(t):this.getTokenForServer(e,t);var r,n,i,o,a,s},e.prototype.validateAppAccess=function(e){return this.getToken(this.portal).then((function(t){return function(e,t,r){void 0===r&&(r="https://www.arcgis.com/sharing/rest");var n=r+"/oauth2/validateAppAccess",i={method:"POST",params:{f:"json",client_id:t,token:e}};return(0,C.Em)(n,i)}(t,e)}))},e.prototype.toJSON=function(){return{clientId:this.clientId,refreshToken:this.refreshToken,refreshTokenExpires:this.refreshTokenExpires,username:this.username,password:this.password,token:this.token,tokenExpires:this.tokenExpires,portal:this.portal,ssl:this.ssl,tokenDuration:this.tokenDuration,redirectUri:this.redirectUri,refreshTokenTTL:this.refreshTokenTTL}},e.prototype.serialize=function(){return JSON.stringify(this)},e.prototype.enablePostMessageAuth=function(e,t){!t&&window&&(t=window),this._hostHandler=this.createPostMessageHandler(e),t.addEventListener("message",this._hostHandler,!1)},e.prototype.disablePostMessageAuth=function(e){!e&&window&&(e=window),e.removeEventListener("message",this._hostHandler,!1)},e.prototype.refreshSession=function(e){return this._user=null,this.username&&this.password?this.refreshWithUsernameAndPassword(e):this.clientId&&this.refreshToken?this.refreshWithRefreshToken():Promise.reject(new C.yk("Unable to refresh token."))},e.prototype.getServerRootUrl=function(e){var t=(0,le.T)(e).split(/\/rest(\/admin)?\/services(?:\/|#|\?|$)/)[0].match(/(https?:\/\/)(.+)/),r=(t[0],t[1]),n=t[2].split("/"),i=n[0],o=n.slice(1);return""+r+i.toLowerCase()+"/"+o.join("/")},e.prototype.getDomainCredentials=function(e){return this.trustedDomains&&this.trustedDomains.length&&this.trustedDomains.some((function(t){return e.startsWith(t)}))?"include":"same-origin"},e.prototype.createPostMessageHandler=function(e){var t=this;return function(r){var n=e.indexOf(r.origin)>-1,i="arcgis:auth:requestCredential"===r.data.type,o=t.tokenExpires.getTime()>Date.now();if(n&&i){var a={};if(o){var s=t.toCredential();s.server=s.server.replace("/sharing/rest",""),a={type:"arcgis:auth:credential",credential:s}}else a={type:"arcgis:auth:error",error:{name:"tokenExpiredError",message:"Session token was expired, and not returned to the child application"}};r.source.postMessage(a,r.origin)}}},e.prototype.getTokenForServer=function(e,t){var r=this,n=this.getServerRootUrl(e),i=this.federatedServers[n];return i&&i.expires&&i.expires.getTime()>Date.now()?Promise.resolve(i.token):(this._pendingTokenRequests[n]||(this._pendingTokenRequests[n]=this.fetchAuthorizedDomains().then((function(){return(0,C.Em)(n+"/rest/info",{credentials:r.getDomainCredentials(e)}).then((function(i){if(i.owningSystemUrl){if(o=i.owningSystemUrl,a=r.portal,s=(0,le.T)(function(e){if(!me.test(e))return e;switch(ge(e)){case"dev":return"https://devext.arcgis.com/sharing/rest";case"qa":return"https://qaext.arcgis.com/sharing/rest";default:return"https://www.arcgis.com/sharing/rest"}}(a)).replace(/https?:\/\//,""),u=(0,le.T)(o).replace(/https?:\/\//,""),new RegExp(u,"i").test(s))return(0,C.Em)(i.owningSystemUrl+"/sharing/rest/info",t);throw new C.yk(e+" is not federated with "+r.portal+".","NOT_FEDERATED")}var o,a,s,u;if(i.authInfo&&void 0!==r.federatedServers[n])return Promise.resolve({authInfo:i.authInfo});throw new C.yk(e+" is not federated with any portal and is not explicitly trusted.","NOT_FEDERATED")})).then((function(e){return e.authInfo.tokenServicesUrl})).then((function(t){return r.token&&r.tokenExpires.getTime()>Date.now()?pe(t,{params:{token:r.token,serverUrl:e,expiration:r.tokenDuration,client:"referer"}}):pe(t,{params:{username:r.username,password:r.password,expiration:r.tokenDuration,client:"referer"}}).then((function(e){return r._token=e.token,r._tokenExpires=new Date(e.expires),e}))})).then((function(e){return r.federatedServers[n]={expires:new Date(e.expires),token:e.token},delete r._pendingTokenRequests[n],e.token}))}))),this._pendingTokenRequests[n])},e.prototype.getFreshToken=function(e){var t=this;return this.token&&!this.tokenExpires||this.token&&this.tokenExpires&&this.tokenExpires.getTime()>Date.now()?Promise.resolve(this.token):(this._pendingTokenRequests[this.portal]||(this._pendingTokenRequests[this.portal]=this.refreshSession(e).then((function(e){return t._pendingTokenRequests[t.portal]=null,e.token}))),this._pendingTokenRequests[this.portal])},e.prototype.refreshWithUsernameAndPassword=function(e){var t=this,r=(0,O.Cl)({params:{username:this.username,password:this.password,expiration:this.tokenDuration}},e);return pe(this.portal+"/generateToken",r).then((function(e){return t._token=e.token,t._tokenExpires=new Date(e.expires),t}))},e.prototype.refreshWithRefreshToken=function(e){var t=this;if(this.refreshToken&&this.refreshTokenExpires&&this.refreshTokenExpires.getTime()<Date.now())return this.refreshRefreshToken(e);var r=(0,O.Cl)({params:{client_id:this.clientId,refresh_token:this.refreshToken,grant_type:"refresh_token"}},e);return fe(this.portal+"/oauth2/token",r).then((function(e){return t._token=e.token,t._tokenExpires=e.expires,t}))},e.prototype.refreshRefreshToken=function(e){var t=this,r=(0,O.Cl)({params:{client_id:this.clientId,refresh_token:this.refreshToken,redirect_uri:this.redirectUri,grant_type:"exchange_refresh_token"}},e);return fe(this.portal+"/oauth2/token",r).then((function(e){return t._token=e.token,t._tokenExpires=e.expires,t._refreshToken=e.refreshToken,t._refreshTokenExpires=new Date(Date.now()+60*(t.refreshTokenTTL-1)*1e3),t}))},e.prototype.fetchAuthorizedDomains=function(){var e=this;return this.server||!this.portal?Promise.resolve(this):this.getPortal().then((function(t){return t.authorizedCrossOriginDomains&&t.authorizedCrossOriginDomains.length&&(e.trustedDomains=t.authorizedCrossOriginDomains.filter((function(e){return!e.startsWith("http://")})).map((function(e){return e.startsWith("https://")?e:"https://"+e}))),e}))},e}();function ve(e){return e.multipart&&!e.filename?Promise.reject(new Error("The filename is required for a multipart request.")):F(e).then((function(t){var r=(0,R.e)(e)+"/content/users/"+t,n=r+"/addItem";e.folderId&&(n=r+"/"+e.folderId+"/addItem"),e.params=(0,O.Cl)((0,O.Cl)({},e.params),M(e.item)),e.params.extent&&D(e.params.extent)&&(e.params.extent=j(e.params.extent));var i=T(e,["owner","folderId","file","dataUrl","text","async","multipart","filename","overwrite"],{params:(0,O.Cl)({},e.params)});return(0,C.Em)(n,i)}))}function be(e){return ve((0,O.Cl)({folderId:null},e))}var we=r(8639);function Ie(e){return z(e)}function xe(e,t){return L(e,t)}function _e(e,t){return function(e,t){var r=(0,R.e)(t)+"/content/groups/"+e,n=(0,O.Cl)((0,O.Cl)({httpMethod:"GET"},{params:{start:1,num:100}}),t);return t&&t.paging&&(n.params=(0,O.Cl)({},t.paging)),(0,C.Em)(r,n)}(e,t)}function ke(e,t){return(0,C.Em)(e,t)}function Se(e){return function(e){return F(e).then((function(t){var r=(0,R.e)(e)+"/content/users/"+encodeURIComponent(t)+"/"+e.folderId+"/delete";return(0,C.Em)(r,e)}))}(e)}function Ee(e){return(0,W.Y)(e)}function Ae(e){return K(e)}function Pe(e){return J(e)}function Oe(e){return ce(e)}const Te=1,Ce="unreachable";var Re,Me,Fe;!function(e){e[e.Data=0]="Data",e[e.Info=1]="Info",e[e.Metadata=2]="Metadata",e[e.Resource=3]="Resource",e[e.Thumbnail=4]="Thumbnail"}(Re||(Re={})),function(e){e[e.Data=0]="Data",e[e.Info=1]="Info",e[e.Metadata=2]="Metadata",e[e.Resource=3]="Resource",e[e.Thumbnail=4]="Thumbnail"}(Me||(Me={})),function(e){e[e.Started=0]="Started",e[e.Created=1]="Created",e[e.Cancelled=2]="Cancelled",e[e.Finished=3]="Finished",e[e.Ignored=4]="Ignored",e[e.Failed=5]="Failed",e[e.Unknown=6]="Unknown"}(Fe||(Fe={}));const De=["1 Started","2 Created","3 Cancelled","3 Finished","3 Ignored","3 Failed","Unknown"];function je(e){let t={};if(Array.isArray(e))t=e.map(je);else if("object"==typeof e){if(null===e)return e;for(const r in e)if(e.hasOwnProperty(r)){const n=e[r];null!=n&&"object"==typeof n?n instanceof Date?t[r]=new Date(n.getTime()):"undefined"!=typeof Blob&&n instanceof Blob?t[r]=new Blob([n],{type:n.type}):t[r]=je(n):t[r]=n}}else t=e;return t}function Ge(e,t){return e.filter((e=>e!==t))}function ze(e="i"){return`${e}${Math.random().toString(36).substr(2,8)}`}function Le(e,t){return null!=e&&(t=je(t)).push(e),t}function Ne(e,t,r){return r.indexOf(e)===t}function Ue(e,t,r=!0){const n=je(e);return Object.keys(t).reduce(((e,n)=>{if(null!==t[n]&&void 0!==t[n]){const i=je(t[n]);Array.isArray(i)?e[n]=i:e[n]=r&&"object"==typeof i?Ue(e[n]||{},i,r):i}return e}),n)}var $e=r(2461),Be=r.n($e),We=function(){return We=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},We.apply(this,arguments)},Ve={exports:{}},qe={},He={exports:{}},Ke={};function Je(){return{"align-content":!1,"align-items":!1,"align-self":!1,"alignment-adjust":!1,"alignment-baseline":!1,all:!1,"anchor-point":!1,animation:!1,"animation-delay":!1,"animation-direction":!1,"animation-duration":!1,"animation-fill-mode":!1,"animation-iteration-count":!1,"animation-name":!1,"animation-play-state":!1,"animation-timing-function":!1,azimuth:!1,"backface-visibility":!1,background:!0,"background-attachment":!0,"background-clip":!0,"background-color":!0,"background-image":!0,"background-origin":!0,"background-position":!0,"background-repeat":!0,"background-size":!0,"baseline-shift":!1,binding:!1,bleed:!1,"bookmark-label":!1,"bookmark-level":!1,"bookmark-state":!1,border:!0,"border-bottom":!0,"border-bottom-color":!0,"border-bottom-left-radius":!0,"border-bottom-right-radius":!0,"border-bottom-style":!0,"border-bottom-width":!0,"border-collapse":!0,"border-color":!0,"border-image":!0,"border-image-outset":!0,"border-image-repeat":!0,"border-image-slice":!0,"border-image-source":!0,"border-image-width":!0,"border-left":!0,"border-left-color":!0,"border-left-style":!0,"border-left-width":!0,"border-radius":!0,"border-right":!0,"border-right-color":!0,"border-right-style":!0,"border-right-width":!0,"border-spacing":!0,"border-style":!0,"border-top":!0,"border-top-color":!0,"border-top-left-radius":!0,"border-top-right-radius":!0,"border-top-style":!0,"border-top-width":!0,"border-width":!0,bottom:!1,"box-decoration-break":!0,"box-shadow":!0,"box-sizing":!0,"box-snap":!0,"box-suppress":!0,"break-after":!0,"break-before":!0,"break-inside":!0,"caption-side":!1,chains:!1,clear:!0,clip:!1,"clip-path":!1,"clip-rule":!1,color:!0,"color-interpolation-filters":!0,"column-count":!1,"column-fill":!1,"column-gap":!1,"column-rule":!1,"column-rule-color":!1,"column-rule-style":!1,"column-rule-width":!1,"column-span":!1,"column-width":!1,columns:!1,contain:!1,content:!1,"counter-increment":!1,"counter-reset":!1,"counter-set":!1,crop:!1,cue:!1,"cue-after":!1,"cue-before":!1,cursor:!1,direction:!1,display:!0,"display-inside":!0,"display-list":!0,"display-outside":!0,"dominant-baseline":!1,elevation:!1,"empty-cells":!1,filter:!1,flex:!1,"flex-basis":!1,"flex-direction":!1,"flex-flow":!1,"flex-grow":!1,"flex-shrink":!1,"flex-wrap":!1,float:!1,"float-offset":!1,"flood-color":!1,"flood-opacity":!1,"flow-from":!1,"flow-into":!1,font:!0,"font-family":!0,"font-feature-settings":!0,"font-kerning":!0,"font-language-override":!0,"font-size":!0,"font-size-adjust":!0,"font-stretch":!0,"font-style":!0,"font-synthesis":!0,"font-variant":!0,"font-variant-alternates":!0,"font-variant-caps":!0,"font-variant-east-asian":!0,"font-variant-ligatures":!0,"font-variant-numeric":!0,"font-variant-position":!0,"font-weight":!0,grid:!1,"grid-area":!1,"grid-auto-columns":!1,"grid-auto-flow":!1,"grid-auto-rows":!1,"grid-column":!1,"grid-column-end":!1,"grid-column-start":!1,"grid-row":!1,"grid-row-end":!1,"grid-row-start":!1,"grid-template":!1,"grid-template-areas":!1,"grid-template-columns":!1,"grid-template-rows":!1,"hanging-punctuation":!1,height:!0,hyphens:!1,icon:!1,"image-orientation":!1,"image-resolution":!1,"ime-mode":!1,"initial-letters":!1,"inline-box-align":!1,"justify-content":!1,"justify-items":!1,"justify-self":!1,left:!1,"letter-spacing":!0,"lighting-color":!0,"line-box-contain":!1,"line-break":!1,"line-grid":!1,"line-height":!1,"line-snap":!1,"line-stacking":!1,"line-stacking-ruby":!1,"line-stacking-shift":!1,"line-stacking-strategy":!1,"list-style":!0,"list-style-image":!0,"list-style-position":!0,"list-style-type":!0,margin:!0,"margin-bottom":!0,"margin-left":!0,"margin-right":!0,"margin-top":!0,"marker-offset":!1,"marker-side":!1,marks:!1,mask:!1,"mask-box":!1,"mask-box-outset":!1,"mask-box-repeat":!1,"mask-box-slice":!1,"mask-box-source":!1,"mask-box-width":!1,"mask-clip":!1,"mask-image":!1,"mask-origin":!1,"mask-position":!1,"mask-repeat":!1,"mask-size":!1,"mask-source-type":!1,"mask-type":!1,"max-height":!0,"max-lines":!1,"max-width":!0,"min-height":!0,"min-width":!0,"move-to":!1,"nav-down":!1,"nav-index":!1,"nav-left":!1,"nav-right":!1,"nav-up":!1,"object-fit":!1,"object-position":!1,opacity:!1,order:!1,orphans:!1,outline:!1,"outline-color":!1,"outline-offset":!1,"outline-style":!1,"outline-width":!1,overflow:!1,"overflow-wrap":!1,"overflow-x":!1,"overflow-y":!1,padding:!0,"padding-bottom":!0,"padding-left":!0,"padding-right":!0,"padding-top":!0,page:!1,"page-break-after":!1,"page-break-before":!1,"page-break-inside":!1,"page-policy":!1,pause:!1,"pause-after":!1,"pause-before":!1,perspective:!1,"perspective-origin":!1,pitch:!1,"pitch-range":!1,"play-during":!1,position:!1,"presentation-level":!1,quotes:!1,"region-fragment":!1,resize:!1,rest:!1,"rest-after":!1,"rest-before":!1,richness:!1,right:!1,rotation:!1,"rotation-point":!1,"ruby-align":!1,"ruby-merge":!1,"ruby-position":!1,"shape-image-threshold":!1,"shape-outside":!1,"shape-margin":!1,size:!1,speak:!1,"speak-as":!1,"speak-header":!1,"speak-numeral":!1,"speak-punctuation":!1,"speech-rate":!1,stress:!1,"string-set":!1,"tab-size":!1,"table-layout":!1,"text-align":!0,"text-align-last":!0,"text-combine-upright":!0,"text-decoration":!0,"text-decoration-color":!0,"text-decoration-line":!0,"text-decoration-skip":!0,"text-decoration-style":!0,"text-emphasis":!0,"text-emphasis-color":!0,"text-emphasis-position":!0,"text-emphasis-style":!0,"text-height":!0,"text-indent":!0,"text-justify":!0,"text-orientation":!0,"text-overflow":!0,"text-shadow":!0,"text-space-collapse":!0,"text-transform":!0,"text-underline-position":!0,"text-wrap":!0,top:!1,transform:!1,"transform-origin":!1,"transform-style":!1,transition:!1,"transition-delay":!1,"transition-duration":!1,"transition-property":!1,"transition-timing-function":!1,"unicode-bidi":!1,"vertical-align":!1,visibility:!1,"voice-balance":!1,"voice-duration":!1,"voice-family":!1,"voice-pitch":!1,"voice-range":!1,"voice-rate":!1,"voice-stress":!1,"voice-volume":!1,volume:!1,"white-space":!1,widows:!1,width:!0,"will-change":!1,"word-break":!0,"word-spacing":!0,"word-wrap":!0,"wrap-flow":!1,"wrap-through":!1,"writing-mode":!1,"z-index":!1}}var Ze=/javascript\s*\:/gim;Ke.whiteList={"align-content":!1,"align-items":!1,"align-self":!1,"alignment-adjust":!1,"alignment-baseline":!1,all:!1,"anchor-point":!1,animation:!1,"animation-delay":!1,"animation-direction":!1,"animation-duration":!1,"animation-fill-mode":!1,"animation-iteration-count":!1,"animation-name":!1,"animation-play-state":!1,"animation-timing-function":!1,azimuth:!1,"backface-visibility":!1,background:!0,"background-attachment":!0,"background-clip":!0,"background-color":!0,"background-image":!0,"background-origin":!0,"background-position":!0,"background-repeat":!0,"background-size":!0,"baseline-shift":!1,binding:!1,bleed:!1,"bookmark-label":!1,"bookmark-level":!1,"bookmark-state":!1,border:!0,"border-bottom":!0,"border-bottom-color":!0,"border-bottom-left-radius":!0,"border-bottom-right-radius":!0,"border-bottom-style":!0,"border-bottom-width":!0,"border-collapse":!0,"border-color":!0,"border-image":!0,"border-image-outset":!0,"border-image-repeat":!0,"border-image-slice":!0,"border-image-source":!0,"border-image-width":!0,"border-left":!0,"border-left-color":!0,"border-left-style":!0,"border-left-width":!0,"border-radius":!0,"border-right":!0,"border-right-color":!0,"border-right-style":!0,"border-right-width":!0,"border-spacing":!0,"border-style":!0,"border-top":!0,"border-top-color":!0,"border-top-left-radius":!0,"border-top-right-radius":!0,"border-top-style":!0,"border-top-width":!0,"border-width":!0,bottom:!1,"box-decoration-break":!0,"box-shadow":!0,"box-sizing":!0,"box-snap":!0,"box-suppress":!0,"break-after":!0,"break-before":!0,"break-inside":!0,"caption-side":!1,chains:!1,clear:!0,clip:!1,"clip-path":!1,"clip-rule":!1,color:!0,"color-interpolation-filters":!0,"column-count":!1,"column-fill":!1,"column-gap":!1,"column-rule":!1,"column-rule-color":!1,"column-rule-style":!1,"column-rule-width":!1,"column-span":!1,"column-width":!1,columns:!1,contain:!1,content:!1,"counter-increment":!1,"counter-reset":!1,"counter-set":!1,crop:!1,cue:!1,"cue-after":!1,"cue-before":!1,cursor:!1,direction:!1,display:!0,"display-inside":!0,"display-list":!0,"display-outside":!0,"dominant-baseline":!1,elevation:!1,"empty-cells":!1,filter:!1,flex:!1,"flex-basis":!1,"flex-direction":!1,"flex-flow":!1,"flex-grow":!1,"flex-shrink":!1,"flex-wrap":!1,float:!1,"float-offset":!1,"flood-color":!1,"flood-opacity":!1,"flow-from":!1,"flow-into":!1,font:!0,"font-family":!0,"font-feature-settings":!0,"font-kerning":!0,"font-language-override":!0,"font-size":!0,"font-size-adjust":!0,"font-stretch":!0,"font-style":!0,"font-synthesis":!0,"font-variant":!0,"font-variant-alternates":!0,"font-variant-caps":!0,"font-variant-east-asian":!0,"font-variant-ligatures":!0,"font-variant-numeric":!0,"font-variant-position":!0,"font-weight":!0,grid:!1,"grid-area":!1,"grid-auto-columns":!1,"grid-auto-flow":!1,"grid-auto-rows":!1,"grid-column":!1,"grid-column-end":!1,"grid-column-start":!1,"grid-row":!1,"grid-row-end":!1,"grid-row-start":!1,"grid-template":!1,"grid-template-areas":!1,"grid-template-columns":!1,"grid-template-rows":!1,"hanging-punctuation":!1,height:!0,hyphens:!1,icon:!1,"image-orientation":!1,"image-resolution":!1,"ime-mode":!1,"initial-letters":!1,"inline-box-align":!1,"justify-content":!1,"justify-items":!1,"justify-self":!1,left:!1,"letter-spacing":!0,"lighting-color":!0,"line-box-contain":!1,"line-break":!1,"line-grid":!1,"line-height":!1,"line-snap":!1,"line-stacking":!1,"line-stacking-ruby":!1,"line-stacking-shift":!1,"line-stacking-strategy":!1,"list-style":!0,"list-style-image":!0,"list-style-position":!0,"list-style-type":!0,margin:!0,"margin-bottom":!0,"margin-left":!0,"margin-right":!0,"margin-top":!0,"marker-offset":!1,"marker-side":!1,marks:!1,mask:!1,"mask-box":!1,"mask-box-outset":!1,"mask-box-repeat":!1,"mask-box-slice":!1,"mask-box-source":!1,"mask-box-width":!1,"mask-clip":!1,"mask-image":!1,"mask-origin":!1,"mask-position":!1,"mask-repeat":!1,"mask-size":!1,"mask-source-type":!1,"mask-type":!1,"max-height":!0,"max-lines":!1,"max-width":!0,"min-height":!0,"min-width":!0,"move-to":!1,"nav-down":!1,"nav-index":!1,"nav-left":!1,"nav-right":!1,"nav-up":!1,"object-fit":!1,"object-position":!1,opacity:!1,order:!1,orphans:!1,outline:!1,"outline-color":!1,"outline-offset":!1,"outline-style":!1,"outline-width":!1,overflow:!1,"overflow-wrap":!1,"overflow-x":!1,"overflow-y":!1,padding:!0,"padding-bottom":!0,"padding-left":!0,"padding-right":!0,"padding-top":!0,page:!1,"page-break-after":!1,"page-break-before":!1,"page-break-inside":!1,"page-policy":!1,pause:!1,"pause-after":!1,"pause-before":!1,perspective:!1,"perspective-origin":!1,pitch:!1,"pitch-range":!1,"play-during":!1,position:!1,"presentation-level":!1,quotes:!1,"region-fragment":!1,resize:!1,rest:!1,"rest-after":!1,"rest-before":!1,richness:!1,right:!1,rotation:!1,"rotation-point":!1,"ruby-align":!1,"ruby-merge":!1,"ruby-position":!1,"shape-image-threshold":!1,"shape-outside":!1,"shape-margin":!1,size:!1,speak:!1,"speak-as":!1,"speak-header":!1,"speak-numeral":!1,"speak-punctuation":!1,"speech-rate":!1,stress:!1,"string-set":!1,"tab-size":!1,"table-layout":!1,"text-align":!0,"text-align-last":!0,"text-combine-upright":!0,"text-decoration":!0,"text-decoration-color":!0,"text-decoration-line":!0,"text-decoration-skip":!0,"text-decoration-style":!0,"text-emphasis":!0,"text-emphasis-color":!0,"text-emphasis-position":!0,"text-emphasis-style":!0,"text-height":!0,"text-indent":!0,"text-justify":!0,"text-orientation":!0,"text-overflow":!0,"text-shadow":!0,"text-space-collapse":!0,"text-transform":!0,"text-underline-position":!0,"text-wrap":!0,top:!1,transform:!1,"transform-origin":!1,"transform-style":!1,transition:!1,"transition-delay":!1,"transition-duration":!1,"transition-property":!1,"transition-timing-function":!1,"unicode-bidi":!1,"vertical-align":!1,visibility:!1,"voice-balance":!1,"voice-duration":!1,"voice-family":!1,"voice-pitch":!1,"voice-range":!1,"voice-rate":!1,"voice-stress":!1,"voice-volume":!1,volume:!1,"white-space":!1,widows:!1,width:!0,"will-change":!1,"word-break":!0,"word-spacing":!0,"word-wrap":!0,"wrap-flow":!1,"wrap-through":!1,"writing-mode":!1,"z-index":!1},Ke.getDefaultWhiteList=Je,Ke.onAttr=function(e,t,r){},Ke.onIgnoreAttr=function(e,t,r){},Ke.safeAttrValue=function(e,t){return Ze.test(t)?"":t};var Ye=function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},Xe=function(e){return String.prototype.trimRight?e.trimRight():e.replace(/(\s*$)/g,"")},Qe=Ke,et=function(e,t){";"!==(e=Xe(e))[e.length-1]&&(e+=";");var r=e.length,n=!1,i=0,o=0,a="";function s(){if(!n){var r=Ye(e.slice(i,o)),s=r.indexOf(":");if(-1!==s){var u=Ye(r.slice(0,s)),c=Ye(r.slice(s+1));if(u){var l=t(i,a.length,u,c,r);l&&(a+=l+"; ")}}}i=o+1}for(;o<r;o++){var u=e[o];if("/"===u&&"*"===e[o+1]){var c=e.indexOf("*/",o+2);if(-1===c)break;i=(o=c+1)+1,n=!1}else"("===u?n=!0:")"===u?n=!1:";"===u?n||s():"\n"===u&&s()}return Ye(a)};function tt(e){return null==e}function rt(e){(e=function(e){var t={};for(var r in e)t[r]=e[r];return t}(e||{})).whiteList=e.whiteList||Qe.whiteList,e.onAttr=e.onAttr||Qe.onAttr,e.onIgnoreAttr=e.onIgnoreAttr||Qe.onIgnoreAttr,e.safeAttrValue=e.safeAttrValue||Qe.safeAttrValue,this.options=e}rt.prototype.process=function(e){if(!(e=(e=e||"").toString()))return"";var t=this.options,r=t.whiteList,n=t.onAttr,i=t.onIgnoreAttr,o=t.safeAttrValue;return et(e,(function(e,t,a,s,u){var c=r[a],l=!1;if(!0===c?l=c:"function"==typeof c?l=c(s):c instanceof RegExp&&(l=c.test(s)),!0!==l&&(l=!1),s=o(a,s)){var d,p={position:t,sourcePosition:e,source:u,isWhite:l};return l?tt(d=n(a,s,p))?a+":"+s:d:tt(d=i(a,s,p))?void 0:d}}))};var nt=rt;!function(e,t){var r=Ke,n=nt;for(var i in t=e.exports=function(e,t){return new n(t).process(e)},t.FilterCSS=n,r)t[i]=r[i]}(He,He.exports);var it=He.exports,ot={indexOf:function(e,t){var r,n;if(Array.prototype.indexOf)return e.indexOf(t);for(r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1},forEach:function(e,t,r){var n,i;if(Array.prototype.forEach)return e.forEach(t,r);for(n=0,i=e.length;n<i;n++)t.call(r,e[n],n,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(e){var t=/\s|\n|\t/.exec(e);return t?t.index:-1}},at=it.FilterCSS,st=it.getDefaultWhiteList,ut=ot;var ct=new at;function lt(e){return e.replace(dt,"&lt;").replace(pt,"&gt;")}var dt=/</g,pt=/>/g,ft=/"/g,mt=/&quot;/g,ht=/&#([a-zA-Z0-9]*);?/gim,gt=/&colon;?/gim,yt=/&newline;?/gim,vt=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,bt=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,wt=/u\s*r\s*l\s*\(.*/gi;function It(e){return e.replace(ft,"&quot;")}function xt(e){return e.replace(mt,'"')}function _t(e){return e.replace(ht,(function(e,t){return"x"===t[0]||"X"===t[0]?String.fromCharCode(parseInt(t.substr(1),16)):String.fromCharCode(parseInt(t,10))}))}function kt(e){return e.replace(gt,":").replace(yt," ")}function St(e){for(var t="",r=0,n=e.length;r<n;r++)t+=e.charCodeAt(r)<32?" ":e.charAt(r);return ut.trim(t)}function Et(e){return St(e=kt(e=_t(e=xt(e))))}function At(e){return lt(e=It(e))}qe.whiteList={a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]},qe.getDefaultWhiteList=function(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}},qe.onTag=function(e,t,r){},qe.onIgnoreTag=function(e,t,r){},qe.onTagAttr=function(e,t,r){},qe.onIgnoreTagAttr=function(e,t,r){},qe.safeAttrValue=function(e,t,r,n){if(r=Et(r),"href"===t||"src"===t){if("#"===(r=ut.trim(r)))return"#";if("http://"!==r.substr(0,7)&&"https://"!==r.substr(0,8)&&"mailto:"!==r.substr(0,7)&&"tel:"!==r.substr(0,4)&&"data:image/"!==r.substr(0,11)&&"ftp://"!==r.substr(0,6)&&"./"!==r.substr(0,2)&&"../"!==r.substr(0,3)&&"#"!==r[0]&&"/"!==r[0])return""}else if("background"===t){if(vt.lastIndex=0,vt.test(r))return""}else if("style"===t){if(bt.lastIndex=0,bt.test(r))return"";if(wt.lastIndex=0,wt.test(r)&&(vt.lastIndex=0,vt.test(r)))return"";!1!==n&&(r=(n=n||ct).process(r))}return At(r)},qe.escapeHtml=lt,qe.escapeQuote=It,qe.unescapeQuote=xt,qe.escapeHtmlEntities=_t,qe.escapeDangerHtml5Entities=kt,qe.clearNonPrintableCharacter=St,qe.friendlyAttrValue=Et,qe.escapeAttrValue=At,qe.onIgnoreTagStripAll=function(){return""},qe.StripTagBody=function(e,t){"function"!=typeof t&&(t=function(){});var r=!Array.isArray(e),n=[],i=!1;return{onIgnoreTag:function(o,a,s){if(function(t){return!!r||-1!==ut.indexOf(e,t)}(o)){if(s.isClosing){var u=s.position+10;return n.push([!1!==i?i:s.position,u]),i=!1,"[/removed]"}return i||(i=s.position),"[removed]"}return t(o,a,s)},remove:function(e){var t="",r=0;return ut.forEach(n,(function(n){t+=e.slice(r,n[0]),r=n[1]})),t+=e.slice(r)}}},qe.stripCommentTag=function(e){for(var t="",r=0;r<e.length;){var n=e.indexOf("\x3c!--",r);if(-1===n){t+=e.slice(r);break}t+=e.slice(r,n);var i=e.indexOf("--\x3e",n);if(-1===i)break;r=i+3}return t},qe.stripBlankChar=function(e){var t=e.split("");return(t=t.filter((function(e){var t=e.charCodeAt(0);return!(127===t||t<=31&&10!==t&&13!==t)}))).join("")},qe.cssFilter=ct,qe.getDefaultCSSWhiteList=st;var Pt={},Ot=ot;function Tt(e){var t,r=Ot.spaceIndex(e);return t=-1===r?e.slice(1,-1):e.slice(1,r+1),"/"===(t=Ot.trim(t).toLowerCase()).slice(0,1)&&(t=t.slice(1)),"/"===t.slice(-1)&&(t=t.slice(0,-1)),t}function Ct(e){return"</"===e.slice(0,2)}var Rt=/[^a-zA-Z0-9\\_:.-]/gim;function Mt(e,t){for(;t<e.length;t++){var r=e[t];if(" "!==r)return"="===r?t:-1}}function Ft(e,t){for(;t<e.length;t++){var r=e[t];if(" "!==r)return"'"===r||'"'===r?t:-1}}function Dt(e,t){for(;t>0;t--){var r=e[t];if(" "!==r)return"="===r?t:-1}}function jt(e){return function(e){return'"'===e[0]&&'"'===e[e.length-1]||"'"===e[0]&&"'"===e[e.length-1]}(e)?e.substr(1,e.length-2):e}Pt.parseTag=function(e,t,r){var n="",i=0,o=!1,a=!1,s=0,u=e.length,c="",l="";e:for(s=0;s<u;s++){var d=e.charAt(s);if(!1===o){if("<"===d){o=s;continue}}else if(!1===a){if("<"===d){n+=r(e.slice(i,s)),o=s,i=s;continue}if(">"===d){n+=r(e.slice(i,o)),c=Tt(l=e.slice(o,s+1)),n+=t(o,n.length,c,l,Ct(l)),i=s+1,o=!1;continue}if('"'===d||"'"===d)for(var p=1,f=e.charAt(s-p);""===f.trim()||"="===f;){if("="===f){a=d;continue e}f=e.charAt(s-++p)}}else if(d===a){a=!1;continue}}return i<e.length&&(n+=r(e.substr(i))),n},Pt.parseAttr=function(e,t){var r=0,n=0,i=[],o=!1,a=e.length;function s(e,r){if(!((e=(e=Ot.trim(e)).replace(Rt,"").toLowerCase()).length<1)){var n=t(e,r||"");n&&i.push(n)}}for(var u=0;u<a;u++){var c,l=e.charAt(u);if(!1!==o||"="!==l)if(!1===o||u!==n){if(/\s|\n|\t/.test(l)){if(e=e.replace(/\s|\n|\t/g," "),!1===o){if(-1===(c=Mt(e,u))){s(Ot.trim(e.slice(r,u))),o=!1,r=u+1;continue}u=c-1;continue}if(-1===(c=Dt(e,u-1))){s(o,jt(Ot.trim(e.slice(r,u)))),o=!1,r=u+1;continue}}}else{if(-1===(c=e.indexOf(l,u+1)))break;s(o,Ot.trim(e.slice(n+1,c))),o=!1,r=(u=c)+1}else o=e.slice(r,u),r=u+1,n='"'===e.charAt(r)||"'"===e.charAt(r)?r:Ft(e,u+1)}return r<e.length&&(!1===o?s(e.slice(r)):s(o,jt(Ot.trim(e.slice(r))))),Ot.trim(i.join(" "))};var Gt=it.FilterCSS,zt=qe,Lt=Pt,Nt=Lt.parseTag,Ut=Lt.parseAttr,$t=ot;function Bt(e){return null==e}function Wt(e){(e=function(e){var t={};for(var r in e)t[r]=e[r];return t}(e||{})).stripIgnoreTag&&(e.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),e.onIgnoreTag=zt.onIgnoreTagStripAll),e.whiteList||e.allowList?e.whiteList=function(e){var t={};for(var r in e)Array.isArray(e[r])?t[r.toLowerCase()]=e[r].map((function(e){return e.toLowerCase()})):t[r.toLowerCase()]=e[r];return t}(e.whiteList||e.allowList):e.whiteList=zt.whiteList,e.onTag=e.onTag||zt.onTag,e.onTagAttr=e.onTagAttr||zt.onTagAttr,e.onIgnoreTag=e.onIgnoreTag||zt.onIgnoreTag,e.onIgnoreTagAttr=e.onIgnoreTagAttr||zt.onIgnoreTagAttr,e.safeAttrValue=e.safeAttrValue||zt.safeAttrValue,e.escapeHtml=e.escapeHtml||zt.escapeHtml,this.options=e,!1===e.css?this.cssFilter=!1:(e.css=e.css||{},this.cssFilter=new Gt(e.css))}Wt.prototype.process=function(e){if(!(e=(e=e||"").toString()))return"";var t=this.options,r=t.whiteList,n=t.onTag,i=t.onIgnoreTag,o=t.onTagAttr,a=t.onIgnoreTagAttr,s=t.safeAttrValue,u=t.escapeHtml,c=this.cssFilter;t.stripBlankChar&&(e=zt.stripBlankChar(e)),t.allowCommentTag||(e=zt.stripCommentTag(e));var l=!1;t.stripIgnoreTagBody&&(l=zt.StripTagBody(t.stripIgnoreTagBody,i),i=l.onIgnoreTag);var d=Nt(e,(function(e,t,l,d,p){var f={sourcePosition:e,position:t,isClosing:p,isWhite:Object.prototype.hasOwnProperty.call(r,l)},m=n(l,d,f);if(!Bt(m))return m;if(f.isWhite){if(f.isClosing)return"</"+l+">";var h=function(e){var t=$t.spaceIndex(e);if(-1===t)return{html:"",closing:"/"===e[e.length-2]};var r="/"===(e=$t.trim(e.slice(t+1,-1)))[e.length-1];return r&&(e=$t.trim(e.slice(0,-1))),{html:e,closing:r}}(d),g=r[l],y=Ut(h.html,(function(e,t){var r=-1!==$t.indexOf(g,e),n=o(l,e,t,r);return Bt(n)?r?(t=s(l,e,t,c))?e+'="'+t+'"':e:Bt(n=a(l,e,t,r))?void 0:n:n}));return d="<"+l,y&&(d+=" "+y),h.closing&&(d+=" /"),d+">"}return Bt(m=i(l,d,f))?u(d):m}),u);return l&&(d=l.remove(d)),d};var Vt=Wt;!function(e,t){var r=qe,n=Pt,i=Vt;function o(e,t){return new i(t).process(e)}(t=e.exports=o).filterXSS=o,t.FilterXSS=i,function(){for(var e in r)t[e]=r[e];for(var i in n)t[i]=n[i]}(),"undefined"!=typeof self&&"undefined"!=typeof DedicatedWorkerGlobalScope&&self instanceof DedicatedWorkerGlobalScope&&(self.filterXSS=e.exports)}(Ve,Ve.exports);var qt=Ve.exports,Ht=function(){function e(e,t){var r,n=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],article:["style"],aside:["style"],audio:["autoplay","controls","loop","muted","preload"],b:[],blockquote:["style"],br:[],code:["style"],dd:["style"],details:["style"],div:["align","style","aria-label","aria-hidden"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],footer:["style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],header:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],main:["style"],mark:["style"],nav:["style"],ol:[],p:["style"],pre:["style"],section:["style"],source:["media","src","type"],span:["style"],strong:[],sub:["style"],summary:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],time:["style"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.arcgisCSSWhiteList=We(We({},qt.getDefaultCSSWhiteList()),{flex:!0,"flex-basis":!0,"flex-direction":!0,"flex-flow":!0,"flex-grow":!0,"flex-shrink":!0,"flex-wrap":!0,"line-height":!0,"justify-content":!0,overflow:!0}),this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(e,t,r,i){return"a"===e&&"href"===t||("img"===e||"source"===e)&&"src"===t?n.sanitizeUrl(r):qt.safeAttrValue(e,t,r,i)}},this._entityMap={"&":"&#x38;","<":"&#x3C;",">":"&#x3E;",'"':"&#x22;","'":"&#x27;","/":"&#x2F;"},e&&!t?r=e:e&&t?((r=Object.create(this.arcgisFilterOptions)).css={whiteList:this.arcgisCSSWhiteList},Object.keys(e).forEach((function(t){if("whiteList"===t)r.whiteList=n._extendObjectOfArrays([n.arcgisWhiteList,e.whiteList||{}]);else if("css"===t){var i=e.css.whiteList;null!=i&&e.css instanceof Object&&Object.keys(i).forEach((function(e){return r.css.whiteList[e]=i[e]}))}else r[t]=e[t]}))):((r=Object.create(this.arcgisFilterOptions)).whiteList=this.arcgisWhiteList,r.css={whiteList:this.arcgisCSSWhiteList}),this.xssFilterOptions=r,this._xssFilter=new qt.FilterXSS(r)}return e.prototype.sanitize=function(e,t){switch(void 0===t&&(t={}),typeof e){case"number":return isNaN(e)||!isFinite(e)?null:e;case"boolean":return e;case"string":return this._xssFilter.process(e);case"object":return this._iterateOverObject(e,t);default:if(t.allowUndefined&&void 0===e)return;return null}},e.prototype.sanitizeUrl=function(e,t){var r=(null!=t?t:{}).isProtocolRequired,n=void 0===r||r,i=this._trim(e.substring(0,e.indexOf(":"))),o="/"===e,a=/^#/.test(e),s=i&&this.allowedProtocols.indexOf(i.toLowerCase())>-1;return o||a||s?qt.escapeAttrValue(e):i||n?"":qt.escapeAttrValue("https://".concat(e))},e.prototype.sanitizeHTMLAttribute=function(e,t,r,n){return"function"==typeof this.xssFilterOptions.safeAttrValue?this.xssFilterOptions.safeAttrValue(e,t,r,n):qt.safeAttrValue(e,t,r,n)},e.prototype.validate=function(e,t){void 0===t&&(t={});var r=this.sanitize(e,t);return{isValid:e===r,sanitized:r}},e.prototype.encodeHTML=function(e){var t=this;return String(e).replace(/[&<>"'\/]/g,(function(e){return t._entityMap[e]}))},e.prototype.encodeAttrValue=function(e){var t=/^[a-zA-Z0-9]$/;return String(e).replace(/[\x00-\xFF]/g,(function(r,n){return t.test(r)?r:"&#x".concat(Number(e.charCodeAt(n)).toString(16),";")}))},e.prototype._extendObjectOfArrays=function(e){var t={};return e.forEach((function(e){Object.keys(e).forEach((function(r){Array.isArray(e[r])&&Array.isArray(t[r])?t[r]=t[r].concat(e[r]):t[r]=e[r]}))})),t},e.prototype._iterateOverObject=function(e,t){var r=this;void 0===t&&(t={});try{var n=!1,i=void 0;if(Array.isArray(e))i=e.reduce((function(e,i){var o=r.validate(i,t);return o.isValid?e.concat([i]):(n=!0,e.concat([o.sanitized]))}),[]);else{if(!function(e){if("object"!=typeof e||null===e)return!1;if("[object Object]"!==Object.prototype.toString.call(e))return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}(e)){if(t.allowUndefined&&void 0===e)return;return null}i=Object.keys(e).reduce((function(i,o){var a=e[o],s=r.validate(a,t);return s.isValid?i[o]=a:(n=!0,i[o]=s.sanitized),i}),{})}return n?i:e}catch(e){return null}},e.prototype._trim=function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},e}();function Kt(e,t){return t||(t=new Ht),t.sanitize(e)}function Jt(e){return new Promise((t=>{Yt(e).then((e=>{try{t(JSON.parse(e))}catch(e){t(null)}}),(()=>t(null)))}))}function Zt(e,t,r){return new File([e],t||"",{type:r??e.type})}function Yt(e){return new Promise((t=>{const r=new FileReader;r.onload=function(e){const r=e.target.result;t(r||"")},r.readAsText(e)}))}function Xt(e){return e?e.endsWith("/")?e:e+"/":e}function Qt(e){const t={...e};return t.resources=e?.resources?Object.values(e.resources):[],t}function er(e=[]){if(0===e.length)return[];const t=new Set(e),r=[];return t.forEach((e=>r.push(e))),r}function tr(e,t=""){return{item:null,id:t,type:e,postProcess:!1}}function rr(e){let t=[];const r=e.match(/{{[0-9A-F]{32}.itemId}}/gi);return r&&(t=r.map((e=>e.replace("{{","").replace(".itemId}}","")))),t}function nr(e,t,r="application/json"){return Zt(function(e){const t=(new TextEncoder).encode(JSON.stringify(e));return new Blob([t],{type:"application/octet-stream"})}(e),t,r)}function ir(e){let t={};if(Array.isArray(e))t=e.map(ir);else if("object"==typeof e)if(e instanceof File){const r=e.type?{type:e.type}:void 0;t=new File([e],e.name,r)}else for(const r in e)null!=e[r]&&"object"==typeof e[r]?t[r]=ir(e[r]):t[r]=e[r];else t=e;return t}function or(e,t){const r=t.split(".");if(Array.isArray(e))e.forEach((e=>or(e,t)));else{const n=r.slice(1).join(".");void 0!==e[r[0]]&&(1===r.length?delete e[t]:or(e[r[0]],n))}}function ar(e,t){t.forEach((t=>{or(e,t)}))}function sr(e){return e?{success:!1,error:e.response?.error||e.error||e}:{success:!1}}function ur(e){return vr(e,/({*)(\b[0-9A-F]{32}\b)/gi).reduce((function(e,t){return t.indexOf("{{")<0&&e.push(t.replace("{","")),e}),[])}function cr(e,t){return t.split(".").reduce((function(e,t){return e?e[t]:void 0}),e)}function lr(e,t){ur(e).forEach((e=>{-1===t.indexOf(e)&&t.push(e)}))}function dr(e,t,r){const n=t.split(".");n.reduce(((e,t,i)=>i===n.length-1?(e[t]=r,r):(e[t]||(e[t]={}),e[t])),e)}function pr(e,t,r){if(cr(e,t)){const n=t.split(".");n.reduce(((e,t,i)=>i===n.length-1?(e[t]=r,r):e[t]),e)}}function fr(e,t){const r=cr(e,"item.typeKeywords")||e.typeKeywords||[];return t.reduce(((e,t)=>(e||(e=r.includes(t)),e)),!1)}function mr(e,t,r){e=e?e.trim():"_";const n=(cr(t,r)||[]).map((e=>e.title));let i=e,o=0;for(;n.indexOf(i)>-1;)o++,i=e+" "+o;return i}function hr(e){return e?e.replace("{{","").replace(".itemId}}",""):e}function gr(e){return e?.toString()?parseInt(e.toString().replace(/[{]{2}.{32}[.]layer/,"").replace(/[.]layerId[}]{2}/,""),10):e}function yr(e,t){let r;return e.some((e=>e.itemId===t&&(r=e,!0))),r}function vr(e,t){return e&&t.test(e)?e.match(t):[]}var br=function(e,t,r){return void 0===r&&(r=void 0),t.split(".").reduce((function(e,t){return e?e[t]:r}),e)};function wr(e,t){return Object.keys(e).reduce((function(r,n){return r[n]=t(e[n],n,e),r}),{})}var Ir=function(e){return e instanceof Date},xr=function(e){return"function"==typeof e},_r=function(e){return"object"==typeof e},kr=function(e){return e instanceof RegExp};function Sr(e,t,r){return r=r||"",Array.isArray(e)?e.map(n):!e||!_r(e)||Ir(e)||kr(e)||xr(e)?t(e,r):Object.assign({},e,wr(e,n));function n(e,n){return Sr(e,t,r?r+"."+n:n)}}var Er=function(e){return"object"==typeof e};function Ar(e,t){return Array.isArray(e)?(a=e.map(c).filter((function(e){return null!=e})),s=a,(u=a.reduce((function(e,t){if(Tr(t)&&Or(t)){var r=Pr(t);r>e&&(e=r)}return e}),-1))>-1&&(s=0===u?[]:"{{delete:"+(u-1)+"}}"),s):e&&Er(e)?(i=wr(e,c),o=Object.keys(i).reduce((function(e,t){var r=i[t];if(Tr(r)&&Or(r)){var n=Pr(r);n>e.maxLevel&&(e.maxLevel=n)}else e.obj[t]=r;return e}),{obj:{},maxLevel:-1}),o.maxLevel>0?1===o.maxLevel?void 0:"{{delete:"+(o.maxLevel-1)+"}}":o.obj):(n=r=e,"string"==typeof r&&Or(r)&&(n=function(e){var t=Pr(e);return 0===t?void 0:"{{delete:"+t+"}}"}(r)),n);var r,n,i,o,a,s,u;function c(e,t){return Ar(e)}}var Pr=function(e){return parseInt(e.replace(/{|}/g,"").split(":")[1])};function Or(e){return!(!e||"string"!=typeof e)&&e.indexOf("{{delete")>-1}var Tr=function(e){return"string"==typeof e};function Cr(e,t,r,n){void 0===n&&(n=0);var i=t;return t||(i="{{delete:"+n+"}}"),i}var Rr=function(e){var t={};if(Array.isArray(e))t=e.map(Rr);else if("object"==typeof e)for(var r in e)null!=e[r]&&"object"==typeof e[r]?t[r]=Rr(e[r]):t[r]=e[r];else t=e;return t},Mr=/{{\s*?[\w].*?}}/g,Fr=function(e){return"string"==typeof e};function Dr(e){return e||""===e||0===e}function jr(e,t,r){if(void 0===r&&(r=null),(r=Rr(r)||{}).optional)throw new Error("Please do not pass in an `optional` transform; adlib provides that internally.");r.optional=Cr;var n=Sr(e,(function(e,n){if(!Fr(e))return e;var i,o=e.match(Mr);if(o&&o.length){var a=o.map((function(e){var n=!1,i=e.replace(/{|}/g,"").trim();if(i.indexOf("||")>-1){var o=i.split("||").map((function(e){return e.trim()})),a=o.length;i=o.find((function(e,r){var i,o;return i=t,o=e.split(":")[0],null!=br(i,o,null)?e:r+1===a&&(n=!0,isNaN(e)||(e=parseInt(e)),e)}))}var s={key:e,value:i};if(!n){var u=function(e,t,r){var n,i=e.split(":");if(i.length>1){var o,a=i[0],s=i[1];if(i[2]&&(o=i[2]),!r||!r[s]||"function"!=typeof r[s])throw new Error("Attempted to apply non-existant transform "+s+" on "+a+" with params "+e);n=br(t,a),n=r[s](a,n,t,o)}else n=br(t,e);return n}(i,t,r);s.value=Dr(u)?u:e}return s}));return a.forEach((function(t){e===t.key?("string"==typeof t.value&&(isNaN(t.value)||""===t.value||(t.value.indexOf(".")>-1?t.value=parseFloat(t.value):"0"!==t.value[0]&&(t.value=parseInt(t.value)))),i=t.value):e=e.replace(t.key,t.value)})),Dr(i)?i:e}return e}));return Ar(n)}const Gr="portalBaseUrl",zr="organization.helperServices.geometry.url",Lr="organization.helperServices.geocode:getDefaultLocatorURL",Nr="organization.helperServices.route.url",Ur={getDefaultLocatorURL:(e,t)=>t?t[0].url:`{{${Lr}}}`};function $r(e){return"{{"+e+"}}"}function Br(e){const t=Wr(e.id,e.type);return t.item={...t.item,accessInformation:e.accessInformation,categories:e.categories,contentStatus:e.contentStatus,created:e.created,culture:e.culture,description:e.description,extent:Hr(e),licenseInfo:e.licenseInfo,modified:e.modified,name:e.name,origUrl:e.origUrl,properties:e.properties,snippet:e.snippet,spatialReference:void 0,tags:e.tags,thumbnail:e.thumbnail,title:e.title,typeKeywords:e.typeKeywords,url:e.url},t}function Wr(e,t=""){return{itemId:e,type:t,key:((r=.2777777777777778,.7222222222218678*Math.random()+r).toString(36)+"0000000").substr(2,8),item:{id:e,type:t},data:{},resources:[],dependencies:[],groups:[],properties:{},estimatedDeploymentCostFactor:2};var r}function Vr(e,t){const r=function(e,t){const r=t;return e.findIndex((e=>r===e.itemId))}(e,t);return r>=0?e[r]:null}function qr(e){return(t=e,t&&JSON.stringify(t).match(/{{.+?}}/gim)||[]).length>0;var t}function Hr(e){const t=e.extent;return null===t||Array.isArray(t)&&0===t.length?t:"{{solutionItemExtent}}"}function Kr(e,t){return jr(e,t,Ur)}function Jr(e,t,r=""){if(!e)return e;const n=new RegExp(t,"g");return e.replace(n,"{{"+t+r+"}}")}function Zr(e,t,r,n=!1){let i=JSON.stringify(e);return t.forEach((e=>{let t="\\b"+e.name+"\\b(?![.])(?![}]{2})";n||(t+='(?!":)'),i=i.replace(new RegExp(t,"g"),function(e,t){return t.startsWith("{{")?t:String(Jr(e,e,"."+String(t).toLowerCase()))}(r,e.name+".name"))})),JSON.parse(i)}function Yr(e){let t=JSON.stringify(e);const r=/[0-9A-F]{32}/gim;return e&&r.test(t)&&(t.match(r).filter(Ne).forEach((e=>{const r=new RegExp(e,"gm");t=t.replace(r,"{{"+e+".itemId}}")})),e=JSON.parse(t)),e}function Xr(e,t,r={}){return e?ke(e,{authentication:t,rawResponse:!0,...r}).then((e=>e.blob())):Promise.reject("Url must be provided")}const Qr="PK";function en(e,t){return U(e,{authentication:t})}function tn(e){return new Promise((t=>{const r={httpMethod:"GET",authentication:e,rawResponse:!1};ke(`${e.portal}/portals/self/urls`,r).then((e=>{t(e)}),(()=>t({})))}))}function rn(e){return e.getUser()}function nn(e){return new Promise(((t,r)=>{const n={httpMethod:"GET",authentication:e,rawResponse:!1},i=`${e.portal}/content/users/${encodeURIComponent(e.username)}`,o=`${e.portal}/community/users/${encodeURIComponent(e.username)}`;Promise.all([ke(i,n),ke(o,n)]).then((e=>{t({folders:e[0].folders||[],groups:e[1].groups||[]})}),(e=>r(e)))}))}function on(e,t,r,n=[],i){return new Promise(((o,a)=>{an(e,r,n).then((e=>o(e?Zt(e,t,i):null)),a)}))}function an(e,t,r=[]){return new Promise(((n,i)=>{Xr(e,t).then((e=>{bn(e).then((e=>{"application/json"===e.type?Jt(e).then((t=>{if(t?.error){const e=t.error.code;void 0!==e&&r.indexOf(e)>=0?n(null):i(t)}else n(e)})):n(e)}),i)}),i)}))}function sn(e,t){return new Promise(((r,n)=>{wn(e,{start:1,num:100},t).then((e=>{r(e)}),n)}))}function un(e,t){const r={authentication:t};return(0,N.Gq)(e,r)}function cn(e,t,r){return new Promise((n=>{dn(e,r).then((e=>n(Zt(e,t))),(()=>n(null)))}))}function ln(e,t){return new Promise((r=>{dn(e,t).then((e=>r(Jt(e))),(()=>r(null)))}))}function dn(e,t){return new Promise((r=>{const n=function(e,t){return`${vn(t)}/content/items/${e}/data`}(e,t);an(n,t,[400,500]).then((e=>r(bn(e))),(()=>r(null)))}))}function pn(e,t){return new Promise((r=>{(function(e,t){return new Promise(((r,n)=>{const i=function(e,t){return function(e,t){return`${vn(t)}/content/items/${e}/info/`}(e,t)+"metadata/metadata.xml"}(e,t);an(i,t,[400]).then(r,n)}))})(e,t).then((e=>{!e||e&&e.type.startsWith("application/json")?r(null):r(Zt(e,"metadata.xml"))}),(()=>r(null)))}))}function fn(e,t,r,n,i=100){return new Promise((o=>{In({id:e,relationshipType:t,authentication:n,params:{direction:r,start:1,num:i}}).then((e=>{o(e)}))}))}function mn(e,t,r){return new Promise((n=>{const i=["APIKey2Item","Area2CustomPackage","Area2Package","Item2Attachment","Item2Report","Listed2Provisioned","Map2AppConfig","Map2Area","Map2FeatureCollection","Map2Service","MobileApp2Code","Service2Data","Service2Layer","Service2Route","Service2Service","Service2Style","Solution2Item","Style2Style","Survey2Data","Survey2Service","SurveyAddIn2Data","Theme2Story","TrackView2Map","WebStyle2DesktopStyle","WMA2Code","WorkforceMap2FeatureService"],o=i.map((n=>fn(e,n,t,r)));Promise.all(o).then((e=>{const t=[];for(let r=0;r<i.length;++r)e[r].total>0&&t.push({relationshipType:i[r],relatedItemIds:e[r].relatedItems.map((e=>e.id))});n(t)}))}))}function hn(e,t){return new Promise(((r,n)=>{xn(e,{start:1,num:100},t).then((e=>{Promise.all(e).then(r,n)}),n)}))}function gn(e,t,r,n){return new Promise(((i,o)=>{if(!t)return void i(null);const a=yn(e,t,r,n),s=t.lastIndexOf("/")+1;on(a,t.substring(s),n,[400,500]).then(i,o)}))}function yn(e,t,r,n){return Xt(vn(n))+(r?"community/groups/":"content/items/")+e+"/info/"+t}function vn(e){return cr(e,"portal")||"https://www.arcgis.com/sharing/rest"}function bn(e){return new Promise(((t,r)=>{e&&e.size>0&&(e.type.startsWith("text/plain")||e.type.startsWith("application/json"))?Yt(e).then((r=>{try{JSON.parse(r),t(new Blob([e],{type:"application/json"}))}catch(n){r.length>4&&r.substr(0,4)===Qr?t(new Blob([e],{type:"application/zip"})):r.startsWith("<")?t(new Blob([e],{type:"text/xml"})):t(e)}}),r):e?t(e):r()}))}function wn(e,t,r){return new Promise(((n,i)=>{const o={paging:t,authentication:r};_e(e,o).then((a=>{if(a.num>0){const s=a.items.map((e=>e.id));a.nextStart>0?(o.paging.start=a.nextStart,wn(e,t,r).then((e=>{n(s.concat(e))}),i)):n(s)}else n([])}),i)}))}function In(e){return new Promise((t=>{const r={total:0,relatedItems:[]};(function(e){return(0,N.S9)(e)})(e).then((n=>{n.aggregations.total.count>0?(r.total=n.aggregations.total.count,r.relatedItems=n.relatedItems,n.nextkey?(e.params.start+=e.params.num,e.params.nextkey=n.nextkey,In(e).then((e=>{r.total+=e.total,r.relatedItems=r.relatedItems.concat(e.relatedItems),t(r)}))):t(r)):t(r)}),(()=>{t(r)}))}))}function xn(e,t,r){return new Promise(((n,i)=>{const o=vn(r),a=[];ke(`${o}/content/items/${e}/resources`,{params:{...t},authentication:r}).then((s=>{s.num>0?(s.resources.forEach((t=>{const n=`${o}/content/items/${e}/resources/${t.resource}`;a.push(on(n,t.resource,r))})),s.nextStart>0?(t.start=s.nextStart,xn(e,t,r).then((e=>{n(a.concat(e))}),i)):n(a)):n([])}),i)}))}function _n(e,t){const r=cr(e,"item.typeKeywords")||cr(t,"typeKeywords"),n=cr(e,"item.properties.trackViewGroup")||cr(t,"properties.trackViewGroup");return!!(r&&r.indexOf("Location Tracking View")>-1&&n)}function kn(e){const t=cr(e,"item.tags");return!!(t&&t.indexOf("Location Tracking Group")>-1)}function Sn(e,t,r,n){const i=cr(e,t);i&&pr(e,t,i.replace(r,n))}function En(e,t,r,n){n=n||{};const i=e.item.id,o=e.item.url;e.item={...e.item,id:Jr(i,i,".itemId"),url:Un(i,"url"),typeKeywords:Yr(e.item.typeKeywords)},function(e){if(_n(e)){const t=cr(e,"item.properties.trackViewGroup");e.groups.push(t),e.dependencies.push(t);const r=Jr(t,t,".itemId");pr(e,"item.properties.trackViewGroup",r),Sn(e,"item.name",t,r),Sn(e,"properties.service.adminServiceInfo.name",t,r),(e.properties.layers||[]).concat(e.properties.tables||[]).forEach((e=>{!function(e,t){const r=cr(e,t);r&&pr(e,t,Jr(r,r,".itemId"))}(e,"adminLayerInfo.viewLayerDefinition.sourceServiceItemId")}))}}(e),or(e,"properties.service.size");const a=e.properties.layers||[],s=e.properties.tables||[],u=a.concat(s),c=e.data||{},l=c.layers||[],d=c.tables||[],p=l.concat(d);n[o]=e.item.url,u.concat(p).forEach((e=>{n[o+"/"+e.id]=Un(i,"layer"+e.id+".url")})),e.properties.service.serviceItemId=Jr(e.properties.service.serviceItemId,e.properties.service.serviceItemId,".itemId");const f=cr(e,"properties.service.initialExtent");f&&(e.properties.service.initialExtent=Jr(i,i,".solutionExtent"));const m=cr(e,"properties.service.fullExtent");m&&(e.properties.service.fullExtent=Jr(i,i,".solutionExtent")),e.properties.defaultExtent=f||m,!cr(e,"properties.service.spatialReference")&&cr(e,"properties.defaultExtent.spatialReference")&&dr(e,"properties.service.spatialReference",e.properties.defaultExtent.spatialReference);let h=!1;return u.forEach((i=>{const o=p.filter((e=>i.id===e.id)),a=1===o.length?o[0]:void 0;!function(e,t,r,n,i,o){(function(e){const t=(e.fields||[]).map((e=>e.name));(function(e,t){const r=e.displayField||"";let n=-1;if(t.some((e=>(n+=1,e===r||e===r.toLowerCase()))))e.displayField=t[n];else{const r=[],n=cr(e,"uniqueIdField.name");n&&r.push(n);const i=cr(e,"globalIdField");i&&r.push(i),t.some((t=>-1===r.indexOf(t)&&(e.displayField=t,!0)))}})(e,t),function(e,t){const r=e.indexes;if(r){const n=[];e.indexes=r.reduce(((e,r)=>{const i=r.fields.split(","),o=[];return i.forEach((e=>{-1===n.indexOf(e)&&(n.push(e),t.indexOf(e)>-1&&o.push(e))})),o.length>0&&(r.fields=o.join(","),e.push(r)),e}),[])}}(e,t),Bn(e,t),function(e,t){const r=e.types;r&&(e.types=r.map((e=>(Bn(e,t),e))))}(e,t),function(e,t){const r=e.editFieldsInfo;r&&Object.keys(r).forEach((e=>{const n=r[e];n&&t.some((t=>t===n||t===n.toLowerCase()&&(r[e]=t,!0)))}))}(e,t)})(t),i&&function(e,t,r,n){const i=t+".layer"+r.id+".fields",o=r.fields.map((e=>e.name));e&&(Vn(e,n),Kn(e,r,i,t,o)),Vn(r,n),function(e,t){e&&e.relationships&&e.relationships.forEach((r=>{r.keyField&&$n(r,"keyField",t+".layer"+e.id+".fields","name")}))}(r,t),Qn(r,i,o),ei(r,i,o),ri(r,i,o),function(e,t){(e.templates||[]).forEach((e=>{const r=oi(cr(e,"prototype.attributes"),t,"name");r&&(e.prototype.attributes=r)}))}(r,i),function(e,t){const r=e.types;r&&Array.isArray(r)&&r.length>0&&r.forEach((e=>{const r=oi(e.domains,t,"name");r&&(e.domains=r);const n=e.templates;n&&n.length>0&&n.forEach((e=>{const r=oi(cr(e,"prototype.attributes"),t,"name");r&&(e.prototype.attributes=r)}))}))}(r,i),function(e,t){if(e.timeInfo){const r=e.timeInfo;["endTimeField","startTimeField","trackIdField"].forEach((e=>{""!==r[e]?$n(r,e,t,"name"):r[e]=null}))}}(r,i),function(e,t,r){e&&e.hasOwnProperty("viewDefinitionQuery")&&(e.viewDefinitionQuery=ti(e.viewDefinitionQuery||"",t,r,"name")),e&&e.hasOwnProperty("definitionQuery")&&(e.definitionQuery=ti(e.definitionQuery||"",t,r,"name"))}(r,i,o)}(e,r.itemId,t,n);const a=[t];e&&a.push(e),a.forEach((e=>{e.hasOwnProperty("name")&&(e.name=Jr(e.serviceItemId+".layer"+e.id,e.serviceItemId+".layer"+e.id,".name||"+e.name)),e.hasOwnProperty("extent")&&(e.extent=Jr(e.serviceItemId,e.serviceItemId,".solutionExtent")),e.hasOwnProperty("serviceItemId")&&(e.serviceItemId=Jr(e.serviceItemId,e.serviceItemId,".itemId")),e.hasOwnProperty("adminLayerInfo")&&(e.adminLayerInfo=function(e,t,r){const n=Object.assign({},e.adminLayerInfo);if(Gn(n,r),or(n,"xssTrustedFields"),or(n,"tableName"),n.viewLayerDefinition){const e=Object.assign({},n.viewLayerDefinition);Wn(e,t),e.table&&(Wn(e.table,t),e.table.relatedTables&&e.table.relatedTables.forEach((e=>{Wn(e,t)}))),n.viewLayerDefinition=e}return n}(e,n,o))}))}(a,i,e,t,r,n),h=!!(i.hasZ||a&&a.hasZ)||h})),h&&(e.properties.service.enableZDefaults=!0,e.properties.service.zDefault=0),e}function An(e,t,r){r.forEach((r=>{r&&r.hasOwnProperty("popupInfo")&&(e[t][r.id]=r.popupInfo,r.popupInfo={})}))}function Pn(e,t,r,n){if(e){const i=`layer${e}`,o=cr(n,`${Ce}.${t}`)||{itemId:t};o[i]=cr(o,i)||{layerId:e,itemId:t},""!==r&&(o[i].url=r);const a={};a[t]=o,n[Ce]={...n[Ce],...a}}}function On(e,t,r){return function(e,t){const r=cr(e,"item.typeKeywords"),n=cr(t,"typeKeywords");r&&n&&pr(e,"item.typeKeywords",r.concat(n.filter((e=>r.indexOf(e)<0))))}(e,r),t[e.itemId]=Object.assign(t[e.itemId]||{},{itemId:r.serviceItemId,url:Xt(r.serviceurl),name:r.name}),e.itemId=r.serviceItemId,Kr(e,t)}function Tn(e,t,r,n){const i={};return Object.keys(e).forEach((o=>{const a=cr(e[o],"item.id"),s=parseInt(a,10)>-1,u=s&&n?n[a]:s?a:o;i[`layer${s?a:o}`]={fields:ai(e,o),url:Xt(t)+u,layerId:u,itemId:r},or(e[o],"newFields"),or(e[o],"sourceFields")})),i}function Cn(e){const t=e.properties,r=[];return(t.layers||[]).forEach((function(e){r.push({item:e,type:"layer"})})),(t.tables||[]).forEach((function(e){r.push({item:e,type:"table"})})),r}function Rn(e,t,r,n){return new Promise(((i,o)=>{if(_n(e))!function(e,t){const r=e.item.url,n=e.itemId;let i;Object.keys(t).some((e=>{if(n===t[e].itemId)return i=e,!0})),e.properties.layers.forEach((e=>{const n=e.id.toString();t[i][`layer${n}`]={url:Xt(r)+n}}))}(e,t),i(null);else{const a={},s={},u=Cn(e);u.length>0?function(e,t,r,n,i,o,a,s){return new Promise(((i,u)=>{if(_n(s))i(null);else{let c={layers:[],tables:[],authentication:n};cr(s,"properties.service.hasViews")&&zn(s,r);const l=function(e){const t=e.map((e=>e.item.name)),r={};return e.some((e=>{const n=e.item.adminLayerInfo?.viewLayerDefinition?.table;if(n){const e=n.sourceServiceName,i=n.sourceLayerId;if(e&&i>-1)if(Object.keys(r).indexOf(e)>-1){if(r[e].indexOf(i)>-1)return!0;r[e].push(i)}else r[e]=[i];return(n.relatedTables||[]).some((e=>t.indexOf(e.name)>-1))}}))}(t);t=function(e,t,r){const n=cr(r,"properties.service.isMultiServicesView")||!1;return t||n?e.sort(((e,t)=>e.item.id-t.item.id)):e}(t,l,s);const d=20,p=[];t.forEach(((e,i)=>{let u=e.item;const d=u.id,f=s.properties.service.isView,m=r.isPortal;var h;a=function(e,t,r,n){e&&e.fields&&(t[e.id]={sourceFields:JSON.parse(JSON.stringify(e.fields)),type:e.type,id:e.id},!r&&n&&(t[e.id].subtypes=e.subtypes,t[e.id].subtypeField=e.subtypeField,t[e.id].defaultSubtypeCode=e.defaultSubtypeCode));const i={editFieldsInfo:!1,types:!1,templates:!1,relationships:!0,drawingInfo:!1,timeInfo:!1,viewDefinitionQuery:!1};return!r&&n&&(i.subtypes=!0,i.subtypeField=!0,i.defaultSubtypeCode=!0),Object.keys(i).forEach((r=>{!function(e,t,r,n){e&&e.hasOwnProperty(t)&&r&&r.hasOwnProperty(e.id)&&(r[e.id][t]=e[t],n&&"relationships"===t?e[t]=null:n&&delete e[t])}(e,r,t,i[r])})),t}(u,a,f,m),a=function(e,t,r){const n=cr(r,"properties.contingentValues");return n&&n[e]&&(t[e].contingentValues=n[e]),t}(u.id,a,s),m&&(a=function(e,t){if(Array.isArray(e.indexes)){const r=e.objectIdField,n=e.globalIdField;t[e.id].indexes=e.indexes.filter((e=>{if(e.isUnique&&e.fields!==r&&e.fields!==n||"FullText"===e.indexType)return e.name&&(e.name=e.name.replaceAll(" ","")),e})),delete e.indexes}return t}(u,a)),u.isView&&(h=u,["definitionQuery"].forEach((e=>{or(h,e)}))),f&&(Gn(u.adminLayerInfo,r),o[d]=u.adminLayerInfo,function(e,t){const r=e.dependencies,n=e.itemId,i=Object.keys(t);i.forEach((e=>{n===t[e].itemId&&r.forEach((r=>{i.forEach((n=>{if(r===n){const i={};i[r]=cr(t[n],"fieldInfos"),t[e].sourceServiceFields=t[e].sourceServiceFields?{...t[e].sourceServiceFields,...i}:i,Object.keys(t[n]).forEach((r=>{r.startsWith("layer")&&(t[e][r]=t[n][r])}))}}))}))}))}(s,r),u.adminLayerInfo=Kr(u.adminLayerInfo,r),a&&a.hasOwnProperty(u.id)&&Object.keys(r).some((e=>r[e].itemId===s.itemId&&(a[u.id].sourceServiceFields=r[e].sourceServiceFields,!0)))),m&&(u=function(e,t,r){if(e.uniqueIdField&&e.uniqueIdField.name&&(e.uniqueIdField.name=String(e.uniqueIdField.name).toLocaleLowerCase()),"Table"===e.type&&e.adminLayerInfo&&or(e.adminLayerInfo,"geometryField"),e.isView){const n=cr(e,"adminLayerInfo.viewLayerDefinition.table");let i=[];if(n){const o=Fn(n,t,r);i=i.concat(o);const a=Dn(n);i=i.concat(a),pr(e,"adminLayerInfo.viewLayerDefinition.table",jn(n,i)),Array.isArray(n.relatedTables)&&n.relatedTables.map((e=>{const n=Fn(e,t,r);i=i.concat(n);const o=Dn(e);return i=i.concat(o),jn(e,[...n,...o])}))}else Object.keys(r).some((t=>{if(r[t].itemId===e.serviceItemId){const n=r[t][`layer${e.id}`];return n&&n.fields&&(i=Array.isArray(n.fields)?n.fields.map((e=>e.name)):Object.keys(n.fields)),!0}}));e=function(e,t){return t.length>0&&(e.fields&&(e.fields=e.fields.filter((e=>t.indexOf(e.name)>-1))),e.indexes&&(e.indexes=e.indexes.filter((e=>t.indexOf(e.fields)>-1)))),e}(e,i)}return or(e,"isView"),e}(u,s,r)),Mn(u),c=function(e,t,r,n,i){return(cr(e,"properties.service.isMultiServicesView")||!1||n)&&(t.layers.length>0||t.tables.length>0)&&(r.push(Object.assign({},t)),t={layers:[],tables:[],authentication:i}),t}(s,c,p,l,n),"Feature Layer"===u.type?c.layers.push(u):c.tables.push(u),i+1===t.length&&(p.push(Object.assign({},c)),c={layers:[],tables:[],authentication:n})}));const f=t.length>d;p.reduce(((t,r)=>t.then((()=>ki(e,r,!1,f)))),Promise.resolve(null)).then((()=>i(null)),(e=>u(sr(e))))}}))}(e.item.url||"",u,t,n,e.key,s,a,e).then((()=>{(function(e,t,r,n,i){return new Promise(((o,a)=>{(function(e,t,r,n,i){return new Promise(((o,a)=>{if(e.item.url){const a=e.itemId,s=Object.keys(i);let u;s.some((e=>i[e].itemId===a&&(u=i[e],!0)));const c=e.properties.layers,l=e.properties.tables;c.concat(l).forEach((r=>{const n=r.isView||e.properties.service.isView;if(t&&t.hasOwnProperty(r.id)){const e=t[r.id];e.isView=r.isView,e.newFields=r.fields,e.sourceSchemaChangesAllowed=r.sourceSchemaChangesAllowed,r.editFieldsInfo&&(e.newEditFieldsInfo=JSON.parse(JSON.stringify(r.editFieldsInfo))),n&&u&&i.isPortal&&(e.sourceServiceFields=u.sourceServiceFields)}})),s.forEach((e=>{a===i[e].itemId&&(i[e]=Object.assign(i[e],Tn(t,i[e].url,a)))})),o(function(e,t,r,n){return Object.keys(e).forEach((t=>{e[t].hasOwnProperty("templates")&&(e[t].templates=JSON.parse(Kr(JSON.stringify(e[t].templates),n))),e[t].hasOwnProperty("adminLayerInfo")&&(r[t].viewLayerDefinition.table.relatedTables=e[t].adminLayerInfo,or(e[t],"adminLayerInfo")),e[t].hasOwnProperty("types")&&(e[t].types=JSON.parse(Kr(JSON.stringify(e[t].types),n)))})),{popupInfos:Kr(t,n),fieldInfos:Kr(e,n),adminLayerInfos:Kr(r,n)}}(t,r,n,i))}else a(sr("Feature layer "+e.itemId+" does not have a URL"))}))})(e,t,r,n,i).then((t=>{!function(e,t){["layers","tables"].forEach((r=>{const n=cr(e,"data."+r);n&&Array.isArray(n)&&n.forEach((e=>{e.popupInfo=cr(t,r+"."+e.id)||{}}))}))}(e,t.popupInfos),o({itemTemplate:e,layerInfos:t})}),(e=>a(sr(e))))}))})(e,a,r,s,t).then((e=>{(function(e,t){const r=e.itemTemplate.item.url.replace("rest/services","rest/admin/services"),n=[],i=qi(r,null,null,e,"refresh");n.push(i),Object.keys(e.objects).forEach((i=>{const o=Object.assign({},e.objects[i]);t&&ar(o,["type","id","relationships","sourceServiceFields"]),o.hasOwnProperty("deleteFields")&&(n.push(qi(r,i,o,e,"delete")),or(o,"deleteFields"),n.push(qi(r,null,null,e,"refresh")))}));const o=function(e){const t=[];return Object.keys(e.objects).forEach((r=>{const n=e.objects[r];n.subtypeField&&t.push({id:n.id,subtypeField:n.subtypeField,subtypes:n.subtypes,defaultSubtypeCode:n.defaultSubtypeCode}),or(n,"subtypeField"),or(n,"subtypes"),or(n,"defaultSubtypeCode")})),t}({message:"add subtype updates",objects:e.objects,itemTemplate:e.itemTemplate,authentication:e.authentication});if(o.length>0&&t&&o.forEach((t=>{n.push(qi(r+t.id,null,{subtypeField:t.subtypeField},e,"update")),n.push(qi(r+t.id,null,{defaultSubtypeCode:t.defaultSubtypeCode},e,"update")),n.push(qi(r+t.id,null,{subtypes:t.subtypes},e,"add"))})),!e.itemTemplate.properties.service.isView){const t=function(e){const t={layers:[]};return Object.keys(e.objects).forEach((r=>{const n=e.objects[r];n.relationships&&n.relationships.length>0&&t.layers.push({id:n.id,relationships:n.relationships}),or(n,"relationships")})),t}({message:"updated layer relationships",objects:e.objects,itemTemplate:e.itemTemplate,authentication:e.authentication});t.layers=function(e,t,r){const n=[].concat(e.map((e=>e.id)),t.map((e=>e.id))),i=[];return n.forEach((e=>{r.layers.some((t=>e===t.id&&(i.push(t),!0)))})),i}(e.itemTemplate.properties.layers,e.itemTemplate.properties.tables,t),t.layers.length>0&&(n.push(qi(r,null,t,e,"add")),n.push(i));const o=function(e){const t=[];return Object.keys(e.objects).forEach((r=>{const n=e.objects[r];n.contingentValues&&t.push({id:n.id,contingentValues:n.contingentValues}),or(n,"contingentValues")})),t}({message:"add layer contingent values",objects:e.objects,itemTemplate:e.itemTemplate,authentication:e.authentication});o.length>0&&o.forEach((t=>{n.push(qi(r+t.id,null,t.contingentValues,e,"add"))}))}return t&&Object.keys(e.objects).forEach((t=>{const i=Object.assign({},e.objects[t]);let o;Array.isArray(i.indexes)&&i.indexes.length>0&&(n.some((e=>{if(e.url.indexOf(`${t}/addToDefinition`)>-1)return o=e,!0}))?o.params.addToDefinition={...o.params.addToDefinition,indexes:i.indexes}:n.push(qi(Xt(r)+t,null,{indexes:i.indexes},e,"add")))})),1===n.length?[]:n})({message:"updated layer definition",objects:e.layerInfos.fieldInfos,itemTemplate:e.itemTemplate,authentication:n},t.isPortal).reduce(((e,r)=>e.then((()=>Ri(r,!1,!1,t.isPortal)))),Promise.resolve(null)).then((()=>i(null)),(e=>o(sr(e))))}))}),(e=>o(sr(e)))):i(null)}}))}function Mn(e){e.multiScaleGeometryInfo&&or(e,"multiScaleGeometryInfo")}function Fn(e,t,r){let n=[];const i=e.sourceLayerId;if("number"==typeof i)return t.dependencies.forEach((t=>{const o=r[t][`layer${i}`];o&&o.fields&&r[t].name===e.sourceServiceName&&(n=Array.isArray(o.fields)?n.concat(o.fields.map((e=>e.name))):n.concat(Object.keys(o.fields)))})),n}function Dn(e){const t=e.sourceLayerFields.reduce(((e,t)=>(t.statisticType&&e.push(t.name),e)),[]);return[...new Set(t)]}function jn(e,t){return Array.isArray(e.sourceLayerFields)&&e.sourceLayerFields.length>0&&t.length>0&&pr(e,"sourceLayerFields",e.sourceLayerFields.filter((e=>t.indexOf(e.source.toLowerCase())>-1))),e}function Gn(e,t){const r=cr(e,"viewLayerDefinition.table.name"),n=cr(e,"geometryField.name");n&&r?pr(e,"geometryField.name",t.isPortal?`${r}.shape`:`${r}.Shape`):!n&&cr(e,"geometryField")&&or(e,"geometryField")}function zn(e,t,r=!0){const n=e.properties.layers,i=e.properties.tables,o=n.concat(i),a={};o.forEach((e=>{a[e.id]=e.fields})),Object.keys(t).some((n=>(r?t[n].itemId===e.itemId:n===e.itemId)&&(t[n].fieldInfos=a,!0)))}function Ln(e,t,r){r&&dr(e,`${t}.defaultSpatialReference`,r)}function Nn(e,t,r,n){const i=[...e.layers||[],...e.tables||[]];let o,a;return t.dependencies.some((e=>{const t=r[e],s=!n||i.some((e=>{const r=cr(e,"adminLayerInfo.viewLayerDefinition.table.sourceServiceName");return r&&t.name&&r===t.name&&e.geometryType})),u=cr(t,"defaultSpatialReference");!o&&u&&s&&(o=u);const c=cr(t,"defaultExtent");return!a&&c&&s&&(a=c),o&&a})),{spatialReference:o,extent:a}}function Un(e,t,r){return t.startsWith("{{")?t:String(Jr(e,e,"."+String(t).toLowerCase()+(r?"."+r:"")))}function $n(e,t,r,n){e&&e.hasOwnProperty(t)&&e[t]&&(e[t]=Un(r,e[t],n))}function Bn(e,t){const r=e.templates;r&&(e.templates=r.map((e=>{const r=cr(e,"prototype.attributes");return r&&(Object.keys(r).forEach((e=>{-1===t.indexOf(e)&&delete r[e]})),pr(e,"prototype.attributes",r)),e})))}function Wn(e,t){or(e,"sourceId"),e.hasOwnProperty("sourceServiceName")&&(e.sourceServiceName=function(e,t){const r=t.filter((t=>t.name===e));return 1===r.length?Un(r[0].id,"name"):void 0}(e.sourceServiceName,t))}function Vn(e,t){const r=cr(e,"adminLayerInfo.viewLayerDefinition.table");if(r){let n=qn(r.sourceServiceName,t);const i=n+".layer"+r.sourceLayerId+".fields";Hn(r.sourceLayerFields||[],i);const o=cr(e,"adminLayerInfo.viewLayerDefinition.table.relatedTables")||[];o.length>0&&o.forEach((e=>{n=qn(e.sourceServiceName,t);const r=n+".layer"+e.sourceLayerId+".fields";!function(e,t){if(e){const r=e.orderByFields||"";if(""!==r){const n=r.split(" ")[0];e.orderByFields=e.orderByFields.replace(n,Un(t,n,"name"))}const n=e.groupByFields||"";if(""!==n){const r=n.split(",");if(r.length>0){const n=r.map((e=>Un(t,e,"name")));e.groupByFields=n.join(",")}}}}(e.topFilter||{},r),Hn(e.sourceLayerFields||[],r);const o=e.parentKeyFields||[];e.parentKeyFields=o.map((e=>Un(i,e,"name")));const a=e.keyFields||[];e.keyFields=a.map((e=>Un(r,e,"name")))}))}}function qn(e,t){const r=t.filter((t=>t.name===e));return 1===r.length?r[0].id:""}function Hn(e,t){e.forEach((e=>$n(e,"source",t,"name")))}function Kn(e,t,r,n,i){if(i&&e.popupInfo){const o=e.popupInfo;Jn(o,"title",i,r),Jn(o,"description",i,r),Zn(o.fieldInfos||[],t,n,r),function(e,t,r){e.map((e=>(t.forEach((t=>{e.expression=ii(e.expression,t,r)})),e)))}(o.expressionInfos||[],i,r),function(e,t,r,n,i){e.forEach((e=>{e.hasOwnProperty("fieldInfos")&&Zn(e.fieldInfos,r,n,t),e.hasOwnProperty("mediaInfos")&&Xn(e.mediaInfos,i,t,r,n)}))}(o.popupElements||[],r,t,n,i),Xn(o.mediaInfos||[],i,r,t,n)}}function Jn(e,t,r,n){e.hasOwnProperty(t)&&r.forEach((r=>{const i=new RegExp("(\\b"+r+"\\b(?![}]{2}))","gm");i.test(e[t])&&(e[t]=e[t].replace(i,Un(n,r,"name")))}))}function Zn(e,t,r,n){e.forEach((e=>{e.fieldName=Yn(e.fieldName,t,r,n)}))}function Yn(e,t,r,n){if(e.indexOf("relationships/")>-1){const n=e.split("/"),i=n[1],o=cr(t,"adminLayerInfo.viewLayerDefinition.table.relatedTables"),a=t.relationships||o;if(a&&a.length>parseInt(i,10)){const t=a[i],o=r+".layer"+t[cr(t,"relatedTableId")?"relatedTableId":"sourceLayerId"]+".fields";n[2]=Un(o,n[2],"name"),e=n.join("/")}}else-1===e.indexOf("expression/")&&(e=Un(n,e,"name"));return e}function Xn(e,t,r,n,i){["title","caption"].forEach((n=>Jn(e,n,t,r))),e.forEach((e=>{if(e.hasOwnProperty("value")){const t=e.value,o=t.fields||[];t.fields=o.map((e=>Yn(e,n,i,r))),t.hasOwnProperty("normalizeField")&&$n(t,"normalizeField",r,"name"),t.hasOwnProperty("tooltipField")&&(t.tooltipField=Yn(t.tooltipField,n,i,r))}}))}function Qn(e,t,r){if(e){const n=e.definitionEditor||{};if(n){const e=n.inputs;e&&e.forEach((e=>{e.parameters&&e.parameters.forEach((e=>{$n(e,"fieldName",t,"name")}))})),n.hasOwnProperty("parameterizedExpression")&&(n.parameterizedExpression=ti(n.parameterizedExpression||"",t,r,"name"))}}}function ei(e,t,r){e&&e.hasOwnProperty("definitionExpression")&&(e.definitionExpression=ti(e.definitionExpression||"",t,r,"name"))}function ti(e,t,r,n){return r.forEach((r=>{const i=new RegExp("\\b"+r+"\\b(?![}]{2})","gm");e&&i.test(e)&&(e=e.replace(i,Un(t,r,n)))})),e}function ri(e,t,r){if(e){const n=e.drawingInfo;n&&(ni(n.renderer||{},t,r),function(e,t,r){e.forEach((e=>{e.hasOwnProperty("fieldInfos")&&(e.fieldInfos||[]).forEach((e=>$n(e,"fieldName",t,"name")));const n=e.labelExpression||"",i=e.labelExpressionInfo||{};r.forEach((r=>{const o=Un(t,r,"name"),a=new RegExp('(\\[\\"*)+('+r+')(\\"*\\])+',"gm");let s=a.exec(n);if(s&&(e.labelExpression=n.replace(a,s[1]+o+s[3])),i.value){let t=i.value;const n=new RegExp("(\\{"+r+"\\})","gm");t=n.test(t)?t.replace(n,"{"+o+"}"):t,s=a.exec(t),t=s?t.replace(a,s[1]+o+s[3]):t,e.labelExpressionInfo.value=t}i.expression&&(e.labelExpressionInfo.expression=ii(i.expression,r,t))}))}))}(n.labelingInfo||[],t,r))}}function ni(e,t,r){switch(e.type){case"classBreaks":case"uniqueValue":case"predominance":case"simple":case"heatmap":!function(e,t,r){if(e){const n=e.authoringInfo;n&&function(e,t,r){if(e){const n=["field","normalizationField"],i=e.field1;n.forEach((e=>$n(i,e,t,"name")));const o=e.field2;n.forEach((e=>$n(o,e,t,"name")));const a=e.fields;a&&(e.fields=a.map((e=>Un(t,e,"name"))));const s=["endTime","field","startTime"],u=e.visualVariables;u&&s.forEach((e=>{r.indexOf(u[e])>-1&&$n(u,e,t,"name")}))}}(n,t,r);const i=["field","normalizationField"];i.forEach((r=>$n(e,r,t,"name"))),["field1","field2","field3"].forEach((r=>$n(e,r,t,"name")));const o=e.rotationExpression;o&&r.forEach((r=>{const n=new RegExp("(\\["+r+"\\])","gm");n.test(o)&&(e.rotationExpression=o.replace(n,"["+Un(t,r,"name")+"]"))})),e.valueExpression&&r.forEach((r=>{e.valueExpression=ii(e.valueExpression,r,t)}));const a=e.visualVariables;a&&a.forEach((e=>{i.forEach((r=>$n(e,r,t,"name"))),e.valueExpression&&r.forEach((r=>{e.valueExpression=ii(e.valueExpression,r,t)}))}))}}(e,t,r);break;case"temporal":!function(e,t,r){[e.latestObservationRenderer,e.observationRenderer,e.trackRenderer].forEach((e=>{ni(e,t,r)}))}(e,t,r)}}function ii(e,t,r){const n=Un(r,t,"name");if(e){let r="(?:\\$feature\\.)("+t+")\\b",i=new RegExp(r,"gm");e=i.test(e)?e.replace(i,"$feature."+n):e,r="(?:[$]feature)(\\[\\\"?\\'?)"+t+"(\\\"?\\'?\\])",i=new RegExp(r,"gm");let o=i.exec(e);o&&(e=e.replace(i,"$feature"+o[1]+n+o[2])),r="(?:[$]feature)(\\[\\\"?\\'?)(\\w+)[.]"+t+"(\\\"?\\'?\\])",i=new RegExp(r,"gm"),o=i.exec(e),o&&o.length>3&&(e=e.replace(i,"$feature"+o[1]+o[2]+"."+n+o[3])),r="(\\\"|\\')+"+t+"(\\\"|\\')+",i=new RegExp(r,"gm"),o=i.exec(e),o&&(e=e.replace(i,o[1]+n+o[2]))}return e}function oi(e,t,r){let n;if(e){n={};const i=Object.keys(e);i&&i.length>0&&i.forEach((i=>{n[Un(t,i,r)]=e[i]}))}return n}function ai(e,t){const r=e[t],n={},i=r.newFields,o=i?i.map((e=>e.name)):[];if((r.sourceFields||[]).forEach((e=>{const t=String(e.name).toLowerCase();i.forEach((r=>{-1===o.indexOf(e.name)&&-1===o.indexOf(t)&&r.alias&&r.alias===e.alias&&(n[t]={name:r.name,alias:r.alias,type:r.type?r.type:""}),String(r.name).toLowerCase()===t&&(n[t]={name:r.name,alias:r.alias?r.alias:"",type:r.type?r.type:""})}))})),r.editFieldsInfo&&r.newEditFieldsInfo){const e=JSON.parse(JSON.stringify(r.editFieldsInfo)),t=JSON.parse(JSON.stringify(r.newEditFieldsInfo)),i=Object.keys(n);Object.keys(e).forEach((a=>{const s=String(e[a]).toLowerCase();if((-1===i.indexOf(s)||n[s].name!==t[a])&&o.indexOf(s)>-1){let i;r.sourceSchemaChangesAllowed&&!r.isView&&(r.hasOwnProperty("deleteFields")||(r.deleteFields=[]),r.deleteFields.push(s)),r.sourceFields.some((t=>(t.name===e[a]&&(i=t),t.name===e[a]))),n[s]={name:t[a],alias:i&&i.alias?i.alias:"",type:i&&i.type?i.type:""}}})),or(r,"sourceSchemaChangesAllowed"),or(r,"editFieldsInfo"),or(r,"newEditFieldsInfo"),or(r,"isView")}return n}function si(e){var t=function(e){var t=e.authentication.username,r=e.owner||t;return(0,R.e)(e)+"/content/users/"+encodeURIComponent(r)+"/items/"+e.id+"/share"}(e);return function(e){var t=e.authentication.username;return(e.owner||t)===t}(e)?ui(t,e):function(e){return e.authentication.getUser(e).then((function(e){return e&&"org_admin"===e.role&&!e.roleId}))}(e).then((function(r){if(r)return ui(t,e);throw Error("This item can not be shared by "+e.authentication.username+". They are neither the item owner nor an organization admin.")}))}function ui(e,t){return t.params=(0,O.Cl)({org:!1,everyone:!1},t.params),"private"===t.access&&(t.params.groups=" "),"org"===t.access&&(t.params.org=!0),"public"===t.access&&(t.params.account=!0,t.params.everyone=!0),(0,C.Em)(e,t)}function ci(e){var t=(0,R.e)(e)+"/community/createGroup";return e.params=(0,O.Cl)((0,O.Cl)({},e.params),e.group),(0,C.Em)(t,e)}function li(e){return H(e,"group")}function di(e){var t=T(e,["where","objectIds","relationParam","time","distance","units","outFields","geometry","geometryType","spatialRel","returnGeometry","maxAllowableOffset","geometryPrecision","inSR","outSR","gdbVersion","returnDistinctValues","returnIdsOnly","returnCountOnly","returnExtentOnly","orderByFields","groupByFieldsForStatistics","outStatistics","returnZ","returnM","multipatchOption","resultOffset","resultRecordCount","quantizationParameters","returnCentroid","resultType","historicMoment","returnTrueCurves","sqlFormat","returnExceededLimitFeatures","f"],{httpMethod:"GET",params:(0,O.Cl)({where:"1=1",outFields:"*"},e.params)});return(0,C.Em)((0,le.T)(e.url)+"/query",t)}function pi(e){const t=[],r=["description",e.globalIdFieldName];return e.features.forEach((e=>{const n={};r.forEach((t=>{n[t]=e.attributes[t]})),t.push(n)})),t}function fi(e,t){const r=cr(e,"urlTemplate")?"urlTemplate":"urltemplate";let n=cr(e,r);n&&(ur(n).forEach((e=>{n=n.replace(e,Jr(e,e,".itemId"))})),bi(n).forEach((r=>{const i=hi(mi(r),".url"),o=t[r];Array.isArray(e.dependencies)&&e.dependencies.indexOf(o)<0&&e.dependencies.push(o),n=n.replace(r,Jr(o,o,i))})),pr(e,r,n))}function mi(e){return e.indexOf("FeatureServer/")>-1?e.substr(e.lastIndexOf("/")+1):void 0}function hi(e,t){return isNaN(Number.parseInt(e,10))?`${t}`:`.layer${e}${t}`}function gi(e){return(e.item.typeKeywords||[]).indexOf("Workforce Project")>-1}function yi(e){return 1===e?["groupId","workerWebMapId","dispatcherWebMapId","dispatchers","assignments","workers","tracks"]:["workforceDispatcherMapId","workforceProjectGroupId","workforceWorkerMapId"]}function vi(e,t){const r=bi(e),n=[];return r.forEach((e=>{const r={f:"json",authentication:t};n.push(ke(e,r))})),{requests:n,urls:r}}function bi(e){return vr(e,/=(http.*?FeatureServer.*?(?=&|$))/gi).map((e=>e.replace("=","")))}function wi(e,t,r,n){return new Promise(((i,o)=>{t.getUser().then((a=>{r=Ii(r);const s=cr(e,"data.dispatchers");(function(e,t,r,n,i){return new Promise(((o,a)=>{if(e){const s=i?"userid":"userId";di({url:e,where:`${s} = '${t}'`,authentication:n}).then((i=>{if(i&&i.features)if(0===i.features.length){const i=[{attributes:{name:r}}];i[0].attributes[s]=t,_i(e,i,n).then(o,a)}else o(!0);else o(!1)}),(e=>a(sr(e))))}else o(!1)}))})(s&&s.url?s.url:`${r}2`,a.username||"",a.fullName||"",t,n.isPortal).then((a=>{let s=cr(e,"properties.workforceInfos");s&&r?(s=Kr(s,n),function(e,t,r){return new Promise(((n,i)=>{const o={f:"json",fields:"*",authentication:r};e=Ii(e);const a=[];t.forEach((t=>{a.push(ke(`${e}${t}`,o))})),Promise.all(a).then((t=>{const r={};t.forEach((t=>{r[`${e}${t.id}`]=t.fields.map((e=>e.name))})),n(r)}),(e=>i(sr(e))))}))}(r,[2,3,4],t).then((e=>{const n=`${r}3`,a=_i(n,xi(s.assignmentTypeInfos,e[n]),t,!0),u=`${r}4`,c=_i(u,xi(s.assignmentIntegrationInfos,e[u]),t,!0);Promise.all([a,c]).then(i,o)}),(e=>o(sr(e))))):i({success:a})}),(e=>o(sr(e))))}),(e=>o(sr(e))))}))}function Ii(e){return e+(e.endsWith("/")?"":"/")}function xi(e,t){const r=[];return e.forEach((e=>{const n={};Object.keys(e).forEach((r=>{const i=function(e,t){return t.filter((t=>t.toLowerCase()===e.toLowerCase()))[0]}(r,t);n[i]=e[r]})),r.push({attributes:n})})),r}function _i(e,t,r,n=!1){return new Promise(((i,o)=>{t.length>0?function(e){var t=(0,le.T)(e.url)+"/applyEdits",r=T(e,["adds","updates","deletes","useGlobalIds","attachments","gdbVersion","returnEditMoment","rollbackOnFailure","trueCurveClient"],{params:(0,O.Cl)({},e.params)});return(0,C.Em)(t,r)}({url:e,adds:t,useGlobalIds:n,authentication:r}).then((e=>{e&&e.addResults?i(!0):o(sr({success:!1,message:"Failed to add dispatch record."}))}),(e=>o(sr({success:!1,message:"Failed to add dispatch record.",error:e})))):i(!0)}))}function ki(e,t,r=!1,n=!1){return n&&(t.params={...t.params,async:!0}),new Promise(((n,i)=>{(function(e,t){return function(e,t){var r=(0,le.T)(e).replace("/rest/services","/rest/admin/services")+"/addToDefinition";return t.params=(0,O.Cl)({addToDefinition:{}},t.params),t.layers&&t.layers.length>0&&(t.params.addToDefinition.layers=t.layers),t.tables&&t.tables.length>0&&(t.params.addToDefinition.tables=t.tables),(0,C.Em)(r,t)}(e,t)})(e,t).then((e=>{Si(e,t.authentication).then((()=>n(null)),(e=>i(sr(e))))}),(o=>{r?i(sr(o)):ki(e,t,!0,!0).then((()=>n(null)),(e=>i(e)))}))}))}function Si(e,t){return new Promise(((r,n)=>{const i=e.statusURL||e.statusUrl;if(i){const e=setInterval((()=>{ke(i,{authentication:t}).then((t=>{["completed","success"].indexOf(t.status.toLowerCase())>-1?(clearInterval(e),r()):"failed"===t.status.toLowerCase()&&(clearInterval(e),n(t))}),(t=>{clearInterval(e),n(t)}))}),2e3)}else r()}))}function Ei(e){return("number"!=typeof e.xmin||"number"!=typeof e.xmax||"number"!=typeof e.ymax||"number"!=typeof e.ymin)&&(e.xmin=-179,e.xmax=179,e.ymax=89,e.ymin=-89,e.spatialReference={wkid:4326}),e}function Ai(e,t,r,n,i){return new Promise(((o,a)=>{const s={xmin:-179,xmax:179,ymin:-89,ymax:89,spatialReference:{wkid:4326}};Pi(Ei(e),r,n,i).then((e=>{JSON.stringify(e)===JSON.stringify(Ei(e))?o(e):Pi(t||s,r,n,i).then(o,(e=>a(sr(e))))}),(()=>{Pi(s,r,n,i).then(o,(e=>a(sr(e))))}))}))}function Pi(e,t,r,n){const i={authentication:n};return new Promise(((n,o)=>{e.spatialReference.wkid!==t?.wkid&&t?(i.params={f:"json",inSR:e.spatialReference.wkid,outSR:t.wkid,extentOfInterest:JSON.stringify(e)},ke(Xt(r)+"findTransformations",i).then((a=>{const s=a&&a.transformations?a.transformations:void 0;let u;s&&s.length>0&&(u=s[0].wkid?s[0].wkid:s[0].geoTransforms?s[0]:void 0),i.params={f:"json",outSR:t.wkid,inSR:e.spatialReference.wkid,geometries:{geometryType:"esriGeometryPoint",geometries:[{x:e.xmin,y:e.ymin},{x:e.xmax,y:e.ymax}]},transformation:u},ke(Xt(r)+"project",i).then((e=>{const r=2===e.geometries.length?e.geometries:void 0;n(r?{xmin:r[0].x,ymin:r[0].y,xmax:r[1].x,ymax:r[1].y,spatialReference:t}:void 0)}),(e=>o(sr(e))))}),(e=>o(sr(e))))):n(e)}))}function Oi(e,t,r,n,i="private"){return new Promise(((o,a)=>{const s={item:{title:"_",...e,data:t},folderId:n,authentication:r};e.thumbnail&&(s.params={thumbnail:e.thumbnail},delete s.item.thumbnail),ve(s).then((e=>{e.success?"private"!==i?si({id:e.id,access:"public"===i?"public":"org",authentication:r}).then((()=>{o({folder:e.folder,id:e.id,success:!0})}),(e=>a(sr(e)))):o({folder:e.folder,id:e.id,success:!0}):a(sr())}),(e=>a(sr(e))))}))}function Ti(e,t,r){return new Promise(((n,i)=>{const o=mr(e,t,"user.folders");var a;(a={title:o,authentication:r},F(a).then((function(e){var t=(0,R.e)(a)+"/content/users/"+e+"/createFolder";return a.params=(0,O.Cl)({title:a.title},a.params),(0,C.Em)(t,a)}))).then((e=>n(e)),(a=>{const s=cr(a,"response.error.details");if(Array.isArray(s)&&s.length>0){const u="Folder title '"+o+"' not available.";s.indexOf(u)>=0?(cr(t,"user.folders")||dr(t,"user.folders",[]),t.user.folders.push({title:o}),Ti(e,t,r).then(n,i)):i(a)}else i(a)}))}))}function Ci(e,t,r,n,i){return new Promise(((o,a)=>{let s;s=i&&i!==n.username?Li(`(owner:${i}) orgid:${r.organization.id}`,n):Promise.resolve([]),s.then((i=>{r.allGroups=i.concat(cr(r,"user.groups")),t.title=mr(e,r,"allGroups"),ci({group:t,authentication:n}).then(o,(i=>{const s=cr(i,"response.error.details");if(Array.isArray(s)&&s.length>0){const u="You already have a group named '"+t.title+"'. Try a different name.";s.indexOf(u)>=0?(r.user.groups.push({title:t.title}),Ci(e,t,r,n).then(o,a)):a(i)}else a(i)}))}),(e=>a(e)))}))}function Ri(e,t=!1,r=!1,n=!1){return new Promise(((i,o)=>{const a={params:e.params,authentication:e.args.authentication};(r&&e.url.indexOf("addToDefinition")>-1||e.url.indexOf("updateDefinition")>-1||e.url.indexOf("deleteFromDefinition")>-1)&&(a.params={...a.params,async:!0}),ke(e.url,a).then((e=>{Si(e,a.authentication).then((()=>i(null)),(e=>o(sr(e))))}),(r=>{t?o(r):Ri(e,!0,!0,n).then((()=>i()),(e=>o(e)))}))}))}function Mi(e,t,r=!1){return new Promise(((n,i)=>{const o={service:{},layers:[],tables:[]};ke((e=e.replace("/rest/services","/rest/admin/services"))+"?f=json",{authentication:t}).then((a=>{o.service=function(e){const t=e.layers||[],r=e.tables||[];return dr(e,"layers",t.filter((e=>"Feature Layer"===e.type))),dr(e,"tables",r.concat(t.filter((e=>"Table"===e.type)))),e}(a),a.adminServiceInfo?.cacheMaxAge&&(o.service.cacheMaxAge=a.adminServiceInfo.cacheMaxAge),a.layers&&(o.layers=a.layers,o.layers.forEach((e=>{e.serviceItemId=o.service.serviceItemId,e.extent=null,Mn(e)}))),delete a.layers,a.tables&&(o.tables=a.tables,o.tables.forEach((e=>{e.serviceItemId=o.service.serviceItemId,e.extent=null}))),delete a.tables,Ki(o),function(e,t,r){return new Promise(((n,i)=>{if(cr(e,"service.isView"))n();else{const o=(e.layers||[]).concat(e.tables||[]),a=[],s=o.reduce(((e,n)=>(n.hasContingentValuesDefinition&&(e.push(ke(`${t}/${n.id}/contingentValues?f=json`,{authentication:r})),a.push(n.id)),e)),[]);s.length>0?Promise.all(s).then((t=>{const r={};t.forEach(((e,t)=>{or(e,"typeCodes"),cr(e,"stringDicts")&&cr(e,"contingentValuesDefinition")&&(e.contingentValuesDefinition.stringDicts=e.stringDicts,or(e,"stringDicts")),ar(cr(e,"contingentValuesDefinition"),["layerID","layerName","geometryType","hasSubType"]),r[a[t]]=e})),e.contingentValues=r,n()}),i):n()}}))}(o,e,t).then((()=>{r?function(e,t,r){return new Promise(((n,i)=>{const o=[di({url:`${t=Ii(t=t.replace("/rest/admin/services","/rest/services"))}3`,where:"1=1",authentication:r}),di({url:`${t}4`,where:"1=1",authentication:r})];Promise.all(o).then((t=>{const[o,a]=t;e.workforceInfos={assignmentTypeInfos:pi(o)},function(e,t){return new Promise(((r,n)=>{let i=[],o=[];const a=[],s=["appid",e.globalIdFieldName,"prompt","urltemplate","assignmenttype"];e.features.forEach((e=>{const r={};s.forEach((n=>{if(r[n]=e.attributes[n],"urltemplate"===n){const a=e.attributes[n],s=ur(a);r.dependencies=s;const u=vi(a,t);Array.isArray(u.requests)&&u.requests.length>0&&(i=i.concat(u.requests),o=o.concat(u.urls))}})),a.push(r)})),function(e,t){return new Promise(((r,n)=>{const i=[];e.length>0?Promise.all(e).then((e=>{const n={};Array.isArray(e)&&e.forEach(((e,r)=>{e.serviceItemId&&(n[t[r]]=e.serviceItemId,-1===i.indexOf(e.serviceItemId)&&i.push(e.serviceItemId))})),r({dependencies:i,urlHash:n})}),(e=>n(sr(e)))):r({dependencies:i,urlHash:{}})}))}(i,o).then((e=>{a.forEach((t=>{fi(t,e.urlHash)})),r(a)}),(e=>n(sr(e))))}))}(a,r).then((t=>{e.workforceInfos.assignmentIntegrationInfos=t,function(e){const t=e=>(e.GlobalID&&(e.GlobalID=`{${e.GlobalID}}`),e.assignmenttype&&(e.assignmenttype=`{${e.assignmenttype}}`),e),r=cr(e,"assignmentIntegrationInfos");r&&Array.isArray(r)&&pr(e,"assignmentIntegrationInfos",r.map(t));const n=cr(e,"assignmentTypeInfos");n&&Array.isArray(n)&&pr(e,"assignmentTypeInfos",n.map(t))}(e.workforceInfos),n(e)}),(e=>i(sr(e))))}),(e=>i(sr(e))))}))}(o,e,t).then(n,i):n(o)}),(e=>i(sr(e))))}),(e=>i(sr(e))))}))}async function Fi(e,t,r){return ke(`${t}/admin/${e}/export`,{authentication:r,headers:{Accept:"application/octet-stream",Authorization:`Bearer ${r.token}`,"X-Esri-Authorization":`Bearer ${r.token}`},params:{f:"zip"}})}function Di(e,t){return new Promise(((r,n)=>{Ee({id:e,authentication:t}).then((e=>e.success?r(e):n(e)),n)}))}function ji(e,t,r=!0){return new Promise(((n,i)=>{B({id:e,authentication:t,params:{permanentDelete:r}}).then((e=>e.success?n(e):i(e)),i)}))}function Gi(e){return Ae(e)}function zi(e,t,r){return li({q:e,params:{...r},authentication:t})}function Li(e,t,r,n){const i=n||{start:1,num:24},o={sortField:"title",sortOrder:"asc",...i};let a=r||[];return new Promise(((r,n)=>{zi(e,t,o).then((n=>{a=a.concat(n.results),n.nextStart>0?(i.start=n.nextStart,r(Li(e,t,a,i))):r(a)}),(e=>n(e)))}))}function Ni(e,t,r,n,i,o){const a=o||{query:t,start:1,num:100,nextStart:-1,total:0,results:[]};return"relevance"===(n=n||{}).sortField&&delete n.sortField,new Promise(((o,s)=>{Ui(e,t,r,n,i).then((s=>{a.results=a.results.concat(s.results),a.num=a.total=a.results.length,s.nextStart>0?(n.start=s.nextStart,o(Ni(e,t,r,n,i,a))):o(a)}),(e=>s(e)))}))}function Ui(e,t,r,n,i){const o={groupId:e,q:t,params:Object.assign({num:100},n),authentication:r,portal:i};return Array.isArray(o.params.categories)&&(o.params.categories=o.params.categories.map((e=>e.split(",")))),function(e){return H(e,"groupContent")}(o)}function $i(e,t,r,n){return new Promise(((i,o)=>{Pe({item:e,folderId:r,authentication:t,params:{...n??{}}}).then((e=>e.success?i(e):o(e)),(e=>o(e)))}))}function Bi(e,t,r,n,i,o){return new Promise(((a,s)=>{const u={item:e,params:{text:t||{}},authentication:r};n&&(u.params.thumbnail=n),_n(void 0,e)&&o&&(u.owner=o.locationTracking.owner),Pe(u).then((t=>{i&&"private"!==i?si({id:e.id,access:"public"===i?"public":"org",authentication:r}).then((()=>a(t)),(e=>s(sr(e)))):a(t)}),(e=>s(sr(e))))}))}function Wi(e,t,r){return new Promise(((n,i)=>{Promise.all([un(e,r),ln(e,r)]).then((([n,i])=>{if(qr(n)||qr(i)){const{item:o,data:a}=Kr({item:n,data:i},t);return function(e,t,r,n){const i=e=>JSON.stringify(e).match(/{{.+?}}/gim);r&&qr(r)&&console.log(e+" ("+t+") contains variables in base: "+JSON.stringify(i(r))),n&&qr(n)&&console.log(e+" ("+t+") contains variables in data: "+JSON.stringify(i(n)))}(e,n.type,o,a),Bi(o,a,r)}return Promise.resolve({success:!0,id:e})})).then((e=>n(e))).catch((e=>i(e)))}))}function Vi(e,t,r){return Ji(e,t,r,3)}function qi(e,t,r,n,i){const o={delete:{url:Xt(e)+t+"/deleteFromDefinition",params:{deleteFromDefinition:{fields:r&&r.hasOwnProperty("deleteFields")?r.deleteFields:[]}}},update:{url:Xt(e)+(t?`${t}/updateDefinition`:"updateDefinition"),params:{updateDefinition:r}},add:{url:Xt(e)+"addToDefinition",params:{addToDefinition:r}},refresh:{url:Xt(e)+"refresh",params:{f:"json"}}};return{url:o[i].url,params:o[i].params,args:n}}function Hi(e){if(!e)return e;const[t,r,n]=e.match(/(https?:\/\/)(.+)/),[i,...o]=n.split("/");return`${r}${i.toLowerCase()}/${o.join("/")}`}function Ki(e){(e.layers||[]).concat(e.tables||[]).forEach((e=>{const t=e.relationships,r=e.indexes;if(t&&t.length>0&&r&&r.length>0){const e=t.reduce(((e,t)=>("esriRelRoleOrigin"===t.role&&t.keyField&&e.indexOf(t.keyField)<0&&e.push(t.keyField),e)),[]);r.map((t=>(e.some((e=>new RegExp(`\\b${e}\\b`).test(t.fields)))&&(t.isUnique=!0),t)))}}))}function Ji(e,t,r,n=1){return new Promise(((i,o)=>{Pe({item:{id:e,url:t},authentication:r}).then((a=>{a.success?setTimeout((()=>{(0,N.Gq)(e,{authentication:r}).then((a=>{const s=a.url.indexOf("{");if(s>-1&&console.warn(e+" has template variable: "+a.url.substr(s)),t===a.url)i(e);else{const s="URL not updated for "+a.type+" "+a.id+": "+a.url+" ("+n+")";--n>0?Ji(e,t,r,n).then(i,o):(console.error(e+": "+s+"; FAILED"),o(s))}}),(e=>o(sr(e))))}),1e3):o(sr(a))}),(e=>o(sr(e))))}))}function Zi(e,t,r){return{...e,fetchedFromSource:t,copiedToDestination:r}}function Yi(e){return new File([e.blob],e.filename,{type:e.mimeType})}async function Xi(e){return(new(Be())).loadAsync(e)}async function Qi(e,t=[],r=["png","jpeg","jpg","gif","svg","xls","xlsx"]){const n=[],i=[];return e.forEach(((e,o)=>{(async()=>{if(0===t.length||t.includes(e)){const t=r.includes(e.split(".").pop())?"blob":"string",a=o.async(t);i.push(a),n.push({file:e,content:await a})}})()})),await Promise.all(i),n.sort(((e,t)=>e.file.localeCompare(t.file)))}async function eo(e,t){const r=t.endsWith(".zip")?t:`${t}.zip`;return Yi({blob:await e.generateAsync({type:"blob"}),filename:r,mimeType:"application/zip"})}async function to(e){const t=await Qi(await Xi(e)),r={};return t.forEach((e=>{r[e.file]=e.content})),Promise.resolve(r)}async function ro(e,t,r){let n;if(!t){const n=await rn(e);r=r??n.orgId,t=await en("",e)}const i=`https://${t.portalHostname}`,o=`${i}/sharing/rest`;return n=t.isPortal?await async function(e,t){const r=await async function(e,t){const r=`${e}/portals/self/servers`;return(await ke(r,{authentication:t,httpMethod:"GET",params:{f:"json"}})).servers}(e,t),n=r.find((e=>"WorkflowManager"===e.serverFunction));return n?n.url:""}(o,e):t.helperServices?.workflowManager?.url??i,Promise.resolve(r?`${n}/${r}`:`${n}/workflow`)}function no(e,t,r,n){const i=cr(r,`data.${e}.itemId`).replace("{{","").replace(".itemId}}","");i&&n.indexOf(i)<0&&n.push(i),t.workflows[r.itemId][e]=i,t[i]={}}async function io(e,t){const r=await un(e,t),n=await Promise.all([cn(e,r.name,t),gn(e,r.thumbnail,!1,t),pn(e,t),hn(e,t),mn(e,"forward",t),mn(e,"reverse",t)]),[i,o,a,s,u,c]=n,l={base:r,data:i,thumbnail:o,metadata:a,resources:s,fwdRelatedItems:u,revRelatedItems:c};if("Feature Service"===r.type)l.featureServiceProperties=await Mi(r.url,t);else if("Workflow"===r.type){const e=await ro(t),n=await Fi(r.id,e,t);l.workflowConfiguration=await to(n)}return Promise.resolve(l)}function oo(e){let t;return e.match(/(qaext|\.mapsqa)\.arcgis.com/)?t="https://hubqa.arcgis.com":e.match(/(devext|\.mapsdevext)\.arcgis.com/)?t="https://hubdev.arcgis.com":e.match(/(www|\.maps)\.arcgis.com/)&&(t="https://hub.arcgis.com"),t}function ao(e,t={}){const r=[];return t.organization?r.push(Promise.resolve(t.organization)):r.push(function(e){return U(null,e)}({authentication:e})),r.push($({authentication:e})),Promise.all(r).then((([t,r])=>{t.user=r;const n={authentication:e,portalSelf:t,isPortal:t.isPortal};return t.isPortal||(n.hubApiUrl=function(e){if(e.isPortal)throw new Error("Hub Url is not available in ArcGIS Enterprise");return oo(e.portalHostname)}(t)),n}))}function so(e){let t=[];const r=[],n={},i={},o={};function a(o){i[o]=uo.InProgress;const s=Vr(e,o);(s.dependencies||[]).concat(cr(s,"properties.syncViews")||[]).forEach((function(e){i[e]===uo.NotYetVisited?a(e):i[e]===uo.InProgress?n[o]?n[o].push(e):n[o]=[e]:i[e]!==uo.Finished&&r.indexOf(e)<0&&r.push(e)})),i[o]=uo.Finished,t.push(o)}e.forEach((function(e){i[e.itemId]=uo.NotYetVisited,o[e.itemId]=e.item?.typeKeywords&&e.item.typeKeywords.includes("View Service")?"View Service":e.item?.tags&&e.item.tags.includes("Location Tracking Group")?"Location Tracking Group":e.type})),e.forEach((function(e){i[e.itemId]===uo.NotYetVisited&&a(e.itemId)}));const s=[],u=[],c=[],l=[];do{const e=t.shift();e&&("Location Tracking Group"===o[e]?s.push(e):"Feature Service"===o[e]?u.push(e):"View Service"===o[e]?c.push(e):l.push(e))}while(t.length>0);return t=s.concat(u,c,l),{buildOrder:t,missingDependencies:r,itemsToBePatched:n}}var uo;function co(e,t,r="",n=Fe.Started){const i=Math.round(e);t.progressCallback&&t.progressCallback(i,t.jobId,{event:"",data:r}),t.consoleProgress&&console.log(Date.now(),r,t.jobId??"",De[n],i+"%")}function lo(e,t){return Promise.all([(0,N.Gq)(e,t),(0,N.MB)(e,t)]).then((e=>({item:e[0],data:e[1]})))}!function(e){e[e.NotYetVisited=0]="NotYetVisited",e[e.InProgress=1]="InProgress",e[e.Finished=2]="Finished"}(uo||(uo={}));var po=r(6808);function fo(e){const t=(0,po.M)(ce,{success:!0}),r=(0,po.M)(B,{success:!0});return t(e).then((()=>r(e)))}function mo(e,t=[]){return t.map((t=>t[e]))}const ho=(e,t)=>t.split(".").reduce((function(t,r){const n=r.match(/\[(.*?)\]$/);if(n){const e=n[1],i=r.replace(n[0],"");if(parseInt(e,10)>-1){const r=parseInt(e,10);return Array.isArray(t[i])&&t[i][r]?t[i][r]:void 0}return function(e,t){const r=t.split("(");if(!r||2!==r.length)return;let n;const i=r[0],o=r[1].replace(")","").split(",").map((e=>e.trim()));if("findBy"===i){const t=o[0];let r;a=o[1],r=isNaN(parseFloat(a))?o[1].replace(/'/g,""):parseFloat(o[1]),n=e.find((e=>e[t]===r))}else n=void 0;var a;return n}(t[i],e)}return t&&void 0!==t[r]?null!==t[r]&&t[r].$use?ho(e,t[r].$use):t[r]:void 0}),e);function go(e,t,r){const n=ho(e,t);return void 0!==n?n:r}function yo(e,t){const r=`${e}Model`,n=`${e}Id`;if(t[r])return Promise.resolve(t[r]);if(t[n])return(0,po.M)(lo,{item:{id:t[n]},isMissing:!0})(t[n],t);throw new Error(`getModelFromOptions requires either a .${r} or .${n} property.`)}function vo(e,t,r){return r.filter((r=>r[e]!==t))}function bo(e){const t=je(e.item);return t.text=JSON.stringify(e.data),t}function wo(e,t){return(0,po.M)(J,{id:e.item.id,success:!0})(Object.assign({item:bo(e)},t))}function Io(e,t,r,n){return Promise.all(t.map((async t=>{const i=Object.assign({},{id:e,groupId:t},r);n&&(i.owner=n);try{return await function(e){return ne(e).then((function(t){if(!t)return Promise.resolve({itemId:e.id,shortcut:!0,notUnsharedFrom:[]});var r=e.authentication.username,n=e.owner;return Promise.all([Y(e),$({username:r,authentication:e.authentication})]).then((function(t){var i=t[0],o=t[1],a=(n||r)===r,s="org_admin"===o.role&&!o.roleId;if(!a&&!s&&["admin","owner"].indexOf(i)<0)throw Error("This item can not be unshared from group "+e.groupId+" by "+r+" as they not the item owner, an org admin, group admin or group owner.");return function(e){var t=e.authentication.username,r=e.owner||t,n=(0,R.e)(e)+"/content/items/"+e.id+"/unshare";return r===t&&(n=(0,R.e)(e)+"/content/users/"+r+"/items/"+e.id+"/unshare"),e.params={groups:e.groupId},(0,C.Em)(n,e)}(e)})).then((function(t){if(t.notUnsharedFrom.length)throw Error("Item "+e.id+" could not be unshared to group "+e.groupId);return t}))}))}(i)}catch(r){throw new Error(`Error unsharing item: ${e} with group: ${t}`)}})))}function xo(e){let t=[];const r=[];let n,i;const o={authentication:e.authentication};return Promise.all([yo("page",e),yo("site",e)]).then((e=>{if([n,i]=e,!i.isMissing){const e=go(i,"data.values.pages",[]);i.data.values.pages=vo("id",n.item.id,e),t=Le(ho(i,"item.properties.collaborationGroupId"),t),t=Le(ho(i,"item.properties.contentGroupId"),t),r.push(wo(i,o))}if(!n.isMissing){const e=go(n,"data.values.sites",[]);n.data.values.sites=vo("id",i.item.id,e),r.push(wo(n,o));const a=(0,po.M)(Io);r.push(a(n.item.id,t,o))}return Promise.all(r)})).then((()=>({pageModel:n,siteModel:i})))}var _o=r(7184);function ko(e){const t={},r=ho(e,"authentication.token");return r&&(t.Authorization=r),t}function So(e){return`${e||"https://hub.arcgis.com"}/api/v3/domains`}async function Eo(e){return e.status>=200&&e.status<300?e.json():e.json().then((t=>{if(t.error)throw new Error(`${t.error.title} :: ${t.error.detail} :: ${e.status}`);throw new Error(`Got ${e.status} ${e.statusText}`)}))}function Ao(e){if("string"==typeof e)return e.replace(/\/sharing\/rest\/?$/,"");if("object"==typeof e){const t=e.portalSelf||e,{portalHostname:r,urlKey:n,customBaseUrl:i}=t;if(r||n&&i)return t.isPortal?`https://${t.portalHostname}`:`https://${t.urlKey}.${t.customBaseUrl}`}return Ao((0,R.e)(e))}function Po(e){return`${Ao(e)}/sharing/rest`}function Oo(e){return e&&e.hubApiUrl||oo(Po(e))}function To(e,t){if(t.isPortal)return Promise.resolve();{const r=`${Oo(t)}/api/v3/${e.item.id}`,n={method:"DELETE",mode:"cors",headers:{Authorization:t.authentication.token}};return fetch(r,n).then((e=>e.json())).then((e=>({success:!0}))).catch((e=>{throw Error(`_removeSiteFromIndex: Error removing site from index: ${e}`)}))}}function Co(e,t){let r,n;return r="string"==typeof e?lo(e,t):Promise.resolve(e),r.then((e=>(n=e,function(e,t){const r=mo("id",go(e,"data.values.pages",[])),n=(0,po.M)(xo);return Promise.all(r.map((r=>{const i=Object.assign({siteModel:e,pageId:r},t);return n(i)})))}(n,t)))).then((()=>function(e,t){const r=["collaborationGroupId","contentGroupId","followersGroupId"].reduce(((t,r)=>Le(ho(e,`item.properties.${r}`),t)),[]).map((e=>{const r=Object.assign({id:e},t);return(0,_o._unprotectAndRemoveGroup)(r)}));return Promise.all(r)}(n,t))).then((()=>function(e,t){const r=ho(e,"item.properties.parentInitiativeId");return r?fo(Object.assign({id:r,owner:e.item.owner},t)):Promise.resolve()}(n,t))).then((()=>function(e,t){return t.isPortal?Promise.resolve([]):function(e,t){if(t.isPortal)throw new Error("removeDomainsBySiteId is not available in ArcGIS Enterprise. Instead, edit the hubdomain typekeyword on the item");const r=ko(t);r["Content-Type"]="application/json";const n=`${So(t.hubApiUrl)}/?siteId=${e}`;return fetch(n,{method:"DELETE",headers:r,mode:"cors"}).then(Eo)}(e,t).then((e=>e))}(n.item.id,t))).then((()=>(0,po.M)(To,{success:!0})(n,t))).then((()=>fo(Object.assign({id:n.item.id,owner:n.item.owner},t)))).catch((e=>{throw Error(`removeSite: Error removing site: ${e}`)}))}function Ro(e,t,r,n,i,o={}){let a,s;const u=e.items.shift(),c=n+i*(e.items.length+1);return u?Ro(e,t,r,n,i,o).then((e=>([a,s]=e,Oe({id:u.id,authentication:r})))).then((async()=>{if(t.includes(u.id)){const e=await ao(r);return Co(u.id,e)}if("Workflow"===u.type){const e=await ro(r);return async function(e,t,r){const n=await ln(e,r),i=n?.groupId,o=`${t}/admin/${e}`,a={authentication:r,headers:{Accept:"application/json",Authorization:`Bearer ${r.token}`,"X-Esri-Authorization":`Bearer ${r.token}`},httpMethod:"DELETE",params:{f:"json"}},s=await ke(o,a);return i&&await Di(i,r),Promise.resolve(s.success)}(u.id,e,r)}return ji(u.id,r)})).then((()=>(a.items.push(u),co(c,o,u.id,Fe.Finished),[a,s]))).catch((e=>{const t=e.error?.message||e.message;return t&&t.includes("Item does not exist or is inaccessible")?co(c,o,u.id,Fe.Ignored):(s.items.push(u),co(c,o,u.id,Fe.Failed)),[a,s]})):(a={id:e.id,title:e.title,folder:e.folder,items:[],groups:[]},s={id:e.id,title:e.title,folder:e.folder,items:[],groups:[]},Promise.resolve([a,s]))}function Mo(e,t,r,n){const i=n||{};let o,a,s=0,u=0,c=[];return new Promise((n=>{let l=Promise.resolve([{id:t.id,title:t.title,folder:t.folder,items:[],groups:[]},{id:t.id,title:t.title,folder:t.folder,items:[],groups:[]}]);if(t.items.length>0){e&&(c=t.items.map((e=>e.id)).concat([e]));const n=t.items.filter((e=>"Hub Site Application"===e.type)).map((e=>e.id));s=100/(t.items.length+2),co(u+=s,i),l=Ro(t,n,r,u,s,i)}l.then((e=>([o,a]=e,new Promise((n=>{(function(e,t){return 0===e.length?Promise.resolve([]):Promise.all(e.map((e=>function(e,t){let r,n;return t.getUsername().then((n=>(r=n,xe(e,{authentication:t})))).then((i=>i.owner!==r?Promise.resolve(null):(n=i.protected,_e(e,{paging:{num:1},authentication:t})))).then((r=>{return!r||r.total>0?Promise.resolve({success:!1}):n?(i={id:e,authentication:t},(0,se.w)(i)):Promise.resolve({success:!0});var i})).then((r=>r.success?Ee({id:e,authentication:t}):Promise.resolve({success:!1}))).then((e=>Promise.resolve(e.success))).catch((()=>Promise.resolve(!1)))}(e,t)))).then((t=>e.filter(((e,r)=>t[r]))))})(t.groups,r).then((()=>{n(e)}))}))))).then((()=>e?0===a.items.length?function(e,t){return Oe({id:e,authentication:t}).then((r=>r.success?ji(e,t):Promise.resolve(r))).then((t=>Promise.resolve({success:t.success,itemId:e})))}(e,r):Promise.resolve({success:!1,itemId:e}):Promise.resolve({success:!0,itemId:""}))).then((n=>n.success?(co(99,i,e,Fe.Finished),function(e,t,r){return r.getUser({authentication:r}).then((e=>Ae({q:(new q).match(r.username).in("owner").and().match(e.orgId).in("orgid").and().match(t).in("ownerfolder"),authentication:r}))).then((n=>0===n.results.map((e=>e.id)).filter((t=>!e.includes(t))).length?Se({folderId:t,owner:r.username,authentication:r}):Promise.resolve({success:!0}))).then((e=>e.success))}(c,t.folder,r)):Promise.resolve(!1))).then((()=>{n([o,a])})).catch((()=>{n([o,a])}))}))}async function Fo(e,t,r){return $i({id:t,data:await eo(e,`${t}.zip`)},r)}function Do(e){if(ho(e,"item.properties.schemaVersion")>=1)return e;const t=je(e);t.item.properties||(t.item.properties={});const r=ho(t,"data.templates")||[];return t.data.templates=r.map((e=>({key:e.fieldName||e.key,type:e.type,item:e.item,data:e.data,itemId:e.itemId||e.fieldName||e.key,resources:e.resources||[]}))),t.item.properties.schemaVersion=1,t}function jo(e){if(ho(e,"item.properties.schemaVersion")>=2)return e;const t=je(e),r=(ho(t,"data.configurationSettings")||[]).find((e=>"Indicators"===e.category));return t.data.indicators=function(e={}){e.fields&&Array.isArray(e.fields)||(e.fields=[]);return e.fields.map(Go)}(r),delete t.data.configurationSettings,t.item.properties.schemaVersion=2,t}const Go=function(e){return{id:e.fieldName,type:"Data",name:e.label||e.fieldName,optional:e.optional||!1,definition:{description:e.label||e.fieldName,supportedTypes:[].concat(e.layerOptions.supportedTypes),geometryTypes:[].concat(e.layerOptions.geometryTypes),fields:e.fields.map(zo)}}},zo=function(e){return{id:e.fieldName,name:e.label,optional:e.optional||!1,description:e.tooltip,supportedTypes:[].concat(e.supportedTypes)}};function Lo(e){return ho(e,"item.properties.schemaVersion")>=2.1||(e.data.templates=e.data.templates.map((e=>(e.key=e.fieldName||e.key,e.itemId=e.itemId||e.key,e))),e.item.properties.schemaVersion=2.1),e}function No(e,t,r){return r=r||"",Array.isArray(e)?e.map(o):!e||"object"!=typeof e||e instanceof Date||Uo(e)||function(e){return"function"==typeof e}(e)?t(e,r):Object.assign({},e,(n=e,i=o,Object.keys(n).reduce((function(e,t){return e[t]=i(n[t],t,n),e}),{})));var n,i;function o(e,n){return No(e,t,""+(r?r+"."+n:n))}}function Uo(e){return e instanceof RegExp}function $o(e,t,r){return No(e,(function(e){if(!("string"==typeof(n=e)||n instanceof String))return e;var n;let i;return i=Uo(t)?t:new RegExp(t,"g"),e.replace(i,r)}))}function Bo(e){if(cr(e,"item.properties.schemaVersion")>=2.2)return e;const t=je(e);return[{src:"{{solution.name}}",val:"{{solution.title}}"},{src:"{{initiative.name}}",val:"{{solution.title}}"},{src:"{{initiative.title}}",val:"{{solution.title}}"},{src:"{{initiative.extent}}",val:"{{organization.defaultExtentBBox}}"},{src:"{{initiative.collaborationGroupId",val:"{{teams.collaborationGroupId"},{src:"{{initiative.openDataGroupId",val:"{{teams.contentGroupId"},{src:"{{initiative.contentGroupId",val:"{{teams.contentGroupId"},{src:"{{initiative.followersGroupId",val:"{{teams.followersGroupId"},{src:"{{collaborationGroupId",val:"{{teams.collaborationGroupId"},{src:"{{contentGroupId",val:"{{teams.contentGroupId"},{src:"{{followersGroupId",val:"{{teams.followersGroupId"},{src:"{{initiative.id",val:"{{initiative.item.id"},{src:"{{organization.portalBaseUrl",val:"{{portalBaseUrl"}].forEach((e=>{t.data=$o(t.data,e.src,e.val)})),t.item.properties.schemaVersion=2.2,t}function Wo(e){if(cr(e,"item.properties.schemaVersion")>=2.3)return e;const t=je(e);return t.data.templates=t.data.templates.map((e=>(e.resources?(e.assets=e.resources.map((e=>({name:e,type:"resource"}))),delete e.resources):e.assets=[],e))),t.item.properties.schemaVersion=2.3,t}function Vo(e){if(ho(e,"item.properties.schemaVersion")>=2.4)return e;{const t=je(e);return t.data.templates.map((e=>({src:`{{${e.key}.item.id}}`,val:`{{${e.itemId}.itemId}}`}))).forEach((e=>{t.data=$o(t.data,e.src,e.val)})),t.data.templates=t.data.templates.map((e=>(e.assets&&(e.resources=e.assets.map((t=>{let r=t.name;return r.indexOf("/")>-1&&(r=r.split("/")[1]),`${e.itemId}-${r}`}))),e.estimatedDeploymentCostFactor||(e.estimatedDeploymentCostFactor=1),e))),t.item.properties.schemaVersion=2.4,t}}function qo(e){if(cr(e,"item.properties.schemaVersion")>=2.5)return e;{const t=ir(e);return t.data.templates.forEach((e=>{if("Form"===e.type){cr(e,"properties.form.portalUrl")&&(e.properties.form.portalUrl="{{portalBaseUrl}}");const t=parseFloat(cr(e,"properties.form.version")||"2.5");if(!cr(e,"properties.form")||t>=3.8)return e;e.properties.form.layerName="survey",cr(e,"properties.form.theme")&&(e.properties.form.themes=[e.properties.form.theme],delete e.properties.form.theme);const r=e=>(e.appearance&&e.appearance.layout&&(e.appearance.layout="vertical"),e);e.properties.form.questions=e.properties.form.questions.map((e=>e.questions?{...e,questions:e.questions.map(r)}:r(e))),e.properties.form.version=3.8}})),t.item.properties.schemaVersion=2.5,t}}function Ho(e){if(cr(e,"item.properties.schemaVersion")>=2.6)return e;{const t=ir(e),r=(e,t)=>(cr(t,"properties.form.questions.length")&&t.properties.form.questions.forEach((r=>{r.maps&&r.maps.forEach((r=>{const n=hr(r.itemId);t.dependencies=t.dependencies.filter((e=>e!==n)),e.push(n)}))})),e),n=t.data.templates.filter((({type:e})=>"Form"===e)).reduce(r,[]);return t.data.templates=t.data.templates.filter((e=>!n.includes(e.itemId))),t.item.properties.schemaVersion=2.6,t}}function Ko(e){return ho(e,"item.properties.schemaVersion")>=2.7||(e.data.templates=e.data.templates.map(((e,t,r)=>(e.itemId||(e.itemId=ze()),e.dependencies||(e.dependencies=[]),t>0&&0===e.dependencies.length&&(e.dependencies=[r[t-1].itemId]),e))),e.item.properties.schemaVersion=2.7),e}function Jo(e){if(cr(e,"item.properties.schemaVersion")>=3)return e;{const t=ir(e);return t.item.properties.schemaVersion=3,t}}const Zo=3;function Yo(e){ho(e,"item.properties")||(e.item.properties={});const t=ho(e,"item.properties.schemaVersion");if(t===Zo)return Promise.resolve(e);{const r=function(e){let t=!1;const r=cr(e,"item.typeKeywords")||[];return r.includes("Template")||r.includes("hubSolutionTemplate")&&r.includes("solutionTemplate")&&(t=!0),t}(e),n=[];return t||r?(n.push(Do,jo,Lo,Bo,Wo,Vo,qo,Ho,Ko),n.push(Jo)):n.push(Jo),n.reduce(((e,t)=>e.then((e=>t(e)))),Promise.resolve(e))}}var Xo;function Qo(e,t,r=0,n){if(void 0!==n)switch(n){case Xo.data:e=`${e}_info_data`;break;case Xo.fakezip:e=`${e}_info_dataz`;break;case Xo.info:e=`${e}_info`;break;case Xo.metadata:e=`${e}_info_metadata`;break;case Xo.thumbnail:e=`${e}_info_thumbnail`}let i=e,o=t;const a=o.lastIndexOf("/");if(a>=0){let e=o.substr(0,a);0===r?(e=e.replace("/","_"),i+="_"+e):i+="/"+e,o=o.substr(a+1)}return{folder:i,filename:o}}function ea(e,t=0){const r=e.split("/");let n=r.pop(),i="";const o=r.shift();let a=Re.Resource;if(o)if(o.endsWith("_info_thumbnail"))a=Re.Thumbnail;else if(o.endsWith("_info_metadata"))a=Re.Metadata,n="metadata.xml";else if(o.endsWith("_info_data"))a=Re.Data;else if(o.endsWith("_info_dataz"))n=n.replace(/\.zip$/,""),a=Re.Data;else if(t<1){const e=o.indexOf("_");e>0&&(i=o.substr(e+1))}else i=r.join("/");return{type:a,folder:i,filename:n}}async function ta(e,t,r,n,i,o={},a={}){return new Promise((s=>{let u=[],c=e;u=e.filter((e=>e.type===Re.Data||e.type===Re.Metadata)).map((e=>{switch(e.type){case Re.Data:return function(e,t,r,n){return new Promise((i=>{Xr(e.url,t).then((t=>{$i({id:r,data:Yi({blob:t,filename:e.filename,mimeType:e.mimeType||t.type})},n,e.folder).then((()=>i(Zi(e,!0,!0))),(()=>i(Zi(e,!0,!1))))}),(()=>i(Zi(e,!1))))}))}(e,t,n,i);case Re.Metadata:return function(e,t,r,n){return new Promise((i=>{Xr(e.url,t).then((t=>{"text/xml"===t.type||"application/xml"===t.type?function(e,t,r){return Pe({item:{id:t},params:{metadata:e},authentication:r})}(t,r,n).then((()=>i(Zi(e,!0,!0))),(()=>i(Zi(e,!0,!1)))):i(Zi(e,!1))}),(()=>i(Zi(e,!1))))}))}(e,t,n,i)}})),c=e.filter((e=>e.type===Re.Info||e.type===Re.Resource));const l=[],d=new Promise((e=>{c.length>0?function(e,t,r,n,i,o={}){const a=[];if("Vector Tile Service"===r.type){const o=n.filter((e=>"root.json"===e.filename)),s="{{"+t+".url}}",u=i.portal+"/content/items/"+r.itemId,c=new RegExp(s,"g");o.forEach((t=>{a.push(new Promise((r=>{on(t.url,t.filename,e).then((e=>{Jt(e).then((e=>{const n=JSON.parse(JSON.stringify(e).replace(c,u));t.file=nr(n,t.filename),t.url="",r(null)}))}))})))}))}else if("Geoprocessing Service"===r.type){const i={};i[`{{${t}.itemId}}`]=r.itemId,r.dependencies.forEach((e=>{i[`{{${e}.itemId}}`]=o[e].itemId})),n.forEach((t=>{a.push(new Promise((r=>{on(t.url,t.filename,e).then((e=>{Jt(e).then((e=>{let n=JSON.stringify(e);Object.keys(i).forEach((e=>{const t=new RegExp(e,"g");n=n.replace(t,i[e])}));const o=JSON.parse(n);t.file=nr(o,t.filename),t.url="",r(null)}))}))})))}))}return Promise.all(a)}(t,r,o,c,i,a).then((()=>{(function(e){const t=[];let r=0;for(;r<e.length;)t.push(e.slice(r,r+40)),r+=40;return t})(c).forEach(((e,r)=>{const n={filename:`resources${r}.zip`,zip:new(Be()),filelist:[]};u=u.concat(e.map((e=>function(e,t,r){return new Promise((n=>{let i;i=e.file?Promise.resolve(e.file):on(e.url,e.filename,t),i.then((t=>{e.folder?r.zip.folder(e.folder).file(e.filename,t,{binary:!0}):r.zip.file(e.filename,t,{binary:!0}),r.filelist.push(e),n(Zi(e,!0))}),(()=>n(Zi(e,!1))))}))}(e,t,n)))),l.push(n)})),e(null)})):e(null)}));d.then((()=>{u.length>0?Promise.all(u).then((e=>{e=e.filter((e=>!(e.fetchedFromSource&&void 0===e.copiedToDestination))),function(e,t,r){return new Promise((n=>{const i=[],o=e.filter((e=>Object.keys(e.zip.files).length>0));o.length>0?ra(o,t,r).then((e=>{n(e)})):n(i)}))}(l,n,i).then((t=>{s(e.concat(t))}))})):s([])}))}))}function ra(e,t,r){return new Promise((n=>{let i=[];const o=e.pop();let a=Promise.resolve([]);e.length>0&&(a=ra(e,t,r)),a.then((e=>(i=e,new Promise((e=>{setTimeout((()=>e()),1e3)}))))).then((()=>function(e,t,r){return new Promise((n=>{e.zip.generateAsync({type:"blob"}).then((t=>Zt(t,e.filename,"application/zip"))).then((e=>Ie({id:t,resource:e,authentication:r,params:{archive:!0}}))).then((()=>n(Zi(e,!0,!0))),(()=>n(Zi(e,!0,!1))))}))}(o,t,r))).then((e=>{e.filelist.forEach((t=>{i.push(Zi(t,!0,e.copiedToDestination))})),n(i)}))}))}function na(e,t,r,n){return Promise.all(e.map((e=>{const i={id:t,groupId:e,authentication:r};return n&&(i.owner=n),function(e){return ie(e)}(i)})))}!function(e){e[e.thumbnail=0]="thumbnail",e[e.metadata=1]="metadata",e[e.resource=2]="resource",e[e.data=3]="data",e[e.fakezip=4]="fakezip",e[e.info=5]="info"}(Xo||(Xo={}));const ia=["feat-lyr-new","feat-lyr-existing","stream-lyr-new"],oa=[".portal.mapServicePortalItemID",".portal.featureServicePortalItemID",".portal.streamServicePortalItemID",".portalItemId"];function aa(e,t,r){const n=r.velocityUrl;return e&&"Web Map"===t&&n&&(e.operationalLayers||[]).concat(e.tables||[]).forEach((e=>{e.url&&e.url.indexOf(n)>-1&&e.itemId&&delete e.itemId})),n&&e?function(e,t){let r=JSON.stringify(e);if(r.indexOf(t)>-1){r=r.replace(new RegExp(`${t}`,"gi"),"{{velocityUrl}}");const e=new RegExp("{{velocityUrl}}.+?(?=/[A-Za-z]+Server)","gi"),n=r.match(e);return n&&n.filter(((e,t,r)=>r.indexOf(e)===t)).forEach((e=>{r=r.replaceAll(e,`${e}_{{solutionItemId}}`)})),JSON.parse(r)}return e}(e,n):e}function sa(e){return document.getElementById(e).checked}function ua(e){return document.getElementById(e).value}function ca(e,t,r,n){return new Promise(((t,i)=>{const o=Br(e);var a;(a=e.groupDesignations)&&["livingatlas"].indexOf(a)>-1?function(e,t){return new Promise(((r,n)=>{if(e.properties.hasInvalidDesignations=!0,e.item.url){const i=e.item.url;ke(i+"?f=json",{authentication:t}).then((t=>{const n={};(t.layers||[]).concat(t.tables||[]).forEach((e=>{e&&e.hasOwnProperty("id")&&(n[e.id]=e)})),e.data[e.itemId]=Object.assign({itemId:e.itemId},Tn(n,i,e.itemId)),r(e)}),(e=>n(sr(e))))}else r(e)}))}(o,r).then((e=>t(e)),(e=>i(sr(e)))):(o.estimatedDeploymentCostFactor=10,ln(o.item.id,r).then((e=>{var a,s;o.data=e,(a=o,s=r,new Promise(((e,t)=>{const r=gi(a);a.item.url?Mi(a.item.url,s,r).then((t=>{a.properties=t,e(a)}),(e=>t(sr(e)))):e(a)}))).then((e=>{e.item.modified=Math.max(e.item.modified,pa(o.properties.layers),pa(o.properties.tables)),function(e,t){const r=[];return new Promise(((n,i)=>{e.properties.service.isView&&e.item.url&&!_n(e)?ke(Xt(e.item.url)+"sources?f=json",{authentication:t}).then((e=>{e&&e.services&&e.services.forEach((e=>{r.push({id:e.serviceItemId,name:e.name})})),n(r)}),(e=>i(sr(e)))):gi(e)?n(function(e,t){const r=e.item.properties||{},n=yi(2);t=n.reduce((function(e,n){return r[n]&&t.indexOf(r[n])<0&&e.push(r[n]),e}),t);const i=cr(e,"properties.workforceInfos.assignmentIntegrationInfos");return i&&i.length>0&&i.forEach((e=>{Object.keys(e).indexOf("dependencies")>-1&&e.dependencies.forEach((e=>{t.indexOf(e)<0&&t.push(e)}))})),t.map((e=>({id:e,name:""})))}(e,r)):n(r)}))}(e,r).then((r=>{e.dependencies=r.map((e=>e.id)),t(En(e,r,!1,n))}),(e=>i(sr(e))))}),(e=>i(sr(e))))})))}))}function la(e,t,r,n){return new Promise((i=>{if(!n(e.itemId,Fe.Started,0))return n(e.itemId,Fe.Ignored,0),void i(tr(e.type));let o=ir(e);o=Kr(o,t),delete o.item.thumbnail,or(o,"properties.service.size");const a=function(e){const t={layers:{},tables:{}};return e&&e.layers&&e.layers.length>0&&An(t,"layers",e.layers),e&&e.tables&&e.tables.length>0&&An(t,"tables",e.tables),t}(o.data);(function(e,t,r){return new Promise(((n,i)=>{(function(e,t,r){return new Promise(((n,i)=>{const o=e.properties,a=r.folderId,s=r.isPortal,u=e.itemId;!function(e,t,r){if(cr(e,"service.isView")){const n=Nn(e,t,r,!0),i=Nn(e,t,r,!1),o=n.spatialReference||i.spatialReference,a=n.extent||i.extent,s=cr(o,"wkid"),u=cr(e,"service.spatialReference.wkid");s&&u&&s!==u&&dr(e,"service.spatialReference",o);const c=cr(e,"service.fullExtent");a&&c&&JSON.stringify(a)!==JSON.stringify(c)&&dr(e,"defaultExtent",a)}}(o,e,r);const c=function(e,t){const r=e.service.spatialReference,n=cr(e,"defaultExtent.spatialReference.wkid"),i=cr(t,"params.defaultExtent");return n&&n===r.wkid?e.defaultExtent:i||e.defaultExtent}(o,r),l={},d={item:{title:e.item.title,name:e.item.name,preserveLayerIds:!0},folderId:a,params:l,authentication:t};d.item=_n(e)?function(e,t,r){return _n(e)&&(dr(t,"owner",r.locationTracking.owner),dr(t.item,"name",e.item.name),dr(t.item,"isView",!0),dr(t.item,"owner",r.locationTracking.owner),dr(t.params,"isView",!0),dr(t.params,"outputType","locationTrackingService"),delete t.folderId),t.item}(e,d,r):function(e,t,r,n,i){const o=["Create","Query","Editing","Update","Delete","Uploads","Sync","Extract"],a=cr(r,"service.capabilities")||(i?"":[]);e.capabilities=i?a.split(",").filter((e=>o.indexOf(e)>-1)).join(","):a,r.service.capabilities&&(r.service.capabilities=e.capabilities),Ki(r);const s=["isView","sourceSchemaChangesAllowed","isUpdatableView","capabilities","isMultiServicesView"],u=["layers","tables"];i&&u.push("adminServiceInfo");const c=Object.keys(e);return Object.keys(r.service).forEach((t=>{-1===c.indexOf(t)&&u.indexOf(t)<0&&(e[t]=r.service[t],r.service.isView&&s.indexOf(t)>-1&&(n[t]=r.service[t]))})),e.isMultiServicesView&&cr(e,"editorTrackingInfo.enableEditorTracking")&&(e.editorTrackingInfo.enableEditorTracking=!1,n.editorTrackingInfo=e.editorTrackingInfo),i&&Object.keys(e).indexOf("initialExtent")>-1&&!e.initialExtent&&or(e,"initialExtent"),e}(d.item,0,o,l,s),Ai(r.organization.defaultExtent,c,o.service.spatialReference,r.organization.helperServices.geometry.url,t).then((t=>{r[u].solutionExtent=t,Ln(r,u,t.spatialReference),d.item=Kr(d.item,r),d.params=Kr(d.params,r),e.item.thumbnail&&(d.params.thumbnail=e.item.thumbnail),n(d)}),(e=>i(sr(e))))}))})(e,t,r).then((e=>{var t;(t=e,F(t).then((function(e){var r=(0,O.Cl)((0,O.Cl)({},t),{rawResponse:!1}),n=(0,R.e)(t)+"/content/users/"+e+(r.folderId&&"/"!==r.folderId?"/"+r.folderId:"")+"/createService";return r.params=(0,O.Cl)({createParameters:r.item,outputType:"featureService"},r.params),(0,C.Em)(n,r)}))).then((e=>{e.encodedServiceURL=Hi(e.encodedServiceURL),e.serviceurl=Hi(e.serviceurl),n(e)}),(e=>i(sr(e))))}),(e=>i(sr(e))))}))})(o,r,t).then((s=>{s.success?n(e.itemId,Fe.Created,e.estimatedDeploymentCostFactor/2,s.serviceItemId)?(o=On(o,t,s),Rn(o,t,a,r).then((()=>{o=On(o,t,s),Bi({...o.item,url:void 0},o.data,r,e.item.thumbnail,void 0,t).then((()=>{n(e.itemId,Fe.Finished,e.estimatedDeploymentCostFactor/2,s.serviceItemId)?un(o.itemId,r).then((e=>{o.item=e,cr(o,"item.url")&&!o.item.url.endsWith("/")&&(o.item.url+="/"),i({item:o,id:s.serviceItemId,type:o.type,postProcess:qr({item:o.item,data:o.data})||gi(o)})}),(()=>{n(e.itemId,Fe.Failed,0),ji(s.serviceItemId,r).then((()=>i(tr(e.type))),(()=>i(tr(e.type))))})):(n(e.itemId,Fe.Cancelled,0),ji(s.serviceItemId,r).then((()=>i(tr(e.type))),(()=>i(tr(e.type)))))}),(()=>{n(e.itemId,Fe.Failed,0),ji(s.serviceItemId,r).then((()=>i(tr(e.type))),(()=>i(tr(e.type))))}))}),(()=>{n(e.itemId,Fe.Failed,0),ji(s.serviceItemId,r).then((()=>i(tr(e.type))),(()=>i(tr(e.type))))}))):(n(e.itemId,Fe.Cancelled,0),ji(s.serviceItemId,r).then((()=>i(tr(e.type))),(()=>i(tr(e.type))))):(n(e.itemId,Fe.Failed,0),i(tr(e.type)))}),(()=>{n(e.itemId,Fe.Failed,0),i(tr(e.type))}))}))}function da(e,t,r,n,i,o,a){return new Promise(((t,r)=>{Wi(e,o,a).then((e=>{gi(n)?wi(n=Kr(n,o),a,n.item.url,o).then(t,r):t(e)}),r)}))}function pa(e){let t=0;return e.forEach((e=>{t=e.editingInfo?.lastEditDate?Math.max(t,e.editingInfo.lastEditDate):t})),t}function fa(e,t,r){return new Promise((t=>{const n=Br(e);n.item.id=Jr(n.item.id,n.item.id,".itemId");const i=new Promise((e=>{cn(n.itemId,n.item.name,r).then((t=>{t&&0!==t.size?e(t):e(null)}))})),o=Promise.resolve({});Promise.all([i,o]).then((e=>{const[r]=e;if(r){const e=function(e,t=""){const r=e.name||t;let n=r;return n&&!function(e){const t=e.match(/\.([a-z]+)$/i);return!!t&&"|.json|.xml|.txt|.png|.pbf|.zip|.jpeg|.jpg|.gif|.bmp|.gz|.svg|.svgz|.geodatabase|".indexOf("|"+t[0]+"|")>=0}(n)&&(n+=".zip"),{blob:new File([e],n,{type:e.type}),filename:r,mimeType:e.type}}(r,n.item.name);n.properties[e.filename]=e.mimeType;const i=Qo(n.itemId,e.blob.name,Te,e.blob.name===e.filename?Xo.data:Xo.fakezip),o={itemId:n.itemId,file:e.blob,folder:i.folder,filename:i.filename};n.dataFile=o,n.resources.push(i.folder+"/"+i.filename),t(n)}else t(n)}))}))}function ma(e,t,r,n){return new Promise((i=>{if(!n(e.itemId,Fe.Started,0))return n(e.itemId,Fe.Ignored,0),void i(tr(e.type));let o=ir(e);o=Kr(o,t),e.item.thumbnail&&(o.item.thumbnail=e.item.thumbnail),Oi(o.item,o.data,r,t.folderId).then((a=>{n(e.itemId,Fe.Created,e.estimatedDeploymentCostFactor/2,a.id)?(o.itemId=a.id,t[e.itemId]={itemId:a.id},n(e.itemId,Fe.Finished,e.estimatedDeploymentCostFactor/2,a.id),i({item:o,id:a.id,type:o.type,postProcess:!1})):(n(e.itemId,Fe.Cancelled,0),ji(a.id,r).then((()=>i(tr(e.type))),(()=>i(tr(e.type)))))}),(()=>{n(e.itemId,Fe.Failed,0),i(tr(e.type))}))}))}function ha(e,t){let r;const n=cr(e,"dataSource.id")||cr(e,"targetId");if(n){const e=n.split("#")[1];if(!t.some((t=>(r=t.ids.indexOf(e)>-1?t:r,t.ids.indexOf(e)>-1)))){const e=n.split("#")[0];t.some((t=>{const n=(t.references||[]).indexOf(e)>-1;return r=n?t:r,n}))}}else{const n=hr(cr(e,"dataSource.itemId")),i=gr(cr(e,"dataSource.layerId"));n&&t.some((e=>{const t=n===e.itemId&&i===e.layerId;return r=t?e:r,t}))}return r}function ga(e,t){e.references=Array.isArray(e.references)?e.references:[],e.references.indexOf(t)<0&&e.references.push(t)}function ya(e,t,r,n,i=!1){return new Promise(((o,a)=>{const s=cr(e,n)||[];let u=[],c=[];if(s.forEach((e=>{!i&&cr(e,"icon")&&Ia(e,["icon"],$r(Gr));const n=e.config;if(n){const i=ba(JSON.stringify(n),r,c,u,t);e.config=JSON.parse(i.testString),u=i.serviceRequests,c=i.requestUrls}})),u.length>0){const t=JSON.stringify(s);va(u,c,t).then((t=>{pr(e,n,JSON.parse(t)),o(e)}),(e=>a(sr(e))))}else o(e)}))}function va(e,t,r){return new Promise(((n,i)=>{if(e&&e.length>0){let o=0;Promise.all(e).then((e=>{e.forEach((e=>{if(cr(e,"serviceItemId")){const n="{{"+e.serviceItemId+(e.hasOwnProperty("id")?".layer"+e.id:"")+".url}}";r=wa(r,t[o],n,!0)}o++})),n(r)}),(e=>i(sr(e))))}else n(r)}))}function ba(e,t,r,n,i){const o={f:"json",authentication:i},a=e.match(/(\bhttps?:\/\/[-A-Z0-9/._]*)/gim);return a&&a.length&&a.forEach((i=>{i.indexOf("NAServer")>-1?e=wa(e,i,$r(Nr)):i.indexOf("GeocodeServer")>-1?e=wa(e,i,$r(Lr)):t&&i.indexOf(t)>-1?e=wa(e,t,$r(Gr)):i.indexOf("FeatureServer")>-1&&-1===r.indexOf(i)&&(r.push(i),n.push(ke(i,o)))})),{testString:e,requestUrls:r,serviceRequests:n}}function wa(e,t,r,n=!1){const i=n&&e.indexOf('"')>-1,o=new RegExp(i?'"'+t+'"':t,"gmi");return e.replace(o,i?'"'+r+'"':r)}function Ia(e,t,r){t.forEach((t=>{const n=cr(e,t);if(n){const i=n.substring(n.indexOf("/",n.indexOf("//")+2));pr(e,t,i!==n?r+i:r)}}))}function xa(e){return t=e,["data.values.webmap","data.values.group"].reduce(((e,r)=>{const n=cr(t,r);return n&&e.push(n),e}),[]);var t}function _a(e){const t=[],r=cr(e,"data.map.itemId");r&&t.push(r);const n=cr(e,"data.dataSource.dataSources");return n&&Object.keys(n).forEach((e=>{const r=n[e];r.itemId&&t.push(r.itemId)})),t}function ka(e,t,r){pr(e,t,Jr(r,r,".itemId"))}function Sa(e,t,r=!1){e=function(e,t,r){const n=JSON.stringify(e),i=t.filter((e=>{let t;e.url&&!isNaN(e.layerId)&&(t=new RegExp(e.url.replace(/[.]/,".layer"+e.layerId+"."),"gm"));let r=!1;if(e.ids.length>0&&(r=e.ids.some((e=>new RegExp(e,"gm").test(n)))),r||t&&t.test(n))return e}));return i.length>0&&i.forEach((t=>{e=Aa(e,t,r),t.ids.length>0&&t.ids.forEach((n=>{e=Pa(e,t,n,r)}))})),e}(e,t,r);const n=function(e,t){const r=JSON.stringify(e);return t.filter((e=>Ea(e,r)<4)).sort(((e,t)=>Ea(e,r)-Ea(t,r)))}(e,t);return n.forEach((t=>{e=Zr(e,t.fields,t.basePath,r)})),e}function Ea(e,t){const r=e.url,n=e.itemId,i=e.layerId;let o;return r&&!isNaN(i)&&(o=new RegExp(r.replace(/[.]/,".layer"+i+"."),"gm")),o&&o.test(t)||e.ids.length>0&&e.ids.some((e=>new RegExp(e,"gm").test(t)))?1:r&&new RegExp(r,"gm").test(t)?2:n&&new RegExp(n,"gm").test(t)?3:4}function Aa(e,t,r){let n={};const i=t.url,o=t.layerId;let a;if(i&&!isNaN(o)&&(a=new RegExp(i.replace(/[.]/,".layer"+o+"."),"gm")),Array.isArray(e))n=e.map((e=>Aa(e,t,r)));else if("object"==typeof e)for(const i in e)null!=e[i]&&"object"==typeof e[i]?n[i]=Aa(e[i],t,r):(a&&a.test(e[i])&&(e=Zr(e,t.fields,t.basePath,r)),n[i]=e[i]);else n=e;return n}function Pa(e,t,r,n){let i={};const o=new RegExp(r,"gm");if(Array.isArray(e))i=e.map((e=>Pa(e,t,r,n)));else if("object"==typeof e)for(const a in e)if(null!==e[a]){let s;try{s=JSON.parse(e[a])}catch(e){s=void 0}s&&"object"==typeof s?i[a]=JSON.stringify(Pa(s,t,r,n)):"object"==typeof e[a]?(o.test(a)&&n&&(e[a]=Zr(e[a],t.fields,t.basePath,n)),i[a]=Pa(e[a],t,r,n)):(o.test(e[a])&&(e=Zr(e,t.fields,t.basePath,n)),i[a]=e[a])}else i[a]=e[a];else i=e;return i}function Oa(e,t,r,n){return new Promise((i=>{if(n(e.itemId,Fe.Started,0)){let o,a=ir(e);a=Kr(a,t),"Web Mapping Application"===e.type&&e.data?a=JSON.parse(Kr(JSON.stringify(a),t)):"QuickCapture Project"===e.type&&e.data&&(o=JSON.stringify(a.data.application),delete a.data),e.item.thumbnail&&(a.item.thumbnail=e.item.thumbnail),Oi(a.item,a.data,r,t.folderId).then((s=>{if(n(e.itemId,Fe.Created,e.estimatedDeploymentCostFactor/2,s.id)){t[e.itemId]={itemId:s.id,itemUrl:t.portalBaseUrl+"/sharing/rest/content/items/"+s.id},a.itemId=s.id,"Web Mapping Application"===a.type&&e.data&&pr(a,"data.appItemId",s.id);const d=qr(a.data),p=a.item.url;a=Kr(a,t);let f,m=Promise.resolve([]);if(a.relatedItems){const e=Kr(Yr(a.relatedItems),t);u=a.itemId,c=e,l=r,m=new Promise((e=>{const t=new Array;c.forEach((e=>{e.relatedItemIds.forEach((r=>{t.push(function(e,t,r,n){return new Promise((i=>{G({originItemId:e,destinationItemId:t,relationshipType:r,authentication:n}).then((t=>{i({success:t.success,itemId:e})}),(()=>{i({success:!1,itemId:e})}))}))}(u,r,e.relationshipType,l))}))})),Promise.all(t).then((t=>e(t)))}))}if("Web Mapping Application"===e.type&&e.data&&fr(e,["WAB2D","WAB3D","Web AppBuilder"]))f=function(e,t,r,n){return new Promise((i=>{if(fr(e,["WAB2D","WAB3D","Web AppBuilder"])){const o=$i({id:t.itemId,url:t.item.url,data:t.data},n),a=Oi({tags:e.item.tags,title:e.item.title,type:"Code Attachment",typeKeywords:["Code","Javascript","Web Mapping Application"],relationshipType:"WMA2Code",originItemId:t.itemId,url:Xt(Kr($r(Gr),r))+"sharing/rest/content/items/"+t.itemId+"/package"},{},n,r.folderId);Promise.all([o,a]).then((()=>i(null)),(()=>i(null)))}else i(null)}))}(e,a,t,r);else if("Workforce Project"===e.type)f=function(e,t,r){return wi(e,t,"",r)}(a,r,t);else if("QuickCapture Project"===e.type){if(o){const e=nr(Kr(JSON.parse(o),t),"qc.project.json");f=function(e,t,r,n,i){if(n&&n.indexOf(".")<0)return new Promise(((e,t)=>{t(new C.yk("Filename must have an extension indicating its type"))}));const o={id:t,resource:e,name:n,authentication:i,params:{}};return Ie(o)}(e,a.itemId,0,e.name,r)}}else f="Notebook"===e.type?Da(0,a,0,r):p!==a.item.url?new Promise(((e,t)=>{Vi(s.id,a.item.url,r).then((()=>e()),t)})):Promise.resolve(null);Promise.all([m,f]).then((()=>{n(e.itemId,Fe.Finished,e.estimatedDeploymentCostFactor/2,s.id)?i({item:a,id:s.id,type:a.type,postProcess:d}):(n(e.itemId,Fe.Cancelled,0),ji(s.id,r).then((()=>i(tr(e.type))),(()=>i(tr(e.type)))))}),(()=>{n(e.itemId,Fe.Failed,0),i(tr(e.type))}))}else n(e.itemId,Fe.Cancelled,0),ji(s.id,r).then((()=>i(tr(e.type))),(()=>i(tr(e.type))));var u,c,l}),(()=>{n(e.itemId,Fe.Failed,0),i(tr(e.type))}))}else n(e.itemId,Fe.Ignored,0),i(tr(e.type))}))}function Ta(e,t,r,n){return Ka(e,0,r,n)}function Ca(e,t,r,n){return Oa(e,t,r,n)}function Ra(e){return new Promise((t=>{Fa(e.data),t(e)}))}function Ma(e,t){if(e.some((e=>"Notebook"===e.type))){const r=Object.keys(t).filter((e=>e.indexOf("FeatureServer")>-1)).sort().reverse(),n=e.reduce(((e,t)=>[...new Set([...e,...t.dependencies,t.itemId])]),[]);e=e.map((e=>{if("Notebook"===e.type){let i=e.data&&JSON.stringify(e.data);return n.forEach((t=>{new RegExp(t,"gim").test(i)&&(i=i.replace(t,"{{"+t+".itemId}}"),e.dependencies.indexOf(t)<0&&e.dependencies.push(t))})),r.forEach((r=>{const n=new RegExp(r,"gim");if(n.test(i)){const o=t[r];i=i.replace(n,o);const a=/[0-9A-F]{32}/gim,s=o.match(a)[0];e.dependencies.indexOf(s)<0&&e.dependencies.push(s)}})),e.data=JSON.parse(i),e}}))}return e}function Fa(e){if(e){const t=["metadata.interpreter","metadata.papermill"];ar(e,t),(e.cells||[]).forEach((e=>{ar(e,t)}))}}function Da(e,t,r,n){return new Promise(((e,r)=>{$i({id:t.itemId,url:t.item.url,data:nr(t.data,t.itemId+".ipynb")},n).then((()=>e(null)),r)}))}function ja(e,t,r,n,i,o,a){return Wi(e,o,a)}function Ga(e,t){let r=e;if(e){const n=t[e];n&&(r=Jr(n,n,".layer"+e.substr(e.lastIndexOf("/")+1)+".url")),r=Yr(r.replace(/.+?(?=\/home)/,"{{portalBaseUrl}}"))}return r}function za(e,t,r,n){return Ka(e,0,r,n)}function La(e){return pr(e,"data.application",Na(e.data.application,e)),e}function Na(e,t){Wa(e,"itemId"),Ua(e);const r=e?.dataSources;return r&&Array.isArray(r)&&r.forEach((e=>{const r=e.featureServiceItemId;r&&($a(r,t),Ba(e,"featureServiceItemId","url"),Wa(e,"featureServiceItemId"))})),e}function Ua(e){cr(e,"preferences.adminEmail")&&pr(e,"preferences.adminEmail","{{user.email}}")}function $a(e,t){-1===t.dependencies.indexOf(e)&&t.dependencies.push(e)}function Ba(e,t,r){const n=cr(e,t),i=cr(e,r);i&&pr(e,r,Jr(n,n,".layer"+i.substr(i.lastIndexOf("/")+1)+".url"))}function Wa(e,t){const r=cr(e,t);r&&pr(e,t,Jr(r,r,".itemId"))}function Va(e,t,r,n){return Oa(e,t,r,n)}const qa="home/webmap/viewer.html?webmap=";function Ha(e=[],t,r){e.forEach((e=>{if(e.itemId&&"VectorTileLayer"===e.layerType)e.templatizeId&&(e.itemId=Jr(e.itemId,e.itemId,".itemId"),delete e.templatizeId);else if(e.url){const n=e.url.substr(e.url.lastIndexOf("/")+1),i=Object.keys(t).indexOf(e.url)>-1?t[e.url]:void 0;i&&(Pn(n,i,e.url,r),e.url=Jr(i,i,".layer"+n+".url"),e.itemId=Jr(i,i,".layer"+n+".itemId"))}}))}function Ka(e,t,r,n){return new Promise(((t,i)=>{const o=Br(e);o.item.id=Jr(o.item.id,o.item.id,".itemId");const a=mn(o.itemId,"forward",r);let s=Promise.resolve({}),u=Promise.resolve([]);switch(e.type){case"Dashboard":case"Data Pipeline":case"Feature Collection":case"Feature Service":case"Hub Initiative":case"Hub Page":case"Hub Site Application":case"Insights Model":case"Oriented Imagery Catalog":case"Project Package":case"Style":case"Workforce Project":case"Web Map":case"Web Mapping Application":case"Web Scene":case"Notebook":s=new Promise((e=>{ln(o.itemId,r).then((t=>e(t)))}));break;case"Form":s=cn(o.itemId,o.item.name,r);break;case"QuickCapture Project":u=hn(o.itemId,r)}Promise.all([s,a,u]).then((a=>{const[s,u,c]=a;!function(e,t){if("Geoprocessing Service"===e.type){const r=e.item.origUrl,n=`{{${e.itemId}.url}}`;t[r]=n}}(o,n),o.data=aa(s,e.type,n);const l=u;o.dependencies=[],o.relatedItems=[],l.forEach((e=>{"WMA2Code"!==e.relationshipType&&(o.relatedItems.push(e),e.relatedItemIds.forEach((e=>{o.dependencies.indexOf(e)<0&&o.dependencies.push(e)})))})),"Data Pipeline"===e.type&&(o.dependencies=o.dependencies.concat(function(e){const t=[];return(e?.inputs??[]).concat(e?.outputs??[]).forEach((e=>{if("FeatureServiceSource"===e.type||"FeatureServiceSink"===e.type){const r=cr(e,"parameters.layer.value.itemId");r&&t.push(r)}})),t}(s)));let d=Promise.resolve(o);switch(e.type){case"Dashboard":!function(e,t){(function(e,t){["data.desktopView.header","data.desktopView.headerPanel.selectors","data.desktopView.leftPanel.selectors","data.desktopView.sidebar","data.desktopView.urlParameters","data.desktopView.widgets","data.header","data.headerPanel.selectors","data.leftPanel.selectors","data.mobileView.header","data.mobileView.headerPanel.selectors","data.mobileView.leftPanel.selectors","data.mobileView.sidebar","data.mobileView.urlParameters","data.mobileView.widgets","data.sidebar","data.urlParameters","data.widgets"].forEach((r=>{const n=cr(e,r);Array.isArray(n)&&n.forEach((r=>{"mapWidget"===r.type&&(e.dependencies.indexOf(r.itemId)<0&&e.dependencies.push(r.itemId),r.itemId=Jr(r.itemId,r.itemId,".itemId")),Array.isArray(r.datasets)&&function(e,t,r){e.datasets.forEach((e=>{if("arcadeDataSource"!==cr(e,"dataSource.type")){const n=cr(e,"dataSource.itemId");if(n){t.dependencies.indexOf(n)<0&&t.dependencies.push(n);const i=cr(e,"dataSource.layerId");Pn(i?.toString(),n,"",r),e.dataSource.itemId=Jr(n,n,".itemId")}}}))}(r,e,t)}))}))})(e,t)}(o,n);break;case"Notebook":d=Ra(o);break;case"Oriented Imagery Catalog":d=function(e,t,r){return new Promise(((t,n)=>{(function(e,t){return new Promise(((r,n)=>{const i=[];if(e.data?.properties){const o=[];e.data.properties.ServiceURL&&o.push(e.data.properties.ServiceURL),e.data.properties.OverviewURL&&e.data.properties.OverviewURL!==e.data.properties.ServiceURL&&o.push(e.data.properties.OverviewURL),function(e,t,r){return new Promise(((n,i)=>{const o={},a={f:"json",authentication:r},s=[],u={},c=e.filter((e=>{if(e){const t=/.+FeatureServer/g.exec(e),r=Array.isArray(t)&&t.length>0?t[0]:void 0;return!!r&&(Object.keys(u).indexOf(r)<0&&(u[r]=ke(e,a)),s.push(u[r]),!0)}return!1}));s.length>0?Promise.all(s).then((e=>{e.forEach(((e,r)=>{if(cr(e,"serviceItemId")){const n=e.serviceItemId;t.indexOf(n)<0&&t.push(n),o[c[r]]=n}})),n({dependencies:t,urlHash:o})}),(e=>i(sr(e)))):n({dependencies:t,urlHash:o})}))}(o,i,t).then((e=>{r(e)}),(e=>n(sr(e))))}else r({dependencies:i,urlHash:{}})}))})(e,r).then((r=>{e.dependencies=r.dependencies,e.data?.properties&&(e.data.properties.ServiceURL=Ga(e.data.properties.ServiceURL,r.urlHash),e.data.properties.OverviewURL=Ga(e.data.properties.OverviewURL,r.urlHash)),t(e)}),(e=>n(sr(e))))}))}(o,0,r);break;case"QuickCapture Project":o.resources=c,d=new Promise((async e=>{let t=null,r=-1;c&&(c.some(((e,n)=>{const i="qc.project.json"===e.name;return i&&(t=e,r=n),i})),r>=0&&c.splice(r,1)),t&&(o.data={application:{...await Jt(t)},name:"qc.project.json"}),"Web Map"===o.data.application?.basemap?.type&&o.dependencies.push(o.data.application.basemap.itemId),e(La(o))}));break;case"Vector Tile Service":case"Web Map":case"Web Scene":d=function(e,t,r,n){return new Promise(((t,i)=>{"Vector Tile Service"!==e.type&&(e.item.url=e.item.url?Xt($r(Gr))+qa+e.item.id:e.item.url),function(e,t){return new Promise(((r,n)=>{const i=[];if(e.data){const o=e.data.baseMap?.baseMapLayers||[],a=e.data.operationalLayers||[],s=e.data.tables||[];(function(e,t,r){return new Promise(((n,i)=>{const o={},a={f:"json",authentication:r},s=[],u={},c=e.filter((e=>{if(e.itemId&&"VectorTileLayer"===e.layerType)return s.push(un(e.itemId,r)),!0;if(e.url&&e.url.indexOf("{{velocityUrl}}")<0){const t=/.+FeatureServer/g.exec(e.url),r=Array.isArray(t)&&t.length>0?t[0]:void 0;return!!r&&(Object.keys(u).indexOf(r)<0&&(u[r]=ke(e.url,a)),s.push(u[r]),!0)}return!1}));s.length>0?Promise.all(s).then((e=>{e.forEach(((e,r)=>{if("VectorTileLayer"===c[r].layerType){const n=cr(e,"typeKeywords");if(n&&n.includes("Vector Tile Style Editor")){t.indexOf(e.id)<0&&t.push(e.id),c[r].templatizeId=!0;const n=c[r].styleUrl.indexOf(e.id)+e.id.length;c[r].styleUrl=Jr(c[r].styleUrl.replace(c[r].styleUrl.substring(0,n),e.id),e.id,".itemUrl")}}else if(cr(e,"serviceItemId")){const n=e.serviceItemId;t.indexOf(n)<0&&t.push(n),o[c[r].url]=n}})),n({dependencies:t,urlHash:o})}),(e=>i(sr(e)))):n({dependencies:t,urlHash:o})}))})(o.concat(a).concat(s),i,t).then((e=>{r(e)}),(e=>n(sr(e))))}else r({dependencies:i,urlHash:{}})}))}(e,r).then((r=>{if(e.dependencies=r.dependencies,e.data){const t=e.data.baseMap?.baseMapLayers;t&&Ha(e.data.baseMap.baseMapLayers,r.urlHash,n),e.data.operationalLayers&&Ha(e.data.operationalLayers,r.urlHash,n),Ha(e.data.tables,r.urlHash,n),or(e.data,"initialState")}t(e)}),(e=>i(sr(e))))}))}(o,0,r,n);break;case"Web Mapping Application":s&&(d=function(e,t,r,n){return new Promise(((t,i)=>{let o="";if(e.item.url){const t=e.item.url,r=t.indexOf("//");e.item.url=$r(Gr)+t.substring(t.indexOf("/",r+2),t.lastIndexOf("=")+1)+e.item.id,o=t.replace(t.substring(t.indexOf("/",r+2)),"")}e.dependencies=function(e){let t=xa;return fr(e,["WAB2D","WAB3D","Web AppBuilder"])&&(t=_a),t(e)}(e),pr(e,"data.folderId","{{folderId}}"),function(e){["data.map.itemId","data.map.appProxy.mapItemId","data.values.webmap","data.values.group"].forEach((t=>{const r=cr(e,t);ka(e,t,r)}))}(e),ka(e,"data.appItemId",e.itemId),Ia(e,["data.logo","data.map.portalUrl","data.portalUrl","data.httpProxy.url"],$r(Gr)),pr(e,"data.geometryService",$r(zr)),function(e,t,r,n){return new Promise(((i,o)=>{const a=cr(e,"data.dataSource.dataSources");if(a&&Object.keys(a).length>0){const s=new Array;Object.keys(a).forEach((e=>{const i=a[e];pr(i,"portalUrl",$r(Gr));const o=cr(i,"itemId");if(cr(i,"url")){if(o){const e=i.url.substr(i.url.lastIndexOf("/")+1);Pn(e.toString(),o,i.url,n),i.itemId=Jr(o,o,".layer"+e+".itemId")}const e=ba(i.url,r,[],[],t);s.push(new Promise(((t,r)=>{va(e.serviceRequests,e.requestUrls,e.testString).then((e=>{i.url=e,t()}),(e=>r(sr(e))))})))}else o&&(i.itemId=Jr(o,o,".itemId"))})),Promise.all(s).then((()=>i(e)),(e=>o(sr(e))))}else i(e)}))}(e,r,o,n).then((()=>{ya(e,r,o,"data.widgetPool.widgets").then((e=>{ya(e,r,o,"data.widgetOnScreen.widgets",!0).then((e=>{(function(e,t,r,n){return new Promise(((i,o)=>{let a=cr(e,n),s=[],u=[];if(a){cr(a,"icon")&&Ia(a,["icon"],$r(Gr));const e=ba(JSON.stringify(a),r,u,s,t);a=JSON.parse(e.testString),s=e.serviceRequests,u=e.requestUrls}s.length>0?va(s,u,JSON.stringify(a)).then((t=>{pr(e,n,JSON.parse(t)),i(e)}),(e=>o(sr(e)))):i(e)}))})(e,r,o,"data.values").then((e=>{t(e)}),(e=>i(sr(e))))}),(e=>i(sr(e))))}),(e=>i(sr(e))))}),(e=>i(sr(e))))}))}(o,0,r,n));break;case"Workforce Project":d=function(e,t,r,n){return function(e,t,r){return new Promise(((n,i)=>{const o=yi(1),a=e.data;a?function(e,t,r){return new Promise(((n,i)=>{const o=[];if(t.forEach((t=>{const r=cr(e,t+".serviceItemId"),n=cr(e,t);r?-1===o.indexOf(r)&&o.push(r):lr(n,o)})),cr(e,"assignmentIntegrations")){let t=[],a=[];e.assignmentIntegrations.forEach((e=>{e.assignmentTypes&&Object.keys(e.assignmentTypes).forEach((n=>{const i=e.assignmentTypes[n].urlTemplate;lr(i,o);const s=vi(i,r);Array.isArray(s.requests)&&s.requests.length>0&&(t=t.concat(s.requests),a=a.concat(s.urls))}))})),t.length>0?Promise.all(t).then((e=>{const t={};Array.isArray(e)&&e.forEach(((e,r)=>{e.serviceItemId&&(t[a[r]]=e.serviceItemId,-1===o.indexOf(e.serviceItemId)&&o.push(e.serviceItemId))})),n({dependencies:o,urlHash:t})}),(e=>i(sr(e)))):n({dependencies:o,urlHash:{}})}else n({dependencies:o,urlHash:{}})}))}(a,o,t).then((t=>{e.dependencies=t.dependencies,e.data=function(e,t,r,n){return t.forEach((t=>{if(cr(e,t))if(cr(e[t],"serviceItemId")){const r=e[t].serviceItemId;let i=".itemId";if(cr(e[t],"url")){const o=mi(e[t].url);Pn(o,r,e[t].url,n),e[t].url=Jr(r,r,hi(o,".url")),i=hi(o,i)}e[t].serviceItemId=Jr(r,r,i)}else e[t]=Jr(e[t],e[t],".itemId")})),e.folderId="{{folderId}}",(e.assignmentIntegrations||[]).forEach((e=>{fi(e,r),e.assignmentTypes&&Object.keys(e.assignmentTypes).forEach((t=>{fi(e.assignmentTypes[t],r)}))})),e}(a,o,t.urlHash,r),n(e)}),(e=>i(sr(e)))):n(e)}))}(e,r,n)}(o,0,r,n)}d.then(t,(e=>i(sr(e))))}))}))}function Ja(e,t,r,n){return Ka(e,0,r,n)}function Za(e,t,r,n){return Oa(e,t,r,n)}function Ya(e,t,r){switch(r){case"Web Mapping Application":!function(e,t){const r=cr(e,"data.dataSource.dataSources");r&&Object.keys(r).length>0&&(Object.keys(r).forEach((e=>{const n=r[e];r[e]=Sa(n,t)})),pr(e,"data.dataSource.dataSources",r)),["data.widgetPool.widgets","data.widgetOnScreen.widgets"].forEach((r=>{const n=cr(e,r);n&&pr(e,r,function(e,t){const r=["SmartEditor","Screening"];return e.map((e=>{if(e.config){const n=r.indexOf(e.name)>-1;e.config=Sa(e.config,t,n)}return e}))}(n,t))}));const n=cr(e,"data.values");n&&pr(e,"data.values",Sa(n,t))}(e,t);break;case"Dashboard":!function(e,t){const r=["data.desktopView.header","data.desktopView.headerPanel.selectors","data.desktopView.leftPanel.selectors","data.desktopView.sidebar","data.desktopView.urlParameters","data.desktopView.widgets","data.header","data.headerPanel.selectors","data.leftPanel.selectors","data.mobileView.header","data.mobileView.headerPanel.selectors","data.mobileView.leftPanel.selectors","data.mobileView.sidebar","data.mobileView.urlParameters","data.mobileView.widgets","data.sidebar","data.urlParameters","data.widgets"];r.forEach((r=>{!function(e,t){e&&Array.isArray(e)&&e.forEach((e=>{Array.isArray(e.datasets)&&e.datasets.forEach((r=>{const n=hr(cr(r,"dataSource.itemId"));if(n){const i=gr(cr(r,"dataSource.layerId"));t.some((t=>t.itemId===n&&t.layerId===i&&(ga(t,e.id),!0)))}else{const n=cr(r,"dataSource.id");if(n){const r=n.split("#")[1];t.some((t=>t.ids.indexOf(r)>-1&&(ga(t,e.id),!0)))}}}))}))}(cr(e,r),t)})),r.forEach((r=>{!function(e,t,r){const n=cr(e,t);n&&pr(e,t,function(e,t){return Array.isArray(e)?e.map((e=>{let r=e;return Array.isArray(r.events)&&(r.events=r.events.map((e=>{const r=e;return Array.isArray(r.actions)&&(r.actions=r.actions.map((e=>{const r=e;if(r.fieldMap&&r.targetId&&r.targetId.indexOf("#")>-1){const e=ha(r,t);if(e){const t=cr(e,"fields"),n=cr(e,"basePath");Array.isArray(t)&&n&&(r.fieldMap=r.fieldMap.map((e=>{const r=e;return r.targetName=Zr(r.targetName,t,n),r})))}}return r}))),r}))),Array.isArray(r.datasets)?(r.datasets=r.datasets.map((e=>{let n=e;if("serviceDataset"===n.type){const i=ha(e,t);if(i){const e=cr(i,"fields"),t=cr(i,"basePath");Array.isArray(e)&&t&&(r=Zr(r,e,t),n=Zr(n,e,t))}}return n})),r):r})):e}(n,r))}(e,r,t)}))}(e,t);break;case"Web Map":!function(e,t){["data.operationalLayers","data.tables","data.applicationProperties.viewing.search.layers"].forEach((r=>function(e,t,r){const n=cr(e,r);n&&pr(e,r,function(e,t){return e.forEach((e=>{const r=function(e,t){let r;return t.some((t=>t.ids.indexOf(e.id)>-1&&(r=t,!0))),r}(e,t);if(r){const t=r.fields.map((e=>e.name));Kn(e,r,r.basePath,r.itemId,t),Qn(e,r.basePath,t),e.layerDefinition&&(ri(e.layerDefinition,r.basePath,t),ei(e.layerDefinition,r.basePath,t));const n=cr(e,"field.name");n&&pr(e,"field.name",Yn(n,e,r.itemId,r.basePath))}})),e}(n,t))}(e,t,r)))}(e,t)}return e}function Xa(e,t,r,n,i,o,a){return Wi(e,o,a)}function Qa(e,t,r,n){return Ja(e,0,r,n)}function es(e){return!!cr(e,"properties.services")}const ts=function(e){const t=ir(e),r=(e,t)=>(e&&e[t]&&(e[t]=encodeURIComponent(e[t])),e);[["header","content"],["subHeader","content"],["footer","content"],["settings","thankYouScreenContent"]].forEach((([e,n])=>r(t[e],n)));const n=e=>r(e,"description");return t.questions=(t.questions||[]).map((e=>e.questions?{...e,questions:e.questions.map(n)}:n(e))),t};function rs(e,t,r,n){const i=Kr(e,t),{survey123Url:o}=t;return function(e,t,r){const{item:{title:n,description:i,tags:o,typeKeywords:a},properties:{form:s}}=e,{user:{username:u},portalBaseUrl:c,organization:{basemapGalleryGroupQuery:l,defaultBasemap:{title:d}}}=t,{token:p}=r.toCredential();return function(e,t,r){return zi(e,r,{num:1}).then((({results:[e]})=>{if(!e)throw new Error("No basemap group found");return Ui(e.id,`title:${t}`,r,{num:1})})).then((({results:[e]})=>{if(!e)throw new Error("No basemap found");return e}))}(l,d,r).then((e=>{const r="Survey-",l=mr(`${r}${n}`,t,"user.folders").replace(r,"");if(s.questions){const t=t=>(t.maps&&(t.maps=t.maps.map((t=>({...t,itemId:e.id})))),t);s.questions=s.questions.map((e=>e.questions?{...e,questions:e.questions.map(t)}:t(e)))}const d=ts(s);return{description:i,form:d,portalUrl:c,tags:o,title:l,token:p,typeKeywords:a,username:u}}))}(i,t,r).then((e=>function(e,t="https://survey123.arcgis.com"){const r=`${t}/api/survey/create`,n={credentials:"same-origin",method:"POST",body:(0,we.b)({f:"json",...e},!0)};return fetch(r,n).then((e=>e.json())).then((e=>{if(!e.success)throw new Error(`Failed to create survey: ${e.error.message}`);return{formId:e.id,featureServiceId:e.featureService.source.itemId,folderId:e.formItemInfo.ownerFolder}}))}(e,o))).then((o=>{const{formId:a,featureServiceId:s}=o;let u=Promise.resolve(null);return e.item.thumbnail&&(u=Bi({id:a},null,r,e.item.thumbnail)),u.then((()=>un(a,r))).then((r=>(t[i.itemId]={itemId:a},t[i.properties.info.serviceInfo.itemId]={itemId:s},n(i.itemId,Fe.Finished,i.estimatedDeploymentCostFactor,a),{item:{...e,item:r,itemId:a},id:a,type:"Form",postProcess:!0})))})).catch((e=>{throw n(i.itemId,Fe.Failed,0),e}))}function ns(e,t,r,n){return es(e)?rs(e,t,r,n):Za(e,t,r,n)}async function is(e,t){const r=await Qi(e);let n=new Date;return n=new Date(n.valueOf()-864e5-1e3*n.getTimezoneOffset()*60),r.forEach((r=>{if("string"==typeof r.content){const i=ls(r,t);e.file(r.file,i,{date:n})}else r.file.endsWith(".xlsx")&&e.file(r.file,r.content,{date:n})})),Promise.resolve(e)}async function os(e,t){return(await Qi(e)).forEach((r=>{if(r.file.endsWith(".info")||r.file.endsWith(".itemInfo")||r.file.endsWith(".json")||r.file.endsWith(".webform")||r.file.endsWith(".xml")){let n=r.content;const i=/\b([0-9A-Fa-f]){32}_type/g;n=ss(n,t,i),n=as(n,t,i),n=us(n,t),n=cs(n,t),e.file(r.file,n)}})),Promise.resolve(e)}function as(e,t,r){let n=e;return Object.keys(t).filter((e=>e.match(r)&&"Feature Service"===t[e].type)).forEach((e=>{const r=t[e].url,i=t[r];i&&(n=n.replace(new RegExp(r,"g"),i))})),n}function ss(e,t,r){let n=e;return Object.keys(t).filter((e=>e.match(r)&&"Feature Service"!==t[e].type)).map((e=>e.replace("_type",""))).forEach((e=>{n=n.replace(new RegExp(e,"g"),`{{${e}.itemId}}`)})),n}function us(e,t){let r=e;return t.portalBaseUrl&&(r=r.replace(new RegExp(t.portalBaseUrl,"g"),"{{portalBaseUrl}}")),r}function cs(e,t){let r=e;return t.workflowBaseUrl&&(r=r.replace(new RegExp(t.workflowBaseUrl,"g"),"{{workflowBaseUrl}}")),r}function ls(e,t){let r=e.content;return r=Kr(e.content,t),er(r.match(/\b([0-9A-Fa-f]){32}\b/g)??[]).forEach((e=>{const n=t[e];"string"==typeof n?.itemId&&(r=r.replace(new RegExp(e,"g"),`${n.itemId}`))})),r}async function ds(e,t,r,n,i,o,a){const s=await cn(e,"Form",a);if(!s)return await new Promise((e=>setTimeout(e,5e3))),ds(e,t,r,n,i,o,a);{const t=await Xi(s);Fo(await is(t,o),e,a)}return es(n)?function(e,t,r,n,i,o,a){const s=n.properties.info.serviceInfo.itemId,{itemId:u}=o[s],c=Kr(n,o);return un(u,a).then((t=>{const r=[{id:e,title:c.item.title,snippet:c.item.snippet,extent:c.item.extent,culture:c.item.culture},{id:u,extent:c.item.extent,typeKeywords:[`source-${s}`].concat(t.typeKeywords)}].map((e=>$i(e,a)));return Promise.all(r).then((()=>{const t=[e,u].map((e=>Z({itemId:e,folderId:o.folderId,authentication:a})));return Promise.all(t)})).then((()=>function(e,t){return new Promise(((r,n)=>{Se({folderId:e,authentication:t}).then((e=>e.success?r(e):n(e)),n)}))}(t.ownerFolder,a))).then((()=>{const e=Br(t);return i.push(e),n.dependencies.push(t.id),!0}))}))}(e,0,0,n,i,o,a):Wi(e,o,a)}async function ps(e,t){for(const r of e)if("Form"===r.type){const e=r.data;if(r.data=null,e){let n=await Xi(e);n=await os(n,t),r.item.name=fs(r.item.name,e.name,`${r.itemId}.zip`);const i=await eo(n,r.item.name),o=Qo(r.itemId,r.item.name,Te,Xo.data),a={itemId:r.itemId,file:i,folder:o.folder,filename:r.item.name};r.dataFile=a,r.resources.push(o.folder+"/"+o.filename)}}return Promise.resolve(e)}function fs(e,t,r){const n=e||t;return n&&"undefined"!==n?n:r}function ms(e,t,r){return new Promise((t=>{const n=function(e){const t=Wr(e.id,e.type);return t.item={...t.item,description:e.description,snippet:e.snippet,tags:e.tags,typeKeywords:e.typeKeywords,title:e.title,thumbnail:e.thumbnail},t}(e);n.item.id=Jr(n.item.id,n.item.id,".itemId"),sn(e.id,r).then((i=>{var o,a;n.type="Group",(o=e.id,a=r,xe(o,{authentication:a})).then((e=>{e.id=n.item.id,n.item={...e,type:"Group"},n.dependencies=i.concat(function(e){if(e){const t="group.";return e.filter((e=>e.startsWith(t))).map((e=>e.substring(t.length)))}return[]}(e.tags)),t(n)}),(()=>t(n)))}),(()=>t(n)))}))}function hs(e,t,r,n){return new Promise((i=>{if(!n(e.itemId,Fe.Started,0))return n(e.itemId,Fe.Ignored,0),void i(tr(e.type));let o=ir(e);o=Kr(o,t),o.item.thumbnail=e.item.thumbnail;const a=ys(o.item);Ci(a.title,a,t,r,kn(o)?t.locationTracking.owner:void 0).then((a=>{if(a.success)if(n(e.itemId,Fe.Created,e.estimatedDeploymentCostFactor/2,a.group.id))if(o.itemId=a.group.id,t[e.itemId]={itemId:a.group.id},o=Kr(o,t),t[e.itemId].itemId=a.group.id,n(e.itemId,Fe.Finished,e.estimatedDeploymentCostFactor/2,a.group.id))if(kn(o)){const s=t.locationTracking.owner;(function(e,t,r){const n={authentication:r,params:{targetUsername:t}};return ke(`${r.portal}/community/groups/${e}/reassign`,n)})(a.group.id,s,r).then((t=>{var s,u,c;t.success?n(e.itemId,Fe.Created,e.estimatedDeploymentCostFactor/2,a.group.id)?(s=a.group.id,u=[r.username],c=r,te({id:s,users:u,authentication:c})).then((t=>{Array.isArray(t.notRemoved)&&0===t.notRemoved.length?n(e.itemId,Fe.Created,e.estimatedDeploymentCostFactor/2,a.group.id)?i({item:o,id:a.group.id,type:o.type,postProcess:qr(o)}):(n(e.itemId,Fe.Cancelled,0),Di(a.group.id,r).then((()=>i(tr(e.type))),(()=>i(tr(e.type))))):(n(e.itemId,Fe.Failed,0),i(tr(e.type)))})):(n(e.itemId,Fe.Cancelled,0),Di(a.group.id,r).then((()=>i(tr(e.type))),(()=>i(tr(e.type))))):(n(e.itemId,Fe.Failed,0),i(tr(e.type)))}))}else i({item:o,id:a.group.id,type:o.type,postProcess:qr(o)});else n(e.itemId,Fe.Cancelled,0),Di(a.group.id,r).then((()=>i(tr(e.type))),(()=>i(tr(e.type))));else n(e.itemId,Fe.Cancelled,0),Di(a.group.id,r).then((()=>i(tr(e.type))),(()=>i(tr(e.type))));else n(e.itemId,Fe.Failed,0),i(tr(e.type))}),(()=>{n(e.itemId,Fe.Failed,0),i(tr(e.type))}))}))}function gs(e,t,r,n,i,o,a){let s=Promise.resolve({success:!0});return r.some((t=>{if(t.id===e){let e=t.item.item;return qr(e)&&(e=Kr(e,o),s=function(e,t){return new Promise(((r,n)=>{var i;(i={group:e,authentication:t,params:{}},function(e){var t=(0,R.e)(e)+"/community/groups/"+e.group.id+"/update";return e.params=(0,O.Cl)((0,O.Cl)({},e.params),e.group),(0,C.Em)(t,e)}(i)).then((e=>e.success?r(e):n(e)),(e=>n(e)))}))}(e,a)),!0}})),s}function ys(e){const t={access:"private",description:e.description,owner:e.owner,snippet:e.snippet,tags:e.tags,thumbnail:e.thumbnail,title:e.title||"",typeKeywords:e.typeKeywords};return["autoJoin","displaySettings","isInvitationOnly","isOpenData","isViewOnly","membershipAccess","properties","sortField","sortOrder"].forEach((r=>{e.hasOwnProperty(r)&&(t[r]=e[r])})),t}function vs(e){let t=e;return t=t.replace(/^[0-9]*/g,""),t=t.replace(/[^\w\s]/g,""),t=function(e){return(e=(e=e.toLowerCase()).replace(/[`~!@#$%^&*()_|+\-=?;:'",.<>\{\}\[\]\\\/]/gi," ")).replace(/(\-|\_|\.|\s)+(.)?/g,(function(e,t,r){return r?r.toUpperCase():""})).replace(/(^|\/)([A-Z])/g,(function(e,t,r){return e.toLowerCase()}))}(t),t}const bs=["id","isOrgItem","proxyFilter","ownerFolder","protected","owner","created","modified","guid","name","access","size","listed","numComments","numRatings","avgRating","numViews","scoreCompleteness","groupDesignations","listed","screenshots","banner","appCategories","industries","languages","largeThumbnail"];function ws(e){const t=je(e);return bs.forEach((e=>{delete t[e]})),t.extent="{{organization.defaultExtentBBox}}",t}function Is(e,t,r="{{appid}}"){return $o(je(e),new RegExp(t,"g"),r)}const xs=(e,t,r)=>{const{id:n,access:i}=e,o=`${Po(t)}/content/items/${n}`,a=new URLSearchParams({f:"json"});return"public"!==i&&r&&a.append("token",r),`${o}?${a.toString()}`};function _s(e,t){const r=`${Po(t.portalSelf)}/content/items/${e.id}`,n=function(e,t){if(!e||!e.thumbnail)return null;let{token:r,width:n}={};const i=xs(e,t,r),[o,a]=i.split("?"),s=new URLSearchParams(a);s.delete("f"),n&&s.append("w",n+"");const u=s.toString(),c=`${o}/info/${e.thumbnail}`;return u?`${c}?${u}`:c}(e,t),i=[];return n&&i.push({name:e.thumbnail,url:n,type:"thumbnail"}),(0,N.JA)(e.id,t).then((e=>{const t=e.resources.map((e=>({name:e.resource,type:"resource",url:`${r}/resources/${e.resource}`})));return i.concat(t)}))}function ks(e){let t="Hub Page";return e&&(t="Site Page"),t}const Ss={"event-list-card":function(e){return e.component.settings.initiativeIds=["{{initiative.item.id}}"],{card:e,assets:[]}},"follow-initiative-card":function(e){return e.component.settings.initiativeId="{{initiative.item.id}}",{card:e,assets:[]}},"items/gallery-card":function(e){const t=e.component.settings,r=ho(t,"version");return ho(t,"groups")&&r<4&&(t.groups=[{title:"{{solution.title}}",id:"{{teams.contentGroupId}}"}]),ho(t,"query.groups")&&(t.query.groups=r>=4?["{{teams.contentGroupId}}"]:[{title:"{{solution.title}}",id:"{{teams.contentGroupId}}"}]),ho(t,"query.orgId")&&(t.query.orgId="{{organization.id}}"),ho(t,"orgId")&&(t.orgId="{{organization.id}}"),t.siteId&&(t.siteId="{{appid}}"),{card:e,assets:[]}},"image-card":Es,"jumbotron-card":Es};function Es(e){const t={card:e,assets:[]};return ho(e,"component.settings.fileSrc")&&t.assets.push(e.component.settings.fileSrc),ho(e,"component.settings.cropSrc")&&t.assets.push(e.component.settings.cropSrc),t}function As(e,t){const r=function(e){const t=je(e),r=Ss[t.component.name];return r?r(t):{card:t,assets:[]}}(t);return e.assets=e.assets.concat(r.assets),e.cards.push(r.card),e}function Ps(e,t){const{assets:r,cards:n}=function(e){return e.cards.reduce(As,{assets:[],cards:[]})}(t);return e.assets.push(...r),e.rows.push({cards:n}),e}function Os(e){if(!e)return null;const t=e.sections.reduce(((e,t)=>{const r=function(e){const{rows:t,assets:r}=e.rows.reduce(Ps,{assets:[],rows:[]}),n={section:je(e),assets:r};return n.section.rows=t,ho(e,"style.background.fileSrc")&&n.assets.push(...function(e){const t=[];return e.fileSrc&&t.push(e.fileSrc),e.cropSrc&&t.push(e.cropSrc),t}(e.style.background)),n}(t);return e.assets=e.assets.concat(r.assets),e.sections.push(r.section),e}),{assets:[],sections:[]}),r={assets:t.assets,layout:{sections:t.sections}};return e.header&&(r.layout.header=je(e.header)),e.footer&&(r.layout.footer=je(e.footer)),r}function Ts(e){return e.rows.reduce(((e,t)=>e.concat(function(e){return e.cards.reduce(((e,t)=>{const r=function(e){return function(e){switch(e){case"webmap-card":return["component.settings.webmap"];case"survey-card":return["component.settings.surveyId"];case"app-card":case"summary-statistic-card":return["component.settings.itemId"];case"items/gallery-card":return["component.settings.ids"];default:return[]}}(ho(e,"component.name")).reduce(function(e){return(t,r)=>{const n=ho(e,r);return n?Array.isArray(n)?t.concat(n):t.concat([n]):t}}(e),[])}(t);return r.length&&(e=e.concat(r)),e}),[])}(t))),[])}function Cs(e){const t=(ho(e,"data.values.pages")||[]).map((e=>e.id));return(ho(e,"data.values.layout")||{}).sections.reduce(((e,t)=>e.concat(Ts(t))),[]).concat(t)}const Rs=/^draft-(\d+).json$/;function Ms(e,t){let r=e.assets||e.resources||[];if(e.bundleItemId){const n=`${Po(t.portalSelf)}/content/items/${e.bundleItemId}`,i=e.itemId;r=r.map((e=>({name:e.name,type:e.type||"resource",url:`${n}/resources/${i}-${e.name}`})))}return r}function Fs(e,t,r){return jr(e,t,r)}function Ds(e,t,r={},n=!1){const i=t.split(".");let o=e;const a=i.length-1;i.forEach(((e,t)=>{o.hasOwnProperty(e)&&null!=o[e]?t===a&&("object"!=typeof o[e]||Array.isArray(o[e])?o[e]=r:o[e]=n?je(r):Object.assign(o[e],je(r))):o[e]=t===a?r:{},o=o[e]}))}function js(e){return"string"==typeof e?e.trim().toLowerCase().replace(/ +/g,"-").replace(/[^\w-]/g,"").replace(/-+/g,"-"):e}function Gs(e,t={}){return t.credentials||(t.credentials="same-origin"),fetch(e,t).then((e=>e.blob()))}function zs(e,t){let r=e;return-1===e.indexOf("token")&&e.indexOf(t.authentication.portal)>-1&&(r=`${e}?token=${t.authentication.token}`),r}function Ls(e,t,r){if(Array.isArray(t)){const n=t.reduce(((t,n)=>{if(n.url){const i={id:e.item.id,owner:e.item.owner,fileName:n.name,url:zs(n.url,r),authentication:r.authentication};"thumbnail"===n.type?t.push(function(e){return Gs(e.url).then((t=>J({item:{id:e.id,owner:e.owner},params:{fileName:e.fileName,thumbnail:t},authentication:e.authentication}).catch((e=>Promise.resolve())))).catch((e=>Promise.resolve()))}(i)):t.push(function(e){return Gs(e.url).then((t=>z({id:e.id,owner:e.owner,name:e.fileName,resource:t,authentication:e.authentication})))}(i))}return t}),[]);return Promise.all(n)}return Promise.resolve([])}const Ns="hubPage";function Us(e,t){return-1!==e.indexOf(t)}async function $s(e,t,r,n){const i=li.bind(void 0,Object.assign({q:`id:(${t.join(" OR ")})`,num:t.length},r)),o=e=>e.results.length===t.length;let a;try{({results:a}=t.length?await async function(e,t,r){const n=e=>!isNaN(e)&&e>0,i=n(void 0)?r.maxAttempts:7,o=n(void 0)?r.initialRetryDelay:500;return async function r(n,a){if(n>i)throw new Error(`Polling failed after ${i} attempts`);const s=await new Promise((t=>{setTimeout((async()=>{const r=await e();t(r)}),a)}));return t(s)?s:await r(n+1,1===n?o:2*a)}(1,0)}(i,o):{results:[]})}catch(r){throw new Error(`Error sharing item: ${e} with groups: ${t.join(", ")}`)}return Promise.all(a.map((async t=>{const i=Object.assign(Object.assign({},r),{id:e,groupId:t.id,owner:n,confirmItemControl:t.capabilities.includes("updateitemcontrol")});try{return await ie(i)}catch(r){throw new Error(`Error sharing item: ${e} with group: ${t.id}`)}})))}var Bs;function Ws(e){let t=[];const r=[];let n,i;const o={authentication:e.authentication};return Promise.all([yo("page",e),yo("site",e)]).then((a=>{if([n,i]=a,i.isMissing||n.isMissing){let e=`The Page item (${n.item.id}) is inaccessible.`;throw i.isMissing&&(e=n.isMissing?`Both the Page item (${n.item.id}) and the Site item (${i.item.id}) are inaccssible`:`The Site item (${i.item.id}) is inaccessible.`),new Error(`Linking Failed: ${e}`)}{if("Hub Site Application"!==function(e={}){let t=e.type;const r=e.typeKeywords||[];return function(e,t=[]){return"Site Application"===e||"Hub Site Application"===e||"Web Mapping Application"===e&&t.includes("hubSite")}(e.type,r)&&(t="Hub Site Application"),("Site Page"===e.type||"Web Mapping Application"===e.type&&Us(r,"hubPage"))&&(t="Hub Page"),"Hub Initiative"===e.type&&Us(r,"hubInitiativeTemplate")&&(t="Hub Initiative Template"),"Web Mapping Application"===e.type&&Us(r,"hubSolutionTemplate")&&(t="Solution"),t}(i.item)||!Us(["Hub Page","Site Page"],n.item.type))return Promise.resolve([]);const a={id:i.item.id,title:i.item.title};if(ho(n,"data.values.sites")||Ds(n,"data.values.sites",[]),!Us(ho(n,"data.values.sites").map((e=>e.id)),a.id)){n.data.values.sites.push(a);const e=Object.assign({item:bo(n)},o);r.push(J(e))}const s={id:n.item.id,title:n.item.title};ho(i,"data.values.pages")||Ds(i,"data.values.pages",[]);const u=ho(i,"data.values.pages");if(!Us(u.map((e=>e.id)),s.id)){const t=mo("slug",u);s.slug=e.pageSlug||function(e,t){let r=!1,n=0,i=t;for(;!r;)Us(e,i)?(n++,i=`${t}-${n}`):r=!0;return i}(t,js(s.title)),i.data.values.pages.push(s);const n=Object.assign({item:bo(i)},o);r.push(J(n))}t=Le(ho(i,"item.properties.collaborationGroupId"),t),t=Le(ho(i,"item.properties.contentGroupId"),t);const c=(0,po.M)($s);return r.push(c(s.id,t,o)),Promise.all(r)}})).then((()=>({pageModel:n,siteModel:i}))).catch((e=>{throw Error(`Error occured linking site ${i.item.id} with ${n.item.id}: ${e}`)}))}function Vs(e,t){let r,n=Promise.resolve(e);return"string"==typeof e&&(n=lo(e,t)),n.then((e=>{r=e;const n=mo("id",go(r,"data.values.sites",[])),i=(0,po.M)(xo);return Promise.all(n.map((e=>{const n=Object.assign({pageModel:r,siteId:e},t);return i(n)})))})).then((()=>function(e,t){return e.item.protected?ce(Object.assign({id:e.item.id},t)):Promise.resolve({success:!0})}(r,t))).then((()=>B(Object.assign({id:r.item.id},t))))}function qs(e,t,r){return Array.isArray(r)&&r.length?(r.forEach((r=>{void 0!==ho(e,r)&&Ds(t,r,ho(e,r))})),t):e}function Hs(e){const t=je(e);return(e.dependencies||[]).forEach((r=>{const n=new RegExp(r,"g"),i=`{{${r}.itemId}}`;t.item=$o(t.item,n,i),t.data=$o(t.data,n,i),e.properties&&(t.properties=$o(t.properties,n,i))})),t}function Ks(e,t,r){const n=(0,po.M)(Z,{success:!0}),i=[n({itemId:e.item.id,folderId:t,authentication:r})];return ho(e,"item.properties.parentInitiativeId")&&i.push(n({itemId:e.item.properties.parentInitiativeId,folderId:t,authentication:r})),Promise.all(i)}function Js(e,t,r=null){let n=0,i=0;return Promise.all([lo(e.id,{authentication:t}),ao(t)]).then((([e,t])=>(n=e.item.created,i=e.item.modified,function(e,t){const r=je(e);r.type=ks(t.isPortal),r.key=`${vs(e.item.title)}_${ze("i")}`,r.itemId=e.item.id,r.item=ws(r.item),r.data.values.sites=[],["source","updatedAt","updatedBy","folderId","slug"].forEach((e=>{delete r.data.values[e]}));const n=Os(r.data.values.layout);return r.data.values.layout=n.layout,r.dependencies=Cs(e),r.data=Is(r.data,r.itemId),r.item.properties||(r.item.properties={}),_s(e.item,t).then((e=>(r.assets=e.filter((e=>-1===e.name.search(Rs))),r)))}(e,t)))).then((e=>(e.item.created=n,e.item.modified=i,e.item.typeKeywords=Ge(e.item.typeKeywords,"doNotDelete"),e.groups=[],e.estimatedDeploymentCostFactor=2,e.resources=[],ho(e,"properties")||(e.properties={}),Hs(e))))}function Zs(e,t,r,n){if(!n(e.itemId,Fe.Started,0))return Promise.resolve(tr(e.type));if(e.assets&&e.resources&&delete e.assets,t.solutionItemExtent){const e=t.solutionItemExtent.split(",");t.organization.defaultExtentBBox=[[e[0],e[1]],[e[2],e[3]]]}const i={};let o,a;const s=e.item.thumbnail;return ao(r,t).then((r=>(a=r,function(e,t,r,n){e.assets=Ms(e,n);const i=Fs(e,t,r);i.item.properties||(i.item.properties={});const o=ho(t,"initiative.id");return o&&Ds(i,"item.properties.parentInitiativeId",o),Ds(i,"data.values.slug",js(i.item.title)),Promise.resolve(i)}(e,t,i,a)))).then((e=>function(e,t,r){if(!r.authentication)throw new Error("createPage must be passed hubRequestOptions.authentication");const n=function(e,t){const r=je(e);return r.item.owner=t.username,r.item.access="private",r.data.values||(r.data.values={}),r.data.values.updatedAt=(new Date).toISOString(),r.data.values.updatedBy=t.username,r.data.values.sites||(r.data.values.sites=[]),r.item.url&&(r.item.url=""),r.item.type=ks(t.isPortal),-1===r.item.typeKeywords.indexOf(Ns)&&r.item.typeKeywords.push(Ns),r}(e,{username:r.authentication.username,isPortal:r.isPortal});return be({item:bo(n),owner:n.item.owner,authentication:r.authentication}).then((e=>(n.item.id=e.id,ue({id:n.item.id,owner:n.item.owner,authentication:r.authentication})))).then((e=>{let i=[];return Array.isArray(t.shareTo)&&t.shareTo.length&&(i=t.shareTo.map((e=>ie({id:n.item.id,groupId:e.id,authentication:r.authentication,confirmItemControl:e.confirmItemControl||!1}))),n.item.access="shared"),Promise.all(i)})).then((e=>{const t=go(n,"data.values.sites",[]),i={authentication:r.authentication};return Promise.all(t.map((e=>Ws(Object.assign({siteId:e.id,pageModel:n},i)))))})).then((e=>{const i=go(t,"assets",[]);return Ls(n,i,r)})).then((()=>n)).catch((e=>{throw Error(`createPage: Error creating page: ${e}`)}))}(e,{assets:e.assets||[]},a))).then((e=>(o=e,Ks(e,t.folderId,r)))).then((()=>Pe({item:{id:o.item.id},params:{thumbnail:s},authentication:r}))).then((()=>{if(t[e.itemId]={itemId:o.item.id},n(e.itemId,Fe.Finished,e.estimatedDeploymentCostFactor||2,o.item.id)){const t={item:{...e,...Qt(o)},id:o.item.id,type:e.type,postProcess:!0};return t.item.itemId=o.item.id,t}return(0,po.M)(Vs,{success:!0})(o,a).then((()=>Promise.resolve(tr(e.type))))})).catch((t=>{throw n(e.itemId,Fe.Failed,0),t}))}function Ys(e,t,r,n,i,o,a){let s;return ao(a).then((t=>(s=t,lo(e,{authentication:a})))).then((e=>function(e,t,r,n){return function(e,t){const r=Array.isArray(t.allowList)?t.allowList:[];e.data.values.updatedAt=(new Date).toISOString(),e.data.values.updatedBy=t.authentication.username,e.item.url="";let n=Promise.resolve(e);return r.length&&(n=lo(ho(e,"item.id"),t)),n.then((n=>{r.length&&(e=qs(e,n,r));const i=Object.assign({item:bo(e)},t);return i.params={clearEmptyFields:!0},J(i)}))}(e=Fs(e,r,{}),{...n,allowList:[]}).then((()=>!0))}(e,0,o,s)))}function Xs(e){let t=!1;return"Hub Page"!==e&&"Site Page"!==e||(t=!0),t}!function(e){e.Continual="continual",e.Daily="daily",e.Weekly="weekly",e.Fortnightly="fortnightly",e.Monthly="monthly",e.Quarterly="quarterly",e.Biannually="biannually",e.Annually="annually",e.AsNeeded="as-needed",e.Irregular="irregular",e.NotPlanned="not-planned",e.Unknown="unknown",e.Semimonthly="semimonthly"}(Bs||(Bs={}));const Qs=1.8;function eu(e){return"{"===e[0]&&(e=e.substring(1,e.length-1)),/^(\{){0,1}[0-9a-fA-F]{8}[-]?[0-9a-fA-F]{4}[-]?[0-9a-fA-F]{4}[-]?[0-9a-fA-F]{4}[-]?[0-9a-fA-F]{12}(\}){0,1}$/gi.test(e)}function tu(e,t,r,n=!1){Array.isArray(e)&&(e=e.join(".")),Ds(r,e,t,n)}const ru={"{{default.name}}":"{{name}}","{{default.description}}":"{{description}}","{{item.tags}}":"{{tags}}","{{item.created:toISO}}":"{{created:toISO}}","{{item.modified:toISO}}":"{{modified:toISO}}","{{default.source.source}}":"{{source}}","{{item.owner}}":"{{owner}}","{{org.portalProperties.links.contactUs.url}}":"{{orgContactEmail}}","{{org.name}}":"{{orgName}}","{{item.categories}}":"{{categories}}","{{item.licenseInfo}}":"{{licenseInfo}}","{{item.modified}}":"{{modified}}","{{enrichments.categories}}":"{{categories}}","{{default.id}}":"{{id}}","{{item.licenseInfo || No License}}":"{{licenseInfo || No License}}","{{org.portalProperties.links.contactUs.url || mailto:data@tempe.gov}}":"{{orgContactEmail || mailto:data@tempe.gov}}","{{default.description || No Description}}":"{{description || No Description}}","{{item.id}}":"{{id}}"},nu=[{capability:"hideFollow",feature:"hub:site:feature:follow",negate:!0},{capability:"disableDiscussions",feature:"hub:site:feature:discussions",negate:!0}],iu=e=>{const t={};let r={};(ho(e,"data.values.capabilities")||[]).forEach((e=>{t[e]=!0}));const n=ho(e,"data.settings.features")||{};return r=nu.reduce(((e,r)=>{const n=r.negate?!t[r.capability]:t[r.capability];return Object.assign(Object.assign({},e),{[r.feature]:n})}),n),tu("data.settings.features",r,e),e};function ou(e){return ho(e,"item.properties.schemaVersion")!==Qs&&(e=function(e){var t;if((null===(t=e.item.properties)||void 0===t?void 0:t.schemaVersion)>=1.6)return e;const r=je(e);return r.data.values.layout.sections.map((e=>Object.assign(Object.assign({},e),{rows:(e.rows||[]).map((e=>Object.assign(Object.assign({},e),{cards:(e.cards||[]).map((e=>("event-list-card"===e.component.name&&(e.component.settings.displayMode=e.component.settings.calendarEnabled?"calendar":"list",delete e.component.settings.calendarEnabled),e)))})))}))),tu("item.properties.schemaVersion",1.6,r),r}(e=function(e){if(ho(e,"item.properties.schemaVersion")>=1.5)return e;const t=je(e),r=t.data.values.dcatConfig;return t.data.feeds={},r&&(t.data.feeds.dcatUS11=function(e){let t=JSON.stringify(e);return Object.keys(ru).forEach((e=>{const r=ru[e];t=t.split(e).join(r)})),JSON.parse(t)}(r)),t.item.properties.schemaVersion=1.5,t}(e=function(e){if(ho(e,"item.properties.schemaVersion")>=1.4)return e;const t=je(e),r=ho(t,"data.values.gacode");return t.data.values.telemetry={consentNotice:{isTheme:!0,consentText:"",policyURL:""},customAnalytics:{ga:{customerTracker:{enabled:Boolean(r),id:r}}}},function(e,t){if("object"!=typeof e||null===e)return;const r=t.split(".");for(let t=0;t<r.length-1;t++){if(!e.hasOwnProperty(r[t]))return;e=e[r[t]]}delete e[r[r.length-1]]}(t,"data.values.gacode"),tu("item.properties.schemaVersion",1.4,t),t}(e=function(e){if(ho(e,"item.properties.schemaVersion")>=1.3)return e;const t=je(e),r=ho(t,"data.catalog.groups")||[];return t.data.catalog.groups=r.filter(eu),t.item.properties.schemaVersion=1.3,t}(e=function(e){if(ho(e,"item.properties.schemaVersion")>=1.2)return e;const t=je(e),r=ho(t,"data.catalog")||{};return ho(t,"data.values.groups")&&(r.groups=je(t.data.values.groups),delete t.data.values.groups),t.data.catalog=r,t.item.properties.schemaVersion=1.2,t}(e=function(e){if(ho(e,"item.properties.schemaVersion")>=1.1)return e;const t=je(e);return["subdomain","defaultHostname","internalUrl","customHostname","externalUrl"].forEach((e=>{t.data.values[e]&&"string"==typeof t.data.values[e]&&(t.data.values[e]=t.data.values[e].toLowerCase())})),t.item.properties.schemaVersion=1.1,t}(e=function(e){if(ho(e,"item.properties.schemaVersion")>=1)return e;const t=je(e);if(["groupId","title"].forEach((e=>{delete t.data.values[e]})),t.item.properties||(t.item.properties={}),t.item.properties.schemaVersion=1,t.data.values.groups&&Array.isArray(t.data.values.groups)){const e=t.data.values.groups.map((e=>"object"==typeof e?e.id:e)).filter((e=>!!e));t.data.values.groups=e}return t}(e))))))),e=function(e){if(ho(e,"item.properties.schemaVersion")>=1.8)return e;const t=je(e);t.data.telemetry={};const r=(ho(e,"data.values.capabilities")||[]).includes("consentNotice");t.data.telemetry.consentNotice={allowPrivacyConfig:r,disclaimer:[{text:ho(e,"data.values.telemetry.consentNotice.consentText")||"",default:!0}],policyURL:ho(e,"data.values.telemetry.consentNotice.policyURL")||""};const n=ho(e,"item.properties.telemetry.plugins");return n&&(t.data.telemetry.plugins=n),tu("item.properties.schemaVersion",1.8,t),t}(e=iu(e))),function(e){const t=je(e),r=ho(e,"data.values.capabilities");return r&&(t.data.values.capabilities=r.filter((e=>"underlinedLinks"!==e))),t}(e=function(e){const t="Web Mapping Application"===ho(e,"item.type"),r=go(e,"item.typeKeywords",[]).includes("hubSite");return t&&r&&(e.item.type="Hub Site Application"),e}(e=function(e){if(ho(e,"data.telemetry"))return e;const t=je(e);return t.data.telemetry={},t}(e=function(e){if(ho(e,"data.values.map.basemaps"))return e;if(ho(e,"data.values.map.baseMapLayers")){const t=je(e),r=ho(e,"data.values.map.baseMapLayers"),n=ho(e,"data.values.map.title");return delete t.data.values.map.baseMapLayers,delete t.data.values.map.title,t.data.values.map.basemaps={primary:{baseMapLayers:r,title:n}},t}return e}(e))))}function au(e,t){return lo(e,t).then(ou)}function su(e){let t="Hub Site Application";return e&&(t="Site Application"),t}function uu(e){let t=ho(e,"portalProperties.hub.enabled")?"premium":"basic";return e.isPortal&&"singletenant"===e.portalMode&&(t="portal"),t}function cu(e){return Object.keys(e).forEach((t=>{e[t]&&"object"==typeof e[t]?cu(e[t]):null==e[t]&&delete e[t]})),e}const lu={header:{background:"#fff",text:"#4c4c4c"},body:{background:"#fff",text:"#4c4c4c",link:"#0079c1"},button:{background:"#0079c1",text:"#fff"},logo:{small:""},fonts:{base:{url:"",family:"Avenir Next"},heading:{url:"",family:"Avenir Next"}}};function du(e){let t=je(lu),r=ho(e,"portalProperties.sharedTheme");return r&&(r=cu(r),t=Ue(t,r)),t}function pu(e){return(e=e.toLowerCase()).includes("//")&&(e=e.split("//")[1]),e}const fu=e=>go(e,"subscriptionInfo.type","Enterprise"),mu=["ar","bs","ca","cs","da","de","en","es","et","el","fi","fr","hr","he","hu","it","id","ja","ko","lt","lv","nb","nl","pl","pt","pt-br","pt-pt","ro","ru","sl","sr","sv","th","tr","uk","vi","zh","zh-cn","zh-tw","zh-hk"],hu={devext:"https://d1011m9qpnz5mw.cloudfront.net",qaext:"https://dyq9ux9ryu4qj.cloudfront.net",www:"https://d1iq7pbacwn5rb.cloudfront.net"};const gu=[{config:{groupType:"Hub Collaboration Group",type:"core",availableIn:["premium"],propertyName:"collaborationGroupId",requiredPrivs:["portal:admin:createUpdateCapableGroup"],titleI18n:"collaborationTitle",descriptionI18n:"collaborationDesc",snippetI18n:"collaborationSnippet",privPropValues:[{priv:"portal:user:addExternalMembersToGroup",prop:"membershipAccess",value:"collaboration"}]},access:"org",autoJoin:!1,isInvitationOnly:!1,isViewOnly:!1,sortField:"modified",sortOrder:"desc",capabilities:"updateitemcontrol",membershipAccess:"org",_edit_privacy:"on",_edit_contributors:"on",tags:["Hub Group","Hub Initiative Group","Hub Site Group","Hub Core Team Group","Hub Team Group"]},{config:{groupType:"Hub Collaboration Group",type:"core",availableIn:["basic"],propertyName:"collaborationGroupId",requiredPrivs:["portal:admin:createUpdateCapableGroup"],titleI18n:"collaborationTitleBasic",descriptionI18n:"collaborationDescBasic",snippetI18n:"collaborationSnippetBasic",privPropValues:[{priv:"portal:user:addExternalMembersToGroup",prop:"membershipAccess",value:"collaboration"}]},access:"org",autoJoin:!1,isInvitationOnly:!1,isViewOnly:!1,sortField:"modified",sortOrder:"desc",capabilities:"updateitemcontrol",membershipAccess:"org",_edit_privacy:"on",_edit_contributors:"on",tags:["Hub Group","Hub Site Group","Hub Core Team Group","Hub Team Group"]},{config:{groupType:"Portal Collaboration Group",type:"core",availableIn:["portal"],propertyName:"collaborationGroupId",requiredPrivs:["portal:user:createGroup","portal:admin:createUpdateCapableGroup"],titleI18n:"collaborationTitlePortal",descriptionI18n:"collaborationDescPortal",snippetI18n:"collaborationSnippetPortal"},access:"org",autoJoin:!1,isInvitationOnly:!1,isViewOnly:!1,sortField:"modified",sortOrder:"desc",capabilities:"updateitemcontrol",_edit_privacy:"on",_edit_contributors:"on",tags:["Sites Group","Sites Core Team Group"]},{config:{groupType:"Hub Content Group",type:"content",availableIn:["premium"],propertyName:"contentGroupId",requiredPrivs:["portal:user:createGroup"],titleI18n:"contentTitle",descriptionI18n:"contentDesc",snippetI18n:"contentSnippet",privPropValues:[{priv:"portal:user:addExternalMembersToGroup",prop:"membershipAccess",value:""}]},access:"public",autoJoin:!1,isInvitationOnly:!1,isViewOnly:!1,sortField:"modified",sortOrder:"desc",membershipAccess:"org",tags:["Hub Group","Hub Content Group","Hub Site Group","Hub Initiative Group"]},{config:{groupType:"Hub Content Group",type:"content",availableIn:["basic"],propertyName:"contentGroupId",requiredPrivs:["portal:user:createGroup"],titleI18n:"contentTitleBasic",descriptionI18n:"contentDescBasic",snippetI18n:"contentSnippetBasic",privPropValues:[{priv:"portal:user:addExternalMembersToGroup",prop:"membershipAccess",value:""}]},access:"public",autoJoin:!1,isInvitationOnly:!1,isViewOnly:!1,sortField:"modified",sortOrder:"desc",membershipAccess:"org",tags:["Hub Group","Hub Content Group","Hub Site Group"]},{config:{groupType:"Portal Content Group",type:"content",availableIn:["portal"],propertyName:"contentGroupId",requiredPrivs:["portal:user:createGroup"],titleI18n:"contentTitle",descriptionI18n:"contentDescPortal",snippetI18n:"contentSnippetPortal"},access:"org",autoJoin:!1,isInvitationOnly:!1,isViewOnly:!1,sortField:"modified",sortOrder:"desc",tags:["Sites Group","Sites Content Group"]},{config:{groupType:"Hub Followers Group",type:"followers",availableIn:["premium"],propertyName:"followersGroupId",requiredPrivs:["portal:user:createGroup"],titleI18n:"followersTitle",descriptionI18n:"followersDesc",snippetI18n:"followersSnippet",privPropValues:[{priv:"portal:user:addExternalMembersToGroup",prop:"membershipAccess",value:""}]},access:"public",autoJoin:!0,isInvitationOnly:!1,isViewOnly:!0,notificationsEnabled:!0,sortField:"title",sortOrder:"asc",membershipAccess:"org",tags:["Hub Group","Hub Initiative Followers Group","Hub Initiative Group"]},{config:{groupType:"Generic AGO Site Team",type:"team",availableIn:["basic"],requiredPrivs:["portal:user:createGroup"],titleI18n:"teamTitle",descriptionI18n:"teamDesc",snippetI18n:"teamSnippet"},access:"org",autoJoin:!1,isInvitationOnly:!1,isViewOnly:!1,sortField:"modified",sortOrder:"desc",tags:["Site Team Group"]},{config:{groupType:"Generic AGO Initiative Team",type:"team",availableIn:["premium"],requiredPrivs:["portal:user:createGroup","portal:user:addExternalMembersToGroup"],titleI18n:"teamTitle",descriptionI18n:"teamDesc",snippetI18n:"teamSnippet"},access:"org",autoJoin:!1,isInvitationOnly:!1,isViewOnly:!1,sortField:"modified",sortOrder:"desc",membershipAccess:"",tags:["Hub Team Group"]},{config:{groupType:"Generic AGO Edit Supporting Team",type:"edit",availableIn:["premium"],requiredPrivs:["portal:user:createGroup","portal:user:addExternalMembersToGroup"],titleI18n:"teamTitle",descriptionI18n:"editTeamDesc",snippetI18n:"editTeamSnippet"},access:"org",autoJoin:!1,isInvitationOnly:!1,isViewOnly:!1,sortField:"modified",sortOrder:"desc",capabilities:"updateitemcontrol",membershipAccess:"org",tags:["Hub Team Group"],typekeyword:["Hub Team","Hub Edit Supporting Team"]},{config:{groupType:"Generic Portal Edit Supporting Team",type:"edit",availableIn:["portal"],requiredPrivs:["portal:user:createGroup"],titleI18n:"teamTitle",descriptionI18n:"editTeamDesc",snippetI18n:"editTeamSnippet"},access:"org",autoJoin:!1,isInvitationOnly:!1,isViewOnly:!1,sortField:"modified",sortOrder:"desc",capabilities:"updateitemcontrol",membershipAccess:"org",tags:["Site Team Group"],typekeyword:["Site Team","Site Edit Supporting Team"]},{config:{groupType:"Generic Portal Team",type:"team",availableIn:["portal"],requiredPrivs:["portal:user:createGroup"],titleI18n:"teamTitle",descriptionI18n:"teamDesc",snippetI18n:"teamSnippet"},access:"org",autoJoin:!1,isInvitationOnly:!1,isViewOnly:!1,sortField:"modified",sortOrder:"desc",tags:["Site Team Group"]},{config:{groupType:"Generic Event Team",type:"event",availableIn:["premium"],requiredPrivs:["portal:user:createGroup","portal:user:addExternalMembersToGroup"],titleI18n:"eventTeamTitle",descriptionI18n:"eventTeamDesc",snippetI18n:"eventTeamSnippet"},access:"public",autoJoin:!0,isInvitationOnly:!1,isViewOnly:!1,sortField:"title",sortOrder:"asc",membershipAccess:"",tags:["Hub Group","Hub Event Group","Hub Initiative Group"]}];function yu(e,t){let r=!1;return Array.isArray(t)&&(r=t.every((t=>e.privileges.indexOf(t)>-1))),r}const vu={default:512,mJaJSax0KPHoCNB6:700,q5DTBtIqgaEcBe1j:700,z6hI6KRjKHvhNO0r:700,Xj56SBi2udA78cC9:700,"7ldwmV3MFwjrElY8":700};const bu=["Demo & Marketing","Demo and Marketing","Organizational Plan","Community","In House","ConnectED","ELA","Education Site License","Education","HUP Online"];function wu(e,t,r=""){const n=gu,i=function(e,t){const r=je(e);return Us(bu,t)||(r.privileges=Ge(r.privileges,"portal:user:addExternalMembersToGroup")),r}(e,r);return je(n).reduce(((e,r)=>{const n=function(e,t){const r=je(t);return go(t,"config.privPropValues",[]).forEach((t=>{Us(e.privileges,t.priv)&&(r[t.prop]=t.value)})),r}(i,r);return function(e,t,r){let n=!1;const i=(o=e.orgId,(vu[o]||vu.default)-5);var o;return(ho(e,"groups")||[]).length<=i&&Us(r.config.availableIn,t)&&(n=yu(e,r.config.requiredPrivs)),n}(i,t,n)&&e.push(n),e}),[])}function Iu(e,t,r=0){let n=e;return r&&(n=`${e} ${r}`),function(e,t){return li({q:`(title:"${e}" accountid:${t.portalSelf.id})`,authentication:t.authentication}).then((e=>e.results.length>0)).catch((e=>{throw Error(`Error in team-utils::doesGroupExist ${e}`)}))}(n,t).then((i=>i?(r++,Iu(e,t,r)):n)).catch((e=>{throw Error(`Error in team-utils::getUniqueGroupTitle ${e}`)}))}const xu={public:["portal:user:createGroup","portal:user:shareGroupToPublic"],org:["portal:user:createGroup","portal:user:shareGroupToOrg"],private:["portal:user:createGroup"]};function _u(e,t,r){return t.access=function(e,t,r){const n=!!ho(r,"canSharePublic")&&yu(t,xu.public),i=yu(t,xu.org);let o=e;return"public"!==e||n?"org"!==e||i||(o="private"):(o="org",i||(o="private")),o}(t.access,e,r.portalSelf),Iu(t.title,r).then((e=>(t.title=e,ci({group:t,authentication:r.authentication})))).then((e=>(t.id=e.group.id,(0,se.N)({id:t.id,authentication:r.authentication})))).then((()=>(t.userMembership={username:e.username,memberType:"owner",applications:0},t))).catch((e=>{throw Error(`Error in team-utils::_createTeamGroup ${e}`)}))}function ku(e){const{title:t,types:r,hubRequestOptions:n}=e,i=uu(n.portalSelf),o=fu(n.portalSelf),a=wu(n.portalSelf.user,i,o).filter((e=>r.indexOf(e.config.type)>-1)),s=function(e){return ho(e,"portalSelf.user.culture")||ho(e,"portalSelf.culture")||"en-us"}(n);return function(e,t,r="cors"){const n=`${function(e){if(e.isPortal)return`${Ao(e)}/apps/sites`;{const t=e.portalHostname.split(".")[0];return`${hu[t]||hu.www}/opendata-ui/assets`}}(t)}/locales/${e}.json`.toLocaleLowerCase();return fetch(n,{method:"GET",credentials:"same-origin",mode:r}).then((e=>e.json())).catch((t=>{throw Error(`Attempt to fetch locale ${e} from ${n} failed: ${JSON.stringify(t)}`)}))}(function(e="en"){let t="en";if(e=e.toLowerCase(),mu.indexOf(e)>-1)t=e;else{const r=e.split("-");r.length>1&&mu.indexOf(r[0])>-1&&(t=r[0])}return t}(s),n.portalSelf).then((e=>function(e,t,r,n){const i=t.map((t=>function(e,t,r){return["titleI18n","descriptionI18n","snippetI18n"].forEach((n=>{const i=e.config[n],o=n.replace("I18n",""),a=ho(r,`addons.services.teams.groups.${i}`);e[o]=a.replace(/{title}/g,t)})),e}(t,e,r)));return Promise.all(i.map((e=>_u(n.portalSelf.user,e,n)))).then((e=>{const t=e.reduce(((e,t)=>(t.config.propertyName&&(e[t.config.propertyName]=t.id),e)),{});return e.forEach((e=>delete e.config)),{props:t,groups:e}})).catch((e=>{throw Error(`Error in team-utils::_createTeamGroups ${e}`)}))}(t,a,e,n))).catch((e=>{throw Error(`Error in team-utils::createHubTeams ${e}`)}))}function Su(e,t){let r;r=t.allSSL?443!==t.httpsPort?`:${t.httpsPort}`:"":80!==t.httpPort?`:${t.httpPort}`:"";const n=t.portalHostname.split("/"),i=n[0];let o="/";return n[1]&&(o=`/${n[1]}/`),`${i}${r}${o}apps/sites/#/${e}`}function Eu(e,t,r=0){let n=e;return r&&(n=e+"-"+r),function(e,t){return function(e,t){let r=e;e.indexOf("#/")>-1&&(r=e.split("#/")[1]);const n=`hubsubdomain|${r}`;return K(Object.assign({q:`typekeywords: ${n}`},t)).then((e=>e.results.filter((e=>Us(e.typeKeywords,n)))[0])).then((e=>{if(!e)throw new Error("site not found");return{hostname:e.url,siteId:e.id}}))}(e,t).then((e=>!0)).catch((e=>!1))}(n,t).then((i=>i?Eu(e,t,r+1):n))}function Au(e,t,r,n=0){let i=e;return n&&(i=e+"-"+n),function(e,t){if(t.isPortal)throw new Error("domainExists is not available in ArcGIS Enterprise.");e=pu(e);const r=`${So(t.hubApiUrl)}/${e}`,n=ko(t);return fetch(r,{method:"GET",headers:n,mode:"cors"}).then((e=>404!==e.status))}(`${i}-${t}`,r).then((o=>o?Au(e,t,r,n+1):i))}function Pu(e,t){let r;return r=t.isPortal?Eu(e,t):Au(e,`${t.portalSelf.urlKey}.${pu(Oo(t))}`,t),r.then((e=>function(e,t){let r=je(e),n=63;return t&&(n-=t.length+1),r.length>n&&(r=`${r.slice(0,n-6)}-${function(){let e=(new Date).getTime();return Array(5).fill(0).reduce((function(t){const r=(e+16*Math.random())%16|0;return e=Math.floor(e/16),`${t}${r.toString(16)}`}),"")}()}`),r}(e,t.portalSelf.urlKey)))}function Ou(e,t,r){const n=je(e),i=je(n.data.values.dcatConfig),o=je(n.data.feeds);delete n.data.values.dcatConfig,delete n.data.feeds;const a=Fs(n,t,r);return i&&(a.data.values.dcatConfig=i),o&&(a.data.feeds=o),a}const Tu=/[^\u0000-\u00ff]/;function Cu(e){return Fs(e,{item:{id:e.item.id},appid:e.item.id},{toISO:(e,t)=>t})}function Ru(e){return`hubsubdomain|${e}`.toLowerCase()}const Mu="2.4";function Fu(e,t,r=!1){if((e=je(e)).item.owner=t,e.item.access="private",Array.isArray(e.item.typeKeywords)||(e.item.typeKeywords=[]),e.data.values.updatedAt=(new Date).toISOString(),e.data.values.updatedBy=t,r&&e.item.typeKeywords.push(Ru(e.data.values.subdomain)),!e.item.url){const t=ho(e,"data.values.customHostname")||ho(e,"data.values.defaultHostname");let r="https";e.data.values.customHostname&&(r="http"),e.item.url=`${r}://${t}`}Array.isArray(ho(e,"data.values.pages"))||Ds(e,"data.values.pages",[]),Ds(e,"data.values.uiVersion",Mu),e=function(e,t){return(e=je(e)).item.type=su(t),Array.isArray(e.item.typeKeywords)||(e.item.typeKeywords=[]),Us(e.item.typeKeywords,"hubSite")||e.item.typeKeywords.push("hubSite"),e}(e,r);const n=(e.data.values.capabilities||[]).reduce(((e,t)=>e.includes(t)?e:[...e,t]),["api_explorer","pages","my_data","social_logins","json_chart_card","document_iframes","items_view","app_page","underlinedLinks","globalNav"]);return r||n.includes("socialSharing")||n.push("socialSharing"),Ds(e,"data.values.capabilities",n),ho(e,"data.telemetry")||Ds(e,"data.telemetry",{}),e}function Du(e,t,r){return be({item:bo(e=Fu(e,r.authentication.username,r.isPortal)),owner:e.item.owner,authentication:r.authentication}).then((t=>(e.item.id=t.id,ue({id:e.item.id,owner:e.item.owner,authentication:r.authentication})))).then((t=>function(e,t){if(t.isPortal)return Promise.resolve([{clientKey:"arcgisonline"}]);{const r=["defaultHostname","customHostname"];return Promise.all(r.reduce(((r,n)=>{const i=ho(e,`data.values.${n}`);if(i){const n={hostname:i,clientKey:e.data.values.clientId,orgId:t.portalSelf.id,orgTitle:t.portalSelf.name,orgKey:t.portalSelf.urlKey,siteId:e.item.id,siteTitle:e.item.title,sslOnly:!0};r.push(function(e,t){if(t.isPortal)throw new Error("addDomain is not available in ArcGIS Enterprise. Instead, edit the hubdomain typekeyword on the item");const r=ko(t);r["Content-Type"]="application/json";const n=`${So(t.hubApiUrl)}`,i=e.siteTitle;return"number"==typeof i&&(e.siteTitle=i.toString()),e.clientKey&&(e.clientKey=""),fetch(n,{method:"POST",headers:r,mode:"cors",body:JSON.stringify(e)}).then(Eo)}(n,t))}return r}),[]))}}(e,r))).then((t=>{e.data.values.clientId=t[0].clientKey;const n=je(e.data.values.dcatConfig);return delete e.data.values.dcatConfig,e=Cu(e),n&&(e.data.values.dcatConfig=n),J({item:bo(e),authentication:r.authentication})})).then((n=>Ls(e,t.assets||[],r))).then((t=>{let n=Promise.resolve({success:!0});const i=ho(e,"item.properties.collaborationGroupId");return i&&(n=ie({id:e.item.id,groupId:i,authentication:r.authentication,confirmItemControl:!0})),n})).then((t=>{const n=ho(e,"item.properties.parentInitiativeId");return n?function(e,t,r){let n=Promise.resolve(e);if("string"==typeof e){if(!eu(e))return Promise.reject(new Error("updateInitiativeSiteId was passed a string that is not a GUID."));n=(0,N.Gq)(e,{authentication:r.authentication})}else if(ho(e,"item.id")){const t=e;n=Promise.resolve(t.item)}return n.then((e=>(e.properties||(e.properties={}),e.properties.siteId=t,J({item:e,authentication:r.authentication}))))}(n,e.item.id,r):Promise.resolve(!0)})).then((t=>e)).catch((e=>{throw Error(`site-utils::createSite - Error creating site ${JSON.stringify(e)}`)}))}function ju(e,t,r){const n=(0,po.M)(ie,{success:!0}),i=function(e){return[{prop:"item.properties.contentGroupId",itemControl:!1},{prop:"item.properties.collaborationGroupId",itemControl:!0}].reduce(((t,r)=>{const n=ho(e,r.prop);return n&&t.push({id:n,confirmItemControl:r.itemControl}),t}),[])}(e);return function(e,t,r){return function(e,t,r){const n=e=>(0,_o.getSurveyModels)(e.item,r).then((({form:e,featureService:t,fieldworker:r,stakeholder:n})=>[e,t,r,n].filter(Boolean))),i=t.reduce(((e,t)=>"Form"===t.item.type?[...e,n(t)]:e),[Promise.resolve([e])]);return Promise.all(i).then((e=>e.reduce(((e,t)=>[...e,...t]),[])))}(e,t,r).then((e=>t.reduce(((t,r)=>e.find((({item:{id:e}})=>r.item.id===e))?t:[...t,r]),[])))}(e,t,r).then((e=>Promise.all(e.reduce(((e,t)=>{const o=i.map((e=>{const i={id:t.item.id,groupId:e.id,confirmItemControl:e.confirmItemControl,authentication:r.authentication};return n(i)}));return e.concat(o)}),[]))))}function Gu(e,t,r,n){const i=t.filter((t=>t.id!==e.item.id)),o=i.map((e=>({item:{id:e.id,type:e.type}})));let a=[];a=a.concat(ju(e,o,n)),a=a.concat(function(e,t,r){const n=t.filter((e=>e.type.indexOf("Page")>-1)).map((e=>e.id));return Promise.all(n.map((e=>lo(e,r)))).then((t=>function(e,t,r){const n=t.filter((e=>e.item.type.indexOf("Page")>-1)),i=(0,po.M)(J,{success:!0}),o={id:e.item.id,title:e.item.title};return Promise.all(n.map((t=>(t.data.values.sites.push(o),t=function(e,t){const r={teams:["collaborationGroupId","followersGroupId","contentGroupId"].reduce(((t,r)=>{const n=ho(e,`item.properties.${r}`);return n&&(t[r]=n),t}),{}),siteId:ho(e,"item.id"),siteUrl:ho(e,"item.url"),initiative:{item:{id:ho(e,"item.properties.parentInitiativeId")}}};return r[e.key]=e,Fs(t,r)}(e,t),i({item:bo(t),authentication:r.authentication})))))}(e,t,r)))}(e,i,n));const s=i.map((e=>e.id));return e.item.properties.children=s,e=Ou(e,r,{}),a.push(function(e,t){const r=t.allowList||[],{updateVersions:n=!0}=t;let i;return Ds(e,"data.values.uiVersion",Mu),Ds(e,"data.values.updatedAt",(new Date).toISOString()),Ds(e,"data.values.updatedBy",t.authentication.username),r.length&&(r.push("data.values.updatedAt"),r.push("data.values.updatedBy"),n&&(r.push("data.values.uiVersion"),r.push("item.properties.schemaVersion"))),t.isPortal&&(e.item.typeKeywords=function(e,t=[]){const r=Ru(e);return Us(t,r)?t:t.reduce(((e,t)=>(/^hubsubdomain/.test(t)||e.push(t),e)),[r])}(ho(e,"data.values.subdomain"),e.item.typeKeywords),r.length&&r.push("item.typeKeywords")),i=r.length?au(e.item.id,t):Promise.resolve(e),i.then((n=>(r.length&&(e=qs(e,n,r)),J({item:bo(e),authentication:t.authentication,params:{clearEmptyFields:!0}})))).catch((e=>{throw Error(`updateSite: Error updating site: ${e}`)}))}(e,{...n,allowList:void 0})),Promise.all(a).then((()=>!0))}function zu(e,t,r=null){let n,i,o,a=0,s=0;return ao(t).then((t=>(o=t,au(e.id,o)))).then((e=>(a=e.item.created,s=e.item.modified,n=e.item.title,i=e.data.values.title,function(e,t){const r=je(e);r.type=su(t.isPortal),r.key=`${vs(e.item.title)}_${ze("i")}`,r.itemId=e.item.id,r.item=ws(r.item),delete r.item.url,r.item.properties={schemaVersion:Qs,children:[]},r.item.title="{{solution.title}}",r.data.values.subdomain="{{solution.subdomain}}",r.data.values.defaultHostname="{{solution.defaultHostname}}",r.data.values.title="{{solution.title}}",r.data.values.subdomain="{{solution.subdomain}}",r.data.values.defaultHostname="{{solution.defaultHostname}}",delete r.data.catalog,delete r.data.values.collaborationGroupId,["updatedAt","updatedBy","clientId","siteId"].forEach((e=>{r.data.values[e]=""})),["customHostname","externalUrl","contentGroupId","followersGroupId","groups"].forEach((e=>{delete r.data.values[e]})),ho(r,"data.values.defaultExtent")&&(r.data.values.defaultExtent="{{organization.defaultExtent}}"),ho(r,"data.values.map.basemaps.primary.extent")&&(r.data.values.map.basemaps.primary.extent="{{organization.defaultExtent}}");const n=Os(r.data.values.layout);return r.data.values.layout=n.layout,r.data=Is(r.data,r.itemId),r.dependencies=Cs(e),_s(e.item,t).then((e=>(r.assets=e.filter((e=>-1===e.name.search(Rs))),r)))}(e,o)))).then((e=>(e.item.created=a,e.item.modified=s,e.item.title=n,e.item.typeKeywords=Ge(e.item.typeKeywords,"doNotDelete"),e.data.values.title=i,e.groups=[],e.estimatedDeploymentCostFactor=2,e.resources=[],cr(e,"properties")||(e.properties={}),e.dependencies=er(e.dependencies),Hs(e))))}function Lu(e,t,r,n){if(!n(e.itemId,Fe.Started,0))return Promise.resolve(tr(e.type));e.assets&&e.resources&&delete e.assets,t.solution||(t.solution={}),t.solution.title=t.title;const i={};let o,a;const s=e.item.thumbnail;return ao(r,t).then((r=>(a=r,function(e,t,r,n){e.assets=Ms(e,n),e.item.properties||(e.item.properties={}),["customHostname","externalUrl","contentGroupId","followersGroupId","collaborationGroupId","parentInitiativeId"].forEach((t=>{delete e.data.values[t]})),uu(n.portalSelf);let i=ho(t,"solution.title")||"New Site";"number"==typeof i&&(i=i.toString(),Ds(t,"solution.title",i));const o={};return ku({title:i,types:["core","content","followers"],hubRequestOptions:n}).then((r=>{t.teams=je(r.props),o.teams=r,Object.assign(e.item.properties,r.props),ho(r,"props.contentGroupId")&&Ds(e,"data.catalog.groups",[r.props.contentGroupId]);let a=i;var s;return((s=a).charCodeAt(0)>255||Tu.test(s))&&(a="site"),Pu(js(a),n)})).then((e=>{const r=n.portalSelf;if(t.solution.theme=du(r),t.solution.subdomain=e,n.isPortal)t.solution.defaultHostname=Su(e,r),t.solution.url=function(e,t){let r="http:";return t.allSSL&&(r="https:"),`${r}//${Su(e,t)}`}(e,r);else{const i=pu(Oo(n));t.solution.defaultHostname=`${e}-${r.urlKey}.${i}`,t.solution.url=`https://${e}-${r.urlKey}.${i}`}})).then((n=>{const i=Ou(e,t,r);return"number"==typeof i.item.title&&(i.item.title=ho(t,"solution.title"),i.data.values.title=ho(t,"solution.title")),i})).catch((e=>{throw Error(`site-utils::createSiteModelFromTemplate Error ${e}`)}))}(e,t,i,a)))).then((e=>Du(e,{assets:e.assets||[]},a))).then((e=>(o=e,Ks(e,t.folderId,r)))).then((()=>Pe({item:{id:o.item.id},params:{thumbnail:s},authentication:r}))).then((()=>{if(t[e.itemId]={itemId:o.item.id},n(e.itemId,Fe.Finished,e.estimatedDeploymentCostFactor||2,o.item.id)){const t={item:{...e,...Qt(o)},id:o.item.id,type:e.type,postProcess:!0};return t.item.itemId=o.item.id,t}return(0,po.M)(Co,{success:!0})(o,a).then((()=>Promise.resolve(tr(e.type))))})).catch((t=>{throw n(e.itemId,Fe.Failed,0),t}))}function Nu(e,t,r,n,i,o,a){let s;return ao(a,o).then((t=>(s=t,au(e,s)))).then((e=>Gu(e,r,o,s))).then((()=>Promise.resolve(!0)))}function Uu(e){let t=!1;return"Hub Site Application"!==e&&"Site Application"!==e||(t=!0),t}const $u="smstatusunpublishedchanges",Bu="smstatuspublished",Wu={oembed:{version:"1.0",type:"rich",title:"Example StoryMap",url:"{{storyMapTemplateUrl}}",provider_name:"ArcGIS StoryMaps",provider_url:"{{storyMapBaseUrl}}",width:800,height:600,thumbnail_url:"{{storyMapThumbnailUrl}}",thumbnail_height:"100.5",thumbnail_width:"400",html:'<iframe src="{{storyMapTemplateUrl}}" width="800" height="600" scrolling="yes" frameborder="0" allowfullscreen></iframe>',cache_age:86400},oembedXML:'<?xml version="1.0" encoding="utf-8" standalone="yes"?>\n <oembed>\n <version>1.0</version>\n <type>rich</type>\n <title>Example StoryMap</title>\n <url>{{storyMapTemplateUrl}}</url>\n <author_name>undefined</author_name>\n <provider_name>ArcGIS StoryMaps</provider_name>\n <provider_url>{{storyMapBaseUrl}}</provider_url>\n <width>800</width>\n <height>600</height>\n <thumbnail_url>{{storyMapThumbnailUrl}}</thumbnail_url>\n <thumbnail_height>100.5</thumbnail_height>\n <thumbnail_width>400</thumbnail_width>\n <html><iframe src="{{storyMapTemplateUrl}}" width="800" height="600" scrolling="yes" frameborder="0" allowfullscreen="true"></iframe></html>\n <cache_age>86400</cache_age>\n </oembed>'};function Vu(e){const t=e.portal||"https://www.arcgis.com/sharing/rest";let r;return t.match(/(qaext|\.mapsqa)\.arcgis.com/)?r="storymapsqa":t.match(/(devext|\.mapsdevext)\.arcgis.com/)?r="storymapsdev":t.match(/(www|\.maps)\.arcgis.com/)&&(r="storymaps"),r}function qu(e,t="application/octet-stream"){if("undefined"!=typeof Blob){const r=[];for(let t=0;t<e.length;t++)r[t]=e.charCodeAt(t);const n=new Uint8Array(r);return new Blob([n],{type:t})}throw new Error("stringToBlob is not currently supported on Node")}function Hu(e,t,r){const n={item:e,data:{}};return(0,N.MB)(e.id,{authentication:r}).then((e=>(n.data=e,function(e){const t=Wr(e.item.id,e.item.type);t.key=`${vs(e.item.title)}_${ze("i")}`;const r=je(e);t.data=r.data;const n=r.item.created,i=r.item.modified;return t.item=ws(r.item),t.item.created=n,t.item.modified=i,t.item.url="{{storyMapTemplateUrl}}",function(e={}){let t=0;return Object.keys(e).reduce(((r,n)=>("webmap"===ho(e,`${n}.type`)&&n!==`webmap${t}`&&(r.push({original:n,updated:`webmap${t}`}),t++),r)),[])}(t.data.resources).forEach((e=>{t.data.resources[e.updated]=je(t.data.resources[e.original]),delete t.data.resources[e.original],t.data.nodes=$o(t.data.nodes,e.original,e.updated)})),-1!==t.item.typeKeywords.indexOf($u)&&(t.item.typeKeywords=[Bu].concat(t.item.typeKeywords.filter((e=>e!==$u)))),t.properties={},t.properties.draftFileName="draft_{{timestamp}}.json",Object.assign(t.properties,Wu),t.dependencies=function(e){const t=ho(e,"data.resources")||{};return Object.keys(t).reduce(((e,r)=>("webmap"===ho(t,`${r}.type`)&&e.push(ho(t,`${r}.data.itemId`)),e)),[])}(e),Promise.resolve(t)}(n)))).then((e=>e))}function Ku(e,t,r,n){if(!n(e.itemId,Fe.Started,0))return Promise.resolve(tr(e.type));let i;return t.solution||(t.solution={}),t.solution.title=t.title,function(e,t,r,n){const i=(new Date).getTime();t.agoenv=function(e){const t=e.portal||"https://www.arcgis.com/sharing/rest";let r="portal";return t.match(/(qaext|\.mapsqa)\.arcgis.com/)?r="qaext":t.match(/(devext|\.mapsdevext)\.arcgis.com/)?r="devext":t.match(/(www|\.maps)\.arcgis.com/)&&(r="www"),r}(n),t.smBase=Vu(n),t.timestamp=(new Date).getTime(),t.storyMapBaseUrl=function(e){let t="";const r=Vu(e);return t=r?`https://${r}.arcgis.com`:`${e.portal.replace("/sharing/rest","")}/apps/storymaps`,t}(n),t.storyMapTemplateUrl=`${t.storyMapBaseUrl}/stories/{{appid}}`,t.storyMapThumnailUrl=`${n.portal}/content/items/{{appid}}/info/thumbnail/thumbnail.jpg/?w=400&d=${i}`;const o=Fs(e,t,r);return Promise.resolve(o)}(e,t,{},r).then((e=>(e.assets,function(e,t,r,n){const i=[];e.data=JSON.parse(JSON.stringify(e.data).replace(/portalUrl=https:\/\//g,"portalUrl=https%3A%2F%2F"));const o={item:bo(e),authentication:n};return e.item.thumbnail&&(o.params={thumbnail:e.item.thumbnail},delete o.item.thumbnail),be(o).then((t=>{e.item.id=t.id,e=Cu(e);const r=qu(JSON.stringify(e.data));return i.push({name:e.properties.draftFileName,file:r}),i.push({name:"oembed.json",file:qu(JSON.stringify(e.properties.oembed))}),i.push({name:"oembed.xml",file:qu(e.properties.oembedXML)}),i.push({name:"published_data.json",file:r}),delete e.properties,Promise.all([Pe({item:bo(e),authentication:n}),n.getUsername()])})).then((t=>{const r=t[1],o=(0,po.M)(Ie,{success:!0}),a=i.map((t=>o({id:e.item.id,owner:r,resource:t.file,name:t.name,authentication:n})));return Promise.all(a)})).then((()=>Z({itemId:e.item.id,folderId:t,authentication:n}))).then((()=>e))}(e,t.folderId,0,r)))).then((o=>{if(i=o,t[e.itemId]={itemId:i.item.id},n(e.itemId,Fe.Finished,e.estimatedDeploymentCostFactor||2,i.item.id)){const t={item:{...e,...Qt(i)},id:i.item.id,type:e.type,postProcess:!1};return t.item.itemId=i.item.id,t}return(0,po.M)(B,{success:!0})({id:i.item.id,authentication:r}).then((()=>Promise.resolve(tr(e.type))))})).catch((t=>{throw n(e.itemId,Fe.Failed,0),t}))}function Ju(e){let t=!1;return"StoryMap"===e&&(t=!0),t}function Zu(e,t,r){const n=cr(e,t);n&&pr(e,t,r(n))}function Yu(e){return e.map((e=>(e.label=e.label&&e.id?`{{${e.id}.label}}`:e.label,e.id=e.id?`{{${e.id}.itemId}}`:e.id,e)))}function Xu(e){let t=cr(e,"properties.feature-layer.portalItemId");if(e.properties&&(e.properties["feature-layer.portalItemId"]&&(t=e.properties["feature-layer.portalItemId"],e.properties["feature-layer.portalItemId"]=`{{${t}.itemId}}`),t&&e.properties.hasOwnProperty("feature-layer.layerId"))){const r=e.properties["feature-layer.layerId"];e.properties["feature-layer.layerId"]=`{{${t}.layer${r}.layerId}}`}return e}function Qu(e){return e.map((e=>Xu(e)))}function ec(e,t){e.reduce(((e,t)=>((cr(t,"name")?[t.name]:ia).forEach((r=>{oa.forEach((n=>{if(n.indexOf("mapServicePortalItemID")<0&&n.indexOf("streamServicePortalItemID")<0){const i=t.properties?t.properties[r+n]:void 0;i&&e.indexOf(i)<0&&e.push(i)}}))})),e)),t)}function tc(e,t,r,n="",i=!1,o="",a=""){return function(e,t){return t.hasOwnProperty("velocityUrl")?Promise.resolve(t.velocityUrl):function(e){return(t={authentication:e},ke(`${(0,R.e)(t)}/portals/self/subscriptioninfo`,{httpMethod:"GET",...t})).then((e=>{let t="",r=!1;const n=cr(e,"orgCapabilities");return Array.isArray(n)&&n.some((e=>(r="velocity"===e.id||r,r&&"active"===e.status&&e.velocityUrl&&(t=e.velocityUrl),t))),Promise.resolve({velocityUrl:t,hasVelocity:r})}));var t}(e).then((e=>(t.velocityUrl=e.velocityUrl,Promise.resolve(e.velocityUrl))))}(e,t).then((t=>{if(t){const s="Real Time Analytic"===r?"analytics/realtime":"Big Data Analytic"===r?"analytics/bigdata":r.toLowerCase(),u=a?`/${a}`:"",c=o?`/${o}`:"";return Promise.resolve(i?`${t}/iot/${s}${c}${u}`:n?`${t}/iot/${s}${c}/${n}${u}/?f=json&token=${e.token}`:`${t}/iot/${s}${c}${u}/?f=json&token=${e.token}`)}return Promise.resolve(t)}))}function rc(e,t,r,n,i=!1){return tc(e,n,t.type,void 0,!0).then((o=>o?function(e,t,r){return sc(e,`${r}StatusList?view=admin`,"GET").then((e=>{const r=e&&Array.isArray(e)?e.map((e=>({title:e.label}))):[];return Promise.resolve({label:oc(t,{titles:r},"titles"),titles:r.map((e=>e.title))})}))}(e,r.label,o).then((a=>{const s=a.titles;r.label=a.label,r.id="";const u=Kr(r,n),c=(r.outputs?r.outputs:r.output?[r.output]:[]).map((e=>({id:e.id,name:e.properties[`${e.name}.name`]}))),l=(u.feeds?u.feeds:u.feed?[u.feed]:[]).map((e=>({id:e.id?e.id:e.properties[`${e.name}.portalItemId`]||"",name:e.label?e.label:r.label})));return nc(e,n,t.type,u,s,c,l).then((a=>sc(e,o,"POST",a).then((a=>{t.item.url=`${o}/${a.id}`,t.item.title=r.label,n[t.itemId].url=t.item.url,n[t.itemId].label=r.label,n[t.itemId].itemId=a.id;const s={item:Kr(t.item,n),id:a.id,type:t.type,postProcess:!1};return i?function(e,t,r,n){return ac(e,t,r.type,n).then((i=>i.executable?function(e,t,r,n){return tc(e,t,r,n,!1,"","start").then((t=>sc(e,t,"GET").then((e=>Promise.resolve(e)))))}(e,t,r.type,n):Promise.resolve(i)))}(e,n,t,a.id).then((()=>Promise.resolve(s))):Promise.resolve(s)}))))})):Promise.reject(sr("Velocity NOT Supported by Organization"))))}function nc(e,t,r,n,i,o=[],a=[]){return o.length>0||a.length>0?ac(e,t,r,"",n).then((s=>{const u=function(e){let t=cr(e,"validation.messages");const r=cr(e,"nodes");r&&Array.isArray(r)&&r.forEach((e=>{t=t.concat(cr(e,"validation.messages")||[])}));let n=[];return t&&Array.isArray(t)&&t.forEach((e=>{["VALIDATION_ANALYTICS__MULTIPLE_CREATE_FEATURE_LAYER_OUTPUTS_REFERENCE_SAME_LAYER_NAME","VALIDATION_ANALYTICS__MULTIPLE_CREATE_STREAM_LAYER_OUTPUTS_REFERENCE_SAME_LAYER_NAME","ITEM_MANAGER__CREATE_ANALYTIC_FAILED_DUPLICATE_OUTPUT_NAMES_IN_ORGANIZATION_NOT_ALLOWED","ITEM_MANAGER__CREATE_BIG_DATA_ANALYTIC_FAILED_DUPLICATE_NAMES_NOT_ALLOWED","ITEM_MANAGER__CREATE_REAL_TIME_ANALYTIC_FAILED_DUPLICATE_NAMES_NOT_ALLOWED","ITEM_MANAGER__CREATE_FEED_FAILED_DUPLICATE_NAME"].indexOf(e.key)>-1&&(n=n.concat(e.args))})),n}(s);return u.length>0?(o.length>0&&function(e,t,r){e.forEach((e=>{const n=ic(r,e);if(n){const e=(t.outputs?t.outputs:t.output?[t.output]:[]).map((e=>{if(e.id===n.id&&e.properties){const t=`${e.name}.name`;Object.keys(e.properties).indexOf(t)>-1&&(e.properties[t]=n.label)}return e}));t.outputs&&(t.outputs=e),t.output&&(t.output=e[0])}}))}(o,n,u),a.length>0&&function(e,t,r){e.forEach((e=>{const n=ic(r,e);n&&(t.label=n.label,e.name=n.label)}))}(a,n,u.concat(i)),nc(e,t,r,n,i,o,a)):Promise.resolve(n)})):Promise.resolve(n)}function ic(e,t){const r=e.map((e=>({title:e}))),n=oc(t.name,{titles:r},"titles");return n!==t.name?{label:n,id:t.id}:void 0}function oc(e,t,r){e=e?e.trim():"_";const n=(cr(t,r)||[]).map((e=>e.title));let i=e,o=0;for(;n.indexOf(i)>-1||n.indexOf(i.replace(/ /g,"_"))>-1;)o++,i=e+" "+o;return i}function ac(e,t,r,n,i){return tc(e,t,r,n,!1,"validate","").then((t=>sc(e,t,"POST",i).then((e=>Promise.resolve(e)))))}function sc(e,t,r,n){const i=function(e,t){return{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"token="+e.token},method:t}}(e,r);return n&&(i.body=JSON.stringify(n)),fetch(t,i).then((e=>Promise.resolve(e.json())))}function uc(e,t,r,n){const i=Br(e);return tc(r,n,e.type,e.id).then((e=>e?fetch(e).then((e=>e.json())).then((e=>(i.item.title=e.label,i.data=e,function(e,t){const r=[];return[cr(e,"data.feeds")?e.data.feeds:[],cr(e,"data.feed")?[e.data.feed]:[]].forEach((e=>function(e,t){e.reduce(((e,t)=>{const r=t.id||void 0;return r&&e.indexOf(r)<0&&e.push(r),e}),t),ec(e,t)}(e,r))),[cr(e,"data.sources")?e.data.sources:[],cr(e,"data.source")?[e.data.source]:[],cr(e,"data.outputs")?e.data.outputs:[],cr(e,"data.output")?[e.data.output]:[]].forEach((e=>ec(e,r))),function(e,t){const r=e.map((e=>un(e,t)));return Promise.all(r).then((e=>Promise.resolve(e.reduce(((e,t)=>(t.typeKeywords.indexOf("IoTFeatureLayer")<0&&e.push(t.id),e)),[]))))}(r,t)}(i,r).then((e=>(i.dependencies=e,function(e,t){const r=e.dependencies;[cr(e,"data.sources")?e.data.sources:[],cr(e,"data.source")?[e.data.source]:[],cr(e,"data.feeds")?e.data.feeds:[],cr(e,"data.feed")?[e.data.feed]:[]].forEach((e=>function(e,t,r){e.forEach((e=>{const n="feature-layer.portalItemId";if(e.properties){if(e.properties[n]){const r=e.properties[n];r&&t.indexOf(r)<0&&(delete e.properties[n],delete e.properties["feature-layer.layerId"])}const i="simulator.url",o=e.properties[i];o&&o.indexOf(r)>-1&&delete e.properties[i]}}))}(e,r,t))),[cr(e,"data.outputs")?e.data.outputs:[],cr(e,"data.output")?[e.data.output]:[]].forEach((e=>function(e,t){e.forEach((e=>{var r;e.properties&&((cr(e,"name")?[e.name]:ia).forEach((r=>{oa.forEach((n=>function(e,t,r){const n=e[t];n&&r.indexOf(n)<0&&delete e[t]}(e.properties,r+n,t)))})),r=e.properties,["feat-lyr-new.name","stream-lyr-new.name","feat-lyr-existing.name"].forEach((e=>{const t=r[e];t&&t.indexOf("{{solutionItemId}}")<0&&(r[e]=`${t}_{{solutionItemId}}`)})))}))}(e,r)))}(i,n.velocityUrl),function(e){Zu(e,"data.sources",Qu),Zu(e,"data.feeds",Yu),Zu(e,"data.feed",Xu)}(i),i.item=aa(i.item,i.type,n),Promise.resolve(i))))))):Promise.reject("Velocity NOT Supported by Organization")),(e=>Promise.reject(sr(e))))}function cc(e,t,r,n){if(!n(e.itemId,Fe.Started,0))return Promise.resolve(tr(e.type));const i=e.itemId;return rc(r,e,e.data,t).then((t=>{if(n(i,Fe.Finished,e.estimatedDeploymentCostFactor||2,t.id)){const r={item:{...e,...t},id:t.item.id,type:e.type,postProcess:!0};return r.item.itemId=t.item.id,r}return ji(t.id,r).then((()=>Promise.resolve(tr(e.type))),(()=>Promise.resolve(tr(e.type))))}))}function lc(e,t,r,n,i,o,a){const s=r.filter((t=>t.id===e))[0].item.item;return delete s.url,delete s.origUrl,$i(s,a).then((()=>Z({owner:a.username,itemId:e,folderId:o.folderId,authentication:a})))}function dc(e){if("undefined"!=typeof Blob)return new Blob([JSON.stringify(e)],{type:"application/json"});throw new Error("objectToJsonBlob is not currently supported on Node")}const pc="status: Published",fc="status: Changed";function mc(e,t,r){const n={item:e,data:{}};return(0,N.MB)(e.id,{authentication:r}).then((e=>(n.data=e,function(e){const t=Wr(e.item.id,e.item.type);t.key=`${vs(e.item.title)}_${ze("i")}`;const r=je(e);t.data=r.data;const n=r.item.created,i=r.item.modified;return t.item=ws(r.item),t.item.created=n,t.item.modified=i,t.item.url="{{experienceUrlTemplate}}",-1!==t.item.typeKeywords.indexOf(fc)&&(t.item.typeKeywords=[pc].concat(t.item.typeKeywords.filter((e=>e!==fc)))),t.dependencies=function(e){const t=ho(e,"data.dataSources")||{};return Object.keys(t).reduce(((e,r)=>Le(ho(t,`${r}.itemId`),e)),[])}(e),Promise.resolve(t)}(n))))}function hc(e,t,r,n){if(!n(e.itemId,Fe.Started,0))return Promise.resolve(tr(e.type));let i;return function(e,t,r,n){t.experienceUrlTemplate=function(e){let t="";const r=function(e){const t=e.portal||"https://www.arcgis.com/sharing/rest";let r;return t.match(/(qaext|\.mapsqa)\.arcgis.com/)?r="experienceqa":t.match(/(devext|\.mapsdevext)\.arcgis.com/)?r="experiencedev":t.match(/(www|\.maps)\.arcgis.com/)&&(r="experience"),r}(e);return t=r?`https://${r}.arcgis.com/experience/{{appid}}`:`${e.portal.replace("/sharing/rest","")}/apps/experiencebuilder/?id={{appid}}`,t}(n);const i=Fs(e,t,{});return i.item.url=t.experienceUrlTemplate,e.item.thumbnail&&(i.item.thumbnail=e.item.thumbnail),Promise.resolve(i)}(e,t,0,r).then((e=>(i=e,function(e,t,r,n){const i=[],o={item:bo(e),authentication:n};return e.item.thumbnail&&(o.params={thumbnail:e.item.thumbnail},delete o.item.thumbnail),be(o).then((t=>{e.item.id=t.id;const r=e.item.thumbnail;(e=Cu(e)).item.thumbnail=r;const o=je(e.data);i.push({name:"config.json",prefix:"config",file:dc(o)});const a=je(e.properties.imageResourcesList);a&&i.push({name:"image-resources-list.json",prefix:"images",file:qu(JSON.stringify(a))}),delete e.properties;const s={item:bo(e),authentication:n};return e.item.thumbnail&&(s.params={thumbnail:e.item.thumbnail},delete s.item.thumbnail),Promise.all([Pe(s),n.getUsername()])})).then((t=>{const r=t[1],o=(0,po.M)(Ie,{success:!0}),a=i.map((t=>o({id:e.item.id,owner:r,resource:t.file,name:t.name,prefix:t.prefix,authentication:n})));return Promise.all(a)})).then((()=>Z({itemId:e.item.id,folderId:t,authentication:n}))).then((()=>e))}(e,t.folderId,0,r)))).then((o=>{if(i.item.id=o.item.id,i.item.url=o.item.url,t[e.itemId]={itemId:o.item.id},n(e.itemId,Fe.Finished,e.estimatedDeploymentCostFactor||2,o.item.id)){const t={item:{...e,...Qt(i)},id:i.item.id,type:e.type,postProcess:!1};return t.item.itemId=i.item.id,t}return(0,po.M)(B,{success:!0})({id:i.item.id,authentication:r}).then((()=>Promise.resolve(tr(e.type))))}))}function gc(e,t,r,n,i,o,a){return Wi(e,o,a)}function yc(e,t,r,n){return Ja(e,0,r,n)}function vc(e,t,r,n){return new Promise((i=>{if(n(e.itemId,Fe.Started,0)){let o=ir(e);o=Kr(o,t),e.item.thumbnail&&(o.item.thumbnail=e.item.thumbnail),bc(o,t,r).then((a=>{n(e.itemId,Fe.Created,e.estimatedDeploymentCostFactor/2,a.itemId)?(t[e.itemId]={itemId:a.itemId,itemUrl:t.portalBaseUrl+"/sharing/rest/content/items/"+a.itemId},o.itemId=a.itemId,o.item.id=a.itemId,o.data={},delete o.item.thumbnail,hn(a.itemId,r).then((s=>{let u=Promise.resolve();s.some((e=>{if("webtoolService.json"===e.name)return u=Jt(e),!0})),u.then((s=>{t[e.itemId].url=s?.serviceUrl,o=Kr(o,t),Bi({...o.item},o.data,r,e.item.thumbnail,void 0,t).then((()=>{n(e.itemId,Fe.Finished,e.estimatedDeploymentCostFactor/2,a.itemId)?un(o.itemId,r).then((e=>{o.item=e,i({item:o,id:a.itemId,type:o.type,postProcess:!1})}),(()=>{n(e.itemId,Fe.Failed,0),ji(a.itemId,r).then((()=>i(tr(e.type))),(()=>i(tr(e.type))))})):(n(e.itemId,Fe.Cancelled,0),ji(a.itemId,r).then((()=>i(tr(e.type))),(()=>i(tr(e.type)))))}),(()=>{n(e.itemId,Fe.Failed,0),ji(a.itemId,r).then((()=>i(tr(e.type))),(()=>i(tr(e.type))))}))}))}))):(n(e.itemId,Fe.Cancelled,0),ji(a.itemId,r).then((()=>i(tr(e.type))),(()=>i(tr(e.type)))))}),(()=>{n(e.itemId,Fe.Failed,0),i(tr(e.type))}))}else n(e.itemId,Fe.Ignored,0),i(tr(e.type))}))}function bc(e,t,r){return new Promise(((n,i)=>{if(t?.portalUrls?.notebooks.https.length>0){const o=`https://${t.portalUrls.notebooks.https[0]}/admin/services/createService?f=json&request.preventCache=${Date.now()}`,a={serviceProperties:{description:e.item.description,provider:"notebooks",type:"GPServer",jsonProperties:{timeoutInMinutes:e.data.timeoutInMinutes,title:e.item.title,notebookId:e.data.notebookId,tasks:[{type:"notebook",name:e.data.name}]}}};ke(o,{httpMethod:"POST",authentication:r,params:a,headers:{Accept:"application/json",Authorization:`Bearer ${r.token}`,"Content-Type":"application/json","X-Esri-Authorization":`Bearer ${r.token}`}}).then((e=>{n(e)}),(e=>{i(e)}))}else i()}))}async function wc(e,t,r){const n=`${t}/admin/createWorkflowItem?name=${e.item.title}`,i={authentication:r,headers:{Accept:"application/json",Authorization:`Bearer ${r.token}`,"Content-Type":"application/json","X-Esri-Authorization":`Bearer ${r.token}`},params:{name:`${e.item.title}`}},o=await ke(n,i);return Promise.resolve(o.itemId)}async function Ic(e,t){const r=`workflow_${e}`,n=`WorkflowLocations_${e}`,i=`workflow_views_${e}`,o=await Gi({q:`title:${r} OR title:${n} OR title:${i}`,authentication:t});return Promise.resolve(o.results.map((e=>e.id)))}function xc(e){for(const t of e)if("Workflow"===t.type){const e=rr(JSON.stringify(t.properties.configuration));t.dependencies=er([...t.dependencies,...e])}return e}async function _c(e,t,r,n){const i=await ln(t,n),o=cr(r,`workflows.${e}`);o&&(await kc(r,"viewSchema",o,i,n),await kc(r,"workflowLocations",o,i,n),await kc(r,"workflowSchema",o,i,n))}async function kc(e,t,r,n,i){const o=r[t],a=cr(n,`${t}.itemId`);e[o].itemId=a;const s=await io(a,i),u=cr(s,"base.url");e[o].url=u,e[o].name=cr(s,"base.name"),Sc(cr(s,"featureServiceProperties.layers"),e,u,o,a),Sc(cr(s,"featureServiceProperties.tables"),e,u,o,a)}function Sc(e,t,r,n,i){e&&"__proto__"!==n&&"constructor"!==n&&"prototype"!==n&&e.forEach((e=>{const o=e.fields.reduce(((e,t)=>(e[t.name.toLowerCase()]={alias:t.alias,name:t.name,type:t.type},e)),{}),a=e.id,s=`${r}/${a}`;t[n][`layer${a}`]={fields:o,itemId:i,layerId:a,url:s}}))}async function Ec(e,t,r,n){const i=Br(e);i.estimatedDeploymentCostFactor=20,i.item.id=Jr(i.item.id,i.item.id,".itemId");const o=mn(i.itemId,"forward",r),a=Fi(e.id,n.workflowBaseUrl,r),s=ln(e.id,r),[u,c,l]=await Promise.all([o,a,s]);return i.data=l,i.dependencies=[],i.relatedItems=[],function(e){const t=e.data;t&&["viewSchema","workflowLocations","workflowSchema"].forEach((r=>{if(Object.keys(t).indexOf(r)>-1){const n=t[r].itemId;n&&e.dependencies.indexOf(n)<0&&e.dependencies.push(n)}}))}(i),u.forEach((e=>{"WMA2Code"!==e.relationshipType&&(i.relatedItems.push(e),e.relatedItemIds.forEach((e=>{i.dependencies.indexOf(e)<0&&i.dependencies.push(e)})))})),i.properties.configuration=await to(c),Promise.resolve(i)}async function Ac(e,t,r,n){if(!n(e.itemId,Fe.Started,0))return n(e.itemId,Fe.Ignored,0),Promise.resolve(tr(e.type));e.data={};let i=ir(e);i=Kr(i,t),e.item.thumbnail&&(i.item.thumbnail=e.item.thumbnail);try{const o=await wc(i,t.workflowBaseUrl,r);if(!o)throw new Error("Failed to create workflow item");if(!n(e.itemId,Fe.Created,e.estimatedDeploymentCostFactor/2,o))return n(e.itemId,Fe.Cancelled,0),ji(o,r),Promise.resolve(tr(e.type));i.itemId=i.item.id=o,t[e.itemId]={itemId:o},await _c(e.itemId,o,t,r),i.properties.configuration=Kr(i.properties.configuration,t);const a=await async function(e){const t=new(Be());Object.keys(e).forEach((r=>{t.file(r,e[r])}));const r=Yi({blob:await t.generateAsync({type:"blob"}),filename:"workflow_configuration.zip",mimeType:"application/zip"});return Promise.resolve(r)}(i.properties.configuration);await async function(e,t,r,n){return ke(`${r}/admin/${e}/import`,{authentication:n,headers:{Accept:"application/octet-stream",Authorization:`Bearer ${n.token}`,"X-Esri-Authorization":`Bearer ${n.token}`},params:{file:t}})}(o,a,t.workflowBaseUrl,r);const s=await Ic(o,r);s.push(o);const u=await async function(e,t,r){const n=new Array;return e.forEach((e=>{n.push(async function(e,t,r){return Z({itemId:e,folderId:t,authentication:r})}(e,t,r))})),Promise.all(n)}(s,t.folderId,r);if(u.some((e=>!e.success)))throw new Error("Failed to move all workflow items");return n(e.itemId,Fe.Finished,e.estimatedDeploymentCostFactor/2,o),Promise.resolve({item:i,id:o,type:i.type,postProcess:!1})}catch(t){return n(e.itemId,Fe.Failed,0),Promise.resolve(tr(e.type))}}const Pc=null,Oc={Group:s,"Big Data Analytic":d,"Feature Collection":o,"Feature Service":e,Feed:d,"Geocoding Service":void 0,"Geodata Service":void 0,"Geometry Service":void 0,"Geoprocessing Service":f,"Globe Service":void 0,"Image Service":void 0,KML:void 0,"Map Service":e,"Network Analysis Service":void 0,"Real Time Analytic":d,"Relational Database Connection":void 0,"Scene Service":void 0,"Stream Service":void 0,Tool:void 0,"Vector Tile Service":o,WFS:void 0,WMS:void 0,WMTS:void 0,"Workflow Manager Service":void 0,"3D Web Scene":void 0,"Web Map":o,"Web Scene":o,Application:void 0,Dashboard:o,"Data Pipeline":o,"Data Store":void 0,"Desktop Application":void 0,"Excalibur Imagery Project":void 0,Form:a,"Hub Initiative":Pc,"Hub Page":u,"Hub Site Application":c,"Insights Model":o,"Insights Page":void 0,"Insights Theme":void 0,"Insights Workbook":void 0,Mission:void 0,"Mobile Application":void 0,Notebook:n,"Oriented Imagery Catalog":o,"Ortho Mapping Project":void 0,"QuickCapture Project":i,"Site Application":c,"Site Page":u,Solution:Pc,StoryMap:l,"Urban Model":void 0,"Web Experience Template":void 0,"Web Experience":p,"Web Mapping Application":o,"Workforce Project":o,"360 VR Experience":t,"AppBuilder Extension":t,"AppBuilder Widget Package":t,"Application Configuration":t,"ArcGIS Pro Add In":t,"ArcGIS Pro Configuration":t,"ArcPad Package":t,"Basemap Package":t,"CAD Drawing":t,"CityEngine Web Scene":t,"Code Attachment":Pc,"Code Sample":t,"Color Set":t,"Compact Tile Package":t,"CSV Collection":t,CSV:t,"Deep Learning Package":t,"Desktop Add In":t,"Desktop Application Template":t,"Desktop Style":t,"Document Link":t,"Explorer Add In":t,"Explorer Layer":t,"Explorer Map":t,"Feature Collection Template":t,"File Geodatabase":t,GeoJson:t,GeoPackage:t,"Geoprocessing Package":t,"Geoprocessing Sample":t,"Globe Document":t,"Image Collection":t,Image:t,"iWork Keynote":t,"iWork Numbers":t,"iWork Pages":t,"KML Collection":t,"Layer Package":t,"Layer Template":t,Layer:t,Layout:t,"Locator Package":t,"Map Document":t,"Map Package":t,"Map Template":t,"Microsoft Excel":t,"Microsoft Powerpoint":t,"Microsoft Word":t,"Mobile Basemap Package":t,"Mobile Map Package":t,"Mobile Scene Package":t,"Native Application":t,"Native Application Installer":t,"Native Application Template":t,netCDF:t,"Operation View":t,"Operations Dashboard Add In":t,"Operations Dashboard Extension":t,PDF:t,"Pro Layer Package":t,"Pro Layer":t,"Pro Map Package":t,"Pro Map":t,"Pro Report":t,"Project Package":t,"Project Template":t,"Published Map":t,"Raster function template":t,"Report Template":t,"Rule Package":t,"Scene Document":t,"Scene Package":t,"Service Definition":t,Shapefile:t,"Statistical Data Collection":t,Style:o,"Survey123 Add In":t,"Symbol Set":t,"Task File":t,"Tile Package":t,"Toolbox Package":t,"Vector Tile Package":t,"Viewer Configuration":t,"Visio Document":t,"Window Mobile Package":t,"Windows Mobile Package":t,"Windows Viewer Add In":t,"Windows Viewer Configuration":t,Workflow:m,"Workflow Manager Package":t,"Administrative Report":void 0,"Apache Parquet":void 0,"API Key":void 0,"datastore catalog service":void 0,"Deep Learning Studio Project":void 0,"Earth Configuration":void 0,"Elevation Layer":void 0,"Esri Classifier Definition":void 0,"Export Package":void 0,"GeoBIM Application":void 0,"GeoBIM Project":void 0,"Geoenrichment Service":void 0,GML:void 0,"Hub Event":void 0,"Hub Initiative Template":void 0,"Hub Project":void 0,"Insights Data Engineering Model":void 0,"Insights Data Engineering Workbook":void 0,"Insights Workbook Package":void 0,"Knowledge Graph":void 0,"Knowledge Studio Project":void 0,"Link Chart":void 0,"Map Image Layer":void 0,Markup:void 0,OGCFeatureServer:void 0,"Pro Project":void 0,"Pro Report Template":void 0,"Route Layer":void 0,"Scene Layer Package":void 0,"Site Initiative":void 0,"StoryMap Theme":void 0,Table:void 0,"Video Service":void 0,Undefined:void 0,Unsupported:Pc},Tc=null;function Cc(e,t,r,n,i,o,a,s){return new Promise(((u,c)=>{const l=function(e){return e.reduce(((e,t)=>e+(t.estimatedDeploymentCostFactor||1)),0)}(r)+1;let d=10;const p=(99-d)/l,f=[],m=[];let h=!0;const g=(e,t,r,n)=>{if(d+=p*r,s.progressCallback)if(t===Fe.Finished){const r={event:De[t],data:e};s.progressCallback(Math.round(d),s.jobId,r)}else s.progressCallback(Math.round(d),s.jobId);return s.consoleProgress&&console.log(Date.now(),e,s.jobId??"",De[t],d.toFixed(0)+"%",r,n?"==> "+n:""),t===Fe.Created?m.push(n):t===Fe.Failed&&(f.push(e),console.error("Item "+e+" has failed"),h=!1),h};cr(i,"organization.isPortal")&&(r=function(e){const t=function(e){return e.reduce(((e,t)=>(cr(t,"properties.service.isView")&&e.push({id:t.itemId,dependencies:t.dependencies}),e)),[])}(e);!function(e,t){t.forEach((t=>{t.dependencies.forEach((r=>{e=e.map((e=>(cr(e,"properties.service.isView")&&e.dependencies.indexOf(r)>-1&&e.itemId!==t.id&&(Array.isArray(e.properties.syncViews)||(e.properties.syncViews=[]),e.properties.syncViews.indexOf(t.id)<0&&e.properties.syncViews.push(t.id)),e)))}))}))}(e,t);const r=function(e){const t={};return e.forEach((e=>{e.dependencies.forEach((r=>{Object.keys(t).indexOf(r)<0?t[r]=[e.id]:t[r].indexOf(e.id)<0&&t[r].push(e.id)}))})),t}(t);let n=[];const i=[];return Object.keys(r).forEach((t=>{r[t].forEach((t=>{const r=Vr(e,t),o=cr(r,"properties.syncViews");i.indexOf(r.itemId)>-1&&(n=n.concat(o)),o&&o.length>0&&pr(r,"properties.syncViews",ir(n)),n.indexOf(t)<0&&n.push(t),i.indexOf(r.itemId)<0&&i.push(r.itemId)})),n=[]})),e}(r));const{buildOrder:y,itemsToBePatched:v}=so(r),b=[],w=function(e,t,r,n){return new Promise(((i,o)=>{if(t){const t=function(e,t,r){const n=[],i=[];return e.forEach((e=>{if("Group"===e.item.type){const r=t.user?.groups;Array.isArray(r)&&n.push(Promise.resolve({results:r.filter((t=>t.tags.indexOf(`source-${e.itemId}`)>-1||t.typeKeywords.indexOf(`source-${e.itemId}`)>-1)).map((e=>(e.type="Group",e))),sourceId:e.itemId}))}else n.push(jc(`typekeywords:source-${e.itemId} type:${e.item.type} owner:${t.user.username}`,r));i.push({itemId:e.itemId,type:e.item.type})})),{existingItemsDefs:n,existingItemInfos:i}}(e,r,n),a=t.existingItemsDefs,s=t.existingItemInfos;Promise.all(a).then((t=>{const a=Fc(t,s,r,n,!0),u=a.existingItemsDefs,c=a.existingItemInfos;Promise.all(u).then((t=>{Fc(t,c,r,n,!1),Rc(e,r,n).then(i)}),(e=>o(sr(e))))}),(e=>o(sr(e))))}else i(null)}))}(r,s.enableItemReuse??!1,i,a);w.then((()=>{const l=function(e,t,r,n){return new Promise((i=>{if(t){const t=[],o={},a=[];Object.keys(r.params).forEach((e=>{const i=r.params[e];i.itemId&&/[0-9A-F]{32}/i.test(e)&&(Dc(r,e,i.itemId,i),t.push(un(i.itemId,n)),o[i.itemId]=e,a.indexOf(e)<0&&a.push(e))})),function(e,t,r){return new Promise((n=>{e.length>0?Promise.all(e).then((e=>{const i=[];e.forEach((e=>{const n=t[e.id];if(e&&n&&e.typeKeywords){const t=`source-${n}`,o=e.typeKeywords;if(o.indexOf(t)<0){o.push(t);const n={id:e.id,typeKeywords:o};i.push($i(n,r))}}})),i.length>0?Promise.all(i).then(n,(()=>n(void 0))):n(void 0)}),(()=>n(void 0))):n(void 0)}))}(t,o,n).then((()=>{Rc(a.map((t=>yr(e,t))),r,n).then(i)}))}else i(null)}))}(r,cr(i,"params.useExisting"),i,a);l.then((()=>{r=function(e){const t=function(){try{return crypto.randomUUID().replace(/-/g,"")}catch{return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}}(),r=[];return e.map((e=>{if("Feature Service"===e.item.type&&(e.item.title=e.item.title||e.item.name,!_n(e))){let n=e.item.name||e.item.title;n=n.replace(/_[0-9A-F]{32}/gi,"");const i=n.substring(0,50)+"_"+t;e.item.name=-1===r.indexOf(i)?i:`${i}_${r.filter((e=>e===i)).length}`,r.push(i)}return e}))}(r),y.forEach((o=>{const u=Vr(r,o);"Form"===u.type?v[o]=[]:"QuickCapture Project"===u.type&&(u.resources=u.resources.filter((e=>!e.endsWith("qc.project.json")))),b.push(function(e,t,r,n,i,o){const a=e.itemId;if(e.dependencies=e.dependencies||[],!n.hasOwnProperty(e.itemId)||!cr(n[e.itemId],"def")){let s,u,c=Fe.Unknown;n[e.itemId]=n[e.itemId]||{},n[e.itemId].def=new Promise((l=>{const d=e.dependencies.reduce(((e,t)=>{const r=cr(n,`${t}.def`);return r&&e.push(r),e}),[]),p=cr(e,"properties.syncViews"),f=p&&p.length>0?p.reduce(((e,t)=>{const r=cr(n,`${t}.def`);return r&&e.push(r),e}),d):d;Promise.all(f).then((()=>{const n=e.type;if(u=Oc[n],"Geoprocessing Service"===e.type&&(u=e.item.typeKeywords.indexOf("Web Tool")>-1?u:Tc),!u||u===Tc)throw u===Tc?(c=Fe.Ignored,new Error):(c=Fe.Failed,new Error);return function(e,t){let r,n;return t.forEach((e=>{e.type===Re.Thumbnail&&(r=e.url,n=e.filename)})),r?function(e,t,r){return new Promise((n=>{on(e,t,r,[500]).then(n,(()=>n(null)))}))}(r,n,e):Promise.resolve(null)}(r,t)})).then((t=>(e.item.thumbnail=t,u.createItemFromTemplate(e,n,i,o)))).then((async o=>{if(""===o.id)throw c=Fe.Failed,new Error("handled");if(s=o,s.item.item.url&&dr(n,a+".url",s.item.item.url),t.length>0){const o=s.id;if("Form"===e.type){let e;if(t=t.filter((t=>!t.filename.endsWith(".zip")||(e=t,!1))),e){const t=await async function(e,t){return Xi(await Xr(e,t))}(e.url,r);await Fo(t,o,i)}}return function(e,t,r,n,i,o,a={},s={}){const u=a.properties||null;return a.itemId&&(t=t.map((e=>(0===e.filename.indexOf(a.itemId)&&""===e.folder&&(e.filename=e.filename.replace(`${a.itemId}-`,"")),e)))),new Promise(((c,l)=>{ta(t.map((e=>({folder:e.type===Re.Data?n:e.folder,filename:e.filename,type:e.type,mimeType:u?u[e.filename]:"",url:e.url}))),e,r,i,o,a,s).then((e=>{e.filter((e=>"metadata.xml"!==e.filename)).map((e=>e.fetchedFromSource&&e.copiedToDestination)).reduce(((e,t)=>e&&t),!0)?c(!0):l()}))}))}(r,t,a,n.folderId,o,i,s.item,n)}return Promise.resolve(null)})).then((()=>{l(s)})).catch((t=>{t&&"handled"===t.message||o(a,c===Fe.Unknown?Fe.Failed:c,0),l(tr(e.type))}))}))}return n[a].def}(u,function(e,t,r=[],n=0){return r.map((r=>{return{url:(i=e,o=t,a=r,Xt(i)+"content/items/"+o+"/resources/"+a),...ea(r,n)};var i,o,a}))}(e,t,u.resources,s.storageVersion),n,i,a,g))})),Promise.all(b).then((e=>{0===f.length?(!function(e,t,r){let n=Object.keys(e);n.length>0&&(n=n.map((e=>t[e].itemId)),r.forEach((e=>{n.includes(e.id)&&(e.postProcess=!0)})))}(v,i,e),u(e)):function(e,t,r,n,i){const o={id:e,title:"",folder:n.folderId,items:[],groups:[]};let a=r.map((e=>({id:e.itemId,type:e.type,title:e.item.title,modified:0,owner:""}))).map((e=>(e.id=n[e.id].itemId,e))).filter((e=>!!e.id));return a=a.filter((e=>t.includes(e.id))),a.sort(((e,r)=>t.indexOf(e.id)-t.indexOf(r.id))),a.forEach((e=>{"Group"===e.type?o.groups.push(e.id):o.items.push(e)})),Mo(e,o,i,{consoleProgress:!0})}(o,m,r,i,a).then((()=>c({success:!1,itemIds:f})))}))}))}),(e=>{console.error(e),c(sr(e))}))}))}function Rc(e,t,r){return new Promise((n=>{const i=[],o=[],a=[],s=[];e.forEach((e=>{const n=t[e.itemId];if(n&&n.url&&n.itemId){if("Feature Service"===e.item.type){const r=cr(t,`params.${e.itemId}.enterpriseIDMapping`);Object.assign(t[e.itemId],Tn(Cn(e),n.url,n.itemId,r)),cr(e,"properties.service.hasViews")&&zn(e,t,!1)}o.indexOf(n.url)<0&&(i.push("Feature Service"===e.item.type?ke(n.url,{authentication:r}):un(n.itemId,r)),o.push(n.url),a.push(e.item.type),s.push(n.itemId))}})),i.length>0?Promise.all(i.map((e=>e.catch((e=>e))))).then((e=>{if(Array.isArray(e)&&e.length>0){const i=[];e.forEach(((e,n)=>{e.serviceItemId&&"Feature Service"===a[n]?Object.keys(t).forEach((a=>{const s=t[a];if(s.itemId&&s.itemId===e.serviceItemId){Ln(t,a,e.spatialReference),dr(t,`${a}.defaultExtent`,e.fullExtent||e.initialExtent);const s=(e.layers||[]).map((e=>e.id)),u=(e.tables||[]).map((e=>e.id));i.push(function(e,t,r){return new Promise((n=>{const i=t.map((t=>ke(Xt(e)+t,{authentication:r})));Promise.all(i.map((e=>e.catch((e=>e))))).then(n)}))}(o[n],s.concat(u),r))}})):("Feature Service"===a[n]||cr(e,"response.error"))&&(t=function(e,t){if(t){let r="";Object.keys(e).some((n=>{if(e[n].itemId===t)return r=n,!0})),""!==r&&delete e[r]}return e}(t,s[n]))})),i.length>0?Promise.all(i).then((e=>{e.forEach((e=>{e.forEach((e=>{Object.keys(t).forEach((r=>{if(t[r].itemId===e.serviceItemId){let n="";Object.keys(t).some((r=>{if(t[r].itemId===e.serviceItemId)return n=r,!0}));const i=cr(t,`params.${n}.enterpriseIDMapping`);i?Object.keys(i).forEach((n=>{i[n].toString()===e.id.toString()&&Mc(t,r,n,e.fields)})):Mc(t,r,e.id,e.fields)}}))}))})),n(null)})):n(null)}else n(null)})):n(null)}))}function Mc(e,t,r,n){const i=cr(e,`${t}.layer${r}`);i&&n&&(i.fields=n)}function Fc(e,t,r,n,i){const o=[Promise.resolve(null)],a=[void 0];return e&&Array.isArray(e)&&e.forEach(((e,s)=>{if(Array.isArray(e?.results)){let u;const c=e.results;if(1===c.length)u=c[0];else if(c.length>1)u=c.reduce(((e,t)=>e.created>t.created?e:t));else if(i&&t[s]){const e=t[s],i=`tags:source-${e.itemId} type:${e.type} owner:${r.user.username}`;o.push(jc(i,n)),a.push(t[s])}if(u){const e=t[s].itemId;e&&Dc(r,e,u.id,u)}}})),{existingItemsDefs:o,existingItemInfos:a}}function Dc(e,t,r,n){e[t]=Object.assign(e[t]||{},{def:Promise.resolve(tr(n.type,r)),itemId:r,name:n.name,title:n.title,url:n.url,label:n.title})}function jc(e,t){return Gi({q:e,authentication:t,pagingParam:{start:1,num:100}})}async function Gc(e,t,r,n,i){i.storageVersion=function(e){let t=cr(e,"metadata.version");return t?"string"==typeof t?(t=parseInt(e.metadata.version,10),isNaN(t)?0:t):t:0}(r);const o=i.storageAuthentication?i.storageAuthentication:n,a=i.templateDictionary??{},s=function(e,t){const r=e.filter((e=>"Workflow"===e.type)).reduce(((e,r)=>(t.workflows={...t.workflows},t.workflows[r.itemId]={},no("viewSchema",t,r,e),no("workflowLocations",t,r,e),no("workflowSchema",t,r,e),e)),[]),n=[];return{deployTemplates:e.filter((e=>{if(r.indexOf(e.itemId)<0)return!0;n.push(e)})),workflowManagedTemplates:n}}(r.templates,a);r.templates=s.deployTemplates,function(e,t,r,n){["title","snippet","description","tags"].forEach((n=>{e[n]=e[n]??t[n],e[n]&&(t[n]=e[n],r[n]=e[n])})),!e.thumbnailurl&&t.thumbnail&&(e.thumbnailurl=function(e,t,r,n=!1){return Xt(e)+(n?"community/groups/":"content/items/")+t+"/info/"+r}(n.portal,t.id,t.thumbnail),delete t.thumbnail)}(i,t,a,n),i.additionalTypeKeywords&&(t.typeKeywords=[].concat(t.typeKeywords,i.additionalTypeKeywords));let u="thumbnail",c=Promise.resolve(null);if(!i.thumbnail&&i.thumbnailurl){u=function(e){if(!e)return"";let t=e.indexOf("?");t<0&&(t=e.length);const r=e.lastIndexOf("/",t)+1;return r<t?e.substring(r,t):""}(i.thumbnailurl)||u;const e=(l=i.thumbnailurl)+(-1===l.indexOf("?")?"?":"&")+"w=400";delete i.thumbnailurl,c=on(e,u,o,[400])}var l;!function(e,t){e.templates=e.templates.map((e=>{if("Feature Service"===e.type){const r="params.";e=zc(e,"item.spatialReference.wkid",r,t),e=zc(e,"properties.service.spatialReference.wkid",r,t)}return e}))}(r,a);const d=await Promise.all([en("",n),tn(n),rn(n),nn(n),c]),[p,f,m,h,g]=d;!i.thumbnail&&g&&(i.thumbnail=g),r.templates=r.templates.map((e=>{if(e.item){const t=e.item.typeKeywords||[];t.push("source-"+e.itemId),e.item.typeKeywords=t}return e})),a.isPortal=p.isPortal,a.organization=Object.assign(a.organization||{},p),a.portalUrls=f.urls,a.portalBaseUrl=function(e,t){const r="https",n=cr(e,"urlKey"),i=cr(e,"customBaseUrl"),o=cr(e,"portalHostname");return n&&i?`${r}://${n}.${i}`:o?`${r}://${o}`:t.portal.replace("/sharing/rest","")}(p,n),a.user=m,a.user.folders=h.folders,a.user.groups=h.groups.filter((e=>e.owner===a.user.username));const y=await rn(n);a.workflowBaseUrl=await ro(n,p,y.orgId),function(e,t,r,n){const i=cr(e,"helperServices.locationTracking");i&&(r.locationTracking=i),r.locationTrackingEnabled=!(!r.locationTracking||"org_admin"!==cr(t,"role")),n&&function(e,t){if(!t.locationTrackingEnabled&&e.some((e=>(cr(e,"item.typeKeywords")||[]).indexOf("Location Tracking View")>-1)))throw console.error("Location tracking not enabled or user is not admin."),new Error("Location tracking not enabled or user is not admin.")}(n,r)}(p,m,a,r.templates);const v=function(e,t){return e.locationTrackingEnabled?un(e.locationTracking.id,t).then((r=>(e.locationTracking.owner=r.owner,e[r.id]={itemId:r.id},Promise.resolve(r&&r.owner===t.username))),(()=>Promise.resolve(!1))):Promise.resolve(!1)}(a,n),b=Ti(t.title,a,n),w=Ai(p.defaultExtent,void 0,{wkid:4326},p.helperServices.geometry.url,n),I=await Promise.all([b,w,v]),[x,_,k]=I,S=x.folder.id;let E;if(a.folderId=S,a.solutionItemExtent=_.xmin+","+_.ymin+","+_.xmax+","+_.ymax,a.organization.defaultExtentBBox=[[_.xmin,_.ymin],[_.xmax,_.ymax]],a.locationTrackingEnabled&&dr(a,"locationTracking.userIsOwner",k),!i.dontCreateSolutionItem){t.categories=[];const r={...Kt(t),type:"Solution",typeKeywords:["Solution"]};i.additionalTypeKeywords&&(r.typeKeywords=["Solution"].concat(i.additionalTypeKeywords)),r.thumbnail=i.thumbnail,E=(await Oi(r,{},n,S)).id;const o={id:E,authentication:n};await ue(o),a.solutionItemId=E,t.id=E,t.tryitUrl=Lc(t.tryitUrl,e,E),t.url=Lc(t.url,e,E)}const A=await Cc(o.portal,e,r.templates,o,a,E,n,i);if(r.templates=r.templates.map((e=>(e.itemId=cr(a,`${e.itemId}.itemId`),e.dependencies=e.dependencies.map((e=>go(a,`${e}.itemId`,e))),e))),P=r.templates,O=A.map((e=>e.id)),P.sort(((e,t)=>O.indexOf(e.itemId)-O.indexOf(t.itemId))),await function(e,t,r,n,i){let o=[];e&&(o=r.filter((e=>"Group"!==e.type)).map((t=>G({originItemId:e,destinationItemId:t.id,relationshipType:"Solution2Item",authentication:n}))));const a=function(e,t,r){const n=e.filter((e=>e.groups&&e.groups.length>0));return Promise.all(n.map((e=>{const n=e.groups.reduce(((e,r)=>Le(cr(t,`${r}.itemId`),e)),[]);if(!_n(e)||cr(t,"locationTracking.userIsOwner"))return na(n,e.itemId,r);{const i=cr(e,"item.properties.trackViewGroup"),o=cr(t,"locationTracking.owner");if(i&&o){const a=n.filter((e=>e===Kr(i,t)));if(a.length!==n.length){const t=n.filter((e=>e!==i));return Promise.all([na(a,e.itemId,r,o),na(t,e.itemId,r)])}return na(n,e.itemId,r,o)}}})))}(t,i,n),s=r.filter((e=>e.postProcess)).reduce(((e,o)=>{const a=Oc[o.type];return a&&a.postProcess&&e.push(a.postProcess(o.id,o.type,r,yr(t,o.id),t,i,n)),e}),[]);return Promise.all([a].concat(s,o))}(E,r.templates,A,n,a),!i.dontCreateSolutionItem){t.typeKeywords=[].concat(t.typeKeywords,["Deployed"]);const e=t.typeKeywords.indexOf("Template");e>=0&&t.typeKeywords.splice(e,1),r.templates=r.templates.map((e=>Nc(e))),function(e,t){e.workflowManagedTemplates.forEach((e=>{t.templates.push(Nc(e))}))}(s,r),r.templates=function(e,t){const r=e.reduce(((e,t)=>("Group"===t.type&&e.push(t.itemId),e)),[]);return Object.keys(t).forEach((n=>{const i=t[n].itemId;r.indexOf(i)>-1&&e.forEach((e=>{e.groups=e.groups.map((e=>e===n?i:e))}))})),e}(r.templates,a),r.templates=function(e,t){return t.workflows&&Object.keys(t.workflows).forEach((r=>{const n=t.workflows[r],i=[n.viewSchema,n.workflowLocations,n.workflowSchema];e=e.map((e=>(i.indexOf(e.itemId)>-1&&(e.dependencies=e.dependencies.map((e=>(i.indexOf(e)>-1&&(e=t[e].itemId),e))),e.itemId=t[e.itemId].itemId),e)))})),e}(r.templates,a),t.data=Kr(r,a),a.params&&(t.data.params=a.params),await $i(t,n,S)}var P,O;return t.id}function zc(e,t,r,n){const i=cr(e,t);return i&&"string"==typeof i&&i.indexOf(r)>-1&&pr(e,t,Kr(i,n)),e}function Lc(e,t,r){let n;if(e&&e.indexOf(t)>-1){const i=new RegExp(t,"g");n=e.replace(i,r)}else n=e;return n}function Nc(e){const t=["itemId","type","dependencies","groups"];return ar(e,Object.keys(e).filter((e=>t.indexOf(e)<0))),e}async function Uc(e,t,r){if(!e)return Promise.reject(sr("The Solution Template id is missing"));let n=r||{};n.progressCallback&&n.progressCallback(1,n.jobId);const i=n.storageAuthentication?n.storageAuthentication:t;return function(e,t){return"string"==typeof e?Promise.all([un(e,t),ln(e,t)]).then((([e,t])=>Yo({item:e,data:t}))):function(e){let t=!1;const r=e=>null!=e&&"string"!=typeof e&&!Array.isArray(e)&&"object"==typeof e;return r(e)&&(t=["item","data"].reduce(((t,n)=>(t&&(t=r(e[n])),t)),!0)),t}(e)?Yo(e):Promise.reject(sr("getSolutionTemplateItem must be passed an item id or a model object"))}(e,i).then((e=>function(e){const t=e.typeKeywords;let r=!1;return"Solution"===e.type&&t.indexOf("Solution")>-1&&(t.indexOf("Template")>-1||t.indexOf("solutionTemplate")>-1)&&(r=!0),"Web Mapping Application"===e.type&&t.indexOf("hubSolutionTemplate")>-1&&(r=!0),r}(e.item)?Promise.all([Promise.resolve(e.item),Promise.resolve(e.data)]):Promise.reject(sr(`${e.item.id} is not a Solution Template`)))).then((e=>{const[r,o]=e,a=Kt(r,new Ht),s=o,u=a.id;return n=function(e,t,r){return e.jobId=e.jobId??t.id,e.title=e.title??t.title,e.snippet=e.snippet??t.snippet,e.description=e.description??t.description,e.tags=e.tags??t.tags,e.thumbnailurl=t.thumbnail?yn(t.id,t.thumbnail,!1,r):null,e}(n,a,i),function(e){const t=["accessInformation","appCategories","banner","categories","culture","description","documentation","extent","groupDesignations","industries","languages","licenseInfo","listed","name","properties","proxyFilter","screenshots","size","snippet","spatialReference","tags","title","type","typeKeywords","url"];ar(e,Object.keys(e).filter((e=>t.indexOf(e)<0)))}(a),Gc(u,a,s,t,n)})).then((e=>(n.progressCallback&&n.progressCallback(100,n.jobId),e)),(e=>(n.progressCallback&&n.progressCallback(1,n.jobId),Promise.reject(e)))).catch((e=>{throw e}))}function $c(e){return e?"&nbsp;"+e:""}function Bc(e){return({Group:"grp","Big Data Analytic":"bda","Feature Collection":"col","Feature Service":"svc",Feed:"fee","Geocoding Service":"xxx","Geodata Service":"xxx","Geometry Service":"xxx","Geoprocessing Service":"gs","Globe Service":"xxx","Image Service":"xxx",KML:"xxx","Map Service":"xxx","Network Analysis Service":"xxx","Real Time Analytic":"rta","Relational Database Connection":"xxx","Scene Service":"xxx","Stream Service":"xxx",Tool:"xxx","Vector Tile Service":"vts",WFS:"xxx",WMS:"xxx",WMTS:"xxx","Workflow Manager Service":"xxx","3D Web Scene":"xxx","Web Map":"map","Web Scene":"sc2",Application:"xxx","Data Store":"xxx","Desktop Application":"xxx","Excalibur Imagery Project":"xxx",Form:"frm","Hub Initiative":"hin","Hub Page":"hpg","Hub Site Application":"hsa","Insights Model":"xxx","Insights Page":"xxx","Insights Theme":"xxx","Insights Workbook":"xxx",Mission:"xxx","Mobile Application":"xxx","Native Application":"xxx",Notebook:"nbk","Oriented Imagery Catalog":"oic","Ortho Mapping Project":"xxx","QuickCapture Project":"qck","Site Application":"xxx","Site Initiative":"xxx","Site Page":"xxx",Solution:"sol",StoryMap:"sty","Urban Model":"xxx","Web Experience Template":"wxt","Web Experience":"wex","Web Mapping Application":"wma","Workforce Project":"wrk","360 VR Experience":"xxx","AppBuilder Extension":"xxx","AppBuilder Widget Package":"xxx","Application Configuration":"xxx","ArcGIS Pro Add In":"pro","ArcGIS Pro Configuration":"xxx","ArcPad Package":"xxx","Basemap Package":"xxx","CAD Drawing":"xxx","CityEngine Web Scene":"xxx","Code Attachment":"cod","Code Sample":"sam","Color Set":"xxx","Compact Tile Package":"xxx","CSV Collection":"xxx",CSV:"csv",Dashboard:"dsh","Data Pipeline":"dpl","Deep Learning Package":"xxx","Desktop Add In":"dai","Desktop Application Template":"dat","Desktop Style":"dst","Document Link":"doc","Explorer Add In":"xxx","Explorer Layer":"xxx","Explorer Map":"xxx","Feature Collection Template":"xxx","File Geodatabase":"xxx",GeoJson:"jsn",GeoPackage:"xxx","Geoprocessing Package":"gpk","Geoprocessing Sample":"geo","Globe Document":"xxx","Image Collection":"xxx",Image:"img","iWork Keynote":"xxx","iWork Numbers":"xxx","iWork Pages":"xxx","KML Collection":"xxx","Layer Package":"lyp","Layer Template":"xxx",Layer:"xxx",Layout:"xxx","Locator Package":"xxx","Map Document":"xxx","Map Package":"xxx","Map Template":"mpt","Microsoft Excel":"xls","Microsoft Powerpoint":"ppt","Microsoft Word":"wrd","Mobile Basemap Package":"xxx","Mobile Map Package":"xxx","Mobile Scene Package":"xxx","Native Application Installer":"xxx","Native Application Template":"xxx",netCDF:"xxx","Operation View":"opv","Operations Dashboard Add In":"xxx","Operations Dashboard Extension":"xxx",PDF:"xxx","Pro Layer Package":"xxx","Pro Layer":"xxx","Pro Map Package":"prm","Pro Map":"xxx","Pro Report":"xxx","Project Package":"ppk","Project Template":"prt","Published Map":"xxx","Raster function template":"xxx","Report Template":"xxx","Rule Package":"xxx","Scene Document":"xxx","Scene Package":"xxx","Service Definition":"xxx",Shapefile:"xxx","Statistical Data Collection":"xxx",Style:"sty","Survey123 Add In":"xxx","Symbol Set":"xxx","Task File":"xxx","Tile Package":"xxx","Toolbox Package":"xxx","Vector Tile Package":"xxx","Viewer Configuration":"xxx","Visio Document":"xxx","Window Mobile Package":"xxx","Windows Mobile Package":"xxx","Windows Viewer Add In":"xxx","Windows Viewer Configuration":"xxx",Workflow:"wfw","Workflow Manager Package":"xxx",Undefined:"und",Unsupported:"unk"}[e.type]||"xxx")+" "+e.itemId.substr(0,6)}function Wc(e,t){if(null==e||"object"!=typeof e)return e;const r={};return Object.keys(e).forEach((n=>{t.includes(n)?r[n]="...":r[n]=Wc(e[n],t)})),r}function Vc(e,t=0,r=[]){return new Promise((n=>{if(!e||0===e.size)return void n("<i>none</i>");const i=e,o=i.name||"";if(o.endsWith(".json")&&(e=Yi({blob:i,filename:o,mimeType:"application/json"})),"application/json"===e.type)Jt(e).then((i=>{t&&e.size>t&&r.length>0&&(i=Wc(i,r)),n(qc(i)+$c(o))}),(e=>n("<i>problem extracting JSON: "+e+"</i>")));else if(e.type.startsWith("text/plain")||"text/xml"===e.type||"application/xml"===e.type)Yt(e).then((e=>n(Hc(e)+$c(o))),(e=>n("<i>problem extracting text: "+e+"</i>")));else if(e.type.startsWith("image/")){let t='<img src="'+window.URL.createObjectURL(e)+'" style="max-width:256px;border:1px solid lightgray;"/>';o&&(t+='&nbsp;&nbsp;&nbsp;&nbsp;<a href="'+window.URL.createObjectURL(i)+'" download="'+o+'">'+o+"</a>"),t+="</p>",n(t)}else n(o?'<a href="'+window.URL.createObjectURL(i)+'" download="'+o+'">'+o+"</a>":'<a href="'+window.URL.createObjectURL(e)+'">'+e.type+"</a>")}))}function qc(e){return Hc(JSON.stringify(Kt(e),null,2))}function Hc(e){return'<textarea rows="10" style="width:99%;font-size:x-small">'+e+"</textarea>"}function Kc(e,t,r,n,i,o,a){return Gi({q:(new q).match(e).in("ownerfolder").and().match("Solution").in("type").and().match("Template").in("typekeywords"),num:100,authentication:t}).then((e=>{if(e.results.length>0){const s=e.results.map((e=>({id:e.id,title:e.title})));return Jc(s,s.length,t,r,n,i,o,a)}return Promise.resolve("<i>No solutions found in folder</i>")}))}function Jc(e,t,r,n,i,o,a,s){let u=null,c="",l=Promise.resolve("");return e.length>0&&(u=e.shift(),l=function(e,t,r,n,i,o,a,s){const u={jobId:t,progressCallback:i,consoleProgress:!0,storageAuthentication:r,enableItemReuse:o,templateDictionary:Zc(s)?{params:JSON.parse(s)}:{},dontCreateSolutionItem:a},c=n.portal.replace("/sharing/rest","");return Uc(e.id,n,u).then((t=>'Deployed solution "'+e.title+'" into <a href="'+c+"/home/item.html?id="+t+'" target="_blank">'+t+"</a><br/>"))}(u,t-e.length+"/"+t+' "'+u.title+'"',r,n,i,o,a,s)),l.then((u=>{c=u;let l=Promise.resolve("");return e.length>0&&(l=Jc(e,t,r,n,i,o,a,s)),l})).then((e=>c+e))}function Zc(e){let t={};try{t=JSON.parse(e)}catch(e){return!1}return Object.keys(t).length>0}function Yc(e,t,r,n,i,o,a){const s=Date.now(),u=[];let c=Promise.resolve("<i>No Solution(s) provided</i>");const l=function(e,t,r){r&&u.push(r.data);let n="Deploying "+t+"..."+e.toFixed().toString()+"%<br><br>Finished items:<ol>";u.forEach((function(e){return n+="<li>"+e+"</li>"})),n+="</ol>",document.getElementById("output").innerHTML=n};e.length>0?c=function(e,t,r,n,i,o,a){const s={jobId:e,progressCallback:n,consoleProgress:!0,storageAuthentication:t,enableItemReuse:i,templateDictionary:Zc(a)?{params:JSON.parse(a)}:{},dontCreateSolutionItem:o};return Uc(e,r,s).then((e=>{return o?"Deployed solution":(t=e,n=r,new Promise(((e,r)=>{t?io(t,n).then((async t=>{const o=function(e){return vn(e).replace("/sharing/rest","")}(n);await async function(e,t,r,n){console.log("item.base",t.base),console.log("item.data",t.data),console.log("item.thumbnail",t.thumbnail),console.log("item.metadata",t.metadata),console.log("item.resources",JSON.stringify(t.resources)),console.log("item.fwdRelatedItems",JSON.stringify(t.fwdRelatedItems)),console.log("item.revRelatedItems",JSON.stringify(t.revRelatedItems)),console.log("item.featureServiceProperties",JSON.stringify(t.featureServiceProperties));let i=`\n    <h3>${t.base.type} "${t.base.title}" ( <a href="${e}/home/item.html?id=${t.base.id}" target="_blank">${t.base.id}</a> )</h3>\n    `;if(i+='<div style="width:48%;display:inline-block;">Item</div><div style="width:2%;display:inline-block;"></div><div style="width:48%;display:inline-block;">Data</div><div style="width:48%;display:inline-block;">'+qc(t.base)+'</div><div style="width:2%;display:inline-block;"></div><div style="width:48%;display:inline-block;vertical-align:top;" id="dataSection"><span style="font-style:italic">Rendering</span></div>',i+="<p>Thumbnail<br/><div>",i+=await Vc(t.thumbnail),i+="</div></p>",i+="<p>Metadata<br/><div>",i+=await Vc(t.metadata),i+="</div></p>",i+="<p>Resources<br/>",0===t.resources.length)i+="<p><i>none</i>";else{i+="<ol>";for(const e of t.resources)i+="<li><div>",i+=await Vc(e),i+="</div></li>";i+="</ol>"}if(i+="</p>",i+="<p>Related Items<br/>",0===t.fwdRelatedItems.length&&0===t.revRelatedItems.length)i+="<p><i>none</i>";else{i+="<ul style='margin-left:-36px;list-style-type:none;font-size:smaller;'>";for(const e of t.fwdRelatedItems)i+='<li><span style="font-size:x-large">&rarr;</span> '+e.relationshipType+" "+JSON.stringify(e.relatedItemIds)+"</li>";for(const e of t.revRelatedItems)i+='<li><span style="font-size:x-large">&larr;</span> '+e.relationshipType+" "+JSON.stringify(e.relatedItemIds)+"</li>";i+="</ul>"}if(i+="</p>",t.featureServiceProperties)return i+="<p>Feature Service Properties<br/>",i+="<p><i>Service description</i><br/>"+qc(t.featureServiceProperties.service)+"</p>",i+="<p><i>Layers</i>",t.featureServiceProperties.layers.forEach((e=>i+=qc(e))),i+="</p>",i+="<p><i>Tables</i>",t.featureServiceProperties.tables.forEach((e=>i+=qc(e))),i+="</p>",i+="</p>",i;"Solution"===t.base.type&&r&&n&&(i+='<p>Solution Dependency Graph<br/><div id="topologicalSortGraphic"><i>Drawing...</i></div>',setTimeout((()=>{const e=document.getElementById("topologicalSortGraphic");e&&r&&n&&(e.innerHTML="",Jt(t.data).then((t=>{!function(e,t,r,n,i,o){const a=new o.Graph;e.map((e=>e.itemId)).forEach((t=>{const r=e.find((e=>e.itemId===t));(r.dependencies||[]).forEach((function(t){const n=e.find((e=>e.itemId===t));a.addEdge(Bc(r),Bc(n),{directed:!0})}))})),new o.Layout.Spring(a).layout(),new o.Renderer.Raphael(t,a,1400,1600).draw()}(t.templates,e,0,0,0,n)})))}),3e3));const o=await Vc(t.data,1e6,["drawingInfo"]);return setTimeout((()=>{const e=document.getElementById("dataSection");e&&o&&(e.innerHTML=o)}),2e3),i}(o,t,i,a).then((t=>e(t)),r)}),r):r("Item's ID is not defined")})));var t,n,i,a}))}(e,r,n,l,i,o,a):t.length>0&&(c=Kc(t,r,n,l,i,o,a)),c.then((function(e){Qc(s),document.getElementById("output").innerHTML=e}),(function(e){const t=e?.error||JSON.stringify(e)||"Unspecified error";Qc(s),document.getElementById("output").innerHTML='<span style="color:red">'+t+"</span>"}))}function Xc(e){e&&localStorage.setItem("__SOLUTION_JS_USER_SESSION__",e.serialize())}function Qc(e){var t=Date.now();console.log("Elapsed time: "+((t-e)/1e3).toFixed(1)+" seconds")}fetchFoldersFcn=function(){const e=ua("srcPortal"),t=((e.endsWith("/")?e.slice(0,-1):e)||"https://www.arcgis.com")+"/sharing/rest",r=new ye({username:ua("srcUsername"),password:ua("srcPassword"),portal:t}),n=document.getElementById("foldersPicklist");for(let e=n.options.length-1;e>=0;e--)n.remove(e);var i;n.add(document.createElement("option")),(i=r,function(e){var t=e.folderId,r=e.start,n=void 0===r?1:r,i=e.num,o=void 0===i?10:i,a=e.authentication,s=t?"/"+t:"";return F(e).then((function(t){return(0,R.e)(e)+"/content/users/"+t+s})).then((function(e){return(0,C.Em)(e,{httpMethod:"GET",authentication:a,params:{start:n,num:o}})}))}({authentication:i}).then((e=>e.folders.map((e=>({id:e.id,title:e.title})))))).then((e=>{e.forEach((e=>{var t=document.createElement("option");t.value=e.id,t.text=e.title+" ( "+e.id+" )",n.add(t)}))}))},goFcn=function(){document.getElementById("input").style.display="none",document.getElementById("output").style.display="block";const e=ua("solutionId")||ua("solutionPicklist"),t=ua("foldersPicklist"),r=sa("useExistingChk"),n=sa("dontCreateSolutionItem"),i=ua("customParams"),o=ua("srcPortal"),a=((o.endsWith("/")?o.slice(0,-1):o)||"https://www.arcgis.com")+"/sharing/rest",s=new ye({username:ua("srcUsername"),password:ua("srcPassword"),portal:a}),u=ua("destPortal"),c=((u.endsWith("/")?u.slice(0,-1):u)||"https://www.arcgis.com")+"/sharing/rest";let l;if(sa("destAuthType")){let o=window.location.origin+window.location.pathname;const a=o.lastIndexOf("/");o=o.slice(0,a);const u=ua("clientId");ye.beginOAuth2({clientId:u,redirectUri:o+"/authenticate.html?clientID="+u,popup:!0}).then((function(o){tl=o,Xc(tl),Yc(e,t,s,tl,r,n,i)})).catch((function(e){console.log(e)}))}else l=new ye({username:ua("destUsername"),password:ua("destPassword"),portal:c,clientId:ua("clientId")}),Yc(e,t,s,l,r,n,i)},updateDestAuthFcn=function(e){var t=document.getElementById("destCredentials"),r=document.getElementById("clientIdParent");e.checked?(r.classList.remove("display-none"),t.classList.add("display-none")):(r.classList.add("display-none"),t.classList.remove("display-none"))};const el=document.getElementById("solutionPicklist");el.add(document.createElement("option")),function(e,t){const r="type: Solution typekeywords:Solution,Template",n=new ye({portal:"https://www.arcgis.com/sharing/rest"}),i={sortField:"title",sortOrder:"asc"},o=[];return t&&o.push(Ni(t,r,n,i)),Promise.all(o).then((e=>{let t=[];1===e.length?t=e[0].results:2===e.length&&(t=e[0].results.concat(e[1].results));const r=Kt(t),n=[];return r.forEach((e=>{let t="";(e.typeKeywords||[]).some((e=>!!e.startsWith("solutionversion-")&&(t=e.substring(16),!0)));const r={id:e.id,title:e.title,version:t};n.push(r)})),Promise.resolve(n)}))}(0,"966b251241bb4e3bb9ee3f2b92921aa5").then((e=>{e.forEach((e=>{var t=document.createElement("option");t.value=e.id,t.text=e.title+" ( "+e.id+" )",el.add(t)}))}));let tl=null;const rl=localStorage.getItem("__SOLUTION_JS_USER_SESSION__");if(null!==rl&&"undefined"!==rl){let e=JSON.parse(rl);e.tokenExpires=new Date(e.tokenExpires),tl=new ye(e),localStorage.removeItem("__SOLUTION_JS_USER_SESSION__")}Xc(tl),document.getElementById("container").style.display="block"})()})();